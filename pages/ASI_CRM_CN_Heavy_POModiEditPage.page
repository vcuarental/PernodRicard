<apex:page standardController="ASI_TH_CRM_Contract__c" extensions="ASI_CRM_CN_EditHeavyContractDetailCtrl" docType="html-5.0" sidebar="false">
    
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv='cache-control' content='no-cache'/>
    <meta http-equiv='expires' content='0'/>
    <meta http-equiv='pragma' content='no-cache'/>
    
    <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, '/bower_components/Font-Awesome/css/font-awesome.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, '/bower_components/Font-Awesome/css/font-awesome.min.css')}" />    
    <apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.ASI_Library, 'dist/css/bootstrap.min.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery1.10.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_Library, 'dist/js/bootstrap.min.js')}" />
    
    <style>
        .AlignRight{
        text-align: right  !important;
        font-weight: bold !important;
        }
        
        .BSCommandButton{
        color: #333 !important;
        background-color: #fff !important;
        border-color: #ccc !important;
        margin-left: 0.5em !important; 
        margin-right: 0.5em !important; 
        margin-bottom: 0.5em !important;
        padding: 3px 6px !important; 
        }
        
        .BSCommandButtonSM{
        font-size: 12px;
        color: #333 !important;
        background-color: #fff !important;
        border-color: #ccc !important;
        margin-left: 0.5em !important;
        margin-right: 0.5em !important;
        margin-bottom: 0 !important;
        padding: 2.5px 5px !important;
        margin-top: -0.3em;
        }
        
        .HeaderCss{
        color: #fff;
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
        background-color: #337ab7;
        border: 1px solid transparent;
        border-color: #337ab7;
        padding: 10px 15px;
        text-align: center;
        }
        
        .PanelBody{
        padding: 0.3em; 
        background-color: #fff; 
        border: 1px solid transparent;
        border-color: #337ab7;
        border-bottom-left-radius: 3px;
        border-bottom-right-radius: 3px;
        border-top-right-radius: 3px;
        }
        
        
        .FontWeightCSS{
        font-weight: bold;
        }
        
        .ApexInputNumberField{
        text-align: right;
        padding: 3px 6px; 
        border: 1px solid #ccc; 
        border-radius: 4px;
        }
        
        .InputNumberFieldwidth{
        width: 10em !important;
        }
        
        
        
        
        .style-1 input[type="text"] {
        padding: 5px 10px;
        font-size: 12px;
        line-height: 1.5;
        border-radius: 3px;
        width:80%;
        color: #555;
        background-color: #fff;
        background-image: none;
        border: 1px solid #ccc;
        
        }
        
        .GridColumn1{
        grid-column-start: 1 !important; 
        grid-column-end: 1 !important;
        }
        
        .GridColumn2{
        grid-column-start: 2 !important; 
        grid-column-end: 2 !important;
        }
        
        .GridColumn3{
        grid-column-start: 3 !important; 
        grid-column-end: 3 !important;
        }
        
        .GridColumn4{
        grid-column-start: 4 !important; 
        grid-column-end: 4 !important;
        }
        
        .GridColumn5{
        grid-column-start: 5 !important; 
        grid-column-end: 5 !important;
        }
        
        
        .GridColumn6{
        grid-column-start: 6 !important; 
        grid-column-end: 6 !important;
        }
        
        .GridColumn7{
        grid-column-start: 7 !important; 
        grid-column-end: 7 !important;
        }
        
        .MethodologyLabel{
        font-weight: bold !important; 
        text-align: right !important;
        }
        
        .requiredField{
        border-left: 3px solid red !important;
        }
        
        
        
        .ui-autocomplete span.hl_results {
        background-color: #ffff66;
        }
        
        /* loading - the AJAX indicator */
        .ui-autocomplete-loading {
        background: white url('/img/loading.gif') right center no-repeat;
        }
        
        .ui-autocomplete {
        height: 200px;
        overflow-y: auto;
        /* prevent horizontal scrollbar */
        overflow-x: hidden;
        overflow:auto;
        /* add padding to account for vertical scrollbar */
        padding-right: 20px;
        left: 0;
        }
        
        .overPaid{
        color: red;
        font-weight: bold;
        }
    </style>
    
    
    <script type='text/javascript'>
    
    var NoOfMonths=1;
    var BRSFClickAddNew= false; // BRSF Onclick new Line
    var PSFClickAddNew= false; // PSF Onclick new Line
    var VECClickAddNew= false;// VEC Onclick new Line
    var SubBrands =[];
    var CommercialTeam='';
    var Region='';
    var CityTier='';
    
    $(document).on('mousemove', function(e){
        $('#loadtext').css({
            left:  e.pageX,
            top:   e.pageY
        });
        
        $('input[type=text]').on('keydown', function(e) {
            if (e.which == 13) {
                e.preventDefault();
            }
        });
    });
    
    
    
    window.onload = function() {
        $('input[type=text]').blur(); 
        $('input[type=text]').on('keydown', function(e) {
            if (e.which == 13) {
                e.preventDefault();
            }
        });
    };
    
    
    $(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip();  
        CommercialTeam='{!ContractSelected.ASI_CRM_CN_Outlet_WS__r.ASI_CRM_CN_Commercial_Team__c}';
        Region='{!ContractSelected.ASI_CRM_CN_Outlet_WS__r.ASI_CRM_CN_Region__c}';
        CityTier='{!ContractSelected.ASI_CRM_CN_Outlet_WS__r.ASI_CRM_CN_CCity__r.ASI_CRM_CN_City_Tier__c}';
        
        NoOfMonths = '{!ContractSelected.ASI_CRM_CN_No_of_Months__c}';
        var BrandList=document.getElementsByClassName("bPageFooter");
        for( var i=0; i<BrandList.length ; i++){
            BrandList[i].innerHTML='';
        }
        BRSFClickAddNew= false;
        CheckingVolumeBase();
        retrieveSBBrand();
    });
    
    
    
    
    //Sub-Brand
    function retrieveSBBrand(){
        var whereClause =   ' WHERE RecordType.DeveloperName = \'ASI_FOC_CN_Sub_brand\'  and ASI_CRM_CN_Sub_brand_Grade__c!=null and  ASI_MFM_Brand__r.ASI_CRM_CN_Competitor__c =FALSE and ASI_MFM_Active_for_CRM__c=TRUE  and ASI_MFM_Sub_brand_Code__c != \'999\'  '
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.ASI_CRM_CN_EditHeavyContractDetailCtrl.FindSubBrandList}','ASI_MFM_Sub_brand__c', whereClause ,CommercialTeam,Region,CityTier
            , callbackSBBrand
            , {escape: true}
        );       
    }
    
    
    function callbackSBBrand(result, event){
        if (event.status) {
            if (result) {
                SubBrands = [];
                var size = result.length;
                console.log(result.length);
                for (var i = 0; i < size; i++) {
                    var sb = new Object(); 
                    
                    sb.label =  htmlEncode(result[i]["Name"]);
                    sb.value =  htmlEncode(result[i]["Id"]);
                    sb.SBGradeId =  htmlEncode(result[i]["ASI_CRM_CN_Sub_brand_Grade__c"]);
                    sb.SBGrade =  htmlEncode(result[i]["ASI_CRM_CN_Sub_brand_Grade__r"]["ASI_CRM_Chinese_Name__c"]);// console.log(result[i]["ASI_CRM_CN_Sub_brand_Grade__r"]["Name"]);
                    sb.BRSFIncentive=result[i]["ASI_CRM_Incentive_Central__c"];
                    sb.BRSFMaxIncentive=result[i]["ASI_CRM_Incentive_East__c"];
                    sb.PSFIncentive=result[i]["ASI_CRM_Incentive_North__c"];
                    sb.PSFMaxIncentive=result[i]["ASI_CRM_Incentive_North_West__c"];
                    SubBrands.push(sb);
                }
                console.log('Finished initalizeAutoCompleteComponent ');
            }
        } else {
            
        }   
        initalizeAutoCompleteComponent();
    }
    
    
    function initalizeAutoCompleteComponent(){
        // SuB-Brand
        $(".SubBrandClass").autocomplete({
            source: 
            SubBrands,
            response: function(event, ui) {
                console.log('response');
                if(ui.content.length===0){ 
                    console.log("No result found");
                }
            },
            minLength: 0,
            scroll: true,
            change: function (event, ui) {
                console.log('change');
                if(!ui.item) {//this.value = '';//
                    console.log('remove!!!');
                }
            },select: function(event, ui){
                $(this).val(ui.item.label);
                $(this).next().next().children().val(ui.item.value);
                
                
                var ClassNames = $(this).attr("class"); 
                var ClassNameList = ClassNames.split(" ");
                
                var IsBRSF=false;
                var IsPSF=false;
                var IsVEC=false;
                
                for(var j=1;j<ClassNameList.length;j++){//console.log(ClassNameList[j]);
                    if(ClassNameList[j].indexOf('BRSFSubBrandsClass')!== -1){
                        IsBRSF=true;
                    }
                    if(ClassNameList[j].indexOf('PSFSubBrandsClass')!== -1){
                        IsPSF=true;
                    }
                    
                }
                
                if(ClassNameList[0].indexOf('SubBrandsClass_') !== -1){
                    var LineId= ClassNameList[0].replace('SubBrandsClass_','');
                    //changing Sub-Brand Grade
                    $('#SBGrade_'+LineId).html('<a  href="/"'+ui.item.SBGradeId+'" >'+ui.item.SBGrade +'</a>'); 
                    console.log(IsBRSF);
                    if(IsBRSF){
                        $('#ContractPerBottle_'+LineId).attr('data-Incentive',ui.item.BRSFMaxIncentive)
                        $('#ContractPerBottle_'+LineId)[0].childNodes[0].value=ui.item.BRSFIncentive;
                        $('#ContractPerBottle_'+LineId)[0].childNodes[0].style='';                        
                        if(BRSFClickAddNew){
                            $('#EstPerBottle_'+LineId)[0].textContent= formatNumber(ui.item.BRSFIncentive.toFixed(2));
                        }else{
                            $('#EstPerBottle_'+LineId)[0].childNodes[0].textContent= formatNumber(ui.item.BRSFIncentive.toFixed(2));
                        }
                    }
                    
                    if(IsPSF){
                        $('#PSFContractPerBottle_'+LineId).attr('data-Incentive',ui.item.PSFMaxIncentive)
                        $('#PSFContractPerBottle_'+LineId)[0].childNodes[0].value=ui.item.PSFIncentive;
                        $('#PSFContractPerBottle_'+LineId)[0].childNodes[0].style='';
                        
                        if(PSFClickAddNew){
                            $('#PSFEstPerBottle_'+LineId)[0].textContent= formatNumber(ui.item.PSFIncentive.toFixed(2));
                        }else{
                            $('#PSFEstPerBottle_'+LineId)[0].childNodes[0].textContent= formatNumber(ui.item.PSFIncentive.toFixed(2));
                        }
                    }
                    
                }
                
                event.preventDefault();
            },
            focus: function(event, ui){//$j(this).val(ui.item.label);
                event.preventDefault();
            }
        })
        
        
    }
    
    
    
    
    //After interface with database
    function Rerender(){
        initalizeAutoCompleteComponent();
        CheckingVolumeBase();
        $('[data-toggle="tooltip"]').tooltip(); 
    }
    function InitTooltip(){
        $('[data-toggle="tooltip"]').tooltip(); 
    }
    
    
    //******************************************BRSF function******************************************
    function BRSFNewLine(){
        BRSFClickAddNew=true;
    }
    
    
    
    function ChangingSubBrand(thatId,PSFModuleId){
        //SubBrands                                   
        var SelectedSBBrand = $('.SubBrandsClass_'+thatId).val();//console.log($('.SubBrandsClass_'+thatId).attr('class'));
        
        var ClassNames = $('.SubBrandsClass_'+thatId).attr('class'); 
        
        var ClassNameList = ClassNames.split(" ");
        
        var IsBRSF=false;
        var IsPSF=false;
        for(var j=1;j<ClassNameList.length;j++){
            if(ClassNameList[j].indexOf('BRSFSubBrandsClass')!== -1){
                IsBRSF=true;
            }
            if(ClassNameList[j].indexOf('PSFSubBrandsClass')!== -1){
                IsPSF=true;
            }
            
        }
        
        for (var i = 0; i <SubBrands.length; i++) {
            if(SubBrands[i].label ==SelectedSBBrand){
                console.log(SubBrands[i]);
                $('#SBGrade_'+thatId).html('<a  href="/"'+SubBrands[i].SBGradeId+'" >'+ SubBrands[i].SBGrade +'</a>'); 
                
                if(IsBRSF){
                    $('#ContractPerBottle_'+thatId).attr('data-Incentive',SubBrands[i].BRSFMaxIncentive)
                    $('#ContractPerBottle_'+thatId)[0].childNodes[0].value=SubBrands[i].BRSFIncentive;
                    $('#ContractPerBottle_'+thatId)[0].childNodes[0].style='';                        
                    if(BRSFClickAddNew){
                        $('#EstPerBottle_'+thatId)[0].textContent= formatNumber(SubBrands[i].BRSFIncentive.toFixed(2));
                    }else{
                        $('#EstPerBottle_'+thatId)[0].childNodes[0].textContent= formatNumber(SubBrands[i].BRSFIncentive.toFixed(2));
                    }
                    BRSFCalculation();
                }
                
                if(IsPSF){
                    $('#PSFContractPerBottle_'+thatId).attr('data-Incentive',SubBrands[i].PSFMaxIncentive)
                    $('#PSFContractPerBottle_'+thatId)[0].childNodes[0].value=SubBrands[i].PSFIncentive;
                    $('#PSFContractPerBottle_'+thatId)[0].childNodes[0].style='';
                    
                    if(PSFClickAddNew){
                        $('#PSFEstPerBottle_'+thatId)[0].textContent= formatNumber(SubBrands[i].PSFIncentive.toFixed(2));
                    }else{
                        $('#PSFEstPerBottle_'+thatId)[0].childNodes[0].textContent= formatNumber(SubBrands[i].PSFIncentive.toFixed(2));
                    }
                    PSFCalculation(PSFModuleId);
                }
                
            }
        }
        
    }
    
    
    function BRSFCalculation(){
        //Contract Volume
        CalculateTotalInputField('BRSFContractQtyClass','BRSFTotalContractMonthlyQty');
        //Estimate Volume
        CalculateTotalInputField('BRSFContractEstClass','BRSFTotalEstMonthlyQty');
        //Contract Incentive  //CalculateTotalInputField('BRSFContractIncentive','BRSFTotalEstBRSFPerBottle');
        //Estimate Incentive   // CalculateReadOnlyFieldAmount('BRSFEstimateIncentive','BRSFTotalContractBRSFPerBottle');
        //Contract Total 
        CalculateReadOnlyFieldAmount('BRSFContractTotal','BRSFContractTotalPart');
        //Estimate Total
        CalculateReadOnlyFieldAmount('BRSFEstimateTotal','BRSFEstTotalPart');
        
    }
    
    function PSFCalculation(ModuleId){
        CalculateTotalInputField('PSFContractMonthlyQty_'+ModuleId,'TotalPSFContractQty_'+ModuleId);
        CalculateTotalInputField('PSFEstimateMonthlyQty_'+ModuleId,'TotalPSFEstimateQty_'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFContractDummyTotalClass_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFEstDummyTotalClass_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        console.log('* Enter PSFCalculation **');
    }
    
    function SettingNextAmount(that){
        var CurrentAmount =that.value;
        if(!CurrentAmount){
            CurrentAmount=0;
        }//console.log(CurrentAmount);
        if(BRSFClickAddNew){
            that.parentElement.nextSibling.textContent=formatNumber(Number(CurrentAmount).toFixed(2));
        }else{
            that.parentElement.nextSibling.nextSibling.childNodes[0].textContent=formatNumber(Number(CurrentAmount).toFixed(2));
        }
        CalBRSF_ContractTotal(that.parentElement.getAttribute('data-id'));
        CalBRSF_EstTotal(that.parentElement.getAttribute('data-id'));
    }
    
    
    
    
    
    
    
    //BRSF  : base on user input to check if incentive large then mas incentive 
    function BRSFCheckOverPaid(row,that){
        var rowId = that.parentElement.getAttribute('data-id');
        var MaxIncentive = Number($('#ContractPerBottle_'+rowId).attr('data-Incentive'));
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>MaxIncentive){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
    }
    
    //Calculate BRSF ContractTotal Field
    function CalBRSF_ContractTotal(rowId){    
        var ContractTotal =0.0,ContractQty=0.0,ContractPerBottle=0.0;
        ContractQty=$('#ContractQty_'+rowId)[0].childNodes[0].value;
        ContractPerBottle=$('#ContractPerBottle_'+rowId)[0].childNodes[0].value;
        
        if(!ContractQty){
            ContractQty=0;
        }
        if(!ContractPerBottle){
            ContractPerBottle=0;
        }
        if(ContractPerBottle && ContractQty){
            ContractTotal=Number(ContractQty.replace(/,/g, ''))* Number(ContractPerBottle.replace(/,/g, '')) * Number(NoOfMonths); //console.log('ContractTotal : '+ContractTotal);
            if(BRSFClickAddNew){
                $('#ContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
            }else{
                $('#ContractTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(ContractTotal.toFixed(2));
            }
        }
        CalculateReadOnlyFieldAmount('BRSFContractTotal','BRSFContractTotalPart');
    }
    
    
    
    function ChangingPSFSubBrand(ModuleID, LineId){
        ChangingPSFSubBrandActionFunction(ModuleID,LineId); 
    }
    
    
    function CalBRSF_EstTotal(rowId){
        var EstTotal =0.0;
        var EstQty=$('#EstQty_'+rowId)[0].childNodes[0].value;
        var EstPerBottle=0.0; 
        
        if(BRSFClickAddNew){
            EstPerBottle=$('#EstPerBottle_'+rowId)[0].textContent;
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);//console.log('log 2.3 :  : ' +  EstTotal );console.log($('#EstTotal_'+rowId)[0].textContent);
                $('#EstTotal_'+rowId)[0].textContent=formatNumber(EstTotal.toFixed(2));//'EstTotal ; 
            }
        }else{
            EstPerBottle=$('#EstPerBottle_'+rowId)[0].childNodes[0].textContent;
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#EstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
            }
        }
        
        CalculateTotalInputField('BRSFContractEstClass','BRSFTotalEstMonthlyQty');
        CalculateReadOnlyFieldAmount('BRSFEstimateTotal','BRSFEstTotalPart');
    }
    
    
    function PSFNewLine(){
        PSFClickAddNew=true;
    }
    
    
    
    function ChangingVECSubBrand(that){
        ChangingVECSubBrandActionFunction(that); 
    }
    
    
    function SettingEstTotal(that){
        CalBRSF_EstTotal(that.parentElement.getAttribute('data-id'));
    }
    
    //Shared function
    function formatNumber(n) {
        return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    function CheckingVolumeBase(){    //By Sub-Brand :0; By Grade     :1; By Category  :2; By Total     :3         
        $('.VolumeBaseCls').each(function() {
            var SectionId=$(this)[0].id;
            SettingUnit(SectionId);
        });
    }
    
    
    function changingVolumeBase(that){
        SettingUnit(that.parentElement.getAttribute('id'));
    }    
    
    
    function SettingUnit (ThatId){
        var SelectSection= document.getElementById(ThatId).children[0];
        var selectOpt;
        var SelectValue;
        
        if(SelectSection){
            selectOpt = SelectSection.options; 
            SelectValue = selectOpt[SelectSection.selectedIndex].value;
        }
        
        
        var rowId = ThatId.substring(3, ThatId.length);
        var UnitSection = document.getElementById('UN_'+rowId).children[0];
        
        var UnitOpt ;//= UnitSection.options;
        if(UnitSection && SelectSection){
            UnitOpt = UnitSection.options;
            if(typeof UnitOpt.length != 'undefined') {
                for(var i=UnitOpt.length;i>0;i--){//console.log(i);
                    UnitOpt.remove((i-1));
                }
            }
            if(SelectValue =='By Sub-Brand'){//UnitOpt.remove(1);
                var newOption = document.createElement("option");
                newOption.text = 'Std. Btl.(标准瓶)';
                newOption.value = 'Std. Btl.';
                UnitSection.appendChild(newOption);
            }
            
            if(SelectValue =='By Category' || SelectValue=='By Total'){//UnitOpt.remove(0);
                var newOption = document.createElement("option");
                newOption.text = 'CR12 Extra Eqv.(折芝华士新境12年)';
                newOption.value = 'CR12 Extra Eqv.';
                UnitSection.appendChild(newOption);
            }
            
            if(SelectValue =='By Grade'){
                var newOption1 = document.createElement("option");
                newOption1.text = 'CR12 Extra Eqv.(折芝华士新境12年)';
                newOption1.value = 'CR12 Extra Eqv.';
                newOption1.selected =true;
                UnitSection.appendChild(newOption1);
                
                var newOption2 = document.createElement("option");
                newOption2.text = 'Std. Btl.(标准瓶)';
                newOption2.value = 'Std. Btl.';
                
                UnitSection.appendChild(newOption2);
            }
            
        }
        
        
    }
    
    
    
    //**************************PSF Function Start**************************************************************************************************************************
    
    
    //PSF Changing next amount
    function PSFChangingNextAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        
        
        //Set Estimate Volume Field 
        $('#PSFEstQty_'+rowId)[0].childNodes[0].value=that.value;
        CalPSFContractTotal(rowId);
        CalPSF_EstTotal(rowId);
        //Calculate Total Amount
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('PSFContractMonthlyQty_'+ModuleId,'TotalPSFContractQty_'+ModuleId);
        CalculateTotalInputField('PSFEstimateMonthlyQty_'+ModuleId,'TotalPSFEstimateQty_'+ModuleId);
        
        CalculateReadOnlyFieldAmount('PSFContractDummyTotalClass_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        
        CalculateReadOnlyFieldAmount('PSFEstDummyTotalClass_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
        
    }
    
    //Batch 2: Calculate Total Estimate Amount By Sub-Brand 
    function SetEstimatePSFPerBottle(that){
        var CurrentAmount =that.value;
        
        //console.log('SetEstimatePSFPerBottle  ' + CurrentAmount );
        //attr("Incentive",CurrentAmount); 
        var rowId= that.parentElement.getAttribute('data-id');
        that.parentElement.setAttribute("Incentive",CurrentAmount);
        
        
        if(PSFClickAddNew){//
            $('#PSFEstPerBottle_'+rowId)[0].textContent=that.value;
        }else{
            $('#PSFEstPerBottle_'+rowId)[0].childNodes[0].textContent= that.value;
        }
        //CalPSFContractTotal(rowId);
        CalPSF_EstTotal(rowId);
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        Cal999Line(ModuleId);
        //CalculateReadOnlyFieldAmount('PSFContractDummyTotalClass_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFEstDummyTotalClass_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
        CalculateAllPSFEstimateAmount();
    }
    
    function Cal999Line(ModuleId){
        var AdjustAmount=0;
        var DiffMonth= Number('{!DiffMonth}');
        console.log('----DiffMonth : '+DiffMonth);
        
        $('.PSFEstimateIncentiveClass_'+ModuleId).each(function(){
            //console.log($(this).attr('data-Volume'));
            var Volume=Number( StringToNumberStr($(this).attr('data-Volume')));
            //console.log( 'PSF Incentive Now : ' + StringToNumberStr($(this).attr('Incentive') )   );//.context.textContent  Incentive 
            //var Incentive = Number( StringToNumberStr($(this).children().context.textContent));;
            var Incentive = Number( StringToNumberStr($(this).attr('Incentive') ) );;
            
            AdjustAmount += Incentive*Volume*DiffMonth;
            console.log('$$$ Calculate by Line '+ Incentive+'*'+Volume+'*'+DiffMonth);
        });
        //console.log('Now AdjustAmount : '+AdjustAmount);
        
        
        $('.AdjustmentLine_'+ModuleId).each(function(){
            // console.log('*&****AdjustmentLine_  ');
            //console.log( $(this).children().context.textContent );
            
            $(this).children().context.textContent = formatNumber(AdjustAmount.toFixed(2)) ;
        });
        
        //AdjustmentLine_
    }
    
    //Batch 2:  Calculate All PSF Estimate Amount in All Module(Read-Only // Read Module)
    function CalculateAllPSFEstimateAmount(){
        console.log('***********CalculateAllPSFEstimateAmount*********');
        var TotalAmount=0;
        $('.EstimateTotalClass').each(function(){//
            console.log( $(this).children().context.textContent );
            TotalAmount+=Number( StringToNumberStr($(this).children().context.textContent) );
        });
        
        //set Expected_PSF_Est_Total Amount  console.log($('#Expected_PSF_Est_Total')[0].childNodes[0].value+'***&&***'+TotalAmount); 
        $('#Expected_PSF_Est_Total')[0].childNodes[0].value=TotalAmount;
        PSFGrandEstimateTotal( $('#Expected_PSF_Est_Total')[0].childNodes[0]);
    }
    
    
    
    function PSFCheckOverPaid(row,that){
        var rowId = that.parentElement.getAttribute('data-id');
        var MaxIncentive = Number($('#PSFContractPerBottle_'+rowId).attr('data-Incentive'));
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>MaxIncentive){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
        
    }
    
    
    //Calculate PSF Contract total
    function CalPSFContractTotal(rowId){
        var ContractTotal =0.0,ContractQty=0.0,ContractPerBottle=0.0;
        ContractQty=$('#PSFContractQty_'+rowId)[0].childNodes[0].value;
        ContractPerBottle=$('#PSFContractPerBottle_'+rowId)[0].childNodes[0].value;
        if(ContractPerBottle && ContractQty){
            ContractTotal=Number(ContractQty.replace(/,/g, ''))* Number(ContractPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
            if(PSFClickAddNew){
                $('#PSFContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
            }else{
                try {
                    $('#PSFContractTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(ContractTotal.toFixed(2));
                }  catch(err) {
                    $('#PSFContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
                }
            }
        }
    }
    
    
    
    function SettingPSFEstTotal(that){//console.log('***********SettingPSFEstTotal  ');
        CalPSF_EstTotal(that.parentElement.getAttribute('data-id'));
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('PSFEstimateMonthlyQty_'+ModuleId,'TotalPSFEstimateQty_'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFContractDummyTotalClass_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFEstDummyTotalClass_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
    }
    
    
    function CalPSF_EstTotal(rowId){
        var EstTotal =0.0;
        var EstQty=$('#PSFEstQty_'+rowId)[0].textContent; //var EstQty=$('#PSFEstQty_'+rowId)[0].childNodes[0].value;//
        console.log($('#PSFEstQty_'+rowId)[0].textContent+    ' $$$ Now EstQty !!:'+EstQty);
        var EstPerBottle=0.0;
        if(PSFClickAddNew){
            EstPerBottle=$('#PSFEstPerBottle_'+rowId)[0].textContent;
            if(EstQty && EstPerBottle){//
                console.log(EstQty+ 'enter PSFClickAddNew  '+EstPerBottle);
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#PSFEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal.toFixed(2));
            }
        }else{
            EstPerBottle=$('#PSFEstPerBottle_'+rowId)[0].childNodes[0].textContent;
            if(EstQty && EstPerBottle){//
                console.log('enter EstPerBottle : '+EstPerBottle);
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);// 
                console.log('Now EstTotal : '+EstTotal);
                try {
                    $('#PSFEstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
                }catch(err) {
                    $('#PSFEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal.toFixed(2));
                }
            }
        }
    }
    
    
    //Delete PSF Module
    function DeleteModule(that){
        paraDeletePSFModule(that.id);
    }
    
    
    //Setting Estimate Dummy Total Amount when changing contract total input field
    function PSFSetEstDummyTotalAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        $('#PSFEstDummyTotal_'+rowId)[0].childNodes[0].value=that.value;
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('PSFContractTotalDummy_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        CalculateTotalInputField('PSFEstTotalDummy_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
    }
    
    
    function PSFChangeEstDummyTotalAmount(that){
        var ModuleId = that.parentElement.getAttribute('data-Item');
        console.log('PSFContractTotalDummy_ 1');
        CalculateTotalInputField('PSFContractTotalDummy_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        console.log('PSFEstTotalDummy_2 ');
        CalculateTotalInputField('PSFEstTotalDummy_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
    }
    
    
    //**************************PSF Function End**************************************************************************************************************************
    
    //**********************Variable Event Cost Function************************************************************************************
    
    
    function VECNewLine(){
        VECClickAddNew=true;
    }
    
    
    
    //VEC Changing next amount
    function VECChangingNextAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        $('#VECEstQty_'+rowId)[0].childNodes[0].value=that.value;
        
        CalVECContractTotal(that.parentElement.getAttribute('data-id'));
        CalVEC_EstTotal(that.parentElement.getAttribute('data-id'));
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('VECContractQtyClass','VECTotalContractMonthlyQty');
        CalculateTotalInputField('VECEstimateQtyClass','VECContractMonthlyQtyPart');
        CalculateReadOnlyFieldAmount('VECContractTotalDummyTD','VECContractTotalPart'); 
        CalculateReadOnlyFieldAmount('VECEstimateTotalDummyTD','VECEstTotalPart');   
        
        
    }
    
    
    //Calculate VEC Contract total
    function CalVECContractTotal(rowId){
        var ContractTotal =0.0,ContractQty=0.0,ContractPerBottle=0.0;
        ContractQty=$('#VECContractQty_'+rowId)[0].childNodes[0].value;
        ContractPerBottle=$('#VECContractPerBottle_'+rowId)[0].childNodes[0].value;
        if(ContractPerBottle && ContractQty){
            ContractTotal=Number(ContractQty.replace(/,/g, ''))* Number(ContractPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
            if(VECClickAddNew){
                $('#VECContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
            }else{
                $('#VECContractTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(ContractTotal.toFixed(2));
            }
        }
    }
    
    //batch2 VEC By Subbrand 
    function SetEstimateVECPerBottle(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        CalVEC_EstTotal(rowId);
        
        /*if(VECClickAddNew){
            $('#VECEstPerBottle_'+rowId)[0].textContent=that.value;
        }else{
            $('#VECEstPerBottle_'+rowId)[0].childNodes[0].textContent= that.value;
        }
        CalVECContractTotal(rowId);
        
        
        var ModuleId = that.parentElement.getAttribute('data-Item');*/
        
        //CalculateReadOnlyFieldAmount('VECContractTotalDummyTD','VECContractTotalPart'); 
        CalculateReadOnlyFieldAmount('VECEstimateTotalDummyTD','VECEstTotalPart');   
    }
    
    function SettingVECEstTotal(that){
        CalVEC_EstTotal(that.parentElement.getAttribute('data-id'));
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('VECEstimateQtyClass','VECContractMonthlyQtyPart');
        CalculateReadOnlyFieldAmount('VECContractTotalDummyTD','VECContractTotalPart'); 
        CalculateReadOnlyFieldAmount('VECEstimateTotalDummyTD','VECEstTotalPart');   
    }
    
    
    function SettingVECContractTotal(that){
        CalVECContractTotal(that.parentElement.getAttribute('data-id'));
    }
    
    
    
    function CalVEC_EstTotal(rowId){
        var EstTotal =0.0;
        var EstQty=$('#VECEstQty_'+rowId)[0].textContent; //var EstQty=$('#VECEstQty_'+rowId)[0].childNodes[0].value;
        
        console.log('enter EstQty:  '+EstQty);
        
        var EstPerBottle=0.0;
        if(VECClickAddNew){
            console.log('enter VECClickAddNew : '+  '#VECEstPerBottle_'+rowId  );
            EstPerBottle=$('#VECEstPerBottle_'+rowId)[0].childNodes[0].value;// $('#VECEstPerBottle_'+rowId)[0].textContent;
            console.log($('#VECEstPerBottle_'+rowId)[0].childNodes[0].value);
            
            console.log( '111enter EstPerBottle : ' + EstPerBottle);
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#VECEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal); 
            }
        }else{
            console.log('enter 1 : ');
            EstPerBottle=$('#VECEstPerBottle_'+rowId)[0].childNodes[0].textContent;
            console.log('enter EstPerBottle : ' + EstPerBottle);
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#VECEstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
            }
        }
        
        
        
    }
    
    
    //Setting Estimate Dummy Total Amount when changing contract total input field
    function VECSetEstDummyTotalAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');// console.log('VECSetEstDummyTotalAmount  :  '+rowId);
        $('#VECEstDummyTotal_'+rowId)[0].childNodes[0].value=that.value;
    }
    
    
    //**********************Variable Event Cost Function End************************************************************************************
    
    
    
    //Calculate total Amount function (Input Field)
    function CalculateTotalInputField( InputFieldId,TotalDivId){
        var TotalAmount =0;
        $('.'+InputFieldId).each(function(){
            TotalAmount+=Number(StringToNumberStr($(this).val()));
        });
        
        try {
            $('#'+TotalDivId)[0].childNodes[0].textContent= formatNumber(TotalAmount.toFixed(2));
        }  catch(err) {
            $('#'+TotalDivId)[0].textContent=formatNumber(TotalAmount.toFixed(2));//console.log( $('#'+TotalDivId)[0].textContent);
        }
    }
    
    
    
    //Calculate total Amount function (Output Field)
    function CalculateReadOnlyFieldAmount( FieldId,TotalDivId){
        var TotalAmount=0;
        $('.'+FieldId).each(function(){
            TotalAmount+=Number(StringToNumberStr($(this).children().context.textContent));
        });
        
        try {
            $('#'+TotalDivId)[0].childNodes[0].textContent= formatNumber(TotalAmount.toFixed(2));
        }catch(err) {
            $('#'+TotalDivId)[0].textContent= formatNumber(TotalAmount.toFixed(2));
        }
    }
    
    
    
    
    
    //changing PSF Grand Estimate Total  
    function PSFGrandEstimateTotal(that){
        var PSFGrandEstimateTotalAmount = that.value;
        var AdjustmentAmount=Number(StringToNumberStr(that.value)) - Number(StringToNumberStr($('#PSFGrandEstimateTotalBeforeAdjustmentId')[0].childNodes[0].textContent)) ;
        console.log('PSF Grand Estimate Total'+AdjustmentAmount);
        $('#PSFAdjustmentAmountId')[0].childNodes[0].textContent= formatNumber(AdjustmentAmount.toFixed(2));
    }
    
    
    
    
    
    
    
    
    //******************************************************************************
    
    //remove comma
    function StringToNumberStr( i ) {
        return typeof i === 'string' ? i.replace(/\s/g, '').replace(/[\$,]/g, '')*1 : typeof i === 'number' ?   i : 0;
    };
    
    
    function htmlEncode(input){
        var e = document.createElement('div');
        e.innerHTML = input;
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }
    
    //Covered Outlet select all checkboxes
    function selectAllCheckboxes(obj,receivedInputID){
        var inputCheckBox = document.getElementsByTagName("input");                  
        for(var i=0; i<inputCheckBox.length; i++){          
            if(inputCheckBox[i].id.indexOf(receivedInputID)!=-1){                                     
                inputCheckBox[i].checked = obj.checked;
            }
        }
    }
    
    
    function currencyToFloat(currencyStr){
        if (typeof currencyStr === 'string') {
            var numStr = currencyStr.replace(/,/g, '');
            if (/^-?\d+\.?\d*$/.test(numStr)) {
                return parseFloat(numStr);
            }
        }
        return null;
    }        
    
    </script>
    
    <apex:form id="EditHeavyContractDetailPageId" >
        
        
        <div class="bs ">
            
            
            
            <div class="container-fluid" >
                <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;" >
                    <div style="grid-column-start: 1; grid-column-end: 1;" >
                        <div style="font-weight: bold; font-family: Arial,Helvetica,sans-serif; color: #000; font-size: 1.3em; margin: 0.5em;">
                            {!$ObjectType.ASI_TH_CRM_Contract__c.Label} 
                        </div> 
                    </div>
                    
                    <div style="grid-column-start: 2; grid-column-end: 2;  margin-top: 0.5em;" >
                        <div>
                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_IOM_Save}" status="ActionStatus" action="{!saveItems}"
                                                oncomplete="Rerender();InitTooltip();BRSFCalculation();"
                                                reRender="EditHeavyContractDetailPageId" >
                                <apex:param name="IS_QUICK_SAVE" value="false"/>
                            </apex:commandButton>
                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_Quick_Save}" status="ActionStatus" action="{!saveItems}"
                                                oncomplete="Rerender();InitTooltip();BRSFCalculation();"
                                                reRender="EditHeavyContractDetailPageId" >
                                <apex:param name="IS_QUICK_SAVE" value="true"/>
                            </apex:commandButton>
                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_IOM_Cancel}" action="{!CancelProcess}" /> 
                        </div>
                    </div>
                </div>
                
                <div class="bs row  " >
                    <div class="col">
                        <div class="alert alert-danger " style="{!IF(UpsertPermission,'display:none;','')}"  id="SaveFailPart">
                            <div>
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                <strong>Error!</strong><br/>
                                <apex:outputText escape="false" value="{!msg}"/>
                            </div>                 
                        </div> 
                        
                        <div class="alert alert-warning fade in" style="{!IF(WarningTimes==1,'','display:none;')}"    id="SaveFailPart2">
                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                            <strong>Warning!</strong><br/>
                            <apex:outputText escape="false" value="{!WarningMsg}"/>
                        </div> 
                        
                        
                    </div>
                </div>
                
                <div class="row  ">
                    <div class="col">
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                {!$Label.ASI_CRM_CN_Contract_Fix_Cost}
                            </div>
                            <div class="panel-body" style="padding: 0.5em" >
                                
                                <div class="bs table-responsive" > 
                                    <table class="bs table table-condensed" style="margin-bottom: 0;" >
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th><apex:outputText value="{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Contract_Amount__c.Label}" /></th>
                                                <th><apex:outputText value="{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Estimate_Amount__c.Label}" /></th>
                                            </tr>
                                        </thead>
                                        <apex:variable value="{!0}" var="ContractAmount"/>
                                        <apex:variable value="{!0}" var="EstimateAmount"/>
                                        <tbody>
                                            
                                            <apex:repeat value="{!LFixCost}" var="FCLine">
                                                <apex:variable var="ContractAmount" value="{!ContractAmount+FCLine.ASI_CRM_CN_Contract_Amount__c}" />  
                                                <apex:variable var="EstimateAmount" value="{!EstimateAmount+FCLine.ASI_CRM_CN_Estimate_Amount__c}" />  
                                                <tr>
                                                    <td>
                                                        <apex:outputField value="{!FCLine.Name}"  rendered="{!!showCN}" />
                                                        <apex:outputField value="{!FCLine.ASI_CRM_CN_Chinese_Description__c}"  rendered="{!showCN}" />
                                                    </td>
                                                    <td >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCLine.ASI_CRM_CN_Contract_Amount__c}"/></apex:outputText>
                                                    </td>
                                                    <td>
                                                        <apex:inputField value="{!FCLine.ASI_CRM_CN_Estimate_Amount__c}" 
                                                                         styleClass="ApexInputNumberField FixCostEstimateAmount"  onchange=" CalculateTotalInputField('FixCostEstimateAmount','FixCostTotalEstimateAmount');"/>
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                            <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                <td>{!$Label.ASI_CRM_CN_Contract_Fix_Cost}{!$Label.ASI_CRM_CN_Total_Amount} 
                                                </td>
                                                <td id="FixCostTotalContractAmount"   >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractAmount}"/></apex:outputText>
                                                </td>
                                                <td id="FixCostTotalEstimateAmount" style="padding-left: 11em; " >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!EstimateAmount}"/></apex:outputText>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div> 
                        </div>
                        
                    </div>
                </div>
                
                
                
                <!---------------------------BRSF------------------------------------------------------------------------>
                
                
                
                <div class="row  ">
                    <div class="col">
                        
                        
                        <div class="panel panel-primary">
                            <div class="panel-heading" style="font-weight: bold" >
                                {!$Label.ASI_CRM_CN_VF_LABEL_BRSF}
                            </div>
                            <div class="panel-body" style="padding: 0.5em" >
                                <div class="bs table-responsive" > 
                                    
                                    <table class="bs table table-condensed" style="margin-bottom: 0; width:70%" >
                                        <tr>
                                            <td style="border-left: 1px solid #ddd;border-bottom: 1px solid #ddd; width:15%"   class="MethodologyLabel">{!$Label.ASI_CRM_CN_Key_Principle}</td>
                                            <td style="width:10%; border-left: 1px solid #ddd;border-bottom: 1px solid #ddd;" >
                                                <apex:outputField value="{!BRSFItemMap.Module.ASI_CRM_Methodology__r.Name} "  rendered="{!!showCN}" />
                                                <apex:outputField value="{!BRSFItemMap.Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} "  rendered="{!showCN}" />
                                            </td>
                                            <td  style="border-left: 1px solid #ddd;  border-right: 1px solid #ddd; border-bottom: 1px solid #ddd; width:15% "  class="MethodologyLabel" >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}</td>
                                            <td style="border-right: 1px solid #ddd;border-bottom: 1px solid #ddd; width:10% "  >
                                                {!BRSFItemMap.Module.ASI_CRM_Remark_Display__c}
                                            </td>
                                        </tr>
                                    </table>
                                    
                                </div>
                                
                                <div class="bs table-responsive" > 
                                    <table class="bs table table-condensed" style="margin-bottom: 0;padding-top: 0.5em;" >
                                        <thead>
                                            <tr>
                                                <th>{!$ObjectType.ASI_MFM_Sub_brand__c.Label}</th>
                                                <th>{!$Label.ASI_CRM_CN_Grade}</th>
                                                <th >
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                </th>
                                                <th > 
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                </th>
                                                <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_BRSF_Per_Bottle}"/></th>
                                                <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_BRSF_Per_Bottle}"/></th>
                                                <th>
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                </th>
                                                <th>
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                </th>
                                            </tr>
                                        </thead>
                                        
                                        <apex:variable value="{!0}" var="EstMonthlyQty"/>
                                        <apex:variable value="{!0}" var="ContractMonthlyQty"/>
                                        <apex:variable value="{!0}" var="EstBRSFPerBottle"/>
                                        <apex:variable value="{!0}" var="ContractBRSFPerBottle"/>
                                        <apex:variable value="{!0}" var="EstTotal"/>
                                        <apex:variable value="{!0}" var="ContractTotal"/>
                                        
                                        <tbody>
                                            
                                            <apex:repeat value="{!BRSFItemMap.DetailLineMap}" var="Line" >
                                                <apex:variable var="EstMonthlyQty" value="{!EstMonthlyQty+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                <apex:variable var="ContractMonthlyQty" value="{!ContractMonthlyQty+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>  
                                                <apex:variable var="EstTotal" value="{!EstTotal+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                <apex:variable var="ContractTotal" value="{!ContractTotal+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>  
                                                
                                                <tr>
                                                    <td>
                                                        <apex:outputField value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Sub_Brand__c}"  />
                                                    </td>
                                                    <td>
                                                        <apex:outputLink value="/{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__c}">{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}</apex:outputLink>
                                                    </td>
                                                    <td >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                    </td>
                                                    <td>
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText>
                                                    </td>
                                                    <td >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}" 
                                                                         style="{!IF(BRSFItemMap.DetailLineMap[Line].ASI_CRM_Max_Incentive__c < BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}" > 
                                                            <apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td>
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}" 
                                                                         style="{!IF(BRSFItemMap.DetailLineMap[Line].ASI_CRM_Max_Incentive__c < BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}" > 
                                                            <apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/></apex:outputText>
                                                    </td>
                                                    <td>
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/></apex:outputText>
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </tbody>
                                        <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                            <td>{!$Label.ASI_CRM_CN_VF_LABEL_BRSF}{!$Label.ASI_CRM_CN_Total_Amount} 
                                            </td>
                                            <td></td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!ContractMonthlyQty}"/></apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!EstMonthlyQty}"/></apex:outputText>
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractTotal}"/></apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!EstTotal}"/></apex:outputText>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                
                                <div class="bs table-responsive" > 
                                    <table   style="margin-bottom: 0; width:50%; margin-top: 0.5em;" >
                                        <tr>
                                            <td style=" font-weight: bold; text-align: right; padding-top: 0.3em; padding-right: 1em;"> 
                                                {!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Expected_BRSF_Est_Total__c.Label} 
                                            </td>
                                            <td> <apex:inputField value="{!ContractSelected.ASI_CRM_CN_Expected_BRSF_Est_Total__c}" styleClass="ApexInputNumberField" /></td>
                                        </tr>
                                    </table>
                                </div>
                                
                            </div> 
                        </div>
                        
                    </div>
                </div>
                
                
                
                <apex:actionFunction name="paraDeletePSFModule" action="{!DeletePSFModule}" rerender="PSFPanel"  status="ActionStatus"   oncomplete="CalculateAllPSFEstimateAmount();">       
                    <apex:param id="PARAMID" name="PARAMID" value="" />
                </apex:actionFunction>  
                
                <!--------------------------------------------------------------------------------PSF-------------------------------------------------------------------->
                
                <div class="row  " style="padding-top: 1em;">
                    <div class="col">
                        <apex:outputPanel id="PSFPanel">
                            <apex:actionFunction name="ChangingPSFSubBrandActionFunction" action="{!PSFChangingSB}" rerender="PSFPanel"  status="ActionStatus"   >       
                                <apex:param name="PARAM_Module_ID" value="" />
                                <apex:param name="PARAM_Line_ID" value="" />
                            </apex:actionFunction>  
                            <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                                <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  > {!$Label.ASI_CRM_CN_VF_LABEL_PSF} </div>
                                <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                    <div style="margin-left: 5em;" >
                                        <apex:commandButton styleClass="BSCommandButton" 
                                                            value="{!$Label.ASI_CRM_CN_Add_New_Module}"
                                                            reRender="PSFPanel"
                                                            oncomplete="Rerender();"
                                                            action="{!PSFAddModule}" 
                                                            status="ActionStatus"  />
                                    </div> 
                                </div>
                            </div>
                            <div class="PanelBody" >
                                <apex:variable value="{!0}" var="i"/>
                                <apex:repeat value="{!PSF_Item_Map}"  var="itm" id="PSFitem" >
                                    
                                    
                                    <apex:variable var="i" value="{!i+1}"/>
                                    
                                    <apex:outputPanel rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Created_PO_Version__c==ContractSelected.ASI_CRM_CN_PO_Version__c}" >
                                        <div class="panel panel-primary" >
                                            <div class="panel-heading">{!$Label.ASI_CRM_CN_Module}-{!i}
                                                <span id="{!itm}" class="pull-right clickable" data-effect="fadeOut"   
                                                      onclick="DeleteModule(this);InitTooltip();" oncomplete="CalculateAllPSFEstimateAmount();InitTooltip();"  >
                                                    <i class="fa fa-times"></i>
                                                </span> 
                                            </div>
                                            <div class="panel-body">
                                                <div style="display: grid; grid-template-columns: 15% 30% 10% 10% 10% 15%; grid-template-rows: auto;" >
                                                    <div style="padding: 1em;"  class="GridColumn1" >
                                                        <div class="MethodologyLabel" >
                                                            <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Key_Principle_Help_text}"  >{!$Label.ASI_CRM_CN_Key_Principle} <i class="fa fa-info-circle" aria-hidden="true"></i> </span>
                                                        </div> 
                                                    </div>
                                                    <div  class="GridColumn2"   >
                                                        <div style="{!IF(IsGroupContract,'display:none;','')}"  >
                                                            <apex:selectList size="1"  styleClass="form-control" style="width: 25em;" value="{!PSF_Item_Map[itm].MethodologyValue}">
                                                                <apex:selectOptions value="{!DisplayMethod.PSFMethod}" />
                                                            </apex:selectList> 
                                                        </div>
                                                        <div style="{!IF(IsGroupContract,'padding-right: 1em;padding-top: 1em;padding-bottom: 1em;','display:none;')}"  >
                                                            {!PSF_Item_Map[itm].MethodologyDisplay} 
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn3"  >
                                                        <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                            <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Volume_Base_Help_text}"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i> </span>
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn4"  >
                                                        <div class="VolumeBaseCls" id="{!'VB_'+itm}" style="{!IF(PSF_Item_Map[itm].HaveRefresh,'display:none;','')}"   >                       
                                                            <apex:selectList size="1" onchange="changingVolumeBase(this);" styleClass="form-control" style="width: 10em;" 
                                                                             rendered="{!!PSF_Item_Map[itm].HaveRefresh}"
                                                                             value="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}" >
                                                                <apex:selectOptions value="{!VolumeBasePickList}" />
                                                            </apex:selectList>   
                                                        </div>
                                                        <div style="{!IF(PSF_Item_Map[itm].HaveRefresh,'padding-right: 1em; padding-top: 0.6em;','display:none;')}"  >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}"/>
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn5"   >
                                                        <div class="MethodologyLabel"  style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                            <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Unit_Help_text}"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i></span>
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn6"   >
                                                        <div id="{!'UN_'+itm}"   >
                                                            <apex:selectList size="1"   styleClass="form-control" style="width: 17em;" 
                                                                             value="{!PSF_Item_Map[itm].Module.ASI_CRM_Unit__c}" 
                                                                             rendered="{! !PSF_Item_Map[itm].HaveRefresh || PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Grade'}">
                                                                <apex:selectOption itemValue="Std. Btl."  itemLabel="Std. Btl.(标准瓶)" />
                                                                <apex:selectOption itemValue="CR12 Extra Eqv."  itemLabel="CR12 Extra Eqv.(折芝华士新境12年)"  />
                                                            </apex:selectList>   
                                                        </div>
                                                        <div style="{!IF(PSF_Item_Map[itm].HaveRefresh && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Grade','padding-right: 1em; padding-top: 0.6em;','display:none;')}"  >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Unit__c}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div style="display: grid; grid-template-columns: 10% 20% 10% 20% 20% 20%; grid-template-rows: auto;" >
                                                    <div class="GridColumn1" >
                                                        <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                            <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Remark_Help_text}"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i></span>
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn2" style="padding-top: 0.3em;" > <!------------ style="width: 10em;" -------------->
                                                        <apex:inputfield value="{!PSF_Item_Map[itm].Module.ASI_CRM_Remark_Options__c}" styleClass="form-control  input-sm"   />
                                                    </div>
                                                    <div class="GridColumn3" style="padding-top: 0.3em;" >
                                                        <apex:inputText value="{!PSF_Item_Map[itm].Module.ASI_CRM_Remark__c}"  styleClass="form-control  input-sm"   />
                                                    </div>
                                                    <div class="GridColumn4" style="padding-top: 0.3em;" >
                                                        <apex:commandButton styleClass="BSCommandButton"  
                                                                            value="{!$Label.ASI_CRM_CN_Refresh}" 
                                                                            reRender="PSFPanel" 
                                                                            oncomplete="CalculateAllPSFEstimateAmount();Rerender();InitTooltip();PSFCalculation('{itm}');"
                                                                            action="{!RefreshPSFModule}"  
                                                                            status="ActionStatus">
                                                            <apex:param name="PARAM_Line_ID" value="{!itm}" />
                                                        </apex:commandButton>
                                                    </div>
                                                    <div class="GridColumn5" style="padding-top: 0.3em;" >
                                                        <apex:commandButton styleClass="BSCommandButton"  
                                                                            value="{!$Label.ASI_CRM_CN_Reset}" 
                                                                            reRender="PSFPanel" 
                                                                            oncomplete="CalculateAllPSFEstimateAmount();Rerender();InitTooltip();PSFCalculation('{itm}');"
                                                                            action="{!ResetPSFDetails}"  
                                                                            status="ActionStatus">
                                                            <apex:param name="PARAM_Line_ID" value="{!itm}" />
                                                        </apex:commandButton>
                                                    </div>
                                                    <div class="GridColumn6"><div></div></div>
                                                </div>
                                                
                                                <apex:outputPanel rendered="{!PSF_Item_Map[itm].HaveRefresh }" >
                                                    <table class="bs table table-condensed" style="margin-bottom: 0;"  >
                                                        <thead>
                                                            <tr>
                                                                <th  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  "  >
                                                                </th>
                                                                <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:20%;')}  " >{!$ObjectType.ASI_MFM_Sub_brand__c.Label}</th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >{!$Label.ASI_CRM_CN_Grade}</th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                                                </th>
                                                                <th>                                                               
                                                                    <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" > 
                                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                                                    </span>
                                                                    <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" > 
                                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                                    </span>
                                                                </th>
                                                                <th> 
                                                                    <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                                    </span>
                                                                    <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                                    </span>
                                                                    <br/>
                                                                </th>
                                                                
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                                </th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                                </th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_PSF_Per_Bottle}"/>
                                                                </th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_PSF_Per_Bottle}"/>
                                                                </th>
                                                                <th>
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                                </th>
                                                                <th>
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                                </th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_Key_Sub_brand__c.Label}"/>
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <apex:variable value="{!0}" var="PSFEstMonthlyQty"/>
                                                            <apex:variable value="{!0}" var="PSFContractMonthlyQty"/>
                                                            <apex:variable value="{!0}" var="PSFEstTotalQTY"/>
                                                            <apex:variable value="{!0}" var="PSFContractTotalQTY"/>
                                                            <apex:variable value="{!0}" var="PSFEstTotalQTYCR12"/>
                                                            <apex:variable value="{!0}" var="PSFContractTotalQTYCR12"/>
                                                            <apex:variable value="{!0}" var="PSFEstBRSFPerBottle"/>
                                                            <apex:variable value="{!0}" var="PSFContractBRSFPerBottle"/>
                                                            <apex:variable value="{!0}" var="PSFEstTotal"/>
                                                            <apex:variable value="{!0}" var="PSFContractTotal"/>
                                                            
                                                            <apex:repeat value="{!PSF_Item_Map[itm].DetailLineMap}"  var="line" id="lineItem" >
                                                                
                                                                <apex:variable var="PSFEstMonthlyQty" 
                                                                               value="{!PSFEstMonthlyQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c!=null}" />
                                                                <apex:variable var="PSFContractMonthlyQty" 
                                                                               value="{!PSFContractMonthlyQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c!=null}"/>
                                                                
                                                                <apex:variable var="PSFEstTotalQTY" 
                                                                               value="{!PSFEstTotalQTY+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c!=null}" />
                                                                
                                                                <apex:variable var="PSFContractTotalQTY" 
                                                                               value="{!PSFContractTotalQTY+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c!=null}"/> 
                                                                
                                                                <apex:variable var="PSFEstTotalQTYCR12" value="{!PSFEstTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>
                                                                <apex:variable var="PSFContractTotalQTYCR12" value="{!PSFContractTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/> 
                                                                
                                                                <apex:variable var="PSFEstBRSFPerBottle" 
                                                                               value="{!PSFEstBRSFPerBottle+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c!=null}"/>  
                                                                <apex:variable var="PSFContractBRSFPerBottle" 
                                                                               value="{!PSFContractBRSFPerBottle+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c!=null}"/>
                                                                <apex:variable var="PSFEstTotal" 
                                                                               value="{!PSFEstTotal+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c!=null}" />  
                                                                <apex:variable var="PSFContractTotal" 
                                                                               value="{!PSFContractTotal+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c!=null}"/>
                                                                
                                                                <tr>
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  ">
                                                                        
                                                                        <apex:commandLink styleClass="bs btn btn-default btn-round pull-left btn-sm"
                                                                                          style="border: none;background-color: transparent;"
                                                                                          reRender="PSFPanel" rendered="{!!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Adjustment_Line__c}"
                                                                                          oncomplete="Rerender();InitTooltip();PSFCalculation('{itm}');"
                                                                                          action="{!RemovePSFLine}"
                                                                                          status="ActionStatus">
                                                                            <span class="bs glyphicon glyphicon-trash"  style="color:red;font-size: 20px;"></span>
                                                                            <apex:param name="PARAM_item_ID" value="{!itm}" />
                                                                            <apex:param name="PARAM_Unit_ID" value="{!PSF_Item_Map[itm].Module.ASI_CRM_Unit__c}" />
                                                                            <apex:param name="PARAM_Line_ID" value="{!line}" />
                                                                        </apex:commandLink>
                                                                    </td>
                                                                    <td > 
                                                                        <div  class="style-1" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:20%;')}  " >
                                                                            <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}" ></apex:outputField>
                                                                        </div>
                                                                        <div  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                            <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">
                                                                                {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                                        </div>
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                            <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Product_Category__c}">
                                                                                {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                                        </div>
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                            {!$Label.ASI_CRM_CN_By_Total}
                                                                        </div>
                                                                    </td>
                                                                    <td id="{!'SBGrade_'+line}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%;')}  " >
                                                                        <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}
                                                                        </apex:outputLink>
                                                                    </td>
                                                                    <td >
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" data-Item="{!itm}"   data-id="{!line}"   id="{!'PSFContractQty_'+line}"  >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                                        </div>
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                        </div>
                                                                    </td>
                                                                    <td >
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  
                                                                             class="PSFEstimateVolumeClass"   data-Item="{!itm}"   data-id="{!line}"    id="{!'PSFEstQty_'+line}"  >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText>
                                                                        </div>
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                        </div>
                                                                    </td> 
                                                                    
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: left; padding-right: 2em; ','display:none;')}"    >
                                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                    </td>
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: left; padding-right: 2em; ','display:none;')}" >
                                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                    </td>
                                                                    
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"   data-id="{!line}"  
                                                                        data-Incentive="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c}"  data-Item="{!itm}"  
                                                                        id="{!'PSFContractPerBottle_'+line}"  >
                                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                                        </apex:outputText>
                                                                    </td>
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.9em; padding-right: 2em; ','display:none;')}" 
                                                                        data-id="{!line}" data-Volume="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"
                                                                        id="{!'PSFEstPerBottle_'+line}"   data-Item="{!itm}" class="{!'PSFEstimateIncentiveClass_'+itm}"  
                                                                        Incentive="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" >
                                                                        <apex:inputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                                         onchange="SetEstimatePSFPerBottle(this); PSFCheckOverPaid($(this),this);"  
                                                                                         rendered="{!!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Adjustment_Line__c}"
                                                                                         style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c<PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}"
                                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'PSFEstimateIncentive_'+itm} "    >
                                                                        </apex:inputField>
                                                                        <apex:outputText value="0.00" rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Adjustment_Line__c}"  />
                                                                    </td>
                                                                    <td>
                                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/></apex:outputText>
                                                                    </td>
                                                                    <td class="" >
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" 
                                                                             data-Item="{!itm}"   data-id="{!line}"   id="{!'PSFEstDummyTotal_'+line}"  >
                                                                            <apex:inputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"  
                                                                                             onchange="PSFChangeEstDummyTotalAmount(this);CalculateAllPSFEstimateAmount();"  
                                                                                             styleclass="ApexInputNumberField InputNumberFieldwidth {!'PSFEstTotalDummy_'+itm}"    />
                                                                        </div> 
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.9em; padding-right: 2em; ','display:none;')}"  
                                                                             id="{!'PSFEstTotal_'+line}" class="{!'PSFEstDummyTotalClass_'+itm}  {!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Adjustment_Line__c,'AdjustmentLine_'+itm ,'')} " >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                                <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/></apex:outputText>
                                                                        </div>
                                                                    </td>
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%; ')}"  >
                                                                        <apex:inputfield value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Key_Sub_brand__c}"   />
                                                                    </td>
                                                                </tr>
                                                            </apex:repeat>
                                                            
                                                            <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                                <td colspan="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','1','2')} " >{!$Label.ASI_CRM_CN_VF_LABEL_PSF} {!$Label.ASI_CRM_CN_Total_Amount} 
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                </td>
                                                                <td id="{!'TotalPSFContractQty_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFContractMonthlyQty}"/></apex:outputText>
                                                                </td>
                                                                <td id="{!'TotalPSFEstimateQty_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFEstMonthlyQty}"/></apex:outputText>
                                                                </td>
                                                                <td  id="{!'PSFContractTotalQTY_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotalQTY}"/></apex:outputText>
                                                                </td>
                                                                <td id="{!'PSFEstTotalQTY_'+itm}" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotalQTY}"/></apex:outputText>
                                                                </td>
                                                                <td  id="{!'TotalPSFContractTotalQTYCR12_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotalQTYCR12}"/></apex:outputText>
                                                                </td>
                                                                <td id="{!'TotalPSFEstTotalQTYCR12_'+itm}" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotalQTYCR12}"/></apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                </td>
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','display:none;')}  ">
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','')}"   id="{!'PSFContractTotalPart'+itm}"  >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotal}"/></apex:outputText>
                                                                </td>
                                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;',' ')}" 
                                                                    id="{!'PSFEstTotalPart_'+itm}" class="EstimateTotalClass"  >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotal}"/></apex:outputText>
                                                                </td>
                                                                <td></td>
                                                            </tr>
                                                        </tbody>
                                                        
                                                    </table>
                                                </apex:outputPanel>
                                                
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                    
                                    <br/>
                                    <apex:outputPanel rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Created_PO_Version__c!=ContractSelected.ASI_CRM_CN_PO_Version__c}">
                                        <div style="display: grid; grid-template-columns: 10% 90% ; grid-template-rows: auto; padding-top:0.5em;"   >
                                            <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;font-weight: bold;"  >  {!$Label.ASI_CRM_CN_Module}-{!i}</div>
                                            <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                            </div> 
                                        </div>
                                        <div class="PanelBody" >
                                            <div class="bs table-responsive" >
                                                
                                                <table class="bs table table-condensed" style="margin-bottom: 0; width:70%" >
                                                    <tr>
                                                        <td style=" border-left: 1px solid #ddd;"   class="MethodologyLabel">{!$Label.ASI_CRM_CN_Key_Principle} </td>
                                                        <td style="border-right: 1px solid #ddd;">
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name}"  rendered="{!!showCN}" />
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} "  rendered="{!showCN}" />
                                                        </td>
                                                        <td  style=" "  class="MethodologyLabel" >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                                        <td style=" border-right: 1px solid #ddd;"  >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}"/>
                                                        </td>
                                                        
                                                        <td  style=" "  class="MethodologyLabel">{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label} </td>
                                                        <td style="border-right: 1px solid #ddd;"   >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Unit__c}"/>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style=" border-left: 1px solid #ddd;border-bottom: 1px solid #ddd;"  class="MethodologyLabel"  >
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label} 
                                                        </td>
                                                        <td style=" border-left: 1px solid #ddd; border-right: 1px solid #ddd;border-bottom: 1px solid #ddd;"  colspan="5" > 
                                                            {!PSF_Item_Map[itm].Module.ASI_CRM_Remark_Display__c} 
                                                        </td>
                                                        
                                                    </tr>
                                                    
                                                </table>
                                                
                                            </div>
                                            
                                            <div class="bs table-responsive"  style="padding-top: 0.5em;"> 
                                                <table class="bs table table-condensed" style="margin-bottom: 0; "  >
                                                    <thead>
                                                        <tr>
                                                            <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','width:20%','display:none;')}  " >
                                                                {!$ObjectType.ASI_MFM_Sub_brand__c.Label}
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >{!$Label.ASI_CRM_CN_Grade}</th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</th>
                                                            <th> 
                                                                <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" > 
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/> </span>
                                                                <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                                </span>
                                                            </th>
                                                            <th> 
                                                                <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                                </span>
                                                                <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                                </span>
                                                                <br/>
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                            </th>
                                                            
                                                            <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_PSF_Per_Bottle}"/>
                                                            </th>
                                                            <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_PSF_Per_Bottle}"/>
                                                            </th>
                                                            <th>
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                            </th>
                                                            <th>
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_Key_Sub_brand__c.Label}"/>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <apex:variable value="{!0}" var="PSFEstMonthlyQty"/>
                                                        <apex:variable value="{!0}" var="PSFContractMonthlyQty"/>
                                                        <apex:variable value="{!0}" var="PSFEstTotalQty"/>
                                                        <apex:variable value="{!0}" var="PSFContractTotalQty"/>
                                                        <apex:variable value="{!0}" var="PSFEstBRSFPerBottle"/>
                                                        <apex:variable value="{!0}" var="PSFContractBRSFPerBottle"/>
                                                        <apex:variable value="{!0}" var="PSFEstTotalQTYCR12"/>
                                                        <apex:variable value="{!0}" var="PSFContractTotalQTYCR12"/>
                                                        <apex:variable value="{!0}" var="PSFEstTotal"/>
                                                        <apex:variable value="{!0}" var="PSFContractTotal"/>
                                                        
                                                        <apex:repeat value="{!PSF_Item_Map[itm].DetailLineMap}"  var="line" id="PSFlineItem2" >
                                                            <apex:variable var="PSFEstMonthlyQty" value="{!PSFEstMonthlyQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                            <apex:variable var="PSFContractMonthlyQty" value="{!PSFContractMonthlyQty+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>  
                                                            
                                                            <apex:variable var="PSFContractTotalQty" 
                                                                           rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c!=null}"
                                                                           value="{!PSFContractTotalQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>
                                                            <apex:variable var="PSFEstTotalQty" 
                                                                           rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c!=null}"
                                                                           value="{!PSFEstTotalQty+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>
                                                            <apex:variable var="PSFEstTotalQTYCR12" value="{!PSFEstTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>  
                                                            <apex:variable var="PSFContractTotalQTYCR12" value="{!PSFContractTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>  
                                                            <apex:variable var="PSFEstTotal" value="{!PSFEstTotal+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>  
                                                            <apex:variable var="PSFContractTotal" value="{!PSFContractTotal+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>                                                        
                                                            
                                                            <tr>
                                                                <td>
                                                                    <div  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                        <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}" />
                                                                    </div>
                                                                    <div  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                        <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}</apex:outputLink>
                                                                    </div>
                                                                    <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                        <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Product_Category__c}" />
                                                                    </div>
                                                                    <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                        {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Volume_Base__c}
                                                                    </div>
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}" />
                                                                </td>
                                                                
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                                </td>
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText>
                                                                </td>
                                                                
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                </td>
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                </td>
                                                                
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}" 
                                                                                     style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c < PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}"  >
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                <td >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                <td >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%; ')}"  >
                                                                    
                                                                    <div style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Key_Sub_brand__c,'','display:none;')}"   >
                                                                        <input name="chkBox_1" type="checkbox"  value="1" disabled="true" checked="true" />
                                                                    </div>
                                                                    <div style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Key_Sub_brand__c,'display:none;','')}"   >
                                                                        <input name="chkBox_1" type="checkbox"  value="1" disabled="true"   />
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </apex:repeat>
                                                        
                                                        <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                            <td>{!$Label.ASI_CRM_CN_Total_Amount} 
                                                            </td>
                                                            <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                            </td>
                                                            <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFContractMonthlyQty}"/></apex:outputText>
                                                            </td>
                                                            <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFEstMonthlyQty}"/></apex:outputText>
                                                            </td>
                                                            <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFContractTotalQty}"/></apex:outputText>
                                                            </td>
                                                            <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFEstTotalQty}"/></apex:outputText>
                                                            </td>
                                                            <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotalQTYCR12}"/></apex:outputText>
                                                            </td>                                                            
                                                            <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotalQTYCR12}"/></apex:outputText>
                                                            </td>
                                                            <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                            </td>
                                                            <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                            </td>
                                                            <td>
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotal}"/></apex:outputText>
                                                            </td>
                                                            <td  class="EstimateTotalClass"  >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotal}"/></apex:outputText>
                                                            </td>
                                                            <td></td>
                                                        </tr>
                                                        
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        
                                    </apex:outputPanel>
                                    
                                    <br/>
                                    
                                </apex:repeat>
                                
                                
                                
                                <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto; padding-top:0.5em;"   >
                                    <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;font-weight: bold;"  >
                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Adjustment_and_Grand_Total}"/>
                                    </div>
                                    <div style="grid-column-start: 2; grid-column-end: 2;  " ></div> 
                                </div>
                                <div class="PanelBody" style="width:70%" >
                                    <div class="bs table-responsive" > 
                                        <table class="bs table table-condensed" style="margin-bottom: 0; width:100%" >
                                            <tr>
                                                <td class="PSFAdjLabel" >
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_V0_PSF_Contract_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em;" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_V0_PSF_Contract_Total__c}"/></apex:outputText>
                                                </td>
                                                <td class="PSFAdjLabel"  >
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Expected_V0_PSF_Estimated_Total__c.Label}"/>
                                                </td>
                                                <td > 
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_Expected_V0_PSF_Estimated_Total__c}"/></apex:outputText>
                                                </td>
                                            </tr>
                                            
                                            <tr>
                                                <td></td>
                                                <td ></td>
                                                <td class="PSFAdjLabel" >
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Previous_Version_PSF_Est_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em; " id="PSFGrandEstimateTotalBeforeAdjustmentId"  > 
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_Previous_Version_PSF_Est_Total__c}"/></apex:outputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="PSFAdjLabel" ></td>
                                                <td style="padding-top: 0.8em;" ></td>
                                                <td  class="PSFAdjLabel" > 
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Adjustment}"/>
                                                </td>
                                                <td id="PSFAdjustmentAmountId">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!ContractSelected.ASI_CRM_PSF_Estimate_Adjustment_Amount__c}"/>
                                                    </apex:outputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="PSFAdjLabel" ></td>
                                                <td></td>
                                                <td  class="PSFAdjLabel" >
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Expected_PSF_Est_Total}"/>
                                                </td>
                                                <td  id="Expected_PSF_Est_Total"  style="{!IF(SizeOfPSFMap > 0 ,'','display:none;')}" >
                                                    <apex:inputField value="{!ContractSelected.ASI_CRM_CN_Expected_PSF_Est_Total__c}"
                                                                     onchange="PSFGrandEstimateTotal(this);"  styleClass="ApexInputNumberField" />
                                                </td>
                                                <td  style="{!IF(SizeOfPSFMap > 0 ,'display:none;','')}"  >
                                                    0.00
                                                </td>
                                            </tr>
                                            
                                            
                                        </table>
                                    </div>
                                </div> 
                                
                                
                            </div>
                            
                        </apex:outputPanel>
                    </div>
                </div>
                
                <!--------------------------------------------VEC------------------------------------------------------------------------>
                
                
                <div class="row  " style="padding-top: 1em;">
                    <div class="col">
                        <apex:outputPanel id="VECPanel">
                            <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                                <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  >{!$Label.ASI_CRM_CN_Variable_Event_Cost}</div>
                                <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                    <div style="margin-left: 5em;" >
                                    </div> 
                                </div>
                            </div>
                            <apex:outputPanel rendered="{!VariableEventCost.Module.ASI_CRM_Created_PO_Version__c==ContractSelected.ASI_CRM_CN_PO_Version__c}" >
                                <div class="PanelBody" >
                                    <div style="display: grid; grid-template-columns: 15% 30% 10% 10% 10% 15%; grid-template-rows: auto;" >
                                        <div style="padding: 1em;"  class="GridColumn1" >
                                            <div class="MethodologyLabel" >
                                                <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_VEC_Key_Principle_Help_text}"  >
                                                    {!$Label.ASI_CRM_CN_Key_Principle} <i class="fa fa-info-circle" aria-hidden="true"></i>
                                                </span>
                                            </div> 
                                        </div>
                                        <div  class="GridColumn2"   >
                                            <div style="{!IF(IsGroupContract,'display:none;','')}">
                                                <apex:selectList size="1"  styleClass="form-control" style="width: 25em;" 
                                                                 value="{!VariableEventCost.MethodologyValue}" >
                                                    <apex:selectOptions value="{!DisplayMethod.VECMethod}" />
                                                </apex:selectList> 
                                            </div>
                                            <div style="{!IF(IsGroupContract,'padding-right: 1em;padding-top: 1em;padding-bottom: 1em;','display:none; ')}" >
                                                {!VariableEventCost.MethodologyDisplay} 
                                            </div>
                                        </div>
                                        <div class="GridColumn3"  >
                                            <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_VEC_Volume_Base_Help_text} "  >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="GridColumn4"  >
                                            <div class="VolumeBaseCls" id="VB_VariableEventCost" style="{!IF(VariableEventCost.HaveRefresh,'display:none;','')}" >
                                                <apex:selectList size="1" onchange="changingVolumeBase(this);"  
                                                                 rendered="{!!VariableEventCost.HaveRefresh}"
                                                                 styleClass="form-control" style="width: 10em;" value="{!VariableEventCost.Module.ASI_CRM_Volume_Base__c}">
                                                    <apex:selectOptions value="{!VolumeBasePickList}" />
                                                </apex:selectList>   
                                            </div>
                                            <div style="{!IF(VariableEventCost.HaveRefresh,'padding-right: 1em; padding-top: 0.6em;','display:none;')}" >
                                                <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Volume_Base__c}"/>
                                            </div>
                                        </div>
                                        <div class="GridColumn5"   >
                                            <div class="MethodologyLabel"  style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_VEC_Unit_Help_text}  "  >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}<i class="fa fa-info-circle" aria-hidden="true"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="GridColumn6"   >
                                            <div id="UN_VariableEventCost"    >
                                                <apex:selectList size="1"   styleClass="form-control" style="width: 12em;" 
                                                                 rendered="{!!VariableEventCost.HaveRefresh || VariableEventCost.Module.ASI_CRM_Volume_Base__c =='By Grade'}"
                                                                 value="{!VariableEventCost.Module.ASI_CRM_Unit__c}" >
                                                    <apex:selectOption itemValue="Std. Btl." itemLabel="Std. Btl.(标准瓶)" />
                                                    <apex:selectOption itemValue="CR12 Extra Eqv."  itemLabel="CR12 Extra Eqv.(折芝华士新境12年)"  />
                                                </apex:selectList>   
                                            </div>
                                            <div style="{!IF(VariableEventCost.HaveRefresh && VariableEventCost.Module.ASI_CRM_Volume_Base__c !='By Grade','padding-right: 1em; padding-top: 0.6em;','display:none;')}"  >
                                                <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Unit__c}"/>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: 10% 10% 20% 20% 20% 20%; grid-template-rows: auto;" >
                                        <div class="GridColumn1" >
                                            <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_VEC_Remark_Help_text}"  >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}<i class="fa fa-info-circle" aria-hidden="true"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="GridColumn2"  style="padding-top: 0.3em;" > <!---------------style="width: 10em;"-------------------->
                                            <apex:inputfield value="{!VariableEventCost.Module.ASI_CRM_Remark_Options__c}"   styleClass="form-control  input-sm"   />
                                        </div>
                                        <div class="GridColumn3" style="padding-top: 0.3em;" >
                                            <apex:inputText value="{!VariableEventCost.Module.ASI_CRM_Remark__c}"  styleClass="form-control input-sm"  />
                                        </div>
                                        <div class="GridColumn4" style="padding-top: 0.3em;"  >
                                            <apex:commandButton styleClass="BSCommandButton" 
                                                                value="{!$Label.ASI_CRM_CN_Refresh}" onclick="VECNewLine();"
                                                                action="{!RefreshVECModule}" 
                                                                oncomplete="Rerender();"
                                                                reRender="VECPanel" status="ActionStatus"    >
                                            </apex:commandButton>
                                        </div>
                                        <div class="GridColumn5" style="padding-top: 0.3em;" >
                                            <apex:commandButton styleClass="BSCommandButton" 
                                                                value="{!$Label.ASI_CRM_CN_Reset}"  rendered="{!!IsGroupContract}"
                                                                action="{!ResetVECDetails}"  
                                                                oncomplete="Rerender();"
                                                                reRender="VECPanel" status="ActionStatus"    >
                                            </apex:commandButton>
                                        </div>
                                        <div class="GridColumn6"   ><div></div></div>
                                    </div>
                                    
                                    
                                    
                                    <apex:actionFunction name="ChangingVECSubBrandActionFunction" action="{!VECChangingSB}" rerender="VECPanel"  status="ActionStatus"   >       
                                        <apex:param name="PARAM_Line_ID" value="" />
                                    </apex:actionFunction>  
                                    
                                    <apex:outputPanel rendered="{!VariableEventCost.HaveRefresh}"  >
                                        <table class="bs table table-condensed" style="margin-bottom: 0;"  >
                                            <thead>
                                                <tr>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  "  >
                                                        <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                            <apex:commandButton styleClass="BSCommandButtonSM" 
                                                                                reRender="VECPanel"
                                                                                onclick="VECNewLine();"
                                                                                status="ActionStatus" 
                                                                                oncomplete="Rerender();"
                                                                                value="{!$Label.ASI_CRM_CN_Add_New}" 
                                                                                action="{!AddNewVECLine}" />
                                                        </div>
                                                    </th>
                                                    <th style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  "   >
                                                        {!$ObjectType.ASI_MFM_Sub_brand__c.Label}
                                                    </th>
                                                    <th style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  "   >
                                                        {!$Label.ASI_CRM_CN_Grade}
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                                    </th>
                                                    <th > 
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                                        </span>
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                        </span>
                                                    </th>
                                                    <th > 
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                        </span>
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                        </span>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_VEC_Per_Bottle}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_VEC_Per_Bottle}"/>
                                                    </th>
                                                    
                                                    <th  style="text-align: center;">
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                    </th>
                                                    <th  style="text-align: center;" >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                
                                                <apex:variable value="{!0}" var="VECEstMonthlyQty"/>
                                                <apex:variable value="{!0}" var="VECContractMonthlyQty"/>
                                                <apex:variable value="{!0}" var="VECContractTotalQty"/>
                                                <apex:variable value="{!0}" var="VECEstTotalQty"/>
                                                <apex:variable value="{!0}" var="VECContractTotalQtyCR12"/>
                                                <apex:variable value="{!0}" var="VECEstTotalQtyCR12"/>
                                                <apex:variable value="{!0}" var="VECContractBRSFPerBottle"/>
                                                <apex:variable value="{!0}" var="VECEstBRSFPerBottle"/>
                                                <apex:variable value="{!0}" var="VECContractTotal"/>
                                                <apex:variable value="{!0}" var="VECEstTotal"/>
                                                
                                                <apex:repeat value="{!VariableEventCost.DetailLineMap}"  var="line" id="VECLine" >
                                                    <apex:variable var="VECEstMonthlyQty" value="{!VECEstMonthlyQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                    <apex:variable var="VECContractMonthlyQty" value="{!VECContractMonthlyQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>  
                                                    <apex:variable var="VECEstBRSFPerBottle" value="{!VECEstBRSFPerBottle+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>  
                                                    <apex:variable var="VECContractBRSFPerBottle" value="{!VECContractBRSFPerBottle+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>  
                                                    <apex:variable var="VECEstTotal" value="{!VECEstTotal+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>  
                                                    <apex:variable var="VECContractTotal" value="{!VECContractTotal+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>  
                                                    <apex:variable var="VECContractTotalQty" value="{!VECContractTotalQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>  
                                                    <apex:variable var="VECEstTotalQty" value="{!VECEstTotalQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>  
                                                    <apex:variable var="VECContractTotalQtyCR12" value="{!VECContractTotalQtyCR12+VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>  
                                                    <apex:variable var="VECEstTotalQtyCR12" value="{!VECEstTotalQtyCR12+VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>  
                                                    
                                                    <tr >
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Total','width:5%','display:none;')}  "  >
                                                            <apex:commandLink styleClass="bs btn btn-default btn-round pull-left btn-sm"
                                                                              style="border: none;background-color: transparent;"
                                                                              reRender="VECPanel" 
                                                                              action="{!RemoveVECLine}"
                                                                              oncomplete="Rerender();"
                                                                              status="ActionStatus"
                                                                              html-formnovalidate="formnovalidate">
                                                                <span class="bs glyphicon glyphicon-trash"  style="color:red;font-size: 20px;"></span>
                                                                <apex:param name="PARAM_Line_ID" value="{!line}" />
                                                            </apex:commandLink>
                                                        </td>
                                                        <td > 
                                                            <div class="style-1"    style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                <apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}"  
                                                                                 styleClass="{!'SubBrandsClass_'+line} SBClass SubBrandClass VECSubBrandsClass" 
                                                                                 onchange="ChangingSubBrand('{!line}','');" />
                                                            </div>
                                                            <div  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                <apex:outputLink value="/{!VariableEventCost.DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">
                                                                    {!VariableEventCost.DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                <apex:outputLink value="/{!VariableEventCost.DetailLineMap[line].ASI_CRM_Product_Category__c}">
                                                                    {!VariableEventCost.DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                {!$Label.ASI_CRM_CN_By_Total}
                                                            </div>
                                                        </td>
                                                        <td id="{!'SBGrade_'+line}"  style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','width:5%;','display:none;')}  " >
                                                            <apex:outputLink value="/{!VariableEventCost.DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!VariableEventCost.DetailLineMap[line].ASI_CRM_Line_Name__c}
                                                            </apex:outputLink>	
                                                        </td>
                                                        <td >
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  id="{!'VECContractQty_'+line}"   data-id="{!line}"  >
                                                                <!---------<apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"  
                                                                                 styleClass="ApexInputNumberField InputNumberFieldwidth requiredField VECContractQtyClass" 
                                                                                 onchange="VECChangingNextAmount(this);"    />  ---->
                                                                 <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                     <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>
                                                                </apex:outputText>                                                                
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                            </div>
                                                        </td>
                                                        <td >
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="{!'VECEstQty_'+line}" data-id="{!line}"  >
                                                                <!---<apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}" 
                                                                                 onchange="SettingVECEstTotal(this);" 
                                                                                 styleclass="ApexInputNumberField InputNumberFieldwidth requiredField VECEstimateQtyClass"   /> --->
                                                                 <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                     <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                                </apex:outputText>        
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                    <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>
                                                                </apex:outputText>
                                                            </div>
                                                        </td> 
                                                        
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','width:5%;padding-top: 0.9em;text-align: right; padding-right: 2em;','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                <apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','width:5%;padding-top: 0.9em;text-align: right; padding-right: 2em;','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                <apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','width:5%','display:none;')}"  id="{!'VECContractPerBottle_'+line}"  data-id="{!line}"  >
                                                            <!----<apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}" 
                                                                             styleclass="ApexInputNumberField InputNumberFieldwidth requiredField VECContractIncentive" 
                                                                             onchange="SetEstimateVECPerBottle(this);"     />--->
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                            </apex:outputText>

                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','width:5%;padding-top: 0.9em; padding-right: 2em;','display:none;')}" 
                                                            id="{!'VECEstPerBottle_'+line}" data-id="{!line}" class="VECEstimateIncentive"   >
                                                            <apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                             onchange="SetEstimateVECPerBottle(this); "  
                                                                             styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'VECEstPerBottle_'+line} "    >
                                                            </apex:inputField>
                                                        </td>
                                                        
                                                        <td style="text-align: center;" >
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" data-id="{!line}"   >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/></apex:outputText>
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.5em; padding-right: 2em;','display:none;')}" 
                                                                 id="{!'VECContractTotal_'+line}"  data-id="{!line}" class="VECContractTotalDummyTD" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"  styleclass="VECContractTotalDummy"   >
                                                                    <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                                </apex:outputText>
                                                            </div>
                                                        </td>
                                                        
                                                        <td style="text-align: center;" >
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" data-id="{!line}"  id="{!'VECEstDummyTotal_'+line}" >
                                                                <apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}" 
                                                                                 styleclass="ApexInputNumberField InputNumberFieldwidth VECEstimateTotal" 
                                                                                 onchange="CalculateTotalInputField('VECEstimateTotal','VECEstTotalPart');"     />
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.5em; padding-right: 2em;','display:none;')}" 
                                                                 id="{!'VECEstTotal_'+line}" data-id="{!line}" class="VECEstimateTotalDummyTD"    >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}" styleclass="VECEstimateTotalDummy" >
                                                                    <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                                </apex:outputText>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </apex:repeat>
                                                
                                                <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                    <td>
                                                        {!$Label.ASI_CRM_CN_Total_Amount} 
                                                    </td>
                                                    <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Total','display:none;','')}  ">
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand',' ','display:none;')}  " >
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="VECTotalContractMonthlyQty" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECEstMonthlyQty}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="VECContractMonthlyQtyPart" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECContractMonthlyQty}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"   >
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','text-align: right;','display:none;')}" >
                                                    </td>                                                    
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECContractTotalQty}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECEstTotalQty}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: right; padding-right: 2em; ','display:none;')}"><!-----    padding-left: 5em;--->
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECContractTotalQtyCR12}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: right; padding-right: 2em; ','display:none;')}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECEstTotalQtyCR12}"/></apex:outputText>
                                                    </td>
                                                    <td id="VECContractTotalPart"  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','text-align: center;',' text-align: center;')}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECContractTotal}"/></apex:outputText>
                                                    </td>
                                                    <td id="VECEstTotalPart" style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','text-align: center;',' text-align: center;')}"  >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECEstTotal}"/></apex:outputText>
                                                    </td>
                                                    
                                                </tr>
                                                
                                            </tbody>
                                            
                                        </table>
                                    </apex:outputPanel>
                                </div>
                                
                            </apex:outputPanel>
                            
                            <!---------------------------------------VEC Previous Version---------------------------------------------------------------->
                            <apex:outputPanel rendered="{!VariableEventCost.Module.ASI_CRM_Created_PO_Version__c!=ContractSelected.ASI_CRM_CN_PO_Version__c}" >
                                <div class="PanelBody" style="padding: 0.5em" >
                                    
                                    <div class="bs table-responsive" > 
                                        
                                        <table class="bs table table-condensed" style="margin-bottom: 0; width:70%" >
                                            <tr>
                                                <td style=" border-left: 1px solid #ddd;"   class="MethodologyLabel">{!$Label.ASI_CRM_CN_Key_Principle}</td>
                                                <td style="border-right: 1px solid #ddd;">{!VariableEventCost.MethodologyValue}  </td>
                                                <td  style=" "  class="MethodologyLabel" >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                                <td style=" border-right: 1px solid #ddd;"  >
                                                    <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Volume_Base__c}"/>
                                                </td>
                                                <td  style=" "  class="MethodologyLabel">{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}</td>
                                                <td style="border-right: 1px solid #ddd;"   >
                                                    <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Unit__c}"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style=" border-left: 1px solid #ddd;border-bottom: 1px solid #ddd;"  class="MethodologyLabel"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}</td>
                                                <td style=" border-left: 1px solid #ddd; border-right: 1px solid #ddd;border-bottom: 1px solid #ddd;"  colspan="5" > 
                                                    {!VariableEventCost.Module.ASI_CRM_Remark_Display__c} 
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    
                                    <div class="bs table-responsive" style="padding-top: 0.5em;" > 
                                        <table class="bs table table-condensed" style="margin-bottom: 0; " >
                                            <thead>
                                                <tr>
                                                    <th style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  "   >
                                                        {!$ObjectType.ASI_MFM_Sub_brand__c.Label}
                                                    </th>
                                                    <th style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  "   >
                                                        {!$Label.ASI_CRM_CN_Grade}
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                                    </th>
                                                    <th > 
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                                        </span>
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                        </span>
                                                    </th>
                                                    <th > 
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                        </span>
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                        </span>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}">
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_VEC_Per_Bottle}"/> 
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_VEC_Per_Bottle}"/>
                                                    </th>
                                                    <th>
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                    </th>
                                                    <th>
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                    </th>
                                                </tr>
                                            </thead>
                                            
                                            <apex:variable value="{!0}" var="VECEstMonthlyQty"/>
                                            <apex:variable value="{!0}" var="VECContractMonthlyQty"/>
                                            <apex:variable value="{!0}" var="VECContractTotalQty"/>
                                            <apex:variable value="{!0}" var="VECEstTotalQty"/>
                                            <apex:variable value="{!0}" var="VECContractTotalQtyCR12"/>
                                            <apex:variable value="{!0}" var="VECEstTotalQtyCR12"/>
                                            <apex:variable value="{!0}" var="VECContractBRSFPerBottle"/>
                                            <apex:variable value="{!0}" var="VECEstBRSFPerBottle"/>
                                            <apex:variable value="{!0}" var="VECContractTotal"/>
                                            <apex:variable value="{!0}" var="VECEstTotal"/>
                                            
                                            <tbody>
                                                <apex:repeat value="{!VariableEventCost.DetailLineMap}" var="Line" >
                                                    <apex:variable var="VECEstMonthlyQty" value="{!VECEstMonthlyQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                    <apex:variable var="VECContractMonthlyQty" value="{!VECContractMonthlyQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>
                                                    <apex:variable var="VECEstTotal" value="{!VECEstTotal+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>  
                                                    <apex:variable var="VECContractTotal" value="{!VECContractTotal+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>  
                                                    <apex:variable var="VECContractTotalQty" value="{!VECContractTotalQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>  
                                                    <apex:variable var="VECEstTotalQty" value="{!VECEstTotalQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>  
                                                    <apex:variable var="VECContractTotalQtyCR12" value="{!VECContractTotalQtyCR12+VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>  
                                                    <apex:variable var="VECEstTotalQtyCR12" value="{!VECEstTotalQtyCR12+VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>  
                                                    
                                                    <tr>
                                                        
                                                        <td > 
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                <apex:outputField value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Sub_Brand__c}"  html-placeholder="Sub-Brand"    />
                                                            </div>
                                                            <div  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                <apex:outputLink value="/{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__c}">{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}</apex:outputLink>
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                <apex:outputField value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Product_Category__c}" />
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                {!VariableEventCost.DetailLineMap[Line].ASI_CRM_Volume_Base__c} 
                                                            </div>
                                                        </td>
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand',' ','display:none;')}  " >
                                                            <apex:outputLink value="/{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__c}">{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}</apex:outputLink>
                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText>
                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/></apex:outputText>
                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}">
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/></apex:outputText>
                                                        </td>
                                                        
                                                        
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                        </td>
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                        </td>
                                                        
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                        </td>
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                        </td>                                       
                                                        <td >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/></apex:outputText>
                                                        </td>
                                                        <td>
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/></apex:outputText>
                                                        </td>
                                                    </tr>
                                                </apex:repeat>
                                            </tbody>
                                            <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                <td>{!$Label.ASI_CRM_CN_Total_Amount} 
                                                </td>
                                                <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand',' ','display:none;')}  " >
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="VECTotalContractMonthlyQty" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECEstMonthlyQty}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECContractMonthlyQty}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}">
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                </td>
                                                
                                                
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECContractTotalQty}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECEstTotalQty}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECContractTotalQtyCR12}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECEstTotalQtyCR12}"/></apex:outputText>
                                                </td>
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECContractTotal}"/></apex:outputText>
                                                </td>
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECEstTotal}"/></apex:outputText>
                                                </td>
                                                
                                            </tr>
                                        </table>
                                    </div>
                                    
                                    
                                    
                                    
                                    <div class="bs table-responsive" > 
                                        <table style="margin-bottom: 0; width:50%;margin-top: 0.5em;" >
                                            <tr>
                                                <td style=" font-weight: bold; text-align: right; padding-top: 0.3em; padding-right: 1em;">
                                                    {!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_EVC_Cost_Estimate_Total__c.Label} </td>
                                                <td> <apex:inputField value="{!ContractSelected.ASI_CRM_EVC_Cost_Estimate_Total__c}" styleClass="ApexInputNumberField" /></td>
                                            </tr>
                                        </table>
                                    </div>
                                    
                                    
                                </div> 
                                
                                
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </div>
                </div>
                
                
                <!------------------ Covered Outlet ------------------------------------------->
                
                <div class="row  " style="padding-top: 1em;">
                    <div class="col">
                        <apex:outputPanel id="CoveredOutletPanel">
                            <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                                
                                <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  >{!$Label.ASI_CRM_CN_Covered_Outlet}</div>
                                
                                <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                    <div style="margin-left: 5em;" >
                                        <apex:commandButton styleClass="BSCommandButton" 
                                                            value="{!$Label.ASI_CRM_CN_Add_New}" 
                                                            action="{!AddNew_CoveredOutlet}" 
                                                            reRender="CoveredOutletPanel"  
                                                            status="ActionStatus" />
                                        <apex:commandButton styleClass="BSCommandButton" 
                                                            value="{!$Label.ASI_CRM_CN_Add_All_Child_Outlet}" 
                                                            action="{!AddAllChildOutlets}" 
                                                            reRender="CoveredOutletPanel"  status="ActionStatus" />
                                    </div> 
                                </div>
                            </div>
                            
                            <div class="PanelBody" >
                                
                                <apex:outputPanel >
                                    
                                    <table class="bs table table-condensed" style="margin-bottom: 0;"  >
                                        <thead>
                                            <tr>
                                                <th>
                                                    {!$Label.ASI_CRM_CN_Select_All}<br/>
                                                    <apex:inputCheckbox onclick="selectAllCheckboxes(this,'inputId')"   />
                                                </th>
                                                <th>{!$Label.ASI_CRM_CN_Outlet}</th>
                                                <th style="{!IF(showSuggestedAmountAndTargetVolume,'','display:none;')}"  >Suggested Amount </th>
                                                <th style="{!IF(showSuggestedAmountAndTargetVolume,'','display:none;')}"  >Target Volume (Std Btl)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                            <apex:repeat value="{!CoveredOutlet_Item_Map}"  var="itm" id="CoveredOutletLine" >
                                                <tr>
                                                    <td> 
                                                        <apex:inputfield value="{!CoveredOutlet_Item_Map[itm].ASI_CRM_CN_Selected_Covered_Outlet__c }" id="inputId"  />    
                                                    </td> 
                                                    <td> 
                                                        <div class="style-1"  >
                                                            <apex:inputField value="{!CoveredOutlet_Item_Map[itm].ASI_CRM_CN_Outlet__c}" />
                                                        </div>
                                                    </td>
                                                    <td  style="{!IF(showSuggestedAmountAndTargetVolume,'width:30%','display:none;')}"  >
                                                        <apex:inputField value="{!CoveredOutlet_Item_Map[itm].ASI_CRM_CN_Suggested_Amount__c}" 
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth  " />
                                                    </td>
                                                    <td style="{!IF(showSuggestedAmountAndTargetVolume,'width:30%','display:none;')}"  >
                                                        <apex:inputField value="{!CoveredOutlet_Item_Map[itm].ASI_CRM_CN_Target_Volume_Std_Btl__c}" 
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth  " />
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </tbody>
                                        
                                    </table>
                                </apex:outputPanel>
                                
                                
                            </div>
                        </apex:outputPanel>
                        
                    </div>
                </div>
                                
                <apex:actionstatus id="ActionStatus">
                    <apex:facet name="start">
                        <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                                                                             height: 100%; width:100%; opacity:0.65;"> 
                            <div class="waitingHolder" id="loadtext" style="position: absolute;" align="left" valign="top">
                                &nbsp;&nbsp;&nbsp;
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                                <span class="waitingDescription">Please Wait...</span>
                            </div>
                        </div>
                    </apex:facet>
                </apex:actionstatus>   
                
            </div>
        </div>
        
    </apex:form>
    
</apex:page>