<apex:page standardController="ASI_TH_CRM_Contract__c" extensions="ASI_CRM_MY_ContractBuilderCtl" sidebar="false" showheader="false">

<apex:outputField value="{!ASI_TH_CRM_Contract__c.name}" rendered="false"/>
<apex:outputField value="{!ASI_TH_CRM_Contract__c.ASI_TH_CRM_Contract_Status__c}" rendered="false"/>
<apex:outputField value="{!ASI_TH_CRM_Contract__c.ASI_CRM_Obsolete_Version__c}" rendered="false"/>
<apex:outputField value="{!ASI_TH_CRM_Contract__c.ASI_CRM_Terminate__c}" rendered="false"/>
<apex:outputField value="{!ASI_TH_CRM_Contract__c.ASI_CRM_CN_Outlet_WS__c}" rendered="false"/>
    
<head>

<apex:stylesheet value="/sCSS/21.0/sprites/1297816277000/Theme3/default/gc/versioning.css" />   
<apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_MY_jQuery_Lib, '/libs/jquery/css/redmond/jquery-ui-1.10.3.custom.min.css')}" />
<apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_MY_jQuery_Lib, '/styles/common.css')}" />

<link href="{!URLFOR($Resource.ASI_CRM_MY_jQuery_DataTables, 'css/jquery.dataTables.css')}" media="screen" rel="stylesheet" type="text/css" />

<apex:includeScript value="{!URLFOR($Resource.ASI_CRM_MY_jQuery_Lib, '/libs/jquery/js/jquery-1.9.1.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.ASI_CRM_MY_jQuery_Lib, '/libs/jquery/js/jquery-ui-1.10.3.custom.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.ASI_CRM_MY_jQuery_DataTables, 'js/jquery.dataTables.js')}"/>

<script>
    $ = jQuery.noConflict();
    
    var eventDescriptionItemCount = 0;
    var trainingDescriptionItemCount = 0;
    
    var colLabel_Action = "Action";     
    var colLabel_Brand = "Brand";       
    var colLabel_BrandQuality = "Brand Quality"; 
    var colLabel_Volume = "Volume";     
    
    var basicDataTableProperties = {
        "bDestroy":true,
        "bStateSave":true,
        "aaSorting": [[1, "asc"]],
        "bSearch":false,
        //"bSort" : false,
        "bFilter" : true,
        "aLengthMenu":[60,100,200,1000], //Show  entries
        "iDisplayLength":60
    };
    
    var Column0basicDataTableProperties = {
        "bDestroy":true,
        "bStateSave":true,
        "aaSorting": [[0, "asc"]],
        "bSearch":false,
        //"bSort" : false,
        "bFilter" : true,
        "aLengthMenu":[60,100,200,1000], //Show  entries
        "iDisplayLength":60
    };
    
    var Column3basicDataTableProperties = {
        "bDestroy":true,
        "bStateSave":true,
        "aaSorting": [[1, "asc"], [3, "asc"]],
        "bSearch":false,
        //"bSort" : false,
        "bFilter" : true,
        "aLengthMenu":[60,100,200,1000], //Show  entries
        "iDisplayLength":60
    };
    
    //Contract Mechanic Column Definition
    var contractLineItemColumns = [
        {"sTitle": colLabel_Action},
        {"sTitle": colLabel_Brand}
    ]
    
    var contractMechanicColumns = [
        {"sTitle": colLabel_Action},
        {"sTitle": colLabel_Brand}
    ]
    
    //DataTable Variable
    var cliSKU;
    var cmSKU;
    var cliMerchandising;
    var cliSSIncentives;
    var cliVolumeIncentives;
    var cliOtherIncentives;
    var cmOtherIncentives;
    var cliPromoterPlacement;
    var cmPromoterPlacement;
    var cliEvents;
    var cmEvents;
    var summaryEvents;
    
    $(document).ready(
        function(){
            console.log("##INIT - Contract Builder Page");
            setTables("{!region}");
        }
    );
    
    function summarizeSKU(){
        $('#span_footer_total_TargetCases').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU'),'input.TargetCases'));
        $('#span_footer_total_MinSPCase').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU'),'span.MinSPCase'));
        $('#span_footer_total_TotalSum').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU'),'span.contractTargetTotal'));
    }
    
    function summarizeKHSKU(){
        $('#span_footer_total_KHTotalSum').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU'),'span.contractTargetKHTotal'));
    }
    
    function summarizeSSIncentives(){  
        $('#span_footer_total_SSMinSPCase').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SSIncentives'),'span.SSMinSPBtl'));
        $('#span_footer_total_SSAchievedBtl').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SSIncentives'),'input.SSAchievedBtl'));
        $('#span_footer_total_SSFOCWS').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SSIncentives'),'input.SSFOCWS'));
        $('#span_footer_total_SSFOCPRM').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SSIncentives'),'input.SSFOCPRM'));
        $('#span_footer_total_SSCashInc').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SSIncentives'),'input.SSCashInc'));
    }
    function summarizeVolumeIncentives(){  
        $('#span_footer_total_VolMinSPCase').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}VolumeIncentives'),'span.VolMinSPBtl'));
        $('#span_footer_total_VolAchievedBtl').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}VolumeIncentives'),'input.VolAchievedBtl'));
        $('#span_footer_total_VolFOC').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}VolumeIncentives'),'input.VolFOC'));
        $('#span_footer_total_VolCashInc').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}VolumeIncentives'),'input.VolCashInc'));
        //$('#span_footer_total_VolTotal').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}VolumeIncentives'),'input.VolTotal'));
    }
    function summarizeOtherIncentives(){
        $('#span_footer_total_OVolMinSPCase').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}OtherIncentives'),'span.OVolMinSPBtl'));
        $('#span_footer_total_OAchievedBtl').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}OtherIncentives'),'input.OAchievedBtl'));
        $('#span_footer_total_OVolFOC').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}OtherIncentives'),'input.OVolFOC'));
        $('#span_footer_total_OVolCashInc').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}OtherIncentives'),'input.OVolCashInc'));
        $('#span_footer_total_OVolTotal').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}OtherIncentives'),'span.OVolTotal'));
    }
    
    function setSKUTable(region){
        console.log ('Region: ' +region);
        if('{!isEdit}' == 'false') {
            basicDataTableProperties["iDisplayLength"] = 200;
        }
        
		if (region == 'KH') {
            var cliSKU_dataTableProperties = basicDataTableProperties;
            cliSKU_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "SKU"},
                {"sTitle": "Packing Size"},
                {"sTitle": "Value Per Unit"},
                {"sTitle": "FOC Support (case)"},
                {"sTitle": "FOC Support (bottle)"},
                {"sTitle": "Total"}
            ];
            cliSKU = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU").dataTable(cliSKU_dataTableProperties);
		} else {
        	var cliSKU_dataTableProperties = basicDataTableProperties;
            cliSKU_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "SKU"},
                {"sTitle": "Pack Factor"},
                {"sTitle": "Target (Cases)"},
                {"sTitle": "Min SP (Case)"},
                {"sTitle": "Total"}
            ];
            cliSKU = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU").dataTable(cliSKU_dataTableProperties);
		}
        
        if (region == 'KH') {
            var cmSKU_dataTableProperties = basicDataTableProperties;    
            cmSKU_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "SKU"},
                {"sTitle": "Packing Size"},
                {"sTitle": "Sub-Brand"}
            ];
            cmSKU = $("#available_SKU").dataTable(cmSKU_dataTableProperties);
        } else {
        	var cmSKU_dataTableProperties = basicDataTableProperties;    
            cmSKU_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "SKU"},
                {"sTitle": "Pack Factor"},
                {"sTitle": "Sub-Brand"}
            ];
            cmSKU = $("#available_SKU").dataTable(cmSKU_dataTableProperties);
        }
            
        //Sum Sales 9L
        console.log("Processing table - #{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU");       
        calculateAllTotalSpend($("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU"),'span.Sales9L');
        //Set Sales, Sales 9L (SUM)
        summarizeSKU();
        summarizeKHSKU();
    }
    
    function setMerchandisingTable(region){
        console.log ('Region: ' +region);
        if('{!isEdit}' == 'false') {
            basicDataTableProperties["iDisplayLength"] = 200;
        }
        
		if (region == 'KH') {
            var cliMerchandising_dataTableProperties = basicDataTableProperties;
            cliMerchandising_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "Merchandise Name"},
                {"sTitle": "Size"},
                {"sTitle": "Quantity"}
            ];
            cliMerchandising = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}Merchandise").dataTable(cliMerchandising_dataTableProperties);
		} 
    }
    
    function setSSIncentivesTable(){
        //var cliSSIncentives_dataTableProperties = basicDataTableProperties;
        var cliSSIncentives_dataTableProperties = Column0basicDataTableProperties;
        cliSSIncentives_dataTableProperties["aoColumns"] = [
            {"sTitle": "Target SKU"},
            {"sTitle": "Cross Brand SKU"},
            {"sTitle": "Action"},
            {"sTitle": "Setup Code"},
            {"sTitle": "Min. SP (Btl)"},
            {"sTitle": "Achieved (Btl)"},
            {"sTitle": "FOC (WS)"},
            {"sTitle": "FOC (PRM)"},
            {"sTitle": "Cash Inc."},
        ];
        cliSSIncentives =  $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SSIncentives").dataTable(cliSSIncentives_dataTableProperties);
        
        var cmSSIncentives_dataTableProperties = basicDataTableProperties;
        cmSSIncentives_dataTableProperties["aoColumns"] = [
            {"sTitle": colLabel_Action},
            {"sTitle": "SKU"},
            {"sTitle": "Sub-Brand"}
        ];
        cmSSIncentives = $("#available_SS_CrossBrandSKU").dataTable(cmSSIncentives_dataTableProperties);
        
        summarizeSSIncentives();
    }
    
    function setVolumeIncentivesTable(){
        var cliVolumeIncentives_dataTableProperties = basicDataTableProperties;
        cliVolumeIncentives_dataTableProperties["aoColumns"] = [
            {"sTitle": "Description"},
            {"sTitle": "SKU"},
            {"sTitle": "Setup Code"},
            {"sTitle": "Pack Factor"},
            {"sTitle": "Min. SP (Btl)"},
            {"sTitle": "Achieved (Btl)"},
            {"sTitle": "FOC"},
            {"sTitle": "Cash Inc."}
            //{"sTitle": "Total"}
        ];
        cliVolumeIncentives = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}VolumeIncentives").dataTable(cliVolumeIncentives_dataTableProperties);

        summarizeVolumeIncentives();
    }
    
    function setOtherIncentivesTable(){
        var cliOtherIncentives_dataTableProperties = Column3basicDataTableProperties;
        cliOtherIncentives_dataTableProperties["aoColumns"] = [
            {"sTitle": colLabel_Action},
            {"sTitle": "Type"},
            {"sTitle": "Description"},
            {"sTitle": "SKU"},
            {"sTitle": "Setup Code"},
            {"sTitle": "Pack Factor"},
            {"sTitle": "Min SP (Btl)"},
            {"sTitle": "Achieved (Btl)"},
            {"sTitle": "FOC"},
            {"sTitle": "Cash Inc."},
            {"sTitle": "Total"}
        ];
        cliOtherIncentives = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}OtherIncentives").dataTable(cliOtherIncentives_dataTableProperties);
        
        var cmOtherIncentives_dataTableProperties = basicDataTableProperties;
        cmOtherIncentives_dataTableProperties["aoColumns"] = [
            {"sTitle": colLabel_Action},
            {"sTitle": "SKU"},
            {"sTitle": "Sub-Brand"}
        ];
        cmOtherIncentives = $("#available_SKUOther").dataTable(cmOtherIncentives_dataTableProperties);

        summarizeOtherIncentives();
    }
    
    function setPromoterPlacementsTable(){
        var cliPromoterPlacements_dataTableProperties = basicDataTableProperties;
        cliPromoterPlacements_dataTableProperties["aoColumns"] = [
            {"sTitle": colLabel_Action},
            {"sTitle": "SKU"},
            {"sTitle": "Setup Code"},
            {"sTitle": "Daily Salary"},
            {"sTitle": "Promoter Count"},
            {"sTitle": "Working Days"},
            {"sTitle": "Working Month"},
            {"sTitle": "Total"} 
        ];
        cliPromoterPlacements = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}PromoterPlacements").dataTable(cliPromoterPlacements_dataTableProperties);
        
        var cmPromoterPlacements_dataTableProperties = basicDataTableProperties;
        cmPromoterPlacements_dataTableProperties["aoColumns"] = [
            {"sTitle": colLabel_Action},
            {"sTitle": "SKU"},
            {"sTitle": "Sub-Brand"}
        ];

        cmPromoterPlacements = $("#available_SKUPP").dataTable(cmPromoterPlacements_dataTableProperties);
    }
    
    function setTables(region){
        console.log ('setTables: ' + region);
        
        //Set all line item and contract mechanic tables (for all mechanic type)
        setSKUTable(region);
        setMerchandisingTable(region);
        setSSIncentivesTable();
        setVolumeIncentivesTable();
        setOtherIncentivesTable();
        setPromoterPlacementsTable();
        //setEventsTable();
        
        if('{!isEdit}' == 'false') {
            $(":input").prop("disabled", true);
        }
    }
    
    function validateNumber(input){
        input = normalizeFloat(input, [", ", "."]);
        var numRe =  new RegExp("^([+]?)([0-9]*)(\.[0-9]{0})?$"); 
        return numRe.test(input);
    }
    
    function validateFloat(input, precision){
        input = normalizeFloat(input, [", ", "."]);
        var numRe =  new RegExp("^([+]?)([0-9]*)(\.[0-9]{1,"+precision+"})?$"); 
        return numRe.test(input);
    }
    
    function normalizeFloat(number, chars){
        var lastIndex = -1;
        for(i=0; i < chars.length; i++) {
            t = number.lastIndexOf(chars[i]);

            if (t > lastIndex) {
                lastIndex = t;
            }
        }

        if (lastIndex == -1) {
            lastIndex = number.length;
        }

        var whole = number.substring(0, lastIndex);   
        var precision = number.substring(lastIndex);
        for (i=0; i < chars.length; i++) {
            whole = whole.replace(chars[i], '');
            precision = precision.replace(chars[i],'.');           
        }
        number = whole + precision;

        f = parseFloat(number);
        return f;
    }
    
    function calculateTotalSpend(cpiRow){
        var totalSpendVal = 0;
        var isInputValid = false;
        
        console.log('Calculate Total Spend - CPI Row:'+cpiRow);
        if (cpiRow!=undefined){
            //Get Qty
            var qty = "1";//cpiRow.find("input.cpiVolume").val();//cpiRow.children().children(".cpiVolume").val();
            console.log('Calculate Total Spend - Qty:' + qty);
            if (qty!= undefined){
                if (validateNumber(qty)){
                    cpiRow.find("input.cpiVolume").removeClass('error-input');
                    isInputValid = true;
                }else{
                    cpiRow.find("input.cpiVolume").addClass('error-input');
                    isAllInputValid = false;
                }
            }
            
            //Get Rate (Amount)
            var amount = cpiRow.find("input.TargetCases").val();//cpiRow.children().children(".TargetCases").val();
            if (amount!= undefined){
                if (validateFloat(amount, 2)){
                    cpiRow.find("input.TargetCases").removeClass('error-input');
                    isInputValid = true;
                }else{
                    cpiRow.find("input.TargetCases").addClass('error-input');
                    isAllInputValid = false;
                }
            }
            
            if (isInputValid){
                qty = normalizeFloat(qty, [",","."]);//qty.replace(',', '');
                qty = (qty!=null&&qty!=undefined&&qty!="NaN")?parseInt(qty):0;
                
                amount = normalizeFloat(amount, [",","."]);//amount.replace(',', '');
                console.log('Calculate Total Spend - Amount:' + amount);
                amount = (amount!=null&&amount!=undefined&&amount!="NaN")?parseFloat(amount):0;
                console.log('Calculate Total Spend - Qty, Amount:' + qty + '-'+ amount);

                totalSpendVal = precise_round(qty*amount, 2);
                totalSpendVal = isNaN(totalSpendVal)?0:totalSpendVal;
                console.log('Calculate Total Spend:' + totalSpendVal);
            }
        }
        return totalSpendVal;
    }
    
    function sumTotalSpend(tableEle, colEle){
        var sTotalSpend = 0;
        var totalSpendArr = tableEle.find(colEle);//tableEle.find("span.Sales9L");
        console.log('Table Element:'+tableEle +'-'+totalSpendArr);
        console.log('colEle' + colEle);
        console.log('Table Element size: ' + totalSpendArr.length);
        for (j=0; j<totalSpendArr.length; j++){
            var totalSpendEle = $(totalSpendArr[j]);
            var fTotalSpend = normalizeFloat(totalSpendEle.text(), [",","."]);//parseFloat(totalSpendEle.text())
            if(colEle.indexOf('input')>-1)
                fTotalSpend = normalizeFloat(totalSpendEle.val(), [",","."]);
                            
            fTotalSpend = isNaN(fTotalSpend)?0:fTotalSpend;
            sTotalSpend += fTotalSpend;
        }
        
        console.log("sTotalSpend:" + sTotalSpend);
        sTotalSpend = isNaN(sTotalSpend)?0:sTotalSpend;
        //return precise_round(sTotalSpend, 2);
        
        var tempRound = precise_round(sTotalSpend, 2);
        var newStr = tempRound * 1;
        var isNegative = false;
        if(newStr < 0){
            isNegative = true;
        }
                        
        /*var newStr2 = newStr.toFixed(2).split('.')[1];
        newStr = (newStr.toLocaleString('en-IN')).split('.')[0];
        newStr = newStr + '.' + newStr2;
        */
        
        newStr = numberWithCommas(newStr);
        return newStr;
    }
    
    function numberWithCommas(x) {
            x=x.toFixed(2);
            var parts = x.toString().split(".");
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return parts.join(".");
    }    
    
    function calculateAllTotalSpend(tableEle,cellEle){
        var allCliContentRow = tableEle.find(".cpiContent");
        
        console.log("allCliContentRow:" +allCliContentRow+'-'+allCliContentRow.length);
        for (k=0; k<allCliContentRow.length; k++){
            var cliContentRow = $(allCliContentRow[k]);
            console.log('Check - Calculate All Total Spend:' + cliContentRow);
            //calculateTotalSpend("", cliContentRow);
            var tSpend = calculateTotalSpend(cliContentRow);
            console.log("Check - Calculate All Total Spend - TSpend:"+ tSpend);
            cliContentRow.find(cellEle).text(tSpend);//cliContentRow.children().children(".cpiTotalSpend").text(tSpend);
            console.log("Check - Calculate All Total Spend - Assign:" +cliContentRow.find(cellEle) + "-"+cliContentRow.find("span.cpiTotalSpend").val());
        }
    }
  
    function precise_round(num,decimals){
        return Math.round(num*Math.pow(10,decimals))/Math.pow(10,decimals);
    }
    
    

    
    /* **************************************************************** SKU Tab: AUTOCALC Contract Target Total *********************************** */
    function calculateContractTargetTotal(cpiRow){
        console.log ('cpiRow: '+cpiRow);
        var totalResult = 0;
        var isInputValid = false;
        
        if (cpiRow!=undefined){
            var TargetCases = cpiRow.find("input.TargetCases").val();
            if (TargetCases!= undefined) {
                if (validateFloat(TargetCases, 2)) {
                    cpiRow.find("input.TargetCases").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("input.TargetCases").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            var MinSPCase = cpiRow.find("input.MinSPCase").text(); //alert(MinSPCase);
            if(MinSPCase!= undefined){
                if (validateFloat(MinSPCase, 2)) {
                    cpiRow.find("output.MinSPCase").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("output.MinSPCase").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            if(isInputValid){
                TargetCases = normalizeFloat(TargetCases, [",","."]);
                TargetCases = (TargetCases!=null&&TargetCases!=undefined&&!isNaN(TargetCases))?parseFloat(TargetCases):0;
                MinSPCase = normalizeFloat(MinSPCase, [",","."]);
                MinSPCase = (MinSPCase!=null&&MinSPCase!=undefined&&!isNaN(MinSPCase))?parseFloat(MinSPCase):0;
                
                totalResult = MinSPCase * TargetCases;
                totalResult = (totalResult!=null&&totalResult!=undefined&&!isNaN(totalResult)&&totalResult!="Infinity")?parseFloat(totalResult):0;
                totalResult = parseFloat(Math.round(totalResult * 100) / 100).toFixed(2);
            }
        }
        return totalResult;
    }
    
    function calculateVolTotal(cpiRow){
        var totalResult = 0;
        var isInputValid = false;
        
        if (cpiRow!=undefined){
            var VolAchievedBtl = cpiRow.find("input.VolAchievedBtl").val();
            if (VolAchievedBtl!= undefined) {
                if (validateFloat(VolAchievedBtl, 2)) {
                    cpiRow.find("input.VolAchievedBtl").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("input.VolAchievedBtl").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            var VolFOC = cpiRow.find("input.VolFOC").val(); //alert(MinSPCase);
            if (VolFOC!= undefined) {
                if (validateFloat(VolFOC, 2)) {
                    cpiRow.find("output.VolFOC").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("output.VolFOC").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            var VolCashInc = cpiRow.find("input.VolCashInc").val(); //alert(MinSPCase);
            if (VolCashInc!= undefined) {
                if (validateFloat(VolCashInc, 2)) {
                    cpiRow.find("output.VolCashInc").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("output.VolCashInc").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            if (isInputValid) {
                VolAchievedBtl = normalizeFloat(VolAchievedBtl, [",","."]);
                VolAchievedBtl = (VolAchievedBtl!=null&&VolAchievedBtl!=undefined&&!isNaN(VolAchievedBtl))?parseFloat(VolAchievedBtl):0;
                VolFOC = normalizeFloat(VolFOC, [",","."]);
                VolFOC = (VolFOC!=null&&VolFOC!=undefined&&!isNaN(VolFOC))?parseFloat(VolFOC):0;
                VolCashInc = normalizeFloat(VolCashInc, [",","."]);
                VolCashInc = (VolCashInc!=null&&VolCashInc!=undefined&&!isNaN(VolCashInc))?parseFloat(VolCashInc):0;
                
                totalResult = VolAchievedBtl + VolFOC + VolCashInc; //Please check 2015-01-27
                totalResult = (totalResult!=null&&totalResult!=undefined&&!isNaN(totalResult)&&totalResult!="Infinity")?parseFloat(totalResult):0;
                totalResult = parseFloat(Math.round(totalResult * 100) / 100).toFixed(2);
            }
        }
        return totalResult;
    }
    
    function calculateOVolTotal(cpiRow){
        var totalResult = 0;
        var isInputValid = false;
        
        if (cpiRow!=undefined){
            var OVolFOC = cpiRow.find("input.OVolFOC").val(); //alert(MinSPCase);
            if (OVolFOC!= undefined) {
                if (validateFloat(OVolFOC, 2)) {
                    cpiRow.find("output.OVolFOC").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("output.OVolFOC").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            var OVolCashInc = cpiRow.find("input.OVolCashInc").val(); //alert(MinSPCase);
            if (OVolCashInc!= undefined) {
                if (validateFloat(OVolCashInc, 2)) {
                    cpiRow.find("output.OVolCashInc").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("output.OVolCashInc").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            if(isInputValid){
                OVolFOC = normalizeFloat(OVolFOC, [",","."]);
                OVolFOC = (OVolFOC!=null&&OVolFOC!=undefined&&!isNaN(OVolFOC))?parseFloat(OVolFOC):0;
                OVolCashInc = normalizeFloat(OVolCashInc, [",","."]);
                OVolCashInc = (OVolCashInc!=null&&OVolCashInc!=undefined&&!isNaN(OVolCashInc))?parseFloat(OVolCashInc):0;
                
                totalResult = OVolFOC + OVolCashInc; //Please check 2015-01-27
                totalResult = (totalResult!=null&&totalResult!=undefined&&!isNaN(totalResult)&&totalResult!="Infinity")?parseFloat(totalResult):0;
                totalResult = parseFloat(Math.round(totalResult * 100) / 100).toFixed(2);
            }
        }
        return totalResult;
    }
    
    function calculateTotalBottle(cpiRow){
        console.log ('cpiRow: '+cpiRow);
        var totalResult = 0;
        var isInputValid = false;
        
        if (cpiRow != undefined){
            var TargetCases = cpiRow.find("input.TargetCases").val();
            if (TargetCases != undefined) {
                if (validateFloat(TargetCases, 2)) {
                    cpiRow.find("input.TargetCases").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("input.TargetCases").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            var packagingSize = cpiRow.find("span.packagingSize").text(); //alert(MinSPCase);
            if(packagingSize != undefined){
                if (validateFloat(packagingSize, 2)) {
                   isInputValid = true;
                } else {
                    isInputValid = false;
                }
            }
            
            if(isInputValid){
                TargetCases = normalizeFloat(TargetCases, [",","."]);
                TargetCases = (TargetCases!=null&&TargetCases!=undefined&&!isNaN(TargetCases))?parseFloat(TargetCases):0;
                packagingSize = normalizeFloat(packagingSize, [",","."]);
                packagingSize = (packagingSize!=null&&packagingSize!=undefined&&!isNaN(packagingSize))?parseFloat(packagingSize):0;
                
                totalResult = packagingSize * TargetCases;
                totalResult = (totalResult!=null&&totalResult!=undefined&&!isNaN(totalResult)&&totalResult!="Infinity")?parseFloat(totalResult):0;
                totalResult = parseFloat(Math.round(totalResult * 100) / 100).toFixed(2);
            }
        }
        return totalResult;
    }
    
    function calculateContractTargetKHTotal(cpiRow){
        console.log ('cpiRow: '+cpiRow);
        var totalResult = 0;
        var isInputValid = false;
        
        if (cpiRow!=undefined){
            var TargetCases = cpiRow.find("input.TargetCases").val();
            if (TargetCases!= undefined) {
                if (validateFloat(TargetCases, 2)) {
                    cpiRow.find("input.TargetCases").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("input.TargetCases").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            var ValuePerUnit = cpiRow.find("input.ValuePerUnit").val();
            if (ValuePerUnit!= undefined) {
                if (validateFloat(TargetCases, 2)) {
                    cpiRow.find("input.ValuePerUnit").removeClass('error-input');
                    isInputValid = true;
                } else {
                    cpiRow.find("input.ValuePerUnit").addClass('error-input');
                    isInputValid = false;
                }
            }
            
            var packagingSize = cpiRow.find("span.packagingSize").text(); //alert(MinSPCase);
            if(packagingSize != undefined){
                if (validateFloat(packagingSize, 2)) {
                   isInputValid = true;
                } else {
                    isInputValid = false;
                }
            }
            
            if(isInputValid){
                TargetCases = normalizeFloat(TargetCases, [",","."]);
                TargetCases = (TargetCases!=null&&TargetCases!=undefined&&!isNaN(TargetCases))?parseFloat(TargetCases):0;
                ValuePerUnit = normalizeFloat(ValuePerUnit, [",","."]);
                ValuePerUnit = (ValuePerUnit!=null&&ValuePerUnit!=undefined&&!isNaN(ValuePerUnit))?parseFloat(ValuePerUnit):0;
                packagingSize = normalizeFloat(packagingSize, [",","."]);
                packagingSize = (packagingSize!=null&&packagingSize!=undefined&&!isNaN(packagingSize))?parseFloat(packagingSize):0;
                
                totalResult = packagingSize * TargetCases * ValuePerUnit;
                totalResult = (totalResult!=null&&totalResult!=undefined&&!isNaN(totalResult)&&totalResult!="Infinity")?parseFloat(totalResult):0;
                totalResult = parseFloat(Math.round(totalResult * 100) / 100).toFixed(2);
            }
        }
        return totalResult;
    }
    
</script>

<style>
body {
    margin-top: 40px;
    font-size: 12px;
    font-family: Helvetica,Arial,Verdana,sans-serif;
    width:100%;
}
        
#container1{
    width:100%;
}

#tabLink{
    font-size: 10px;
}

.overlay {
            display: none;
            height: 100%;
            left: 0;
            position: fixed;
            top: 0;
            opacity: 0.3;
            -moz-opacity: 0.3;
            width: 100%;
            -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=30)";
            filter: alpha(opacity=30);
            background: #000;
            -khtml-opacity: 0.3;
            z-index: 1000;
        }
.loader {
    width: 32px;
    height: 32px;
    position: absolute;
    left: 50%;
}

input.error-input {
    border-color: red;
}

.narrowInput {
    width: 55px;
}

.cashInput{
    width: 70px;
}

.totalInput{
    width: 80px;
}
.numInput {
    text-align:right;
}
.numDisplay {
    text-align:right;
}
.TargetCases {
    text-align:right;
}

<!------ for cross brand item ------->    
.blueLinkColor a:link{
    color: #0000ff;
}
.blueLinkColor a:visited{
    color: #0000ff;
}
.blueLinkColor a:hover{
    color: #2b6cd4;
}
    
</style>

</head>

<body> 
    <apex:form >
        <apex:pageMessages id="pageMsg"></apex:pageMessages>
        
        <div id="contentLoading" style="display:none;">
            <div style="text-align: center;">
                <p>Loading...
                    <img src="/img/loading.gif" alt="Loading graphic"/></p>
            </div>
        </div>
        
        <div id="load_scrl" class="loadingBox loader" style="display:none"><div style="text-align: center;">
            <p>Loading...
                <img src="/img/loading.gif" alt="Loading graphic"/></p>
            </div>
        </div>
        <div class="loadingBox overlay"></div>
        
        <apex:actionFunction name="retrieveSKUbySubBrand" action="{!retrieveSKUbySubBrand}" oncomplete="setTables({!region});"/>
        
        <apex:pageBlock id="main_pageBlock">
            <apex:pageblockButtons rendered="{!isEdit}">
                <apex:commandLink value="Save" 
                                  status="loading"
                                  onclick="changeShowEntries()"
                                  action="{!saveContract}"
                                  styleClass="btn" style="text-decoration:none;padding:4px;"
                                  reRender="pageMsg" 
                                  oncomplete="gotoRecord('{!strPageID}')">
                    <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                </apex:commandLink>
                <apex:commandButton value="Quick Save" 
                                    rerender="pageMsg"
                                    onclick="changeShowEntries()"
                                    oncomplete="changeDefaultEntries()"
                                    status="loading"
                                    action="{!saveContract}">
                    <!--on complete="console.log('Quick Save Done');" <apex:param name="IS_QUICK_SAVE" value="true"/>-->
                </apex:commandButton>
                <apex:commandLink value="Exit" action="{!cancel}" 
                                  immediate="true"
                                  target="_parent" styleClass="btn" style="text-decoration:none;padding:4px;" rendered="false" />
            </apex:pageblockButtons>
            
            <apex:pageBlockSection columns="1">
                <apex:outputField value="{!contractObj.Name}"/>
            </apex:pageBlockSection>
            
            <div id="mechanicTypeTabs" class="tabLink">
                <ul>
                    <li><apex:outputPanel rendered="{!region == 'MY'}"><a href="#tab_SKU">Contract Target</a></apex:outputPanel></li>
                    <li><apex:outputPanel rendered="{!region == 'MY'}"><a href="#tab_SSIncentives">Sales &amp; Staff Incentives</a></apex:outputPanel></li>
                    <li><apex:outputPanel rendered="{!region == 'MY'}"><a href="#tab_VolumeIncentives">Volume Incentives</a></apex:outputPanel></li>
                    <li><apex:outputPanel rendered="{!region == 'MY'}"><a href="#tab_OtherIncentives">Other Incentives</a></apex:outputPanel></li>
                    <li><apex:outputPanel rendered="{!region == 'MY'}"><a href="#tab_PromoterPlacements">Promoter Placements</a></apex:outputPanel></li>
                    
                    <li><apex:outputPanel rendered="{!region == 'KH'}"><a href="#tab_Merchandising">Merchandising</a></apex:outputPanel></li>
                    <li><apex:outputPanel rendered="{!region == 'KH'}"><a href="#tab_SKU">Merchandising Support</a></apex:outputPanel></li>
                </ul>
                
                <!----------------------------------------------tab_SKU------------------------------------------------------------------>
                <div id="tab_SKU">
                    <apex:pageBlock id="pageBlock_SKU"> 
                        <apex:pageBlockSection id="section_lineItem_SKU" title="Contract Target" columns="1">
                            
                            <!-- MY -->
                            <apex:outputPanel layout="block" rendered="{!region == 'MY'}">
                                <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU">
                                    <apex:repeat var="cpiKey" value="{!allContractTargetMap}">
                                        <apex:repeat var="cpiObj" value="{!allContractTargetMap[cpiKey]}">
                                            <tr id="row_SKU_{!cpiKey}" class="cpiContent">
                                                <td>
                                                    <apex:commandLink value="Delete"
                                                                      immediate="false"
                                                                      action="{!removeContractSKU}"
                                                                      rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('Remove CPI'); setTables('{!region}');"
                                                                      status="loading"
                                                                      rendered="{!isEdit}">
                                                        <apex:param name="PARAM_CONTRACT_SKU_ID" value="{!cpiKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputField value="{!cpiObj.ASI_CRM_SKU__c}"/></td>
                                                
                                                <td><apex:outputField value="{!cpiObj.ASI_CRM_PackFactor__c}"/></td>
                                                <td style="text-align: right;"><apex:inputField value="{!cpiObj.ASI_CRM_TargetCase__c}"
                                                                                                required="false"
                                                                                                styleclass="TargetCases"
                                                                                                onChange="$('#contractTargetTotal_{!cpiKey}').text(calculateContractTargetTotal($('#row_SKU_{!cpiKey}')));summarizeSKU();" />
                                                </td>
                                                <td class="numDisplay"><!--<apex:outputField value="{!cpiObj.ASI_CRM_MinSPCase__c}" />-->
                                                    <span class="MinSPCase" id="contractTargetTotal_{!cpiKey}" style="display: none;">{!cpiObj.ASI_CRM_MinSPCase__c}</span>
                                                    <apex:outputText value="{0, number, ###,###,###,###.00}" rendered="{!cpiObj.ASI_CRM_MinSPCase__c != 0}"><apex:param value="{!cpiObj.ASI_CRM_MinSPCase__c}"/></apex:outputText>
                                                    <apex:outputText value="0.00" rendered="{!cpiObj.ASI_CRM_MinSPCase__c == 0}"/>
                                                    <!--
                                                    required="false"
                                                    styleclass="MinSPCase"
                                                    onChange="$('#contractTargetTotal_{!cpiKey}').text(calculateContractTargetTotal($('#row_SKU_{!cpiKey}')));summarizeSKU();" /> -->
                                                </td>
                                                <td class="numDisplay">
                                                    <span class="contractTargetTotal" id="contractTargetTotal_{!cpiKey}" style="display:none;">{!cpiObj.ASI_CRM_Total__c}</span>
                                                    <apex:outputText value="{0, number, ###,###,###,###.00}" rendered="{!cpiObj.ASI_CRM_Total__c != 0}"><apex:param value="{!cpiObj.ASI_CRM_Total__c}"/></apex:outputText>
                                                    <apex:outputText value="0.00" rendered="{!cpiObj.ASI_CRM_Total__c == 0}"/>
                                                </td>
                                                <!--<td><apex:outputField value="{!cpiObj.ASI_CRM_Total__c}"/></td>-->
                                                
                                                
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                    <tfoot>
                                        <tr>
                                            <th style="text-align:right;" colspan="3" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                            <th class="numDisplay" id="footer_total_Sales" rowspan="1" colspan="1">
                                                <span id="span_footer_total_TargetCases"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_Sales9L" rowspan="1" colspan="1">
                                                <span id="span_footer_total_MinSPCase"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_TotalSum" rowspan="1" colspan="1">
                                                <span id="span_footer_total_TotalSum"/>
                                            </th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </apex:outputPanel>
                            
                            <!-- KH -->
                            <apex:outputPanel layout="block" rendered="{!region == 'KH'}">
                                <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SKU">
                                    <apex:repeat var="cpiKey" value="{!allContractTargetMap}">
                                        <apex:repeat var="cpiObj" value="{!allContractTargetMap[cpiKey]}">
                                            <tr id="row_SKU_{!cpiKey}" class="cpiContent">
                                                <td>
                                                    <apex:commandLink value="Delete"
                                                                      immediate="false"
                                                                      action="{!removeContractSKU}"
                                                                      rerender="pageBlock_SKU, pageBlock_Merchandising, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('Remove CPI'); setTables('{!region}');"
                                                                      status="loading"
                                                                      rendered="{!isEdit}">
                                                        <apex:param name="PARAM_CONTRACT_SKU_ID" value="{!cpiKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputField value="{!cpiObj.ASI_CRM_SKU__c}"/></td>
                                                <td><apex:outputText styleclass="packagingSize" value="{!cpiObj.ASI_CRM_PackagingSize__c}"/></td>
                                                <td style="text-align: right;"><apex:inputField value="{!cpiObj.ASI_CRM_KH_Value_per_Unit__c}"
                                                                                                required="false"
                                                                                                styleclass="ValuePerUnit"
                                                                                                onChange="$('#contractTargetKHTotal_{!cpiKey}').text(calculateContractTargetKHTotal($('#row_SKU_{!cpiKey}')));
                                                                                                          summarizeKHSKU();" />
                                                </td>															
                                               	<td style="text-align: right;"><apex:inputField value="{!cpiObj.ASI_CRM_KH_FOC_Support_in_actual_case__c}"
                                                                                                required="false"
                                                                                                styleclass="TargetCases"
                                                                                                onChange="$('#contractTargetBottle_{!cpiKey}').text(calculateTotalBottle($('#row_SKU_{!cpiKey}')));
                                                                                                          $('#contractTargetKHTotal_{!cpiKey}').text(calculateContractTargetKHTotal($('#row_SKU_{!cpiKey}')));
                                                                                                          summarizeKHSKU();" />
                                                </td>
                                                <td class="numDisplay">
                                                    <span class="contractTargetBottle" id="contractTargetBottle_{!cpiKey}">{!cpiObj.ASI_CRM_KH_FOC_Support_in_actual_Bottle__c}</span>
                                                    <!--<apex:outputText value="{0, number, ###,###,###,###.00}" rendered="{!cpiObj.ASI_CRM_KH_FOC_Support_in_actual_Bottle__c != 0}"><apex:param value="{!cpiObj.ASI_CRM_KH_FOC_Support_in_actual_Bottle__c}"/></apex:outputText>
                                                    <apex:outputText value="0.00" rendered="{!cpiObj.ASI_CRM_KH_FOC_Support_in_actual_Bottle__c == 0}"/>
													-->
                                                </td>
                                                <td class="numDisplay">
                                                    <span class="contractTargetKHTotal" id="contractTargetKHTotal_{!cpiKey}">{!cpiObj.ASI_CRM_KH_Total_Price__c}</span>
                                                    <!--<apex:outputText value="{0, number, ###,###,###,###.00}" rendered="{!cpiObj.ASI_CRM_Total__c != 0}"><apex:param value="{!cpiObj.ASI_CRM_Total__c}"/></apex:outputText>
                                                    <apex:outputText value="0.00" rendered="{!cpiObj.ASI_CRM_Total__c == 0}"/>
													-->
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                    <tfoot>
                                        <tr>
                                            <th style="text-align:right;" colspan="6" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                            <th class="numDisplay" id="footer_total_TotalSum" rowspan="1" colspan="1">
                                                <span id="span_footer_total_KHTotalSum"/>
                                            </th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                        
                        
                        <apex:outputPanel layout="block" style="border: 0px black solid; text-align: center;" rendered="{!isEdit}">
                            <apex:commandButton value="Save" 
                                                status="loading"
                                                onclick="changeShowEntries()"
                                                action="{!saveContract}"
                                                reRender="pageMsg" 
                                                oncomplete="gotoRecord('{!strPageID}')">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                            &nbsp;
                            <apex:commandButton value="Quick Save" 
                                                rerender="pageMsg"
                                                onclick="changeShowEntries()"
                                                oncomplete="changeDefaultEntries()"
                                                status="loading"
                                                action="{!saveContract}">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                        </apex:outputPanel>
                        
                        
                        <apex:pageBlockSection id="section_available_SKU" title="SKU" columns="1" rendered="{!isEdit}">
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="SKU" />
                                <apex:outputPanel >
                                    <apex:inputText value="{!skuNameFilter}" />
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="Sub-Brand" />
                                <apex:outputPanel >
                                    <apex:selectList value="{!subBrandSelected}" size="1" label="Sub-Brand">
                                        <apex:selectOptions value="{!subBrandSelectOptions}"></apex:selectOptions>
                                    </apex:selectList>
                                    <apex:commandbutton value="Search" 
                                                        action="{!retrieveSKUbySubBrand}" 
                                                        rerender="pageBlock_SKU, pageBlock_Merchandising, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg" 
                                                        onComplete="setTables('{!region}');" 
                                                        status="loading"/>
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem >
                            </apex:pageBlockSectionItem>
                            
                            <apex:outputPanel layout="block" rendered="{!region == 'MY'}">
                                <table id="available_SKU"> 
                                    <apex:repeat var="csKey" value="{!allSKUMap}">
                                        <apex:repeat var="csObj" value="{!allSKUMap[csKey]}">
                                            <tr>
                                                <td>
                                                    <apex:commandLink value="Add"
                                                                      rendered="true" 
                                                                      immediate="false"
                                                                      action="{!addContractProductItem}"
                                                                      rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('Add CPI'); setTables('{!region}');"
                                                                      status="loading"> 
                                                        <apex:param name="PARAM_CONTRACT_SOURCE_ITEM_ID" value="{!csKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputField value="{!csObj.Name}"/></td>
                                                <td><apex:outputField value="{!csObj.ASI_HK_CRM_Pack_Factor__c}"/></td>
                                                <td><apex:outputField value="{!csObj.ASI_MFM_Sub_brand__c}"/></td>
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                            <apex:outputPanel layout="block" rendered="{!region == 'KH'}">
                                <table id="available_SKU"> 
                                    <apex:repeat var="csKey" value="{!allSKUMap}">
                                        <apex:repeat var="csObj" value="{!allSKUMap[csKey]}">
                                            <tr>
                                                <td>
                                                    <apex:commandLink value="Add"
                                                                      rendered="true" 
                                                                      immediate="false"
                                                                      action="{!addContractProductItem}"
                                                                      rerender="pageBlock_SKU, pageBlock_Merchandising, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('Add CPI'); setTables('{!region}');"
                                                                      status="loading"> 
                                                        <apex:param name="PARAM_CONTRACT_SOURCE_ITEM_ID" value="{!csKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputField value="{!csObj.Name}"/></td>
                                                <td><apex:outputField value="{!csObj.ASI_HK_CRM_Packaging_Size__c}"/></td>
                                                <td><apex:outputField value="{!csObj.ASI_MFM_Sub_brand__c}"/></td>
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                            
                            
                        </apex:pageBlockSection>
                    </apex:pageBlock>
                </div>
                
                
                <!----------------------------------------------tab_Merchandising------------------------------------------------------------------>
                <div id="tab_Merchandising">
                    <apex:pageBlock id="pageBlock_Merchandising" rendered="{!region == 'KH'}"> 
                        <apex:pageBlockSection id="section_lineItem_Merchandising" title="Merchandising" columns="1">
                            
                            <apex:outputPanel layout="block" >
                                <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}Merchandise">
                                    <apex:repeat var="cpiKey" value="{!allMerchandiseContractTargetMap}">
                                        <apex:repeat var="cpiObj" value="{!allMerchandiseContractTargetMap[cpiKey]}">
                                            <tr id="row_SKU_{!cpiKey}" class="cpiContent">
                                                <td>
                                                    <apex:commandLink value="Delete"
                                                                      immediate="false"
                                                                      action="{!removeContractSKU}"
                                                                      rerender="pageBlock_SKU, pageBlock_Merchandising, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('Remove CPI'); setTables('{!region}');"
                                                                      status="loading"
                                                                      rendered="{!isEdit}">
                                                        <apex:param name="PARAM_CONTRACT_SKU_ID" value="{!cpiKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td style="text-align: right;"><apex:inputField value="{!cpiObj.ASI_CRM_KH_Merchandise_Name__c}"
                                                                                                required="false"
                                                                                                styleclass="TargetCases"/>
                                                </td>
                                                <td style="text-align: right;"><apex:inputField value="{!cpiObj.ASI_CRM_KH_Merchandising_Size__c}"
                                                                                                required="false"
                                                                                                styleclass="TargetCases"/>
                                                </td>
                                                <td style="text-align: right;"><apex:inputField value="{!cpiObj.ASI_CRM_KH_Merchandising_Quantity__c}"
                                                                                                required="false"
                                                                                                styleclass="TargetCases"/>
                                                </td>
                                        	</tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                   
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                        
                        <apex:outputPanel layout="block" style="border: 0px black solid; text-align: center;" rendered="{!isEdit}">
                            <apex:commandButton value="Add"
                                              rerender="pageBlock_SKU, pageBlock_Merchandising, pageMsg"
                                              action="{!addMerchandisingContract}"
                                              onComplete="setTables('{!region}');"
                                              status="loading"> 
                               
                            </apex:commandButton>
                            &nbsp;
                            <apex:commandButton value="Save" 
                                                status="loading"
                                                onclick="changeShowEntries()"
                                                action="{!saveContract}"
                                                reRender="pageMsg" 
                                                oncomplete="gotoRecord('{!strPageID}')">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                            &nbsp;
                            <apex:commandButton value="Quick Save" 
                                                rerender="pageMsg"
                                                onclick="changeShowEntries()"
                                                oncomplete="changeDefaultEntries()"
                                                status="loading"
                                                action="{!saveContract}">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                            
                        </apex:outputPanel>
                        
                        </apex:pageBlock>
                </div>

                
                
                
                
                <!----------------------------------------------tab_SSIncentives------------------------------------------------------------------>
                <div id="tab_SSIncentives">
                    <apex:pageBlock id="pageBlock_SSIncentives" rendered="{!Region == 'MY'}"> 
                        <apex:pageBlockSection id="section_lineItem_SSIncentives" title="Sales & Staff Incentives" columns="1">
                            <apex:outputPanel layout="block">
                                <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}SSIncentives">
                                    <apex:repeat var="cpiKey" value="{!allSSIncentivesMap}">
                                        <apex:repeat var="cpiObj" value="{!allSSIncentivesMap[cpiKey]}">
                                            <tr id="row_SSIncentives_{!cpiKey}" class="cpiContent2">   
                                                <!---2018.1 To allow input cross-brand SKU --->
                                                <td>
                                                    <apex:outputField value="{!cpiObj.ASI_CRM_SKU__c}"/> 
                                                </td>
                                                <td> 
                                                    <!---- highlight if there is difference -->
                                                    <apex:outputPanel styleClass="{!if(cpiObj.ASI_CRM_CrossBrandSKU__c!=cpiObj.ASI_CRM_SKU__c, 'blueLinkColor','')}">
                                                        <apex:outputField value="{!cpiObj.ASI_CRM_CrossBrandSKU__c}" />
                                                    </apex:outputPanel>
                                                </td>
                                                
                                                <!-------------------Added for cross-brand SKU Input (2018.01):--------------------->
                                                <td>
                                                    <apex:commandLink value="Edit"
                                                                      rendered="{!isEdit && skuIDForChangeSS!=cpiKey}"
                                                                      action="{!selectContractSKUForChangeSS}"
                                                                      rerender="pageBlock_SSIncentives, pageMsg"
                                                                      onComplete="setTables('{!region}');"
                                                                      status="loading" > 
                                                        <apex:param name="PARAM_CONTRACT_SOURCE_ITEM_ID_TO_CHANGE_SS" value="{!cpiKey}"/>
                                                    </apex:commandLink>
                                                    
                                                    <apex:commandLink value="Cancel Editing"
                                                                      rendered="{!isEdit && skuIDForChangeSS==cpiKey}"
                                                                      action="{!cancelContractSKUChangeSS}"
                                                                      rerender="pageBlock_SSIncentives, pageMsg"
                                                                      onComplete="setTables('{!region}');"
                                                                      status="loading" > 
                                                        <apex:param name="PARAM_CONTRACT_SOURCE_ITEM_ID_TO_CHANGE_SS" value="{!cpiKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td>
                                                    <!--<apex:inputField value="{!cpiObj.ASI_CRM_SetupCode__c}"/>-->
                                                    <apex:selectList value="{!cpiObj.ASI_CRM_SetupCode__c}" size="1">
                                                        <apex:selectOptions value="{!ContractSetupCodeValue}"/>
                                                    </apex:selectList>
                                                </td>
                                                <td class="numDisplay">
                                                    <!-- <apex:outputField value="{!cpiObj.ASI_CRM_MinSPBtl__c}" class="SSMinSPBtl"/> -->
                                                    <span class="SSMinSPBtl" style="display:none;">{!cpiObj.ASI_CRM_MinSPBtl__c}</span>
                                                    <apex:outputText value="{0, number, ###,###,###,###.00}" rendered="{!cpiObj.ASI_CRM_MinSPBtl__c != 0}"><apex:param value="{!cpiObj.ASI_CRM_MinSPBtl__c}"/></apex:outputText>
                                                    <apex:outputText value="0.00" rendered="{!cpiObj.ASI_CRM_MinSPBtl__c == 0}"/>
                                                </td>
                                                <td style="text-align: right;">
                                                    <apex:inputField value="{!cpiObj.ASI_CRM_AchievedBtl__c}" styleClass="SSAchievedBtl narrowInput numInput"
                                                                     onChange="summarizeSSIncentives();"/>
                                                </td>
                                                <td style="text-align: right;">
                                                    <apex:inputField value="{!cpiObj.ASI_CRM_FOCWS__c}" styleClass="SSFOCWS narrowInput numInput" onChange="summarizeSSIncentives();"/>
                                                </td>
                                                <td style="text-align: right;">
                                                    <apex:inputField value="{!cpiObj.ASI_CRM_FOCPRM__c}" styleClass="narrowInput numInput SSFOCPRM" onChange="summarizeSSIncentives();"/>
                                                </td>
                                                <td style="text-align: right;">
                                                    <apex:inputField value="{!cpiObj.ASI_CRM_CashInc__c}" styleClass="cashInput numInput SSCashInc" onChange="summarizeSSIncentives();"/>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                    <tfoot>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th style="text-align:right;" colspan="2" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                            <th class="numDisplay" id="footer_total_SSminiSPCase" rowspan="1" colspan="1">
                                                <span id="span_footer_total_SSMinSPCase"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_SSAchievedBtl" rowspan="1" colspan="1">
                                                <span id="span_footer_total_SSAchievedBtl"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_SSFOCWS" rowspan="1" colspan="1">
                                                <span id="span_footer_total_SSFOCWS"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_SFOCPRM" rowspan="1" colspan="1">
                                                <span id="span_footer_total_SSFOCPRM"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_SSCashInc" rowspan="1" colspan="1">
                                                <span id="span_footer_total_SSCashInc"/>
                                            </th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                        
                        <apex:outputPanel layout="block" style="border: 0px black solid; text-align: center;" rendered="{!isEdit}">
                            <apex:commandButton value="Save" 
                                                status="loading"
                                                action="{!saveContract}"
                                                reRender="pageMsg" 
                                                oncomplete="gotoRecord('{!strPageID}')">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                            &nbsp;
                            <apex:commandButton value="Quick Save" 
                                                rerender="pageMsg"
                                                oncomplete="console.log('Quick Save Done');"
                                                status="loading"
                                                action="{!saveContract}">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                        </apex:outputPanel>
                        
                        <!----------------------------SKU Search Section for Sales & Staff Incentives to input cross-brand SKUs(2018.01)------------------------->
                        <apex:pageBlockSection id="section_available_SS_CrossBrandSKU" title="SKU" columns="1" rendered="{!isEdit}">
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="SKU" />
                                <apex:outputPanel >
                                    <apex:inputText value="{!skuNameFilterSS}" />
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="Sub-Brand" />
                                <apex:outputPanel >
                                    <apex:selectList value="{!subBrandSelectedSS}" size="1" label="Sub-Brand">
                                        <apex:selectOptions value="{!subBrandSelectOptions}"></apex:selectOptions>
                                    </apex:selectList>
                                    <apex:commandbutton value="Search" 
                                                        action="{!retrieveSKUbySubBrandSS}" 
                                                        rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg" 
                                                        onComplete="setTables('{!region}');" 
                                                        status="loading"/>
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem >
                            </apex:pageBlockSectionItem>
                            <apex:outputPanel layout="block">
                                <table id="available_SS_CrossBrandSKU">
                                    <apex:repeat var="csKey" value="{!allSKUMapSS}">
                                        <apex:repeat var="csObj" value="{!allSKUMapSS[csKey]}">
                                            <tr>
                                                <td>
                                                    <apex:commandLink value="Select"
                                                                      rendered="true" 
                                                                      immediate="true"
                                                                      action="{!changeContractCrossBrandSKUSS}"
                                                                      rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('change SKU for SS'); setTables('{!region}');"
                                                                      status="loading"> 
                                                        <apex:param name="PARAM_CONTRACT_SOURCE_ITEM_ID_SS" value="{!csKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputField value="{!csObj.Name}"/></td>
                                                <td><apex:outputField value="{!csObj.ASI_MFM_Sub_brand__c}"/></td>
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                    </apex:pageBlock>
                </div>          
                
                <!----------------------------------------------tab_VolumeIncentives------------------------------------------------------------------>
                <div id="tab_VolumeIncentives">
                    <apex:pageBlock id="pageBlock_VolumeIncentives" rendered="{!Region == 'MY'}"> 
                        <apex:pageBlockSection id="section_lineItem_VolumeIncentives" title="Volume Incentives" columns="1">
                            <apex:outputPanel layout="block">
                                <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}VolumeIncentives">
                                    <apex:repeat var="cpiKey" value="{!allVolumeIncentivesMap}">
                                        <apex:repeat var="cpiObj" value="{!allVolumeIncentivesMap[cpiKey]}">
                                            <tr id="row_VolumeIncentives_{!cpiKey}" class="cpiContent2">
                                                
                                                <td>
                                                    <apex:inputField value="{!cpiObj.ASI_CRM_Description__c}"/>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!cpiObj.ASI_CRM_SKU__c}"/>
                                                </td>
                                                <td>
                                                    <apex:selectList value="{!cpiObj.ASI_CRM_SetupCode__c}" size="1">
                                                        <apex:selectOptions value="{!ContractSetupCodeValue}"/>
                                                    </apex:selectList>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!cpiObj.ASI_CRM_PackFactor__c}"/>
                                                </td>
                                                <td class="numDisplay">
                                                    <!-- <apex:outputField value="{!cpiObj.ASI_CRM_MinSPBtl__c}" styleClass="narrowInput VolMinSPBtl"/> -->
                                                    <span class="VolMinSPBtl" style="display:none;">{!cpiObj.ASI_CRM_MinSPBtl__c}</span>
                                                    <apex:outputText value="{0, number, ###,###,###,###.00}" rendered="{!cpiObj.ASI_CRM_MinSPBtl__c != 0}"><apex:param value="{!cpiObj.ASI_CRM_MinSPBtl__c}"/></apex:outputText>
                                                    <apex:outputText value="0.00" rendered="{!cpiObj.ASI_CRM_MinSPBtl__c == 0}"/>
                                                </td>
                                                <td style="text-align: right;">
                                                    <apex:inputField value="{!cpiObj.ASI_CRM_AchievedBtl__c}" styleClass="narrowInput numInput VolAchievedBtl" onChange="$('#volIncentivesTotal_{!cpiKey}').text(calculateVolTotal($('#row_VolumeIncentives_{!cpiKey}')));summarizeVolumeIncentives();"/>
                                                </td>
                                                <td style="text-align: right;">
                                                    <apex:inputField value="{!cpiObj.ASI_CRM_FOC__c}" styleClass="narrowInput numInput VolFOC" onChange="$('#volIncentivesTotal_{!cpiKey}').text(calculateVolTotal($('#row_VolumeIncentives_{!cpiKey}')));summarizeVolumeIncentives();"/>
                                                </td>
                                                <td style="text-align: right;">
                                                    <apex:inputField value="{!cpiObj.ASI_CRM_CashInc__c}" styleClass="cashInput numInput VolCashInc" onChange="$('#volIncentivesTotal_{!cpiKey}').text(calculateVolTotal($('#row_VolumeIncentives_{!cpiKey}')));summarizeVolumeIncentives();"/>
                                                </td>
                                                
                                                <!--<td>
<apex:inputField value="{!cpiObj.ASI_CRM_Total__c}" styleClass="totalInput numInput VolTotal" onChange="summarizeVolumeIncentives();"/>
<span class="VolTotal" value="{!cpiObj.ASI_CRM_Total__c}" id="volIncentivesTotal_{!cpiKey}" />
</td>-->
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                    <tfoot>
                                        <tr>
                                            <th style="text-align:right;" colspan="5" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                            <!--<th class="numDisplay" id="footer_total_VolminiSPCase" rowspan="1" colspan="1">
<span id="span_footer_total_VolMinSPCase"/>
</th>-->
                                            <th class="numDisplay" id="footer_total_VolAchievedBtl" rowspan="1" colspan="1">
                                                <span id="span_footer_total_VolAchievedBtl"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_VolFOCWS" rowspan="1" colspan="1">
                                                <span id="span_footer_total_VolFOC"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_VolCashInc" rowspan="1" colspan="1">
                                                <span id="span_footer_total_VolCashInc"/>
                                            </th>
                                            <!--<th class="numDisplay" id="footer_total_VolTotal" rowspan="1" colspan="1">
                                            <span id="span_footer_total_VolTotal"/>
                                            </th>-->
                                        </tr>
                                    </tfoot>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                    </apex:pageBlock>
                </div>
                
                <!----------------------------------------------tab_OtherIncentives------------------------------------------------------------------>
                <div id="tab_OtherIncentives">
                    <apex:pageBlock id="pageBlock_OtherIncentives" rendered="{!Region == 'MY'}"> 
                        <apex:pageBlockSection id="section_lineItem_OtherIncentives" title="Other Incentives" columns="1">
                            <apex:outputPanel layout="block">
                                <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}OtherIncentives">
                                    <apex:repeat var="cpiKey" value="{!allOtherIncentivesMap}">
                                        <apex:repeat var="cpiObj" value="{!allOtherIncentivesMap[cpiKey]}">
                                            <tr id="row_OtherIncentives_{!cpiKey}" class="cpiContent">
                                                <td>
                                                    <apex:commandLink value="Clone"
                                                                      action="{!cloneContractSKUOther}"
                                                                      rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('clone CPI'); setTables('{!region}');"
                                                                      status="loading"
                                                                      rendered="{!isEdit}">
                                                        <apex:param name="PARAM_CONTRACT_SKU_ID_OTHER" value="{!cpiKey}"/>
                                                    </apex:commandLink>
                                                    
                                                    <apex:outputText value=" | " rendered="{!isEdit}" />
                                                    
                                                    <apex:commandLink value="Delete"
                                                                      immediate="false"
                                                                      action="{!removeContractSKUOther}"
                                                                      rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('Remove CPI'); setTables('{!region}');"
                                                                      status="loading"
                                                                      rendered="{!isEdit}">
                                                        <apex:param name="PARAM_CONTRACT_SKU_ID_OTHER" value="{!cpiKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputPanel style="display:none"><apex:outputField value="{!cpiObj.ASI_CRM_Type__c}"/></apex:outputPanel><apex:inputField value="{!cpiObj.ASI_CRM_Type__c}"/></td>
                                                <td><apex:inputField value="{!cpiObj.ASI_CRM_Description__c}"/></td>
                                                <td><apex:outputField value="{!cpiObj.ASI_CRM_SKU__c}"/></td>
                                                <td>
                                                    <apex:selectList value="{!cpiObj.ASI_CRM_SetupCode__c}" size="1">
                                                        <apex:selectOptions value="{!ContractSetupCodeValue}"/>
                                                    </apex:selectList>
                                                </td>
                                                <td><apex:outputField value="{!cpiObj.ASI_CRM_PackFactor__c}"/></td>
                                                <td class="numDisplay"><!-- <apex:outputField value="{!cpiObj.ASI_CRM_MinSPBtl__c}" /> -->
                                                    <span class="OVolMinSPBtl" style="display:none;">{!cpiObj.ASI_CRM_MinSPBtl__c}</span>
                                                    <apex:outputText value="{0, number, ###,###,###,###.00}" rendered="{!cpiObj.ASI_CRM_MinSPBtl__c != 0}"><apex:param value="{!cpiObj.ASI_CRM_MinSPBtl__c}"/></apex:outputText>
                                                    <apex:outputText value="0.00" rendered="{!cpiObj.ASI_CRM_MinSPBtl__c == 0}"/>
                                                </td>
                                                <td style="text-align: right;"><apex:inputField value="{!cpiObj.ASI_CRM_AchievedBtl__c}" styleClass="narrowInput numInput OAchievedBtl" onChange="$('#OtherIncentivesTotal_{!cpiKey}').text(calculateOVolTotal($('#row_OtherIncentives_{!cpiKey}')));summarizeOtherIncentives();"/></td>
                                                <td style="text-align: right;"><apex:inputField value="{!cpiObj.ASI_CRM_FOC__c}" styleClass="narrowInput numInput OVolFOC" onChange="$('#OtherIncentivesTotal_{!cpiKey}').text(calculateOVolTotal($('#row_OtherIncentives_{!cpiKey}')));summarizeOtherIncentives();"/></td>
                                                <td style="text-align: right;"><apex:inputField value="{!cpiObj.ASI_CRM_CashInc__c}" styleClass="cashInput numInput OVolCashInc" onChange="$('#OtherIncentivesTotal_{!cpiKey}').text(calculateOVolTotal($('#row_OtherIncentives_{!cpiKey}')));summarizeOtherIncentives();"/></td>
                                                <td class="numDisplay"><!--<apex:inputField value="{!cpiObj.ASI_CRM_Total__c}" styleClass="totalInput numInput OVolTotal" onChange="summarizeOtherIncentives();"/>-->
                                                    <span class="OVolTotal" id="OtherIncentivesTotal_{!cpiKey}" style="display:none;">{!cpiObj.ASI_CRM_Total__c}</span>
                                                    <apex:outputText value="{0, number, ###,###,###,###.00}" rendered="{!cpiObj.ASI_CRM_Total__c != 0}"><apex:param value="{!cpiObj.ASI_CRM_Total__c}"/></apex:outputText>
                                                    <apex:outputText value="0.00" rendered="{!cpiObj.ASI_CRM_Total__c == 0}"/>
                                                </td>
                                                
                                                
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                    <tfoot>
                                        <tr>
                                            <th style="text-align:right;" colspan="6" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                            <th class="numDisplay" id="footer_total_OVolminiSPCase" rowspan="1" colspan="1">
                                                <span id="span_footer_total_OVolMinSPCase"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_OAchievedBtl" rowspan="1" colspan="1">
                                                <span id="span_footer_total_OAchievedBtl"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_OVolFOC" rowspan="1" colspan="1">
                                                <span id="span_footer_total_OVolFOC"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_OVolCashInc" rowspan="1" colspan="1">
                                                <span id="span_footer_total_OVolCashInc"/>
                                            </th>
                                            <th class="numDisplay" id="footer_total_OVolTotal" rowspan="1" colspan="1">
                                                <span id="span_footer_total_OVolTotal"/>
                                            </th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                        
                        <apex:outputPanel layout="block" style="border: 0px black solid; text-align: center;" rendered="{!isEdit}">
                            <apex:commandButton value="Save" 
                                                status="loading"
                                                action="{!saveContract}"
                                                reRender="pageMsg" 
                                                oncomplete="gotoRecord('{!strPageID}')">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                            &nbsp;
                            <apex:commandButton value="Quick Save" 
                                                rerender="pageMsg"
                                                oncomplete="console.log('Quick Save Done');"
                                                status="loading"
                                                action="{!saveContract}">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                        </apex:outputPanel>
                        
                        <apex:pageBlockSection id="section_available_SKUOther" title="SKU" columns="1" rendered="{!isEdit}">
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="SKU" />
                                <apex:outputPanel >
                                    <apex:inputText value="{!skuNameFilterOther}" />
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="Sub-Brand" />
                                <apex:outputPanel >
                                    <apex:selectList value="{!subBrandSelectedOther}" size="1" label="Sub-Brand">
                                        <apex:selectOptions value="{!subBrandSelectOptions}"></apex:selectOptions>
                                    </apex:selectList>
                                    <apex:commandbutton value="Search" 
                                                        action="{!retrieveSKUbySubBrandOther}" 
                                                        rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg" 
                                                        onComplete="setTables('{!region}');" 
                                                        status="loading"/>
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem ></apex:pageBlockSectionItem>
                            
                            <apex:outputPanel layout="block">
                                <table id="available_SKUOther">
                                    <apex:repeat var="csKey" value="{!allSKUMapOther}">
                                        <apex:repeat var="csObj" value="{!allSKUMapOther[csKey]}">
                                            <tr>
                                                <td>
                                                    <apex:commandLink value="Add"
                                                                      rendered="true" 
                                                                      immediate="false"
                                                                      action="{!addContractProductItemOther}"
                                                                      rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('Add CPI'); setTables('{!region}');"
                                                                      status="loading"> 
                                                        <apex:param name="PARAM_CONTRACT_SOURCE_ITEM_ID_OTHER" value="{!csKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputField value="{!csObj.Name}"/></td>
                                                <td><apex:outputField value="{!csObj.ASI_MFM_Sub_brand__c}"/></td>
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                    </apex:pageBlock>
                </div>
                
                <!----------------------------------------------tab_PromoterPlacement------------------------------------------------------------------>
                <div id="tab_PromoterPlacements">
                    <apex:pageBlock id="pageBlock_PromoterPlacements" rendered="{!region == 'MY'}"> 
                        <apex:pageBlockSection id="section_lineItem_PromoterPlacements" title="Promoter Placements" columns="1">
                            <apex:outputPanel layout="block">
                                <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}PromoterPlacements">
                                    <apex:repeat var="cpiKey" value="{!allPromoterPlacementsMap}">
                                        <apex:repeat var="cpiObj" value="{!allPromoterPlacementsMap[cpiKey]}">
                                            <tr id="row_PromoterPlacements_{!cpiKey}" class="cpiContent">
                                                <td>
                                                    <apex:commandLink value="Delete"
                                                                      immediate="false"
                                                                      action="{!removeContractSKUPromoterPlacements}"
                                                                      rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('Remove CPI'); setTables('{!region}');"
                                                                      status="loading"
                                                                      rendered="{!isEdit}">
                                                        <apex:param name="PARAM_CONTRACT_SKU_ID_PromoterPlacements" value="{!cpiKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputField value="{!cpiObj.ASI_CRM_SKU__c}"/></td>
                                                <td>
                                                    <apex:selectList value="{!cpiObj.ASI_CRM_SetupCode__c}" size="1">
                                                        <apex:selectOptions value="{!ContractSetupCodeValue}"/>
                                                    </apex:selectList>
                                                </td>
                                                <td><apex:inputField value="{!cpiObj.ASI_CRM_DailySalary__c}" styleClass="numInput" /></td>
                                                <td><apex:inputField value="{!cpiObj.ASI_CRM_PromoterCount__c}" styleClass="narrowInput numInput" /></td>
                                                <td><apex:inputField value="{!cpiObj.ASI_CRM_WorkingDay__c}" styleClass="narrowInput numInput" /></td>
                                                <td><apex:inputField value="{!cpiObj.ASI_CRM_WorkingMonth__c}" styleClass="narrowInput numInput" /></td>
                                                <td class="numDisplay">
                                                    <!--<apex:outputField value="{!cpiObj.ASI_CRM_TotalFx__c}"/>-->
                                                    <apex:outputText value="{0, number, ###,###,###,###.00}" rendered="{!cpiObj.ASI_CRM_TotalFx__c != 0}"><apex:param value="{!cpiObj.ASI_CRM_TotalFx__c}"/></apex:outputText>
                                                    <apex:outputText value="0.00" rendered="{!cpiObj.ASI_CRM_TotalFx__c == 0}"/>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                        
                        <apex:outputPanel layout="block" style="border: 0px black solid; text-align: center;" rendered="{!isEdit}">
                            <apex:commandButton value="Save" 
                                                status="loading"
                                                action="{!saveContract}"
                                                reRender="pageMsg" 
                                                oncomplete="gotoRecord('{!strPageID}')">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                            &nbsp;
                            <apex:commandButton value="Quick Save" 
                                                rerender="pageMsg"
                                                oncomplete="console.log('Quick Save Done');"
                                                status="loading"
                                                action="{!saveContract}">
                                <!--<apex:param name="IS_QUICK_SAVE" value="true"/>-->
                            </apex:commandButton>
                        </apex:outputPanel>
                        
                        <apex:pageBlockSection id="section_available_SKUPromoterPlacements" title="SKU" columns="1" rendered="{!isEdit}">
                            
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="SKU" />
                                <apex:outputPanel >
                                    <apex:inputText value="{!skuNameFilterPP}" />
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="Sub-Brand" />
                                <apex:outputPanel >
                                    <apex:selectList value="{!subBrandSelectedPP}" size="1" label="Sub-Brand">
                                        <apex:selectOptions value="{!subBrandSelectOptions}"></apex:selectOptions>
                                    </apex:selectList>
                                    <apex:commandbutton value="Search" 
                                                        action="{!retrieveSKUbySubBrandPP}" 
                                                        rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg" 
                                                        onComplete="setTables('{!region}');" 
                                                        status="loading"/>
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem ></apex:pageBlockSectionItem>
                            
                            <apex:outputPanel layout="block">
                                <table id="available_SKUPP">
                                    <apex:repeat var="csKey" value="{!allSKUMapOther}">
                                        <apex:repeat var="csObj" value="{!allSKUMapOther[csKey]}">
                                            <tr>
                                                <td>
                                                    <apex:commandLink value="Add"
                                                                      rendered="true" 
                                                                      immediate="false"
                                                                      action="{!addContractProductItemPromoterPlacements}"
                                                                      rerender="pageBlock_SKU, pageBlock_SSIncentives, pageBlock_VolumeIncentives, pageBlock_OtherIncentives, pageBlock_PromoterPlacements, pageMsg"
                                                                      onComplete="console.log('Add CPI'); setTables('{!region}');"
                                                                      status="loading"> 
                                                        <apex:param name="PARAM_CONTRACT_SOURCE_ITEM_ID_PromoterPlacements" value="{!csKey}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputField value="{!csObj.Name}"/></td>
                                                <td><apex:outputField value="{!csObj.ASI_MFM_Sub_brand__c}"/></td>
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                    </apex:pageBlock>
                </div>
                
            </div> <!-- END OF MAIN TABLE-->
            
            
            <script>
            $("#mechanicTypeTabs").tabs();
            </script>
            
        </apex:pageBlock>
    </apex:form>
    
    <apex:actionstatus id="loading">
        <apex:facet name="start">
            <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
               height: 1000%; width:1000%; opacity:0.65;"> 
                <div class="waitingHolder" id="loadtext" style="position: absolute;" align="left" valign="top">
                    &nbsp;&nbsp;&nbsp;
                    <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                    <span class="waitingDescription">Please Wait...</span>
                </div>
            </div>
        </apex:facet>
    </apex:actionstatus>
    
    <script>
        $(document).on('mousemove', function(e){
            $('#loadtext').css({
               left:  e.pageX,
               top:   e.pageY
            });
        });
        
        function gotoRecord(pageID){  
            //alert(pageID);
            changeDefaultEntries();
            
            if(pageID!='ERROR'){
                window.open("/" + pageID, '_parent'); 
            }
        }
        
        function changeShowEntries(){
            //document.getElementsByName('ContractLineItemTable_SSIncentives_length')[0].options[2].setAttribute("selected", "selected");
            //$('[name="ContractLineItemTable_SSIncentives_length"]')[0].options[2].setAttribute("selected", "selected"); 
            
            $('[name="ContractLineItemTable_SKU_length"]').val("1000");
            $('[name="ContractLineItemTable_SKU_length"]').change();
            
            $('[name="ContractLineItemTable_SSIncentives_length"]').val("1000");
            $('[name="ContractLineItemTable_SSIncentives_length"]').change();
            
            $('[name="ContractLineItemTable_VolumeIncentives_length"]').val("1000");
            $('[name="ContractLineItemTable_VolumeIncentives_length"]').change();
            
            $('[name="ContractLineItemTable_OtherIncentives_length"]').val("1000");
            $('[name="ContractLineItemTable_OtherIncentives_length"]').change();
            
            $('[name="ContractLineItemTable_PromoterPlacements_length"]').val("1000");
            $('[name="ContractLineItemTable_PromoterPlacements_length"]').change();
        }
        
        function changeDefaultEntries(){
            $('[name="ContractLineItemTable_SKU_length"]').val("60");
            $('[name="ContractLineItemTable_SKU_length"]').change();
            
            $('[name="ContractLineItemTable_SSIncentives_length"]').val("60");
            $('[name="ContractLineItemTable_SSIncentives_length"]').change();
            
            $('[name="ContractLineItemTable_VolumeIncentives_length"]').val("60");
            $('[name="ContractLineItemTable_VolumeIncentives_length"]').change();
            
            $('[name="ContractLineItemTable_OtherIncentives_length"]').val("60");
            $('[name="ContractLineItemTable_OtherIncentives_length"]').change();
            
            $('[name="ContractLineItemTable_SSIncentives_length"]').val("60");
            $('[name="ContractLineItemTable_SSIncentives_length"]').change();
            
            $('[name="ContractLineItemTable_PromoterPlacements_length"]').val("60");
            $('[name="ContractLineItemTable_PromoterPlacements_length"]').change();
        }
    </script>

</body>
</apex:page>