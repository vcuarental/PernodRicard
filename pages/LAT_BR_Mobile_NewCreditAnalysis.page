<apex:page sidebar="false" showHeader="false" standardController="Analise_de_credito__c" docType="html-5.0" extensions="LAT_BR_VFC13_NuevoAnalisisCredito" action="{!pageActionInit}" >    

	 <!-- Jquery -->
     <apex:includeScript value="https://code.jquery.com/jquery-1.12.3.js"/> 
	 <!-- Bootrap 3.0 -->
     <apex:stylesheet value="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"/>
     <apex:includeScript value="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"/> 

    <apex:includeScript value="{!$Resource.LAT_BR_CreditAnalysisResources}/js/jquery.min.js" />
    <apex:includeScript value="{!$Resource.LAT_BR_CreditAnalysisResources}/js/accounting.min.js" />
    <apex:stylesheet value="{!$Resource.LAT_BR_CreditAnalysisResources}/css/style.css"/>

    <script>
        function close(){
            window.close();
            //window.open('','_self').close();
        }

        function creditClicked(credId){
            $('#'+credId).find('input').attr('value',credId);
            editCreditAF();
        }

        function newCreditAnal(){
            newCreditAF();
        }

        function sendApprovalJs(credId){
            $('#'+credId).find('input').attr('value',credId);
            sendApprovalAF();
        }
        function init() {
        
         /*var total = calcTotal($('.FYCA'), $('.FYPreco'));
         $('.PFTotalFooter').text(total);
         
         var total = 0;
         $('.RecomendColumn').each(function() {
             var percent = $(this).text().replace('%','');
             total += eval(percent);
             console.info(total);
         });
         $('.RecomendFooter').text(total + '%');
         
         var total = calcTotal($('.FYCAAnt'), $('.FYPrecoAnt'));
         $('.PFAntTotalFooter').text(total);
         
         calcPFAtualTotal();
         calcPFAntTotal();
         calcPErcents();
         calcPFCrecimiento();*/
         
         internationalFormat();
        }



        function setInputValues(){
            $( ".dblInput" ).each(function( index ) {
                $(this).next().val(eval($(this).next().val()).toFixed(2));
              $(this).val(parseDotToComma($(this).next().val()));
            }); 
     
            $( ".PFCrescimiento" ).each(function( index ) {
              $(this).text(parseDotToComma($(this).text()));
            }); 
        
                    total = 0;
                    $('.pesoCol').each(function() {
                        var percent = $(this).text().replace('%','');
                        total += eval(percent);
                        $(this).text(parseDotToComma($(this).text()));
                    });
                    $('.pesoFooter').text(total + '%');
            calcPFAntTotal();
            
                

            
        }

        function parseDotToComma(val){
            /*nStr = val.replace(/\./g, '');
            nStr += '';
            x = nStr.split('.');
            x1 = x[0];
            x2 = x.length > 1  ? ',' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + '.' + '$2');
            }
            ret = x1 + x2;
            ret = val;
            ret = ret.toString().replace(/\./g, ',');
            ret = ret.toString().replace(/,/g, '.');
            return ret;*/
            
            val = val.toString();
            if(val.indexOf(',') != -1){
                val = val.replace(/\./g, '');
                val = val.replace(/,/g, '.');
            }

           
            val = val.replace(/\./g, ',');
         

            nStr = val;
            x = nStr.split(',');
            x1 = x[0];
            x2 = x.length > 1  ? ',' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + '.' + '$2');
            }
            ret = x1 + x2;
            if(ret.indexOf(',') == -1){
                ret += ',00';
            }   
            return ret;
        }

        function parseCommaToDot(val){
            val = val.replace(/\./g, '');
            return val.replace(/,/g, '.');
            //return val;
        }


        function PFAtualchange(thisObj) {
             percent = parseCommaToDot($(thisObj).val().replace('%',''));
             retHidden = eval((parseCommaToDot($('.PFTotalFooter').text()) * percent) / 100).toFixed(2);
             var ret = parseDotToComma(retHidden);
             
             $(thisObj).parent().parent().siblings('.PFValorColumn').find('span').text(ret);
             $(thisObj).parent().parent().siblings('.PFValorColumn').find('input').val(retHidden);
             
             if ($(thisObj).parent().parent().siblings('.PFValorAntColumn').find('input').val() != 'undefined' 
                 && $(thisObj).parent().parent().siblings('.PFValorAntColumn').find('input').val() != undefined) {
                 var ant = $(thisObj).parent().parent().siblings('.PFValorAntColumn').find('span').text().replace('%','');
                 if ((ant - 1) != 0) {
                    ant = parseCommaToDot(ant);
                    ret = parseCommaToDot(ret);
                    $(thisObj).parent().parent().siblings('.PFCrescimiento').text(parseDotToComma(Math.round((ret/(ant - 1)) * 100) / 100));
                 } else {
                    $(thisObj).parent().parent().siblings('.PFCrescimiento').text(0);
                 }
             }
             calcPFAtualTotal();
             calcPFCrecimiento();
        }

        function PFAnteriorchange(thisObj) {
             percent = parseCommaToDot($(thisObj).val().replace('%',''));

             retHidden = eval((parseCommaToDot($('.PFAntTotalFooter').text()) * percent) / 100).toFixed(2);
             var ret = parseDotToComma(retHidden);
             
             $(thisObj).parent().parent().siblings('.PFValorAntColumn').find('span').text(ret);
             $(thisObj).parent().parent().siblings('.PFValorAntColumn').find('input').val(retHidden);
             
             var actual = $(thisObj).parent().parent().siblings('.PFAtualColumn').find('input').val().replace('%','');
             if ((ret - 1)!= 0) {
                    actual = parseCommaToDot(actual);
                    ret = parseCommaToDot(ret);
                $(thisObj).parent().parent().siblings('.PFCrescimiento').text(parseDotToComma(Math.round((actual/(ret - 1)) * 100) / 100));
             } else {
                $(thisObj).parent().parent().siblings('.PFCrescimiento').text(0);
             }
             
             calcPFAntTotal();
             calcPFCrecimiento();
        }

        function calcTotal2(fyCaList, fyPrecoList) {        
                    var total = 0;
                    for (var i = 0; i < fyCaList.length; i++) {
                        total += eval(($(fyCaList[i]).next().val()*$(fyPrecoList[i]).next().val()));
                    }
                    return total.toFixed(2);
                }

        function calcTotal(fyCaList, fyPrecoList) {        
            var total = 0;
            for (var i = 0; i < fyCaList.length; i++) {
                total += eval(($(fyCaList[i]).val()*$(fyPrecoList[i]).val()));
            }
            return total;
        }

        function calcPFAtualTotal(selector) {
            var total = 0;
            $('.PFAtual').each(function() {
                percent = $(this).next().val().replace('%','');
                total += eval(percent);

            });
            $('.PFAtualTotal').text(parseDotToComma(Math.round(total * 100) / 100));
            //$('.PFAtualTotal').text(Math.round(total * 100) / 100 + '%');
        }

        function calcPFAntTotal() {
            var total = 0;
            $('.PFAnterior').each(function() {
                if ($(this).next().val() != 'undefined' && 
                    $(this).next().val() != undefined ) {
                    percent = $(this).next().val().replace('%','');
                    total += eval(percent);
                } else {

                    percent = $(this).text().replace('%','');
                    total += eval(percent);

                }
            });

            $('.PFAntTotal').text(parseDotToComma(Math.round(total * 100) / 100 ));
        }

        function calcPFCrecimiento(selector) {
            var total = 0;
            $('.PFCrescimiento').each(function() {
                var percent = eval(parseCommaToDot($(this).text()));
                total += eval(percent);
            });
            $('.PFTotalCrescimiento').text(parseDotToComma(Math.round(total * 100) / 100 ));
        }

        function calcPErcents() {
            $('.PFAtual').each(function(){
                percent = $(this).next().val().replace('%','');
                 percent = eval(percent).toFixed(2);


                retHidden = eval((parseCommaToDot($('.PFTotalFooter').text()) * percent) / 100).toFixed(2);
                var ret = parseDotToComma(percent);

                $(this).text(ret);
                 $(this).parent().parent().siblings('.PFValorColumn').find('span').text(parseDotToComma(retHidden));

                 $(this).parent().parent().siblings('.PFValorColumn').find('input').val(retHidden);
             });
        }

        function calcPErcentsAnt () {
            $('.PFAnterior').each(function(){

                 percent = $(this).next().val().replace('%','');
                 percent = eval(percent).toFixed(2);

                retHidden = eval((parseCommaToDot($('.PFAntTotalFooter').text()) * percent) / 100).toFixed(2);
                var ret = parseDotToComma(percent);
                $(this).text(ret);
                 $(this).parent().parent().siblings('.PFValorAntColumn').find('span').text(parseDotToComma(retHidden));
                 $(this).parent().parent().siblings('.PFValorAntColumn').find('input').val(retHidden);
            });
        }

        function assignValues(thisObj) {
             $(thisObj).parent().siblings('.RecomendColumn').find('span').text($(thisObj).val());
             $(thisObj).parent().siblings('.RecomendColumn').find('input').val($(thisObj).find('option:selected').text());
             var total = 0;
             $('.RecomendColumn').each(function() {
                 var percent = $(this).text().replace('%','');
                 if (eval(percent)) {
                    total += eval(percent);
                 }
             });
             
             $('.RecomendFooter').text(total );
        }

        function internationalFormat() {
            // Sales Forecast
            FormatRowNumbers('FYPrecoAntVendas');
            FormatRowNumbers('FYAntRowTotal');
            
            // Proposed Billing
            FormatRowNumbers('PFValorColumnAnt');
            FormatRowNumbers('PFValorColumn15');
            FormatRowNumbers('PFValorTotal');
            FormatRowNumbers('PFTotalFooterAnt');
        }

        function FormatRowNumbers(selector) {
            $('.' + selector).each(function() {$(this).text(accounting.formatNumber(eval($(this).text().replace(/,/g, '')), 2, ".", ","))});
        }
    </script>
	<style>
		body{
			background-color: #182237;
		}
         .buttonCancel{
            width: 100%;
            height: 41px;
            color: white !important;
            background: red !important;
        }

        .buttonSave{
              width: 100%;
              height: 41px;
              color: white !important;
              background: green !important;
        }

		.newButton{
			background: orange !important;
			height: 50px;
			width: 20%;
			font-size: 28px !important;
		}

        .addProductBtn{
            background: orange !important;
            height: 30px;
            width: 20%;
            font-size: 18px !important;
        }
		.relatedListSectionHeader{
			color:white;
			font-family: Segoe UI;
			font-weight: lighter;
			font-size: 30px;
			text-align: center;
		}
		#tableSegmentation td {
			color:white;
			font-size: 20px;
		}
		#tableSegmentation thead{
			color:white; 
			font-size: 20px;
		}
		#tableCreditAnal td {
			color:#828282;
			font-size: 20px;
		}
		#tableCreditAnal thead{
			color:white; 
			font-size: 20px;
		}

        #tableCreditAnal tfoot{
            color: white;
            background-color: #a5a5a5;
        }

		.newCreditAnal{
			color:white;
            font-size: 25px;
		}

		h3{
			color:white;
            margin-bottom: 5%;
		}
        .not-active {
           pointer-events: none;
           cursor: default;
           color:white;
        }
        .buttons-group{
            margin-top: 4%;

        }
	</style>

	<apex:form >

    <!-- New/Edit Credit analisis -->
	<apex:actionFunction action="{!newCreditApex}" name="newCreditAF" />
	<apex:actionFunction action="{!editCreditApex}" name="editCreditAF" />
	<apex:actionFunction action="{!sendApproval}" name="sendApprovalAF" />

	<!-- New Action functions -->
	<apex:actionFunction action="{!addPrevisaoDeVendas}" name="addPrevisaoDeVendasJs" />
    <!-- Save and Cancel  -->
    <apex:actionFunction action="{!saveAll}" name="saveAC" />
    <apex:actionFunction action="{!cancel}" name="cancelAC" />
	<apex:pageMessages />

    <!-- Credit Analysis List -->
	<apex:outputPanel id="credList" rendered="{!isEditNew}">
		<div class="container">		
				<div>
					<button type="button" class="btn btn-success newButton" onclick="newCreditAnal();">Novo</button>
					<div class="relatedListSectionHeader">{!$ObjectType.Analise_de_credito__c.labelPlural}</div>
				</div>
				<div class="row ">
					<table id="tableSegmentation" class="table">
						<thead>
							<tr>
								<th></th>
								<th>{!$ObjectType.Analise_de_credito__c.fields.Name.Label}</th>
								<th>{!$ObjectType.Analise_de_credito__c.fields.Sugestao_do_analista__c.Label}</th>
								<th>{!$ObjectType.Analise_de_credito__c.fields.CreatedDate.Label}</th>
								<th>{!$ObjectType.Analise_de_credito__c.fields.LastModifiedDate.Label}</th>
								<th>{!$ObjectType.Analise_de_credito__c.fields.LAT_BR_Status__c.Label}</th>
                                <th></th>
							</tr>
						</thead>
						<tbody>
							<apex:outputPanel rendered="{!listCreditAnal != null }">
							<apex:repeat value="{!listCreditAnal}" var="cred">
							<tr >
								<td>
									<div id="{!cred.Id}">
										<apex:inputHidden value="{!credIdParam}"/>
										<button onclick="creditClicked('{!cred.Id}');return false;" class="btn newButton" style="width:100% !important;">Editar</button>
									</div>
								</td>
								<td>{!cred.Name}</td>
								<td>{!cred.Sugestao_do_analista__c}</td>
								<td>
								<!-- <apex:outputText>{!cred.CreatedDate}</apex:outputText> -->
									<apex:outputText value="{0,date,dd'/'MM'/'yyyy}">
										<apex:param value="{!cred.CreatedDate}" />
									</apex:outputText>
								</td>
								<td>
									<apex:outputText value="{0,date,dd'/'MM'/'yyyy}">
										<apex:param value="{!cred.LastModifiedDate}" />
									</apex:outputText>
								</td>
								<td>{!cred.LAT_BR_Status__c}</td>
                                 <td>
                                      <button class="btn newButton" onclick="sendApprovalJs('{!cred.Id}'); return false;" style="width:100% !important;">Enviar para Aprovação</button>
                                </td>
							</tr>
						</apex:repeat>
					</apex:outputPanel>
				</tbody>
			</table>
		</div>
		</div>
    </apex:outputPanel>

    <!-- ################################################################################################################## -->
    <!-- #################################### NOVO Analise de Credit ###################################################### -->
    <!-- ################################################################################################################## -->

	<apex:outputPanel rendered="{!NOT(isEditNew)}" >
	<div class="container">
		<div class="row newCreditAnal">
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Conta__c.Label}</label>
                <div class="not-active">
                    <apex:outputField styleClass="form-control input-lg" value="{!ac.Conta__c}" />
                </div>
                
			</div>
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Ramo_de_atuacao_Macrosegmento__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.Ramo_de_atuacao_Macrosegmento__c}" />

			</div>
		</div>

		<div class="row newCreditAnal">
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.N_Funcionarios__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.N_Funcionarios__c}" />
			</div>
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Atividade_principal__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.Atividade_principal__c}" />
			</div>
		</div>

		<div class="row newCreditAnal">
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.N_de_funcionarios_incluindo_filiais__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.N_de_funcionarios_incluindo_filiais__c}" />
			</div>
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Predio_instala_es__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.Predio_instala_es__c}" />
			</div>
		</div>

		<div class="row newCreditAnal">
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Valor_mensal_folha_de_pagamento__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.Valor_mensal_folha_de_pagamento__c}" />
			</div>
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Metros_quadrados__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.Metros_quadrados__c}" />
			</div>
		</div>

		<div class="row newCreditAnal">
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Empresas_coligadas__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.Empresas_coligadas__c}" />
			</div>
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Valor_mensal_aluguel__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.Valor_mensal_aluguel__c}" />
			</div>
		</div>

		<div class="row newCreditAnal">
			<div class="col-lg-6 col-md-6 col-xs-6">
				<label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.LAT_BR_Status__c.Label}</label>
				<apex:inputField styleClass="form-control input-lg" value="{!ac.LAT_BR_Status__c}" />
			</div>

		</div>


	    <div class="PrevisaoDeVendas ">
	      <hr/>
	      <h3>{!$Label.LAT_BR_VFP13_SalesForecastSection}</h3>
          <apex:actionRegion >
    	      <apex:outputPanel id="PrevisaoDeVendas">
    	      <script>
    	      	setInputValues(); 
    	      </script>
    		  <table id="tableCreditAnal" class="table">
    		    		<thead>
    		    			<tr>
    		    				<th>{!$Label.LAT_BR_VFP13_SKUColumn}</th>
    		    				<th>{!$Label.LAT_BR_VFP13_CAColumn}</th>
    		    				<th>{!$Label.LAT_BR_VFP13_PriceColumn}</th>
    		    				<th>{!$Label.LAT_BR_VFC13_Action}</th>
    		    			</tr>
    		    		</thead>
    		    		<tbody>
    		    			<apex:variable value="{!0}" var="iter" />
    		    			<apex:repeat value="{!salesPrevission}" var="item">
    			    			<tr >
    			    				<td>
    				    				<apex:selectList id="skuSelect" value="{!item.SKU}" size="1" >
    				    					<apex:selectOptions value="{!SKUPFY}"/>
    				    				</apex:selectList> 
    			    				</td>
    			    				<td>
    			    					 <c:LAT_inputComponent dblValue="{!item.CA}" stclass="FYCA" />
    			    				</td>
    			    				<td>
    			    					<c:LAT_inputComponent dblValue="{!item.Preco}" stclass="FYPreco" />
    			    				</td>
    			    				<td>
    				    				<apex:commandLink action="{!removePrevisaoDeVendas}" value="{!$Label.LAT_BR_VFC13_Remove}">
    				    					<apex:param value="{!iter}" name="index" /> 
    				    				</apex:commandLink>
    				    				 <apex:variable value="{!iter + 1}" var="iter" />       
    			    				</td>
    			    			</tr>
    		    			   
    		    			</apex:repeat>
    				    </tbody>
    			</table>

    			
    			<script type="text/javascript">
    				$('.FYCA').change(function() {
    					var fyCaList = $('.FYCA');
    					var fyPrecoList = $('.FYPreco');
    					var total = calcTotal2(fyCaList, fyPrecoList);
    					$('.PFTotalFooter').text(parseDotToComma(total));
    					calcPErcents();
    				});
    				$('.FYPreco').change(function() {
    					var fyCaList = $('.FYCA');
    					var fyPrecoList = $('.FYPreco');
    					var total = calcTotal2(fyCaList, fyPrecoList);
    					$('.PFTotalFooter').text(parseDotToComma(total));
    					calcPErcents();
    				});
    			</script>
    			</apex:outputPanel>
                 <div style="text-align: right;">
                 <apex:commandLink action="{!addPrevisaoDeVendas}" value="{!$Label.LAT_BR_VFP13_AddSKU}" styleClass="btn addProductBtn"/>
    			     <!-- <apex:commandButton action="{!addPrevisaoDeVendas}" value="{!$Label.LAT_BR_VFP13_AddSKU}" rerender="PrevisaoDeVendas" styleClass="btn addProductBtn"/>	 -->
                 </div>
            </apex:actionRegion>
	    </div>
	    <div class="PrevisaoDeVendasAnterior">
	    	<apex:outputPanel id="PrevisaoDeVendasAnterior" rendered="{!AND(isRevision,isCreditoCobranca)}">
	    	<hr/>
	        <h3>{!$Label.LAT_BR_VFP13_ConductedPrevFY}</h3>
	        <script>
	        	setInputValues();
	        </script>
	         <table id="tableCreditAnal" class="table">
		    		<thead>
		    			<tr>
		    				<th>{!$Label.LAT_BR_VFP13_SKUColumn}</th>
		    				<th>{!$Label.LAT_BR_VFP13_CAColumn}</th>
		    				<th>{!$Label.LAT_BR_VFP13_PriceColumn}</th>
		    				<th>{!$Label.LAT_BR_VFC13_Action}</th>
		    			</tr>
		    		</thead>
		    		<tbody>
		    			<apex:variable value="{!0}" var="iterAnt" />
		    			<apex:repeat value="{!salesPrevissionAnt}" var="item">
			    			<tr >
			    				<td>
				    				<apex:selectList id="skuSelect" value="{!item.SKU}" size="1" >
				    					<apex:selectOptions value="{!SKUPFY}"/>
				    				</apex:selectList>
			    				</td>
			    				<td>
			    					<c:LAT_inputComponent dblValue="{!item.CA}" stclass="FYCAAnt" />
			    				</td>
			    				<td>
			    					<c:LAT_inputComponent dblValue="{!item.Preco}" stclass="FYPrecoAnt" />
			    				</td>
			    				<td>
				    				<apex:commandLink action="{!removePrevisaoDeVendasAnt}" reRender="PrevisaoDeVendasAnterior" value="{!$Label.LAT_BR_VFC13_Remove}" >
				    					<apex:param value="{!iterAnt}" name="indexAnt" /> 
				    				</apex:commandLink>
				    				<apex:variable value="{!iterAnt + 1}" var="iterAnt" />
			    				</td>
			    			</tr>
		    			</apex:repeat>
				    </tbody>
			</table>
			<script type="text/javascript">
				$('.FYCAAnt').change(function() {
					var fyCaList = $('.FYCAAnt');
					var fyPrecoList = $('.FYPrecoAnt');
					var total = calcTotal2(fyCaList, fyPrecoList);
					$('.PFAntTotalFooter').text(parseDotToComma(total));
					calcPErcentsAnt();
				});
				$('.FYPrecoAnt').change(function() {
					var fyCaList = $('.FYCAAnt');
					var fyPrecoList = $('.FYPrecoAnt');
					var total = calcTotal2(fyCaList, fyPrecoList);
					$('.PFAntTotalFooter').text(parseDotToComma(total));
					calcPErcentsAnt();
				});
			</script>
	        <apex:commandLink action="{!addPrevisaoDeVendas}" value="{!$Label.LAT_BR_VFP13_AddSKU}" styleClass="btn addProductBtn"/>
	        </apex:outputPanel>
	    </div>
	    <div class="PrevisaoDeVendasAnterior2">
	    	<apex:outputPanel rendered="{!AND(isRevision,!isCreditoCobranca)}">
	    	<apex:outputPanel rendered="{!salesPrevissionAnt.size > 0}">
	    	<hr/>
	        <h3>{!$Label.LAT_BR_VFP13_ConductedPrevFY}</h3>
	         <table id="tableCreditAnal" class="table">
		    		<thead>
		    			<tr>
		    				<th>{!$Label.LAT_BR_VFP13_SKUColumn}</th>
		    				<th>{!$Label.LAT_BR_VFP13_CAColumn}</th>
		    				<th>{!$Label.LAT_BR_VFP13_PriceColumn}</th>
		    				<th>{!$Label.LAT_BR_VFP13_ValueColumn}</th>
		    			</tr>
		    		</thead>
		    		<tbody>
		    			<apex:repeat value="{!salesPrevissionAnt}" var="item" rendered="{!salesPrevissionAnt.size > 0}">
			    			<tr >
			    				<td>
				    				  <apex:outputText value="{!item.SKU}" />
			    				</td>
			    				<td>
			    					<c:LAT_inputComponent dblValue="{!item.CA}" stclass="FYCAAnt displayNone" />
				    				<apex:outputText value="{0, number, ###,###,##0}">
				    					<apex:param value="{!item.CA}" />
				    				</apex:outputText>
			    				</td>
			    				<td>
			    					 <c:LAT_inputComponent dblValue="{!item.Preco}" stclass="FYPrecoAnt displayNone" />
			    					 <apex:outputText value="{0, number, ###,###,##0.00}" styleClass="FYPrecoAntVendas">
			    					  <apex:param value="{!item.Preco}"/>
			    					 </apex:outputText>
			    				</td>
			    				<td>
				    				<apex:outputText value="{0, number, ###,###,##0.00}" styleClass="FYAntRowTotal">
				    					<apex:param value="{!item.Preco * item.CA}"/>
				    				</apex:outputText>
			    				</td>
			    			</tr>
		    			</apex:repeat>
				    </tbody>
			</table>
			<script type="text/javascript">
				$('.FYCAAnt').change(function() {
					var fyCaList = $('.FYCAAnt');
					var fyPrecoList = $('.FYPrecoAnt');
					var total = calcTotal2(fyCaList, fyPrecoList);
					$('.PFAntTotalFooter').text(parseDotToComma(total));
					calcPErcentsAnt();
				});
				$('.FYPrecoAnt').change(function() {
					var fyCaList = $('.FYCAAnt');
					var fyPrecoList = $('.FYPrecoAnt');
					var total = calcTotal2(fyCaList, fyPrecoList);
					$('.PFAntTotalFooter').text(parseDotToComma(total));
					calcPErcentsAnt();
				});
			</script>
			</apex:outputPanel>
	        </apex:outputPanel>
	    </div>
        <div class="BillingProposalSection">
	      <hr/>
	      <h3>{!$Label.LAT_BR_VFC13_BillingProposalSection}</h3>
	      {!isRevision}
	      <apex:outputPanel id="a">
		  <table id="tableCreditAnal" class="table">
		    		<thead>
		    			<tr>
		    				<th>{!$Label.LAT_BR_VFP13_QuarterColumn}</th>
		    				<th style="display: {!IF(isRevision,'block','none')}">{!$Label.LAT_BR_VFP13_PrevFY}</th>
		    				<th>{!$Label.LAT_BR_VFP13_CurrentFY}</th>
		    				<th style="display: {!IF(isRevision,'block','none')}">{!$Label.LAT_BR_VFP13_FatPrevColumn}</th>
		    				<th>{!$Label.LAT_BR_VFP13_CurrentFatColumn}</th>
		    				<th style="display: {!IF(isRevision,'block','none')}">{!$Label.LAT_BR_VFP_Growth}</th>
		    			</tr>
		    		</thead>
		    		<tbody>
		    			<apex:repeat value="{!billingProposal}" var="item">
			    			<tr >
			    				<td>
				    				 {!item.Trimestre}
			    				</td>
			    				<td class="PFAnteriorColumn" style="display: {!IF(isRevision,'block','none')}">
			    					<c:LAT_inputComponent dblValue="{!item.FYAnt}" stclass="PFAnterior" onChange="PFAnteriorchange(this)" rendered="{!isCreditoCobranca}"/>
			    					<!--<apex:inputText value="{!item.FYAnt}" styleClass="PFAnterior" onchange="PFAnteriorchange(this)" rendered="{!isCreditoCobranca}"/> -->

			    					<c:LAT_inputComponent dblValue="{!item.FYAnt}" stclass="PFAnterior displayNone" onChange="PFAnteriorchange(this)" rendered="{!!isCreditoCobranca}" />

			    					<c:LAT_inputComponent dblValue="{!item.FYAnt}" stclass="PFAnterior" onChange="PFAnteriorchange(this)" rendered="{!!isCreditoCobranca}" renderSpan="True"/>
			                        <!--<apex:inputText value="{!item.FYAnt}" styleClass="PFAnterior" onchange="PFAnteriorchange(this)" rendered="{!!isCreditoCobranca}" style="display:none;"/> 
			                        <apex:outputText value="{!item.FYAnt}" rendered="{!!isCreditoCobranca}" />-->
			    				</td>
			    				<td class="PFAtualColumn">
			    					 <c:LAT_inputComponent dblValue="{!item.FY}" stclass="PFAtual" onChange="PFAtualchange(this)"/>
			    				</td>
			    				<td  style="display: {!IF(isRevision,'block','none')}" class="PFValorAntColumn">
				    				<apex:inputHidden value="{!item.ValorAnt}" id="PFValorAntInput"/>
			                        <apex:outputpanel >
			                            {!ROUND(item.ValorAnt, 2)}
			                        </apex:outputpanel>  
			    				</td>
			    				
			    				<td class="PFValorColumn">
			    					<apex:inputHidden value="{!item.Valor}" id="PFValorAtualInput"/>
			    					<apex:outputpanel >
			    					{!ROUND(item.Valor, 2)}
			    					</apex:outputpanel>
			    				</td>
			    				
			    				<td  style="display: {!IF(isRevision,'block','none')}" class="PFCrescimiento">
			    				 	{!IF(item.ValorAnt != 0, ROUND(((item.Valor - item.ValorAnt)/ item.ValorAnt ) * 100, 2), 0)}
			    				</td>
			    				
			    			</tr>
		    			</apex:repeat>
				    </tbody>
				    <tfoot>
				    	<tr>
		    				<th>Total</th>
		    				<th style="display: {!IF(isRevision,'block','none')}" class="PFAntTotal">0</th>
		    				<th class="PFAtualTotal">0</th>
		    				<th style="display: {!IF(isRevision,'block','none')}" class="PFAntTotalFooter">0</th>
		    				<th class="PFTotalFooter">0</th>
		    				<th style="display: {!IF(isRevision,'block','none')}">0</th>
		    			</tr>
				    </tfoot>
			</table>
			 <script type="text/javascript">
			 	var total = calcTotal2($('.FYCA'), $('.FYPreco'));
			 	$('.PFTotalFooter').text(parseDotToComma(Math.round(total * 100) / 100));

			 	var total = calcTotal2($('.FYCAAnt'), $('.FYPrecoAnt'));
			 	$('.PFAntTotalFooter').text(parseDotToComma(Math.round(total * 100) / 100));
			 	setInputValues();
			 	calcPFAtualTotal();
			 	calcPFAntTotal();
			 	calcPErcents();
			 	calcPErcentsAnt();
			 	calcPFCrecimiento();
			 </script>
			</apex:outputPanel>
	    </div>
        <div class="ClientBehavior">
            <apex:outputPanel id="ClientBehavior" rendered="{!isCreditoCobranca}">
                <hr/>
                <h3>{!$Label.LAT_BR_VFC13_ClientBehavior}</h3>
                 <table id="tableCreditAnal" class="table">
                        <thead>
                            <tr>
                                <th>{!$Label.LAT_BR_VFC13_ClientBehavior}</th>
                                <th>{!$Label.LAT_BR_VFP13_ValueColumn}</th>
                                <th>{!$Label.LAT_BR_VFP13_Weights}</th>
                                <th>{!$Label.LAT_BR_VFP_Recommendation}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <apex:repeat value="{!clientB}" var="item2">
                                <tr >
                                    <td>{!item2.comportamentC}</td>
                                    <td>
                                        <apex:selectList value="{!item2.Recomendacao}" size="1" onchange="assignValues(this)">
                                            <apex:selectOptions value="{!item2.sOption}"/>
                                        </apex:selectList>
                                    </td>
                                    <td>{!item2.Pesos}</td>
                                    <td>
                                        <apex:inputHidden value="{!item2.CCValor}" id="RecomendColumnInput"/>
                                        <apex:outputpanel >
                                            {!item2.Recomendacao}
                                        </apex:outputpanel>
                                    </td>
                                </tr>
                            </apex:repeat>
                        </tbody>
                         <tfoot>
                            <tr>
                                <th>Total</th>
                                <th class="PFAtualTotal"></th>
                                <th class="PFTotalFooter">0</th>
                            </tr>
                        </tfoot>
                </table>
                 <script type="text/javascript">
                        var total = 0;
                        $('.RecomendColumn').each(function() {
                            var percent = $(this).text().replace('%','');
                            if (eval(percent)) {
                                total += eval(percent);
                            }
                        });
                        total = total || 0;
                        $('.RecomendFooter').text(total + '%');
                        total = 0;
                       
                        total = total || 0;
                        $('.pesoFooter').text(total + '%');
                    </script>
                </apex:outputPanel>
        </div>
        <div class="ClientBehaviorNotCobranza" >
              <apex:outputPanel id="ClientBehaviorNotCobranza" rendered="{!isCreditoCobranca}">
                <hr/>
                <h3>{!$Label.LAT_BR_VFC13_ClientBehavior}</h3>
                 <table id="tableCreditAnal" class="table">
                        <thead>
                            <tr>
                                <th>{!$Label.LAT_BR_VFC13_ClientBehavior}</th>
                                <th>{!$Label.LAT_BR_VFP13_ValueColumn}</th>
                                <th>{!$Label.LAT_BR_VFP13_Weights}</th>
                                <th>{!$Label.LAT_BR_VFP_Recommendation}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <apex:repeat value="{!clientB}" var="item3">
                                <tr >
                                    <td>{!item3.comportamentC}</td>
                                    <td>{!item3.CCValor}</td>
                                    <td>{!item3.Pesos}</td>
                                    <td>{!item3.Recomendacao}</td>
                                </tr>
                            </apex:repeat>
                        </tbody>
                         <tfoot>
                            <tr>
                                <th>Total</th>
                                <th class="PFAtualTotal"></th>
                                <th class="PFTotalFooter"></th>
                                <th class="PFTotalFooter"></th>
                            </tr>
                        </tfoot>
                </table>
                  <script>
                    var total = 0;
                    $('.RecomendColumn').each(function() {
                         var percent = $(this).text().replace('%','');
                         if (eval(percent)) {
                            total += eval(percent);
                         }
                    });
                    $('.RecomendFooter').text(total + '%');
                    total = 0;
                    $('.pesoCol').each(function() {
                        var percent = $(this).text().replace('%','');
                        total += eval(percent);
                        $(this).text(parseDotToComma($(this).text()));
                    });
                    total = total || 0;
                    $('.pesoFooter').text(total + '%');
                </script>
                </apex:outputPanel>
        </div>
        <div class="CISPinformation" >
              <apex:outputPanel id="CISPInfoTable" rendered="{!isCreditoCobranca}">
                <hr/>
                <h3>{!$Label.LAT_BR_VFP13_CISPinformation}</h3>
                 <table id="tableCreditAnal" class="table">
                        <thead>
                            <tr>
                                <th>{!$Label.LAT_BR_VFP13_CISPinformation}</th>
                                <th>{!$Label.LAT_BR_VFP13_Ordination}</th>
                                <th>{!$Label.LAT_BR_VFP13_Company}</th>
                                <th>{!$Label.LAT_BR_VFP13_GreaterAccumulation}</th>
                                <th>{!$Label.LAT_BR_VFP13_Date}</th>
                                <th>{!$Label.LAT_BR_VFP13_Limit}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <apex:repeat value="{!CISPInfo}" var="item">
                                <tr >
                                    <td>
                                        <apex:selectList id="InfoSelect" value="{!item.InfoCISP}" size="1">
                                            <apex:selectOptions value="{!CISPInfoSO}"/>
                                        </apex:selectList>
                                    </td>
                                    <td><apex:inputText value="{!item.Ordenacao}" /></td>
                                    <td><apex:inputText value="{!item.Empresa}" /></td>
                                    <td><apex:inputText value="{!item.MaiorAcum}" /></td>
                                    <td><apex:input value="{!item.Data}" type="auto"/></td>
                                    <td><apex:inputText value="{!item.Limite}" /></td>
                                </tr>
                            </apex:repeat>
                            </tbody>
                </table>
                 <apex:commandButton action="{!addCISPInfo}" value="{!$Label.LAT_BR_VFP13_AddInformationCISP}" rerender="CISPInfoTable"/>
                </apex:outputPanel>
        </div>
        <div class="AdditionalInformation" >
             <hr/>
                <h3>{!$Label.LAT_BR_VFP13_AdditionalInformation}</h3>
                <apex:inputField value="{!ac.Observacoes__c}" styleClass="textField"/>
        </div>
        <div class="CompositionOfCapital" >
            <hr/>
            <h3>{!$Label.LAT_BR_VFP13_CompositionOfCapital}</h3>
            <div class="row newCreditAnal">
                <div class="col-lg-6 col-md-6 col-xs-6">
                    <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Capital_social__c.Label}</label>
                    <apex:inputField styleClass="form-control input-lg" value="{!ac.Capital_social__c}" rendered="{!isCreditoCobranca}"/>
                    <apex:outputText styleClass="form-control input-lg" value="{!ac.Capital_social__c}" rendered="{!!isCreditoCobranca}"/>
                </div>
                <div class="col-lg-6 col-md-6 col-xs-6">
                    <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Patrimonio_liquido__c.Label}</label>
                    <apex:inputField styleClass="form-control input-lg" value="{!ac.Patrimonio_liquido__c}" rendered="{!isCreditoCobranca}"/>
                    <apex:outputText styleClass="form-control input-lg" value="{!ac.Patrimonio_liquido__c}" rendered="{!!isCreditoCobranca}"/>
                </div>
            </div>
       </div>
        <div class="CISPinformation" >
              <apex:outputPanel id="SuggestedCreditLimit" >
                <hr/>
                <h3>{!$Label.LAT_BR_VFP13_SuggestedCreditLimit}</h3>

                 <div class="row newCreditAnal">

                    <div class="col-lg-6 col-md-6 col-xs-6">
                        <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Prazo_normal_de_pagamento__c.Label}</label>
                        <apex:inputField styleClass="form-control input-lg" value="{!ac.Prazo_normal_de_pagamento__c}" rendered="{!isCreditoCobranca}"/>
                        <apex:outputText styleClass="form-control input-lg" value="{!ac.Prazo_normal_de_pagamento__c}" rendered="{!!isCreditoCobranca}"/>
                    </div>
                     <div class="col-lg-6 col-md-6 col-xs-6">
                         <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Special_term__c.Label}</label>
                        <apex:inputField styleClass="form-control input-lg" value="{!ac.Special_term__c}" rendered="{!isCreditoCobranca}"/>
                        <apex:outputText styleClass="form-control input-lg" value="{!ac.Special_term__c}" rendered="{!!isCreditoCobranca}"/>
                    </div>
                   
                </div>

                   <div class="row newCreditAnal">
                    <div class="col-lg-6 col-md-6 col-xs-6">
                        <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Coface_Limit__c.Label}</label>
                        <apex:inputField styleClass="form-control input-lg" value="{!ac.Coface_Limit__c}" rendered="{!isCreditoCobranca}"/>
                        <apex:outputText styleClass="form-control input-lg" value="{!ac.Coface_Limit__c}" rendered="{!!isCreditoCobranca}"/>
                    </div>
                    <div class="col-lg-6 col-md-6 col-xs-6">
                        <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Current_Limit__c.Label}</label>
                        <apex:inputField styleClass="form-control input-lg" value="{!ac.Current_Limit__c}" rendered="{!AND(isRevision, isCreditoCobranca)}"/>
                        <apex:outputText styleClass="form-control input-lg" value="{!ac.Current_Limit__c}" rendered="{!!isCreditoCobranca}"/>
                    </div>
                   
                 </div>
                 
                 <div class="row newCreditAnal">
                     <div class="col-lg-6 col-md-6 col-xs-6">
                         <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Greater_Exposure__c.Label}</label>
                         <apex:inputField styleClass="form-control input-lg" value="{!ac.Greater_Exposure__c}" rendered="{!AND(isRevision, isCreditoCobranca)}"/>
                         <apex:outputText styleClass="form-control input-lg" value="{!ac.Greater_Exposure__c}" rendered="{!!isCreditoCobranca}"/>
                     </div>

                       <div class="col-lg-6 col-md-6 col-xs-6">
                         <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Greater_Exposure_month__c.Label}</label>
                        <apex:inputField styleClass="form-control input-lg" value="{!ac.Greater_Exposure_month__c}" rendered="{!AND(isRevision, isCreditoCobranca)}"/>
                        <apex:outputText styleClass="form-control input-lg" value="{!ac.Greater_Exposure_month__c}" rendered="{!!isCreditoCobranca}"/>
                       </div>
                 </div>
                <div class="row newCreditAnal">
                    <div class="col-lg-6 col-md-6 col-xs-6">
                         <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Sugestao_do_analista__c.Label}</label>
                        <apex:inputField styleClass="form-control input-lg" value="{!ac.Sugestao_do_analista__c}"/>
                    </div>
                     <div class="col-lg-6 col-md-6 col-xs-6">
                        <label for="exampleInputEmail1" class="labelsColor">{!$ObjectType.Analise_de_credito__c.fields.Comentarios_Consideracoes_finais__c.Label}</label>
                        <apex:inputField styleClass="textField form-control input-lg" value="{!ac.Comentarios_Consideracoes_finais__c}"/>
                     </div>
                 </div>
               </apex:outputPanel>
        </div>
        <!-- Buttons -->
       <div class="row buttons-group">
            <div class="col-md-12">
                <div class="col-md-6">
                    <button type="button" class="btn btn-success buttonSave" onclick="saveAC();return false;">{!$Label.LAT_VFP04_00002}</button>
                     <!-- <apex:commandButton action="{!doSave}" name="Salvar"  id="theButton"> -->
                </div>
                <div class="col-md-6">
                    <button type="button" class="btn btn-success buttonCancel" onclick="cancelAC();">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
	</apex:outputPanel>
    <apex:actionFunction name="refreshBI" action="{!retryBi}" reRender="MainPB, errorMessages" status="status"></apex:actionFunction>
	</apex:form>
	<script type="text/javascript">
		init();
		setInputValues();
	</script>	
</apex:page>