<apex:page standardController="ASI_TH_CRM_Contract__c" extensions="ASI_CRM_CN_Contract_Controller">
    <apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery1.10.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.min.js')}"/>
    <style>
        .negative{
            color : red;
            font-weight : bold;
        }
    </style>
<!--<apex:pageMessages /> 20170329 Elufa hide duplicate page message-->
<apex:detail rendered="{!!IsCNCRM}"/>
<apex:outputLink value="/{!$ObjectType.ASI_TH_CRM_Contract__c}/o" id="theLink"><apex:outputText value="<< Back to List: Contract"></apex:outputText></apex:outputLink>
<chatter:feedWithFollowers entityid="{!ASI_TH_CRM_Contract__c.id}" />
<apex:form rendered="{!IsCNCRM}" styleClass="blockEnterClass" >
<apex:outputPanel id="is_EN" rendered="{!!showCN}">
<apex:pageblock title="Contract" id="Contract">
    <apex:pageMessages id="showmsg"></apex:pageMessages>
<apex:actionstatus id="showStatus">
            <apex:facet name="start">
                <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                       height: 100%;opacity:0.65;width:100%;"> 
                    <div class="waitingHolder" style="top: 10px; width: 91px;">
                        <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                        <span class="waitingDescription">Please Wait...</span>
                    </div>
                </div>
            </apex:facet>
        </apex:actionstatus>
    <apex:pageblockButtons location="top" rendered="{!LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}" >
        <!--20170127 Elufa added  && ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c != 'FY landing Archive'-->
        <apex:commandButton value="Edit" action="{!GoEdit}" rendered="{!if(showEdit,true,false) && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}"/>
        <apex:commandButton value="Contract Shuttle" onclick="window.open('/apex/ASI_CRM_CN_ContractProfitShuttlePDF_Page?id={!ASI_TH_CRM_Contract__c.id}')" rendered="{!ContractSelected.ASI_CRM_CN_PO_Version__c='0.0' && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}"/> <!--action="{!ContractShuttle}" />-->
<!--    <apex:commandButton value="Contract Shuttle" onclick="window.open('/apex/ASI_CRM_CN_ContractProfitShuttlePDF_Page?id={!ASI_TH_CRM_Contract__c.id}')" rendered="{!ContractSelected.ASI_CRM_CN_PO_Modification__c  !=true}"/>  -->
        <apex:commandButton value="PO Modification (PDF)" onclick="window.open('/apex/ASI_CRM_CN_ContractEmailPDFPage?id={!ASI_TH_CRM_Contract__c.id}&PDF=1')"  rendered="{!ContractSelected.ASI_CRM_CN_PO_Version__c != '0.0' && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}"/>
        <apex:commandButton value="CTD Volume Report" onclick="window.open('/apex/ASI_CRM_CN_PSFCTDPDF_Page?id={!ASI_TH_CRM_Contract__c.id}')" rendered="{!LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}" />
        <apex:commandButton value="PO Modification" styleClass="blockEnterClass" onkeypress="return false;" onkeyup="return false;" onkeydown="return false;" action="{!POModification}"  rendered="{!if(showPOModification,true,false) && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive' && !ContractSelected.ASI_CRM_CN_Is_Block__c}" reRender="Contract" status="showStatus" />
                
        <apex:commandButton value="Restore Previous Version" action="{!restorePO}" rendered="{!if(showRestorePO,true,false) && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}" reRender="Contract" status="showStatus"/>    
        <apex:commandButton value="Submit for Approval" action="{!submitApproval}" rendered="{!if(showApprovalButton && showEdit,true,false) && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}"/>
        <apex:commandButton value="Make Payment" action="{!GoPayment }" rendered="{!makePayment && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive' && !ContractSelected.ASI_CRM_CN_Is_Block__c}"/>
        <apex:commandButton value="Check Contract Uploading" action="{!changecontractupload}" rendered="{!if(!contractSelected.ASI_CRM_CN_Contract_Upload__c && contractUpload && inBAPermissionSet,true,false) && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}"/>
        <apex:commandButton value="Uncheck Contract Uploading" action="{!changecontractupload}" rendered="{!if(contractSelected.ASI_CRM_CN_Contract_Upload__c && contractUpload && inBAPermissionSet,true,false) && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}"/>
        <apex:commandButton value="Return" action="{!GoReturn}" rendered="{!showReturn && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}" rerender="showmsg"/>
<!--    <apex:commandButton value="Mark Business License Qualified" action="{!changeBusinessLicense}" rendered="{!if(BusinessLicense && contractSelected.ASI_CRM_CN_Business_License__c = 'Unqualified' && inBAPermissionSet,true,false)}"/>
        <apex:commandButton value="Mark Business License Unqualified" action="{!changeBusinessLicense}" rendered="{!if(BusinessLicense && contractSelected.ASI_CRM_CN_Business_License__c != 'Unqualified' && inBAPermissionSet,true,false)}"/>
-->

      <!--  <apex:commandButton value="CTD Volume Report" onclick="window.open('/apex/ASI_CRM_CN_PSFCTDPDF_Page?id={!ASI_TH_CRM_Contract__c.id}')" rendered="{!ContractSelected.ASI_CRM_CN_PO_Modification__c==true}" /> -->
    </apex:pageblockButtons>      
    
    <apex:pageblockButtons location="bottom" rendered="{!showEdit}">
        <apex:commandButton value="Add Contract Details" action="{!GoEditDetails}"  rendered="{!showEdit && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}"/>
    </apex:pageblockButtons>
    <!--20170127 Elufa added  && ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c != 'FY landing Archive'-->
    <apex:pageMessage summary="Need BA to check 'Contract Uploading' before making payment" severity="error" strength="3" rendered="{!paymentError}" />
    <apex:pageblocksection title="Header Information">

        <apex:pageblockSectionItem >
            <apex:outputText value="Contract No."/>
            <apex:outputField value="{!ContractSelected.Name}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="PO Start Date"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_Start_Date__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="PO No."/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_No__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="PO End Date"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_End_Date__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="PO Version"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_Version__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="Bottle Colection Rate"/>
            <!--<apex:outputField value="{!ContractSelected.ASI_CRM_CN_Bottle_Collection_Rate__c}" />-->
            <apex:outputText value="{0,number,0}%"><apex:param value="{!ContractSelected.ASI_CRM_CN_Bottle_Collection_Rate__c}"/></apex:outputText>
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}"><!--20160607 Ben @ Elufa -->
            <apex:outputText value="PP No."/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PP_No__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Currency"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Currency__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="Outlet/WS"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Outlet_WS__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Exchange Rate"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Exchange_Rate__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Currency" />
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Currency__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="{!if(ContractSelected.ASI_CRM_New_FY_PO__c, 'PO Type', 'Promotion Type')}" /><!--20160607 Ben @ Elufa -->
            <apex:outputField value="{!ContractSelected.ASI_TH_CRM_Promotion_Type__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Status"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Status__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Vol Budget/LE (9L)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Vol_Budget_LE__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Exchange Rate"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Exchange_Rate__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
        <apex:outputText value="Source of Contract"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c!='Others' && !ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="A&P Budget/LE (RMB)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Budget_LE__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Reason without Budget/LE"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Reason_without_Budget__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="Description"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Description__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Vol Budget/LE (9L)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Vol_Budget_LE__c}" />
        </apex:pageblockSectionItem>
        
        <!-- 20170309 Elufa Commented
        <apex:pageblockSectionItem >
            <apex:outputText value="National Group Contract"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_National_Group_Contract__c}"/>
        </apex:pageblockSectionItem>
        -->
        
        <!--20170203 Elufa-->
        <apex:pageblockSectionItem >
            <apex:outputText value="National Group"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_NationalGroup__c}"/>
        </apex:pageblockSectionItem>
        <!--20170203 End-->
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c!='Others' && ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="A&P Budget/LE (RMB)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Budget_LE__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Contract Uploading"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Contract_Upload__c}"/>
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="PO Channel" />
            <apex:outputField rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="{!ContractSelected.ASI_CRM_PO_Channel__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Status"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Status__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="PO Province" />
            <apex:outputField rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="{!ContractSelected.ASI_CRM_PO_Province__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Reason without Budget/LE"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Reason_without_Budget__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="PO City" />
            <apex:outputField rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="{!ContractSelected.ASI_CRM_PO_City__c}" />
        </apex:pageblockSectionItem>
<!--        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c=='Others'}">
            <apex:outputText value="A&P Budget/LE (RMB)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Budget_LE__c}" />
        </apex:pageblockSectionItem>
-->    
<!--        <apex:pageblockSectionItem >
            <apex:outputText value="Total Contract Amount"/>
            <apex:outputField value="{!ASI_TH_CRM_Contract__c.ASI_CRM_CN_Total_Contract_Amount__c}" />
        </apex:pageblockSectionItem> -->
<!--        <apex:pageblockSectionItem >
            <apex:outputText value="Business License"/>
            <apex:outputField value="{!ASI_TH_CRM_Contract__c.ASI_CRM_CN_Business_License__c}" />
        </apex:pageblockSectionItem> -->        
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Contract Uploading"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Contract_Upload__c}"/>
        </apex:pageblockSectionItem>
        
        <apex:pageblockSectionItem rendered="{!IF(ContractSelected.ASI_CRM_CN_Outlet_WS__r.RecordType.DeveloperName == 'ASI_CRM_CN_WS',true,false)}">
            <apex:outputText value="Volume Option"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_Volume_Option__c}"/>
        </apex:pageblockSectionItem>
        
        
        <apex:pageblockSectionItem >
            <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Investment_Type__c.Label}" id="InvestmentType3"   />
            <apex:outputField value="{!ContractSelected.ASI_CRM_Investment_Type__c}"  id="InvestmentType4"  />
        </apex:pageblockSectionItem>
        
        <apex:pageblockSectionItem >
        </apex:pageblockSectionItem>
        
        
 <!--       <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c=='Others'}">
            <apex:outputText value="Source (Others)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Source_Others__c}"/>
        </apex:pageblockSectionItem> -->
        
        
<!--        <apex:pageblockSectionItem >
            <apex:outputText value="Total Paid Amount"/>
            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!Total_Payments_Amount}" /></apex:outputText>
        </apex:pageblockSectionItem>  -->
    </apex:pageblocksection>
</apex:pageblock>
    <apex:pageblock title="Fixed Cost">
        <apex:pageblocktable value="{!LFixCostDisplay}" var="row">
            <apex:column >
                <apex:outputField value="{!row.name}"/>
                <apex:facet name="footer"><apex:outputLabel value="{!fix_totalCost.name}" /></apex:facet> 
            </apex:column>
            <apex:column >
                <apex:facet name="header"><apex:outputLabel value="Estimate" /></apex:facet> 
                
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CN_Estimate_Amount__c}"/></apex:outputText>
                <apex:facet name="footer">
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_CN_Estimate_Amount__c}"/></apex:outputText>
                </apex:facet> 
            </apex:column>
            <!--20160613 Ben @ Elufa -->
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" >
                <apex:facet name="header"><apex:outputLabel value="CNY(Est.)" /></apex:facet> 
                <apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_CNY_Est__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_CNY_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
                <apex:facet name="header"><apex:outputLabel value="MAF(Est.)" /></apex:facet> 
                <apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_MAF_Est__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_MAF_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" >
                <apex:facet name="header"><apex:outputLabel value="Others(Est.)" /></apex:facet> 
                <span class="OthersEstCost"><apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_Other_Est__c}"/></span>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_Other_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <!--20160613 End-->
            <apex:column >
                <apex:facet name="header"><apex:outputLabel value="Contract" /></apex:facet> 
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CN_Contract_Amount__c}"/></apex:outputText>
                <apex:facet name="footer">
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_CN_Contract_Amount__c}"/></apex:outputText>
                </apex:facet> 
                <!--
                <apex:outputField value="{!row.ASI_CRM_CN_Contract_Amount__c}"/>
                
                <apex:facet name="footer"><apex:outputLabel value="{!fix_totalCost.ASI_CRM_CN_Contract_Amount__c}" /></apex:facet>
                --> 
            </apex:column>
        </apex:pageblocktable>
    </apex:pageblock>
<apex:pageblock title="BRSF / Volume Target" >
    <apex:pageBlockTable value="{!LBRSFDisplay}" var="row">
                <apex:column >
                    <apex:facet name="header">Sub Brand</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Sub_Brand__c}" />
                    <apex:facet name="footer">Total:</apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">Est. Monthly QTY (std. Bottle)</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Est_Monthly_Qty__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0}"><apex:param value="{!totalBRSF.ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">Contract Monthly QTY (std. Bottle)</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Contract_Monthly_Qty__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0}"><apex:param value="{!totalBRSF.ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">Est. BRSF (Per Bottle)</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF.ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">Contract BRSF (Per Bottle)</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF.ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">Est. Total</apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Est_Total__c}" id="Est_Total" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF_est_total}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">Contract Total</apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Contract_Total__c}" id="Contract_Total" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF_contract_total}"/></apex:outputText></apex:facet>
                </apex:column>
                
         </apex:pageBlockTable>
</apex:pageblock>
<apex:pageblock title="Other Variable Cost">
        <apex:pageblocktable value="{!LVariableCostDisplay}" var="row">
            <apex:column >
                <apex:outputField value="{!row.name}"/>
                <apex:facet name="footer"><apex:outputLabel value="{!variable_totalCost.name}" /></apex:facet>
            </apex:column>
            <apex:column >
                <apex:facet name="header"><apex:outputLabel value="Estimate" /></apex:facet> 
                <apex:outputField value="{!row.ASI_CRM_CN_Estimate_Amount__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_CN_Estimate_Amount__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <!--20160613 Ben @ Elufa -->
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" >
                <apex:facet name="header"><apex:outputLabel value="CNY(Est.)" /></apex:facet> 
                <apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_CNY_Est__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_CNY_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
                <apex:facet name="header"><apex:outputLabel value="MAF(Est.)" /></apex:facet> 
                <apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_MAF_Est__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_MAF_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" >
                <apex:facet name="header"><apex:outputLabel value="Others(Est.)" /></apex:facet> 
                <span class="OthersEstCost"><apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_Other_Est__c}"/></span>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_Other_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <!--20160613 End-->
            <apex:column >
                <apex:facet name="header"><apex:outputLabel value="Contract" /></apex:facet> 
            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CN_Contract_Amount__c}"/></apex:outputText>
                <apex:facet name="footer">
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_CN_Contract_Amount__c}"/></apex:outputText>
                </apex:facet> 
            
            </apex:column>
        </apex:pageblocktable>
    </apex:pageblock>
<apex:pageblock title="Covered Outlet" >
    <apex:pageblocktable value="{!ContractOutletList}" var="row">
        
        <apex:column style="width:25%">
            <apex:facet name="header"><apex:outputLabel value="Outlet" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_Outlet__r.ASI_CRM_Account__c}"/>
            <apex:facet name="footer"><apex:outputLabel rendered="{!showSuggestedAmountAndTargetVolume}" value="Total :" /></apex:facet>
        </apex:column>
        
        <apex:column style="width:25%" rendered="false">
            <apex:facet name="header">Allocated Amount</apex:facet>
            <apex:outputField value="{!row.ASI_CRM_CN_Allocated_Amount__c}"  />
        </apex:column>
        
        <apex:column style="width:25%" rendered="{!showSuggestedAmountAndTargetVolume}">
            <apex:facet name="header"><apex:outputLabel value="Suggested Amount" /></apex:facet>
            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CN_Suggested_Amount__c}"/></apex:outputText>
        	<apex:facet name="footer">
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalAmount.totalSuggestedAmount}"/></apex:outputText>
            </apex:facet> 
        </apex:column>
        
        <apex:column style="width:25%" rendered="{!showSuggestedAmountAndTargetVolume}">
            <apex:facet name="header"><apex:outputLabel value="Target Volume (Std Btl)" /></apex:facet>
            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CN_Target_Volume_Std_Btl__c}"/></apex:outputText>
        	<apex:facet name="footer">
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalAmount.totalTargetVolume}"/></apex:outputText>
            </apex:facet> 
        </apex:column>
        
    </apex:pageblocktable>
</apex:pageblock>

<apex:pageblock title="Historical Payment Details" >
    <apex:pageblocktable value="{!PaymentRequestList}" var="row">
        <apex:column style="width:20%">
            <apex:facet name="header"><apex:outputLabel value="Payment Request No." /></apex:facet> 
            <apex:outputLink value="ASI_CRM_CN_Payment_Header_Page?id={!row.id}">{!row.Name}</apex:outputLink>
            <!--<apex:outputField value="{!row.Name}"/>-->
             <apex:facet name="footer"><apex:outputLabel value="Total:" /></apex:facet>
        </apex:column>
        <!--<apex:column style="width:10%">
            <apex:facet name="header"><apex:outputLabel value="PO Start Date" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_PO_Start_Date__c}"/>
        </apex:column>
        -->
        <apex:column style="width:20%">
            <apex:facet name="header"><apex:outputLabel value="Status" /></apex:facet> 
            <apex:outputField value="{!row.ASI_TH_CRM_Status__c}"/>
        </apex:column>
        <apex:column style="width:10%">
            <apex:facet name="header"><apex:outputLabel value="Submitted Date" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_Payment_Raised_Date__c}"/>
        </apex:column>
        <apex:column style="width:20%">
            <apex:facet name="header"><apex:outputLabel value="Payment Amount" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_Total_Payment__c}"/>
            <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!Total_Payment_Paid}" /></apex:outputText></apex:facet>
        </apex:column>
        <!--<apex:column style="width:20%">
            <apex:facet name="header"><apex:outputLabel value="Paid In Progress" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_Paid_In_Progress__c}"/>
            <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!Total_Payment_PaidInProgress}" /></apex:outputText></apex:facet>
        </apex:column>-->   
    </apex:pageblocktable>
</apex:pageblock>

</apex:outputPanel>
<!-------------------------------------------------------------------------CN---------------------------lokman 27/6/2014----------------------------------------------->
<apex:outputPanel id="is_CN" rendered="{!showCN}">
<apex:pageblock title="销售合同" id="ContractCN">
<apex:pageMessages id="showmsg"></apex:pageMessages>
<apex:actionstatus id="showStatus1">
            <apex:facet name="start">
                <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                       height: 100%;opacity:0.65;width:100%;"> 
                    <div class="waitingHolder" style="top: 10px; width: 91px;">
                        <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                        <span class="waitingDescription">Please Wait...</span>
                    </div>
                </div>
            </apex:facet>
        </apex:actionstatus>
     <!------------Add by laputa 20170821 hide button for  'fy landing archive' status           sales user can make a new payment through finance landing version is that the 'create payment ' button display in Chinese version.           -->
    <apex:pageblockButtons location="top" rendered="{!LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}"  >
        <apex:commandButton value="编辑" action="{!GoEdit}" rendered="{!if(showEdit,true,false)}"/>
        <apex:commandButton value="合同利润分析表" onclick="window.open('/apex/ASI_CRM_CN_ContractProfitShuttlePDF_Page?id={!ASI_TH_CRM_Contract__c.id}')" rendered="{!ContractSelected.ASI_CRM_CN_PO_Version__c='0.0'}"/> <!--action="{!ContractShuttle}" />-->
        <apex:commandButton value="PO修改 (PDF)" onclick="window.open('/apex/ASI_CRM_CN_ContractEmailPDFPage?id={!ASI_TH_CRM_Contract__c.id}&PDF=1')"  rendered="{!ContractSelected.ASI_CRM_CN_PO_Version__c != '0.0'}"/>        
        <apex:commandButton value="合同至今销量报告" onclick="window.open('/apex/ASI_CRM_CN_PSFCTDPDF_Page?id={!ASI_TH_CRM_Contract__c.id}')"  />        
        <apex:commandButton value="PO修改" action="{!POModification}"  rendered="{!if(showPOModification,true,false) && !ContractSelected.ASI_CRM_CN_Is_Block__c}" reRender="ContractCN" status="showStatus1" />
        <apex:commandButton value="恢复以前的版本" action="{!restorePO}" rendered="{!if(showRestorePO,true,false)}" reRender="ContractCN" status="showStatus1"/>
<!--        <apex:commandButton value="合同至今销量报告" onclick="window.open('/apex/ASI_CRM_CN_PSFCTDPDF_Page?id={!ASI_TH_CRM_Contract__c.id}')" rendered="{!ContractSelected.ASI_CRM_CN_PO_Modification__c==true}" />-->
        <apex:commandButton value="提交审批" action="{!submitApproval}" rendered="{!if(showApprovalButton && showEdit,true,false)}"/>
        <apex:commandButton value="进行付款" action="{!GoPayment }" rendered="{!makePayment && !ContractSelected.ASI_CRM_CN_Is_Block__c}"/>
        <apex:commandButton value="已上传合同附件" action="{!changecontractupload}" rendered="{!if(!contractSelected.ASI_CRM_CN_Contract_Upload__c && contractUpload && inBAPermissionSet,true,false)}"/>
        <apex:commandButton value="未上传合同附件" action="{!changecontractupload}" rendered="{!if(contractSelected.ASI_CRM_CN_Contract_Upload__c && contractUpload && inBAPermissionSet,true,false)}"/>
        <apex:commandButton value="Return" action="{!GoReturn}" rendered="{!showReturn}" rerender="showmsg"/>
<!--        <apex:commandButton value="营业执照合格" action="{!changeBusinessLicense}" rendered="{!if(BusinessLicense && contractSelected.ASI_CRM_CN_Business_License__c = 'Unqualified' && inBAPermissionSet,true,false)}"/>
        <apex:commandButton value="营业执照不合格" action="{!changeBusinessLicense}" rendered="{!if(BusinessLicense && contractSelected.ASI_CRM_CN_Business_License__c != 'Unqualified' && inBAPermissionSet,true,false)}"/>-->
    </apex:pageblockButtons>
    
    <apex:pageblockButtons location="bottom" rendered="{!showEdit}">
        <apex:commandButton value="新增合同细节" action="{!GoEditDetails}"  rendered="{!showEdit}"/>
    </apex:pageblockButtons>
    <apex:pageMessage summary="Need BA to check 'Contract Uploading' before making payment" severity="error" strength="3" rendered="{!paymentError}" />
    <apex:pageblocksection title="头信息">
        <apex:pageblockSectionItem >
            <apex:outputText value="合同编号"/>
            <apex:outputField value="{!ContractSelected.Name}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="PO开始日期"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_Start_Date__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="PO号码"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_No__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="PO结束日期"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_End_Date__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="PO版本"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_Version__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="空瓶回收率"/>
            <!--<apex:outputField value="{!ContractSelected.ASI_CRM_CN_Bottle_Collection_Rate__c}" />-->
            <apex:outputText value="{0,number,0}%"><apex:param value="{!ContractSelected.ASI_CRM_CN_Bottle_Collection_Rate__c}"/></apex:outputText>
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}" ><!--20160607 Ben @ Elufa -->
            <apex:outputText value="PP No."/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PP_No__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="交易币种"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Currency__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="店家/批发商"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Outlet_WS__c}" />
        </apex:pageblockSectionItem>
		<apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="汇率"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Exchange_Rate__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="交易币种"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Currency__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="{!if(ContractSelected.ASI_CRM_New_FY_PO__c, 'PO类别', '促销类别')}"/>
            <apex:outputText value="{!poTypeMap[ContractSelected.ASI_TH_CRM_Promotion_Type__c]}" />
            <!--<apex:outputField value="{!ContractSelected.ASI_TH_CRM_Promotion_Type__c}" />20160622 Ben @ Elufa-->
        </apex:pageblockSectionItem>
		<apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="状态"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Status__c}" />
        </apex:pageblockSectionItem>
		<apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Budget/LE 销量 (9L)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Vol_Budget_LE__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="汇率"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Exchange_Rate__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
        <apex:outputText value="合同来源"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c}" />
        </apex:pageblockSectionItem>
		<apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c!='Others' && !ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Budget/LE 销售费用 (RMB)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Budget_LE__c}" />
        </apex:pageblockSectionItem>
		<apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="未提供Budget/LE原因"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Reason_without_Budget__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText value="附注"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Description__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Budget/LE 销量 (9L)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Vol_Budget_LE__c}" />
        </apex:pageblockSectionItem>
        
        <!-- 20170309 Elufa Commented
        <apex:pageblockSectionItem >
            <apex:outputText value="全国集团合同"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_National_Group_Contract__c}"/>
        </apex:pageblockSectionItem>
		-->

        <!--20170203 Elufa-->
        <apex:pageblockSectionItem >
            <apex:outputText value="全国集团"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_NationalGroup__c}"/>
        </apex:pageblockSectionItem>
        <!--20170203 End-->
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c!='Others' && ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Budget/LE 销售费用 (RMB)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Budget_LE__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c=='Others' && ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="Budget/LE 销售费用 (RMB)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Budget_LE__c}" />
        </apex:pageblockSectionItem>
		<apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
        </apex:pageblockSectionItem>
		<apex:pageblockSectionItem rendered="{!!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="合同附件上传"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Contract_Upload__c}"/>
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="PO渠道" />
            <apex:outputField rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="{!ContractSelected.ASI_CRM_PO_Channel__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="状态"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Status__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="PO省份" />
            <apex:outputField rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="{!ContractSelected.ASI_CRM_PO_Province__c}" />
        </apex:pageblockSectionItem>
         
        
   <!--     <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c=='Others'}">
            <apex:outputText value="Source (Others)"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Source_Others__c}"/>
        </apex:pageblockSectionItem> -->
        
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="未提供Budget/LE原因"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Reason_without_Budget__c}" />
        </apex:pageblockSectionItem>
        <apex:pageblockSectionItem >
            <apex:outputText rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="PO城市" />
            <apex:outputField rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" value="{!ContractSelected.ASI_CRM_PO_City__c}" />
        </apex:pageblockSectionItem>
        
                
                <!--20160607 Ben @ Elufa -->
        
        
        
        
        <!--20160607 Ben @ Elufa -->
        
        
        <apex:pageblockSectionItem rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
            <apex:outputText value="合同附件上传"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Contract_Upload__c}"/>
        </apex:pageblockSectionItem>
        
        <apex:pageblockSectionItem rendered="{!IF(ContractSelected.ASI_CRM_CN_Outlet_WS__r.RecordType.DeveloperName == 'ASI_CRM_CN_WS',true,false)}">
            <apex:outputText value="销量选择"/>
            <apex:outputField value="{!ContractSelected.ASI_CRM_Volume_Option__c}"/>
        </apex:pageblockSectionItem>
           <apex:pageblockSectionItem >
            <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Investment_Type__c.Label}" id="InvestmentType3"   />
            <apex:outputField value="{!ContractSelected.ASI_CRM_Investment_Type__c}"  id="InvestmentType4"  />
        </apex:pageblockSectionItem>
        
     <!--   <apex:pageblockSectionItem >
            <apex:outputText value="合同总金额"/>
            <apex:outputField value="{!ASI_TH_CRM_Contract__c.ASI_CRM_CN_Total_Contract_Amount__c}" />
        </apex:pageblockSectionItem> -->
<!--        <apex:pageblockSectionItem >
            <apex:outputText value="营业执照"/>
            <apex:outputField value="{!ASI_TH_CRM_Contract__c.ASI_CRM_CN_Business_License__c}" />
        </apex:pageblockSectionItem> --> 
       <!-- <apex:pageblockSectionItem >
            <apex:outputText value="总支付金额"/>
            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!Total_Payments_Amount}" /></apex:outputText>
        </apex:pageblockSectionItem> --> 
    </apex:pageblocksection>
</apex:pageblock>
    <apex:pageblock title="固定成本">
        <apex:pageblocktable value="{!LFixCostDisplay}" var="row">
            <apex:column >
                <apex:outputField value="{!row.ASI_CRM_CN_Chinese_Description__c}"/>
                <apex:facet name="footer"><apex:outputLabel value="固定成本总金额" /></apex:facet> 
            </apex:column>
            <apex:column >
                <apex:facet name="header"><apex:outputLabel value="预计" /></apex:facet> 
                <apex:outputField value="{!row.ASI_CRM_CN_Estimate_Amount__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_CN_Estimate_Amount__c}"/></apex:outputText></apex:facet>
               
            </apex:column>
            <!--20160613 Ben @ Elufa -->
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" >
                <apex:facet name="header"><apex:outputLabel value="春节(预估)" /></apex:facet> 
                <apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_CNY_Est__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_CNY_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
                <apex:facet name="header"><apex:outputLabel value="中秋(预估)" /></apex:facet> 
                <apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_MAF_Est__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_MAF_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" >
                <apex:facet name="header"><apex:outputLabel value="其他(预估)" /></apex:facet> 
                <span class="OthersEstCost"><apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_Other_Est__c}"/></span>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_Other_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <!--20160613 End-->
            <apex:column >
                <apex:facet name="header"><apex:outputLabel value="合同" /></apex:facet> 
                <apex:outputField value="{!row.ASI_CRM_CN_Contract_Amount__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!fix_totalCost.ASI_CRM_CN_Contract_Amount__c}"/></apex:outputText></apex:facet>
               
            </apex:column>
        </apex:pageblocktable>
    </apex:pageblock>
<apex:pageblock title="BRSF(空瓶回收费) / 销量目标" >
    <apex:pageBlockTable value="{!LBRSFDisplay}" var="row">
                <apex:column >
                    <apex:facet name="header">子品牌</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Sub_Brand__c}" />
                    <apex:facet name="footer">总数:</apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">预计每月销量（标准瓶）</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Est_Monthly_Qty__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0}"><apex:param value="{!totalBRSF.ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">合同每月销量（标准瓶）</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Contract_Monthly_Qty__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0}"><apex:param value="{!totalBRSF.ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">预计空瓶回收费（每瓶）</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF.ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">合同空瓶回收费（每瓶）</apex:facet>
                    <apex:outputfield value="{!row.ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF.ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">预计总金额</apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Est_Total__c}" id="Est_Total" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF_est_total}"/></apex:outputText></apex:facet>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">合同总金额</apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Contract_Total__c}" id="Contract_Total" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF_contract_total}"/></apex:outputText></apex:facet>
                </apex:column>
                
         </apex:pageBlockTable>
</apex:pageblock>
<apex:pageblock title="其他变动成本总金额">
        <apex:pageblocktable value="{!LVariableCostDisplay}" var="row">
            <apex:column >
                <apex:outputField value="{!row.ASI_CRM_CN_Chinese_Description__c}"/>
                <apex:facet name="footer"><apex:outputLabel value="总变动成本" /></apex:facet>
            </apex:column>
            <apex:column >
                <apex:facet name="header"><apex:outputLabel value="预计" /></apex:facet> 
                <apex:outputField value="{!row.ASI_CRM_CN_Estimate_Amount__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_CN_Estimate_Amount__c}"/></apex:outputText></apex:facet>
            </apex:column>
            <!--20160613 Ben @ Elufa -->
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" >
                <apex:facet name="header"><apex:outputLabel value="春节(预估)" /></apex:facet> 
                <apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_CNY_Est__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_CNY_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}">
                <apex:facet name="header"><apex:outputLabel value="中秋(预估)" /></apex:facet> 
                <apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_MAF_Est__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_MAF_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <apex:column rendered="{!ContractSelected.ASI_CRM_New_FY_PO__c}" >
                <apex:facet name="header"><apex:outputLabel value="其他(预估)" /></apex:facet> 
                <span class="OthersEstCost"><apex:outputField rendered="{!festivalMap[row.id]}" value="{!row.ASI_CRM_Other_Est__c}"/></span>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_Other_Est__c}" /></apex:outputText></apex:facet>
            </apex:column>
            <!--20160613 End-->
            <apex:column >
                <apex:facet name="header"><apex:outputLabel value="合同" /></apex:facet> 
                <apex:outputField value="{!row.ASI_CRM_CN_Contract_Amount__c}"/>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!variable_totalCost.ASI_CRM_CN_Contract_Amount__c}"/></apex:outputText></apex:facet>
                
            </apex:column>
        </apex:pageblocktable>
    </apex:pageblock>
    
<apex:pageblock title="覆盖店家" >
    <apex:pageblocktable value="{!ContractOutletList}" var="row">
        
        <apex:column style="width:25%">
            <apex:facet name="header"><apex:outputLabel value="店家" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_Outlet__r.ASI_CRM_Account__c}"/>
            <apex:facet name="footer"><apex:outputLabel rendered="{!showSuggestedAmountAndTargetVolume}" value="总数 :" /></apex:facet>
        </apex:column>
        
        <apex:column style="width:25%" rendered="false">
                    <apex:facet name="header">分配金额</apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Allocated_Amount__c}"/>
        </apex:column>
        
        <apex:column style="width:25%" rendered="{!showSuggestedAmountAndTargetVolume}">
            <apex:facet name="header"><apex:outputLabel value="建议金额" /></apex:facet>
            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CN_Suggested_Amount__c}"/></apex:outputText>
        	<apex:facet name="footer">
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalAmount.totalSuggestedAmount}"/></apex:outputText>
            </apex:facet> 
        </apex:column>
        
        <apex:column style="width:25%" rendered="{!showSuggestedAmountAndTargetVolume}">
            <apex:facet name="header"><apex:outputLabel value="目标销量(标准瓶)" /></apex:facet>
            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CN_Target_Volume_Std_Btl__c}"/></apex:outputText>
        	<apex:facet name="footer">
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalAmount.totalTargetVolume}"/></apex:outputText>
            </apex:facet> 
        </apex:column>
        
    </apex:pageblocktable>
</apex:pageblock>

<apex:pageblock title="付款申请" >
    <apex:pageblocktable value="{!PaymentRequestList}" var="row">
        <apex:column style="width:20%">
            <apex:facet name="header"><apex:outputLabel value="付款申请号" /></apex:facet> 
            <apex:outputLink value="ASI_CRM_CN_Payment_Header_Page?id={!row.id}">{!row.Name}</apex:outputLink>
            <!--<apex:outputField value="{!row.Name}"/>-->
             <apex:facet name="footer"><apex:outputLabel value="总金额:" /></apex:facet>
        </apex:column>
        <!--<apex:column style="width:10%">
            <apex:facet name="header"><apex:outputLabel value="PO开始日期" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_PO_Start_Date__c}"/>
        </apex:column>-->
        
        <apex:column style="width:20%">
            <apex:facet name="header"><apex:outputLabel value="状态" /></apex:facet> 
            <apex:outputField value="{!row.ASI_TH_CRM_Status__c}"/>
        </apex:column>
        <apex:column style="width:10%">
            <apex:facet name="header"><apex:outputLabel value="付款提交日期" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_Payment_Raised_Date__c}"/>
        </apex:column>
        <apex:column style="width:20%">
            <apex:facet name="header"><apex:outputLabel value="付款金额" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_Total_Payment__c}"/>
            <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!Total_Payment_Paid}" /></apex:outputText></apex:facet>    
        </apex:column>
        <!--<apex:column style="width:20%">
            <apex:facet name="header"><apex:outputLabel value="付款中金额" /></apex:facet> 
            <apex:outputField value="{!row.ASI_CRM_CN_Paid_In_Progress__c}"/>
            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!Total_Payment_PaidInProgress}"/></apex:outputText>
                
        </apex:column>-->   
    </apex:pageblocktable>
</apex:pageblock>

</apex:outputPanel>
</apex:form>


<apex:relatedList id="Attachments" subject="{!pageid}" list="CombinedAttachments" rendered="{!IsCNCRM}"/>
<apex:relatedList id="Approval" subject="{!pageid}" list="ProcessSteps" rendered="{!IsCNCRM}"/>
<apex:relatedList id="ApprovalComment" subject="{!pageid}" list="Contract_Approval_Comments__r" rendered="{!IsCNCRM}"/>
<!-- Hiding Standard 






 Approval button -->
<script type="text/javascript"> 
    function addLoadEvent(func) {   
        var oldonload = window.onload;
        if (typeof window.onload != 'function') {   
            window.onload = func;   }   
        else {  window.onload = function() {    
            if (oldonload) {    oldonload();    }   
            func(); }   
        }   
    }   
    addLoadEvent(   
        function() {    checkPage();    }   ); 
</script>
&nbsp;
<script type="text/javascript">     
    function checkPage() {  
        if (document.getElementsByName("piSubmit")[0] != null)  
            document.getElementsByName("piSubmit")[0].style.display = 'none';   
    }
    
    //20160621 Ben @ Elufa
    var $inputEle = $('td span.OthersEstCost span').each(function(){
        
        if($(this).text().indexOf('-') > -1){
            $(this).addClass('negative');
        }else{
            $(this).removeClass('negative');
        }
    });
    //20160621 End
    
    //20161125 Elufa
    var be = $('.blockEnterClass').keypress(function(e) {
        if(e.keyCode == 13){
            return false;
        }
    });
    //20161125 End
</script>
</apex:page>