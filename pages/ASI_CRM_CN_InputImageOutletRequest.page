<apex:page standardcontroller="ASI_CRM_Image_Outlet_Request__c" extensions="ASI_CRM_CN_InputImageOutletRequestCon" id="Page">
    <apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery1.10.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.min.js')}"/>
    <script type='text/javascript'>
    var addnlFldname2 = [];
    var addnlFldname = [];
    $(function(){
        ASI_CRM_CN_InputImageOutletRequestCon.findSObjects('ASI_MFM_Sub_brand__c', '','', function(result, event){
            if(event.type == 'exception') {
                alert(event.message);
            } else {
                addnlFldname = result;
                for(var i = 0, len = addnlFldname.length;i<len;i++ )
                {
                    addnlFldname[i] =  htmlEncode(addnlFldname[i]);
                }
                $( ".lookupInput" ).each(function(){
                    $(this).find('input').autocomplete({
                        source: addnlFldname
                    });               
                })
                
            }
        });
        
    });
    
    function endAddNewAction() {  
        for(var i = 0, len = addnlFldname.length;i<len;i++ )
        {
            addnlFldname[i] =  htmlEncode(addnlFldname[i]);
        }         
        $(".lookupInput").each(function(){ 
            $(this).find('input').autocomplete({
                source: addnlFldname
            });             
        });
    }
    /* lokman 30/6/2014 autocomplete for new IOM start*/
    function autocomplete_cancel(){
        
        
        $(".lookupInput").each(function(){ 
            $(this).find('input').autocomplete({
                source: addnlFldname2
            });             
        });
        
    }
    /* lokman 30/6/2014 autocomplete for new IOM end*/
    function htmlEncode( input ) {
        var e = document.createElement('div');
        e.innerHTML = input;
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
        //return String(input).replace(/\&amp;/g,'&').replace(/\&lt;/g,'<').replace(/\&rt;/g,'>');
    };
    </script>
    
    <apex:form >
        <apex:outputpanel id="output_en" rendered="{!showCN!=true}">
            <apex:pageblock title="{!$Label.ASI_CRM_CN_IOM_Select_Outlet}" rendered="{!showOutlet}" id="SelectOL_en">
                <apex:pageblockButtons >   
                    <apex:commandButton value="{!$Label.ASI_CRM_CN_IOM_Continue}" action="{!OutletSelected}" reRender="output_en, ON3_en"/>
                    <apex:commandButton value="{!$Label.ASI_CRM_CN_IOM_Cancel}" action="{!Cancel}" />
                </apex:pageblockButtons>
                <apex:pageblocksection >
                    <apex:pageBlockSectionItem >
                        <apex:outputText value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Outlet__c.Label}" />
                        <apex:inputField value="{!ImageReq.ASI_CRM_Outlet__c}" required="true" onkeypress="autocomplete_cancel();" id="outletname"/> <!--<apex:actionSupport event="onchange" action="{!OutletSelected}"/></apex:inputField>-->
                    </apex:pageBlockSectionItem>
                </apex:pageblocksection>
            </apex:pageblock>
            <!-- Image Outlet Request Application Form (ON) -->       
            <apex:pageBlock title="{!$Label.ASI_CRM_CN_IOM_Application_Form}" rendered="{!isON}" id="ON1_en">
                <!--<apex:pageMessage summary="No previous contract found! Not allowed to save form." severity="warning" strength="3" rendered="{!showSaveOn==false}" />--> <!--<apex:pageMessage summary="No previous contract found. Not allowed to save new request." severity="warning" strength="3" rendered="{!showSaveOn==false}" />-->
                <apex:pageBlockButtons location="top">
                    <apex:commandbutton value="{!$Label.ASI_CRM_CN_IOM_Save}" action="{!SaveAll}" id="savebtn" /> <!--  rendered="{!showSaveON}" ---->
                    <apex:commandbutton value="{!$Label.ASI_CRM_CN_IOM_Cancel}" action="{!Cancel}"/>  
                </apex:pageBlockButtons>
                <apex:pageBlockSection title="{!$Label.ASI_CRM_CN_IOM_Key_Contact}" id="outlet_en1" >
                    <apex:pageblocksectionItem >
                        <!----<apex:outputText value="IOM ID:" />----->
                        <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.name.Label}" />
                        <apex:outputLink value="{!LEFT($Api.Partner_Server_URL_140, FIND('.com/',$Api.Partner_Server_URL_140)+3)}/{!ImageReq.id}?nooverride=1">
                            <apex:outputText value="{!ImageReq.name}"/></apex:outputLink>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <!----<apex:outputText value="Need HQ Sponsor:"  /> ----->
                        <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Need_HQ_Sponsor__c.Label}" />
                        <apex:outputPanel layout="block">
                            <apex:inputField value="{!ImageReq.ASI_CRM_Need_HQ_Sponsor__c}"  rendered="{!if(ImageReq.ASI_CRM_Status__c='Preliminary Approved',true,False)}" />
                            <apex:outputField value="{!ImageReq.ASI_CRM_Need_HQ_Sponsor__c}"  rendered="{!if(ImageReq.ASI_CRM_Status__c='Preliminary Approved',False,true)}" /> 
         			<!--		<apex:inputField value="{!ImageReq.ASI_CRM_Need_HQ_Sponsor__c}"  rendered="{!if((ImageReq.ASI_CRM_Status__c='Submitted to RTMK'||ImageReq.ASI_CRM_Status__c='Preliminary Approved'),true,False)}" />
                            <apex:outputField value="{!ImageReq.ASI_CRM_Need_HQ_Sponsor__c}"  rendered="{!if((ImageReq.ASI_CRM_Status__c='Submitted to RTMK'||ImageReq.ASI_CRM_Status__c='Preliminary Approved'),False,true)}" />-->
                        </apex:outputPanel>
                    </apex:pageblocksectionItem>
                    
                    
                    <apex:pageblocksectionItem >
                        <!---<apex:outputText value="Owner:" /> ----><apex:outputLabel value="{!$Label.ASI_CRM_CN_IOM_Owner}" />
                        <apex:outputText value="{!IF(ImageReq.Owner.Name == '', tmpOwnerName, ImageReq.Owner.Name)}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <!----<apex:outputText value="Mobile Phone:" />--->
                     <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Mobile_Phone__c.Label}" />
                        <apex:inputText value="{!ImageReq.ASI_CRM_Mobile_Phone__c}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <!----<apex:outputText value="RTMK Contact:" /> --->
                    <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Sys_Approver__c.Label}" />
                        <apex:outputField value="{!ImageReq.ASI_CRM_Sys_Approver__c}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <!--<apex:outputText value="Mobile Phone:" /> --->
                    <apex:outputLabel value="{!$ObjectType.User.Fields.Phone.Label}" />
                        <apex:outputText value="{!ImageReq.ASI_CRM_Sys_Approver__r.Phone}"/>
                    </apex:pageblocksectionItem>
                    
                    <apex:pageblocksectionItem >
                        <!----<apex:outputText value="Outlet Contact:" /> --->
                    <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_MFM_Outlet_Contacts__c.Label}" />
                        <apex:inputField value="{!ImageReq.ASI_MFM_Outlet_Contacts__c}" />  
                    </apex:pageblocksectionItem>
                    
                    <apex:pageblocksectionItem >
                        <!-----<apex:outputText value="Mobile Phone:" /> ------------------>
                    <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Outlet_Mobile_Phone__c.Label}" />
                        <apex:inputField value="{!ImageReq.ASI_CRM_Outlet_Mobile_Phone__c}"/>
                    </apex:pageblocksectionItem>
                    
                    <apex:pageblocksectionItem >
                        <!----------<apex:outputText value="Status:" /> -------------->
                    <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Status__c.Label}" />
                        <apex:outputField value="{!ImageReq.ASI_CRM_Status__c}"/>
                    </apex:pageblocksectionItem>
                    <br/>
                    <apex:pageblocksectionItem >
                       <!---<apex:outputText value="Created by:" /> --->
                    <apex:outputLabel value="{!$Label.ASI_CRM_CN_IOM_CreatedBy}" />
                        <apex:outputText value="{!ImageReq.CreatedBy.name}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <!--<apex:outputText value="Last Modified By:" /> --->
                    <apex:outputLabel value="{!$Label.ASI_CRM_CN_IOM_LastModifiedBy}" />
                        <apex:outputField value="{!ImageReq.LastModifiedBy.name}"/>
                    </apex:pageblocksectionItem>
                    
                </apex:pageBlockSection>
                
                <apex:pageBlockSection title="{!$Label.ASI_CRM_CN_IOM_Outlet_Description}" id="outlet_en" rendered="{!isON}">
                    <apex:pageblockSectionItem >
                        <!---- <apex:outputText value="Outlet Name:" />------->
                <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Outlet__c.Label}" />
                        <apex:outputField value="{!ImageReq.ASI_CRM_Outlet__c}" />
                    </apex:pageblockSectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="{!$Label.ASI_CRM_CN_IOM_Sub_channel}" />
                        <apex:outputText value="{!strsubchannelName}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <!----<apex:outputText value="Address:" />---->
                     <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Address__c.Label}" />
                        <apex:outputText value="{!strAddress}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <!---<apex:outputText value="Region:" />--->
                    <apex:outputLabel value="{!$ObjectType.ASI_CRM_Region__c.Label}" />
                        <apex:outputText value="{!strregion}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="Division:" />
                        <apex:outputText value="{!strDivision }"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <!----<apex:outputText value="Outlet Segment-Image:" />----->
                    <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Outlet_Segment_Image__c.Label}" />
                        <apex:outputText value="{!strImage}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <!-----<apex:outputText value="Outlet Segment-Volume:" />----->
                    <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Outlet_Segment_Volume__c.Label}" />
                        <apex:outputText value="{!strGrade}"/>
                    </apex:pageblocksectionItem> 
                    <apex:pageblocksectionItem >
                        <!---<apex:outputText value="Room Qty(KTV/ Bar):" />--->
                    <apex:outputLabel value="{!$Label.ASI_CRM_CN_IOM_Room_Qty}" />
                        <apex:outputText value="{!strNumofRoom}"/>
                    </apex:pageblocksectionItem> 
                    <apex:pageblocksectionItem >
                        <!---<apex:outputText value="Cart Qty(Bar):" />--->
                    <apex:outputLabel value="{!$Label.ASI_CRM_CN_IOM_Cart_Qty}" />
                        <apex:outputText value="{!strNumofcart}"/>
                    </apex:pageblocksectionItem> 
                    <apex:pageblocksectionItem >
                        <!----<apex:outputText value="Table Qty(Bar):" />---->
                    <apex:outputLabel value="{!$Label.ASI_CRM_CN_IOM_Table_Qty}" />
                        <apex:outputText value="{!strNumoftable}"/>
                    </apex:pageblocksectionItem> 
                    
                </apex:pageBlockSection>
                <apex:pageBlockSection title="{!$Label.ASI_CRM_CN_IOM_Mapping_Priority}" columns="3" rendered="{!isON}">
                    <apex:pageblocksectionItem >
                        <apex:pageblocktable value="{!MappingP1}" var="mp1" id="mptable1_en">
                            <apex:column >
                                <apex:facet name="header">{!$Label.ASI_CRM_CN_IOM_Priority_1}</apex:facet>
                                <apex:outputField value="{!mp1.ASI_CRM_CN_Sub_brand__c}" />
                            </apex:column>
                        </apex:pageblocktable>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:pageblocktable value="{!MappingP2}" var="mp2" id="mptable2_en">
                            <apex:column >
                                <apex:facet name="header">{!$Label.ASI_CRM_CN_IOM_Priority_2}</apex:facet>
                                <apex:outputField value="{!mp2.ASI_CRM_CN_Sub_brand__c}" />
                            </apex:column>
                        </apex:pageblocktable>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:pageblocktable value="{!MappingP3}" var="mp3" id="mptable3_en">
                            <apex:column >
                                <apex:facet name="header">{!$Label.ASI_CRM_CN_IOM_Priority_3}</apex:facet>
                                <apex:outputField value="{!mp3.ASI_CRM_CN_Sub_brand__c}" />
                            </apex:column>
                        </apex:pageblocktable>
                    </apex:pageblocksectionItem>
                </apex:pageBlockSection>
            </apex:pageBlock>
            
            <apex:pageBlock title="{!$Label.ASI_CRM_CN_IOM_Site_Quantity}" rendered="{!if(ImageReq.ASI_CRM_Status__c='',False,true)}"   id="ON2_en"><!-------------  rendered="{!isON}"  ---------------------->
                <apex:pageBlockButtons location="top">
                    <!--<apex:commandbutton value="Add" action="{!addRow}"/>-->
                </apex:pageBlockButtons>
                <apex:actionRegion >
                    <apex:pageBlocktable value="{!LImageSite}" var="s" id="table_en">
                        <apex:column rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',true,False)}" >
                            <apex:facet name="header"><apex:commandLink value="{!$Label.ASI_CRM_CN_IOM_Add_New}" action="{!addRow}" rerender="table_en" style="text-decoration:underline;" oncomplete="endAddNewAction();" /></apex:facet>
                            <apex:commandLink value="Remove" action="{!RemoveRow}" immediate="true" rerender="table_en"><apex:param assignTo="{!rowid}" value="{!s.Name}" name="assignvalue" /></apex:commandLink>
                        </apex:column>
                        
                        <apex:column >
                            <apex:facet name="header"><apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Site__c.Fields.ASI_CRM_Type__c.Label}" /></apex:facet>
                            <apex:inputField value="{!s.ASI_CRM_Type__c}" required="true" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',true,False)}" />
                            <apex:outputField value="{!s.ASI_CRM_Type__c}" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',False,true)}" />
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header"><apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Site__c.Fields.ASI_CRM_Previous__c.Label}" /></apex:facet>
                            <apex:inputField value="{!s.ASI_CRM_Previous__c}" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',true,False)}" />
                            <apex:outputField value="{!s.ASI_CRM_Previous__c}" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',False,true)}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header"><apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Site__c.Fields.ASI_CRM_Expected__c.Label}" /></apex:facet>
                            <apex:inputField value="{!s.ASI_CRM_Expected__c}" required="true" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',true,False)}"  />
                            <apex:outputField value="{!s.ASI_CRM_Expected__c}" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',False,true)}" />
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header"><apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Site__c.Fields.ASI_CRM_Description__c.Label}" /></apex:facet>
                            <apex:inputField value="{!s.ASI_CRM_Description__c}" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',true,False)}" />
                            <apex:outputField value="{!s.ASI_CRM_Description__c}" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',False,true)}" />
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header"><apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Site__c.Fields.ASI_CRM_Size__c.Label}" /></apex:facet>
                            <apex:inputField value="{!s.ASI_CRM_Size__c}" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',true,False)}" />
                            <apex:outputField value="{!s.ASI_CRM_Size__c}" rendered="{!if(ImageReq.ASI_CRM_Status__c='Draft',False,true)}" />
                        </apex:column>
                    </apex:pageBlocktable>
                </apex:actionRegion>
            </apex:pageBlock>
            
            
            
            <apex:outputpanel id="display_en">
                <apex:pageblock title="{!$Label.ASI_CRM_CN_IOM_Outlet_Supplementary_Information}" rendered="{!isON}" id="ON3_en">
                    <apex:pageblocksection >
                        <apex:pageblocksectionitem >
                            <!---- <apex:outputText value="Last PO:" />--->
            <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_CN_Last_Contract__c.Label}" />
                            <apex:outputField value="{!ImageReq.ASI_CRM_CN_Last_Contract__c}" />
                        </apex:pageblocksectionitem>
                        <apex:pageblocksectionItem >
                            <!----<apex:outputText value="Application Date:" />--->
                <apex:outputLabel value="{!$ObjectType.ASI_CRM_Image_Outlet_Request__c.Fields.ASI_CRM_Application_Date__c.Label}" />
                            <apex:outputField value="{!ImageReq.ASI_CRM_Application_Date__c}"/>
                        </apex:pageblocksectionItem>
                        <apex:pageblocksectionitem >
                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_PO_Start_Date__c.Label}" />
                            <!-- <apex:outputText value="{!Day(POStart)}/{!Month(POStart)}/{!Year(POStart)}" rendered="{!POStart!=null}" />-->
                            <apex:outputField value="{!listContract.ASI_CRM_CN_PO_Start_Date__c}" />
                        </apex:pageblocksectionitem>
                        <apex:pageblocksectionitem >
                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_PO_End_Date__c	.Label}" />
                            <!--<apex:outputText value="{!Day(POEnd)}/{!Month(POEnd)}/{!Year(POEnd)}" rendered="{!POEnd!=null}"/>-->
                            <apex:outputField value="{!listContract.ASI_CRM_CN_PO_End_Date__c}" />
                        </apex:pageblocksectionitem>
                    </apex:pageblocksection>
                    <!-- <table width="100%" style="border: 1px solid #E4E7E7;" border="1" cellpadding="3" cellspacing="0">
<tr >
<td bgcolor="#E4E7E7"><strong>PO Start Date:</strong></td>
<td><apex:outputText value="{!Day(POStart)}/{!Month(POStart)}/{!Year(POStart)}" rendered="{!POStart!=null}" /></td>
<td bgcolor="#E4E7E7"><strong>PO End Date:</strong></td>
<td><apex:outputText value="{!Day(POEnd)}/{!Month(POEnd)}/{!Year(POEnd)}" rendered="{!POEnd!=null}"/></td>
</tr>
</table>-->
                    <table width="100%" style="border: 1px solid #E4E7E7;" border="1" cellpadding="3" cellspacing="0">
                        <tr bgcolor="#E4E7E7">
                            <th><apex:outputLabel value="{!$Label.ASI_CRM_CN_IOM_Sub_brand_Grade}" /> </th>
                            <th><apex:outputLabel value="{!$Label.ASI_CRM_CN_IOM_Sub_brand}" /></th>
                            <th><apex:outputLabel value="{!$Label.ASI_CRM_CN_IOM_Volume}" /></th>
                        </tr>
                        <apex:repeat value="{!mapSubbrandGrade}" var="sb1">
                            <tr>
                                <td>{!sb1}</td>
                                <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                    <apex:repeat value="{!mapSubbrandGrade[sb1]}" var="sb2">
                                        <tr>
                                            <td>{!sb2}</td>
                                        </tr>
                                    </apex:repeat>
                                    </table></td>
                                <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                    <apex:repeat value="{!mapSubbrandGrade[sb1]}" var="sb2">
                                        <tr>
                                            <td align="right"><apex:outputText value="{0,number,#,###,###}" rendered="{!mapSubbrandGrade[sb1][sb2].value!=0&&mapSubbrandGrade[sb1][sb2].value!=null}" ><apex:param value="{!mapSubbrandGrade[sb1][sb2].value}" /></apex:outputText>
                                                <apex:outputText value=" - " rendered="{!mapSubbrandGrade[sb1][sb2].value==0||mapSubbrandGrade[sb1][sb2].value==null}" /></td>
                                        </tr>
                                    </apex:repeat>
                                    </table></td>
                                
                            </tr>
                        </apex:repeat>
                    </table>
                </apex:pageblock>
            </apex:outputpanel>
            <!-- Image Outlet Application Form (OFF) -->       
            <apex:pageBlock title="Image Outlet Application Form" rendered="{!isOFF}" id="OFF1_en">
                
                <apex:pageBlockButtons location="top">
                    <apex:commandbutton value="Save" action="{!SaveAll}"/>
                    <apex:commandbutton value="Cancel" action="{!Cancel}"/>
                    <!--<apex:commandbutton value="Generate"  onclick="window.open('/apex/ASI_CRM_CN_ImageOutletGenerate?id={!ImageReq.Id}','_blank','height=400,location=no,resizable=yes,toolbar=no,status=no,menubar=no,scrollbars=1', 1);"/>-->
                </apex:pageBlockButtons>
                <apex:pageBlockSection title="Region Input Information" id="form2_en">
                    <apex:pageBlockSectionItem >
                        <apex:outputText value="Outlet Name:" />
                        <apex:outputField value="{!ImageReq.ASI_CRM_Outlet__c}" />
                    </apex:pageblocksectionitem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="Sub-channel:" />
                        <apex:outputText value="{!strsubchannelName}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="CRM Code:" />
                        <apex:outputText value="{!strCRMCode}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="Region:" />
                        <apex:outputText value="{!strregion}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="Address:" />
                        <apex:outputText value="{!strAddress}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="Segmentation:" />
                        <apex:outputText value="{!strImage}"/>
                    </apex:pageblocksectionItem>    
                    <!-- <apex:pageBlockSectionItem >
<apex:outputText value="Application Person:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Application_Person__c}"/>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="Application Date:" />
<apex:outputField value="{!ImageReq.ASI_CRM_Application_Date__c}"/>
</apex:pageblockSectionItem>-->
                    <!-- <apex:pageBlockSectionItem >
<apex:outputText value="Sub-brand 1:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Sub_brand_1__c}"> <apex:actionSupport event="onchange" action="{!showAllBrands}" rerender="gen1"/></apex:inputField>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="Image Production:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Image_Production_1__c}"/>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="Sub-brand 2:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Sub_brand_2__c}"> <apex:actionSupport event="onchange" action="{!showAllBrands}" rerender="gen1"/></apex:inputField>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="Image Production:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Image_Production_2__c}"/>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="Sub-brand 3:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Sub_brand_3__c}"> <apex:actionSupport event="onchange" action="{!showAllBrands}" rerender="gen1"/></apex:inputField>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="Image Production:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Image_Production_3__c}"/>
</apex:pageblockSectionItem>-->
                </apex:pageBlockSection>
                
                <!--<apex:pageblocksection columns="1">
<apex:pageBlockSectionItem >
<apex:outputText value="Other Reason for Application:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Application_Reason__c}" style="width:50%;"/>
</apex:pageblockSectionItem>
</apex:pageBlockSection>-->
                <apex:pageBlockSection title="Sub-brand" columns="1">
                    <apex:pageBlockSectionItem >
                        <apex:actionRegion >
                            <apex:pageblockTable value="{!IOMOffSBList}" var="sb" id="sbtable_en">
                                <apex:column >
                                    <apex:facet name="header"><apex:commandLink value="Add New" action="{!addIOMATRow}" rerender="sbtable_en" style="text-decoration:underline;" oncomplete="endAddNewAction();" /></apex:facet>
                                    <apex:commandLink value="Remove" action="{!removeSBRow}" immediate="true" rerender="sbtable_en, gen1_en" ><apex:param assignTo="{!rowid}" value="{!sb.Name}" name="assignvalue" /></apex:commandLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Sub-brand</apex:facet>
                                    <apex:inputField value="{!sb.ASI_CRM_Sub_Brand__c}" required="true" ><apex:actionSupport event="onchange" action="{!showAllBrands}" rerender="gen1_en"/>
                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Image Production</apex:facet>
                                    <apex:inputField value="{!sb.ASI_CRM_Image_Production__c}"/>
                                </apex:column>
                            </apex:pageblockTable>
                        </apex:actionRegion>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>
                <apex:pageBlockSection title="MAT Outlet Business size" id="form3_en" columns="1" >
                    <apex:pageblocktable value="{!data2_list}" var="iomat" id="iomattable_en" >
                        <apex:column >
                            <apex:facet name="header">Sub-category</apex:facet>
                            <apex:outputText value="{!iomat}"/>
                            <apex:facet name="footer">Total:</apex:facet>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Value</apex:facet>
                            <apex:outputText value="{!data2_list[iomat].value}"/>
                            <apex:facet name="footer" ><apex:outputText value="{0,number,####.##}"><apex:param value="{!strTotal}" /></apex:outputText></apex:facet>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">%</apex:facet>
                            <apex:outputText value="{0,number,####.##}"><apex:param value="{!data2_list[iomat].percentage}"/></apex:outputText>
                            <apex:facet name="footer" ><apex:outputText value="{0,number,####.##}%"><apex:param value="{!strTotalP}" /></apex:outputText></apex:facet>
                        </apex:column>
                    </apex:pageblocktable>
                </apex:pageBlockSection>
                <!--   <apex:pageBlockSection >
<apex:pageblocksectionitem >
<apex:outputText value="Total: "/>
<apex:outputText value="{!strTotal}"/>
</apex:pageblocksectionitem>
<apex:pageblocksectionitem >
<apex:outputText value="Total %: "/>
<apex:outputText value="{!strTotalP}%"/>
</apex:pageblocksectionitem>
</apex:pageBlockSection>-->
            </apex:pageBlock>
            
            <apex:pageblock title="MAT PRC Business Size" id="gen1_en" rendered="{!isOFF}">
                <table width="100%" style="border: 1px solid #E4E7E7;" border="1" cellpadding="3" cellspacing="0">
                    <tr bgcolor="#E4E7E7">
                        <th>Sub-category</th>
                        <th>Sub-brand</th>
                        <th>Quantity</th>
                        <th>%</th>
                        <th>值</th>
                        <th>%</th>
                    </tr>
                    <apex:repeat value="{!MATPRC_map}" var="t1">
                        <tr>
                            <td>{!t1}</td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td>{!t2}</td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,0}" ><apex:param value="{!t3.totalvalue}" /></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,####.##}%"><apex:param value="{!t3.totalpercentage}"/></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,#,###,###.##}" ><apex:param value="{!t3.value}" /></apex:outputText>
                                                        <apex:outputText value=" - " rendered="{!t3.value==null||t3.value==0}" /></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,####.##}%"><apex:param value="{!t3.percentage}"/></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                        </tr>
                    </apex:repeat>
                    <tr>
                        <td colspan="2" align="right"><Strong>Total: </Strong></td>
                        <td align="right"><apex:outputText value="{0,number,0}" ><apex:param value="{!strTotalQty}" /></apex:outputText></td>
                        <td align="right"><apex:outputText value="{0,number,0}%" ><apex:param value="{!strTotalQtyP}" /></apex:outputText></td>
                        <td align="right"><apex:outputText value="{0,number,0.00}" ><apex:param value="{!strTotalVal}" /></apex:outputText></td>
                        <td align="right"><apex:outputText value="{0,number,0}%" ><apex:param value="{!strTotalValP}" /></apex:outputText></td>
                    </tr>
                </table>
            </apex:pageblock>
            
            <apex:pageblock title="Sub-brand Volume" id="gen2_en" rendered="{!isOFF}">
                <table width="100%" style="border: 1px solid #E4E7E7;" border="1" cellpadding="3" cellspacing="0">
                    <tr bgcolor="#E4E7E7">
                        <th>Brand</th>
                        <th>Sub-brand</th>
                        <th>Quantity</th>
                        <th>%</th>
                    </tr>
                    <apex:repeat value="{!Allbrands}" var="t1">
                        <tr>
                            <td>{!t1}</td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!Allbrands[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!Allbrands[t1][t2]}" var="t3">
                                                <tr>
                                                    <td>{!t2}</td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!Allbrands[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!Allbrands[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,0}" ><apex:param value="{!t3.totalvalue}" /></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!Allbrands[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!Allbrands[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,####.##}"><apex:param value="{!t3.totalpercentage}"/></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                
                                </table></td>
                        </tr>
                    </apex:repeat>
                    <tr>
                        <td colspan="2" align="right"><Strong>总计: </Strong></td>
                        <td align="right"><apex:outputText value="{0,number,0}" ><apex:param value="{!strTotalGS}" /></apex:outputText></td>
                        <td align="right"><apex:outputText value="{0,number,0}%" ><apex:param value="{!strTotalPGS}" /></apex:outputText></td>
                    </tr>
                </table>
            </apex:pageblock>
            
        </apex:outputpanel>
        <apex:outputpanel id="output" rendered="{!showCN}">
            <apex:pageblock title="选择店家" rendered="{!showOutlet}" id="SelectOL">
                <apex:pageblockButtons >   
                    <apex:commandButton value="继续" action="{!OutletSelected}" reRender="output, ON3"/>
                    <apex:commandButton value="取消" action="{!Cancel}" />
                </apex:pageblockButtons>
                <apex:pageblocksection >
                    <apex:pageBlockSectionItem >
                        <apex:outputText value="店家名称:" />
                        <apex:inputField value="{!ImageReq.ASI_CRM_Outlet__c}" onkeypress="autocomplete_cancel();" id="outletname_cn"/> <!--<apex:actionSupport event="onchange" action="{!OutletSelected}"/></apex:inputField>-->
                    </apex:pageBlockSectionItem>
                </apex:pageblocksection>
            </apex:pageblock>
            <!-- Image Outlet Request Application Form (ON) -->       
            <apex:pageBlock title="形象店申请" rendered="{!isON}" id="ON1">
                <!--<apex:pageMessage summary="No previous contract found! Not allowed to save form." severity="warning" strength="3" rendered="{!showSaveOn==false}" />-->
                <apex:pageMessage summary="没有找到以前的合同！不允许保存表单。" severity="warning" strength="3" rendered="{!showSaveOn==false}" />
                <apex:pageBlockButtons location="top">
                    <apex:commandbutton value="保存" action="{!SaveAll}" id="savebtn" rendered="{!showSaveON}" />
                    <apex:commandbutton value="取消" action="{!Cancel}"/>  
                </apex:pageBlockButtons>
                <apex:pageBlockSection title="店家描述" id="outlet" rendered="{!isON}">
                    <apex:pageBlockSectionItem >
                        <apex:outputText value="店家名称:" />
                        <apex:outputField value="{!ImageReq.ASI_CRM_Outlet__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="子渠道:" />
                        <apex:outputText value="{!strsubchannelName}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="地址:" /> 
                        <apex:outputText value="{!strAddress}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="区域:" />
                        <apex:outputText value="{!strregion}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="部门:" />
                        <apex:outputText value="{!strDivision }"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="店家形象:" />
                        <apex:outputText value="{!strImage}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="店家形象级别:" />
                        <apex:outputText value="{!strGrade}"/>
                    </apex:pageblocksectionItem>
                </apex:pageBlockSection>
                <apex:pageBlockSection title="对应优先级别" columns="3" rendered="{!isON}">
                    <apex:pageblocksectionItem >
                        <apex:pageblocktable value="{!MappingP1}" var="mp1" id="mptable1">
                            <apex:column >
                                <apex:facet name="header">第一优先品牌</apex:facet>
                                <apex:outputField value="{!mp1.ASI_CRM_CN_Sub_brand__c}" />
                            </apex:column>
                        </apex:pageblocktable>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:pageblocktable value="{!MappingP2}" var="mp2" id="mptable2">
                            <apex:column >
                                <apex:facet name="header">第二优先品牌</apex:facet>
                                <apex:outputField value="{!mp2.ASI_CRM_CN_Sub_brand__c}" />
                            </apex:column>
                        </apex:pageblocktable>
                    </apex:pageblocksectionItem>

                    <apex:pageblocksectionItem >
                        <apex:pageblocktable value="{!MappingP3}" var="mp3" id="mptable3">
                            <apex:column >
                                <apex:facet name="header">第三优先品牌</apex:facet>
                                <apex:outputField value="{!mp3.ASI_CRM_CN_Sub_brand__c}" />
                            </apex:column>
                        </apex:pageblocktable>
                    </apex:pageblocksectionItem>
                </apex:pageBlockSection>
            </apex:pageBlock>
            <apex:pageBlock title="站点数量" rendered="{!isON}" id="ON2">
                <apex:pageBlockButtons location="top">
                    <!--<apex:commandbutton value="Add" action="{!addRow}"/>-->
                </apex:pageBlockButtons>
                <apex:actionRegion >
                    <apex:pageBlocktable value="{!LImageSite}" var="s" id="table">
                        <apex:column >
                            <apex:facet name="header"><apex:commandLink value="添加" action="{!addRow}" rerender="table" style="text-decoration:underline;" oncomplete="endAddNewAction();" /></apex:facet>
                            <apex:commandLink value="移除" action="{!RemoveRow}" immediate="true" rerender="table"><apex:param assignTo="{!rowid}" value="{!s.Name}" name="assignvalue" /></apex:commandLink>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">站点</apex:facet>
                            <apex:inputField value="{!s.ASI_CRM_Site__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">类型</apex:facet>
                            <apex:inputField value="{!s.ASI_CRM_Type__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">过去</apex:facet>
                            <apex:inputField value="{!s.ASI_CRM_Previous__c}"/>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">预期</apex:facet>
                            <apex:inputField value="{!s.ASI_CRM_Expected__c}"/>
                        </apex:column>
                        
                    </apex:pageBlocktable>
                </apex:actionRegion>
            </apex:pageBlock>
            <apex:outputpanel id="display">
                <apex:pageblock title="店家补充资料" rendered="{!isON}" id="ON3">
                    <apex:pageblocksection >
                        <apex:pageblocksectionitem >
                            <apex:outputText value="上个PO号码:" />
                            <apex:outputField value="{!ImageReq.ASI_CRM_CN_Last_Contract__c}" />
                        </apex:pageblocksectionitem>
                        <apex:pageblocksectionItem >
                            <apex:outputText value="申请日期:" />
                            <apex:outputField value="{!ImageReq.ASI_CRM_Application_Date__c}"/>
                        </apex:pageblocksectionItem>
                        <apex:pageblocksectionitem >
                            <apex:outputText value="PO 开始日期:" />
                            <!--<apex:outputText value="{!Day(POStart)}/{!Month(POStart)}/{!Year(POStart)}" rendered="{!POStart!=null}" />-->
                            <apex:outputField value="{!listContract.ASI_CRM_CN_PO_Start_Date__c}" />
                        </apex:pageblocksectionitem>
                        <apex:pageblocksectionitem >
                            <apex:outputText value="PO 结束日期:" />
                            <!--<apex:outputText value="{!Day(POEnd)}/{!Month(POEnd)}/{!Year(POEnd)}" rendered="{!POEnd!=null}"/>-->
                            <apex:outputField value="{!listContract.ASI_CRM_CN_PO_End_Date__c}" />
                        </apex:pageblocksectionitem>
                    </apex:pageblocksection>
                    <!-- <table width="100%" style="border: 1px solid #E4E7E7;" border="1" cellpadding="3" cellspacing="0">
<tr >
<td bgcolor="#E4E7E7"><strong>PO 开始日期:</strong></td>
<td><apex:outputText value="{!Day(POStart)}/{!Month(POStart)}/{!Year(POStart)}" rendered="{!POStart!=null}" /></td>
<td bgcolor="#E4E7E7"><strong>PO 结束日期:</strong></td>
<td><apex:outputText value="{!Day(POEnd)}/{!Month(POEnd)}/{!Year(POEnd)}" rendered="{!POEnd!=null}"/></td>
</tr>
</table>-->
                    <table width="100%" style="border: 1px solid #E4E7E7;" border="1" cellpadding="3" cellspacing="0">
                        <tr bgcolor="#E4E7E7">
                            <th>子品牌档次</th>
                            <th>子品牌</th>
                            <th>量</th>
                        </tr>
                        <apex:repeat value="{!mapSubbrandGrade}" var="sb1">
                            <tr>
                                <td>{!sb1}</td>
                                <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                    <apex:repeat value="{!mapSubbrandGrade[sb1]}" var="sb2">
                                        <tr>
                                            <td>{!sb2}</td>
                                        </tr>
                                    </apex:repeat>
                                    </table></td>
                                <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                    <apex:repeat value="{!mapSubbrandGrade[sb1]}" var="sb2">
                                        <tr>
                                            <td align="right"><apex:outputText value="{0,number,#,###,###}" rendered="{!mapSubbrandGrade[sb1][sb2].value!=null&&mapSubbrandGrade[sb1][sb2].value!=0}" ><apex:param value="{!mapSubbrandGrade[sb1][sb2].value}" /></apex:outputText>
                                                <apex:outputText value=" - " rendered="{!mapSubbrandGrade[sb1][sb2].value==0||mapSubbrandGrade[sb1][sb2].value==null}" /></td>
                                        </tr>
                                    </apex:repeat>
                                    </table></td>
                                
                            </tr>
                        </apex:repeat>
                    </table>
                </apex:pageblock>
            </apex:outputpanel>
            <!-- Image Outlet Application Form (OFF) -->       
            <apex:pageBlock title="形象店申请" rendered="{!isOFF}" id="OFF1">
                
                <apex:pageBlockButtons location="top">
                    <apex:commandbutton value="保存" action="{!SaveAll}"/>
                    <apex:commandbutton value="取消" action="{!Cancel}"/>
                    <!--<apex:commandbutton value="Generate"  onclick="window.open('/apex/ASI_CRM_CN_ImageOutletGenerate?id={!ImageReq.Id}','_blank','height=400,location=no,resizable=yes,toolbar=no,status=no,menubar=no,scrollbars=1', 1);"/>-->
                </apex:pageBlockButtons>
                <apex:pageBlockSection title="输入区域信息" id="form2">
                    <apex:pageBlockSectionItem >
                        <apex:outputText value="店家名称:" />
                        <apex:outputField value="{!ImageReq.ASI_CRM_Outlet__c}" />
                    </apex:pageBlockSectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="子渠道:" />
                        <apex:outputText value="{!strsubchannelName}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="CRM 代码:" />
                        <apex:outputText value="{!strCRMCode}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="区域:" />
                        <apex:outputText value="{!strregion}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="地址:" />
                        <apex:outputText value="{!strAddress}"/>
                    </apex:pageblocksectionItem>
                    <apex:pageblocksectionItem >
                        <apex:outputText value="店家形象:" />
                        <apex:outputText value="{!strImage}"/>
                    </apex:pageblocksectionItem>    
                    <apex:pageBlockSectionItem >
                        <apex:outputText value="申请人:" />
                        <apex:inputField value="{!ImageReq.ASI_CRM_Application_Person__c}"/>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputText value="申请日期:" />
                        <apex:outputField value="{!ImageReq.ASI_CRM_Application_Date__c}"/>
                    </apex:pageBlockSectionItem>
                    <!-- <apex:pageBlockSectionItem >
<apex:outputText value="子品牌 1:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Sub_brand_1__c}"> <apex:actionSupport event="onchange" action="{!showAllBrands}" rerender="gen1"/></apex:inputField>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="形象制作:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Image_Production_1__c}"/>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="子品牌 2:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Sub_brand_2__c}"> <apex:actionSupport event="onchange" action="{!showAllBrands}" rerender="gen1"/></apex:inputField>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="形象制作:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Image_Production_2__c}"/>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="子品牌 3:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Sub_brand_3__c}"> <apex:actionSupport event="onchange" action="{!showAllBrands}" rerender="gen1"/></apex:inputField>
</apex:pageblockSectionItem>
<apex:pageBlockSectionItem >
<apex:outputText value="形象制作:" />
<apex:inputField value="{!ImageReq.ASI_CRM_Image_Production_3__c}"/>
</apex:pageblockSectionItem>-->
                </apex:pageBlockSection>
                
                <apex:pageblocksection columns="1">
                    <apex:pageBlockSectionItem >
                        <apex:outputText value="申请原因:" />
                        <apex:inputField value="{!ImageReq.ASI_CRM_Application_Reason__c}" style="width:50%;"/>
                    </apex:pageBlockSectionItem>
                </apex:pageblocksection>
                <apex:pageBlockSection title="子品牌" columns="1">
                    <apex:pageBlockSectionItem >
                        <apex:actionRegion >
                            <apex:pageblockTable value="{!IOMOffSBList}" var="sb" id="sbtable">
                                <apex:column >
                                    <apex:facet name="header"><apex:commandLink value="添加" action="{!addIOMATRow}" rerender="sbtable" style="text-decoration:underline;" oncomplete="endAddNewAction();" /></apex:facet>
                                    <apex:commandLink value="移除" action="{!removeSBRow}" immediate="true" rerender="sbtable, gen1" ><apex:param assignTo="{!rowid}" value="{!sb.Name}" name="assignvalue" /></apex:commandLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">子品牌</apex:facet>
                                    <apex:inputField value="{!sb.ASI_CRM_Sub_Brand__c}" required="true" ><apex:actionSupport event="onchange" action="{!showAllBrands}" rerender="gen1"/>
                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">形象制作</apex:facet>
                                    <apex:inputField value="{!sb.ASI_CRM_Image_Production__c}"/>
                                </apex:column>
                            </apex:pageblockTable>
                        </apex:actionRegion>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>
                <apex:pageBlockSection title="MAT Outlet Business size" id="form3" columns="1" >
                    <apex:pageblocktable value="{!data2_list}" var="iomat" id="iomattable" >
                        <apex:column >
                            <apex:facet name="header">子类别</apex:facet>
                            <apex:outputText value="{!iomat}"/>
                            <apex:facet name="footer">总计:</apex:facet>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">值</apex:facet>
                            <apex:outputText value="{!data2_list[iomat].value}"/>
                            <apex:facet name="footer" ><apex:outputText value="{0,number,####.##}"><apex:param value="{!strTotal}" /></apex:outputText></apex:facet>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">%</apex:facet>
                            <apex:outputText value="{0,number,####.##}"><apex:param value="{!data2_list[iomat].percentage}"/></apex:outputText>
                            <apex:facet name="footer" ><apex:outputText value="{0,number,####.##}%"><apex:param value="{!strTotalP}" /></apex:outputText></apex:facet>
                        </apex:column>
                    </apex:pageblocktable>
                </apex:pageBlockSection>
                <!--   <apex:pageBlockSection >
<apex:pageblocksectionitem >
<apex:outputText value="总计: "/>
<apex:outputText value="{!strTotal}"/>
</apex:pageblocksectionitem>
<apex:pageblocksectionitem >
<apex:outputText value="总计 %: "/>
<apex:outputText value="{!strTotalP}%"/>
</apex:pageblocksectionitem>
</apex:pageBlockSection>-->
            </apex:pageBlock>
            <apex:pageblock title="MAT PRC Business Size" id="gen1" rendered="{!isOFF}">
                <table width="100%" style="border: 1px solid #E4E7E7;" border="1" cellpadding="3" cellspacing="0">
                    <tr bgcolor="#E4E7E7">
                        <th>子类别</th>
                        <th>子品牌</th>
                        <th>数量</th>
                        <th>%</th>
                        <th>值</th>
                        <th>%</th>
                    </tr>
                    <apex:repeat value="{!MATPRC_map}" var="t1">
                        <tr>
                            <td>{!t1}</td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td>{!t2}</td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,0}" ><apex:param value="{!t3.totalvalue}" /></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,####.##}%"><apex:param value="{!t3.totalpercentage}"/></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,#,###,###.##}" rendered="{!t3.value!=0&&t3.value!=null}" ><apex:param value="{!t3.value}" /></apex:outputText>
                                                        <apex:outputText value=" - " rendered="{!t3.value==0||t3.value==null}" /></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!MATPRC_map[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!MATPRC_map[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,####.##}%"><apex:param value="{!t3.percentage}"/></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                        </tr>
                    </apex:repeat>
                    <tr>
                        <td colspan="2" align="right"><Strong>Total: </Strong></td>
                        <td align="right"><apex:outputText value="{0,number,0}" ><apex:param value="{!strTotalQty}" /></apex:outputText></td>
                        <td align="right"><apex:outputText value="{0,number,0}%" ><apex:param value="{!strTotalQtyP}" /></apex:outputText></td>
                        <td align="right"><apex:outputText value="{0,number,0.00}" ><apex:param value="{!strTotalVal}" /></apex:outputText></td>
                        <td align="right"><apex:outputText value="{0,number,0}%" ><apex:param value="{!strTotalValP}" /></apex:outputText></td>
                    </tr>
                </table>
            </apex:pageblock>
            
            <apex:pageblock title="子品牌量" id="gen2" rendered="{!isOFF}">
                <table width="100%" style="border: 1px solid #E4E7E7;" border="1" cellpadding="3" cellspacing="0">
                    <tr bgcolor="#E4E7E7">
                        <th>品牌</th>
                        <th>子品牌</th>
                        <th>数量</th>
                        <th>%</th>
                    </tr>
                    <apex:repeat value="{!Allbrands}" var="t1">
                        <tr>
                            <td>{!t1}</td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!Allbrands[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!Allbrands[t1][t2]}" var="t3">
                                                <tr>
                                                    <td>{!t2}</td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!Allbrands[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!Allbrands[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,0}" ><apex:param value="{!t3.totalvalue}" /></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                </table></td>
                            <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <apex:repeat value="{!Allbrands[t1]}" var="t2">
                                    <tr>
                                        <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <apex:repeat value="{!Allbrands[t1][t2]}" var="t3">
                                                <tr>
                                                    <td align="right"><apex:outputText value="{0,number,####.##}"><apex:param value="{!t3.totalpercentage}"/></apex:outputText></td>
                                                </tr>
                                            </apex:repeat>
                                            </table></td>
                                    </tr>
                                </apex:repeat>
                                
                                </table></td>
                        </tr>
                    </apex:repeat>
                    <tr>
                        <td colspan="2" align="right"><Strong>总计: </Strong></td>
                        <td align="right"><apex:outputText value="{0,number,0}" ><apex:param value="{!strTotalGS}" /></apex:outputText></td>
                        <td align="right"><apex:outputText value="{0,number,0}%" ><apex:param value="{!strTotalPGS}" /></apex:outputText></td>
                    </tr>
                </table>
            </apex:pageblock>
            
        </apex:outputpanel>
        
    </apex:form>
</apex:page>