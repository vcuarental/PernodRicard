<apex:page standardController="ASI_TH_CRM_PaymentRequest__c" extensions="ASI_CRM_CN_EditHeavyPaymentDetailCtrl" docType="html-5.0" sidebar="false" >
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, '/bower_components/Font-Awesome/css/font-awesome.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, '/bower_components/Font-Awesome/css/font-awesome.min.css')}" />
    
    <apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.ASI_Library, 'dist/css/bootstrap.min.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery1.10.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_Library, 'dist/js/bootstrap.min.js')}" />
    <style>
        
        .BSCommandButton{
        color: #333 !important;
        background-color: #fff !important;
        border-color: #ccc !important;
        margin-left: 0.5em !important; 
        margin-right: 0.5em !important; 
        margin-bottom: 0.5em !important;
        padding: 3px 6px !important; 
        }
        
        
        .HeaderCss{
        color: #fff;
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
        background-color: #337ab7;
        border: 1px solid transparent;
        border-color: #337ab7;
        padding: 10px 15px;
        text-align: center;
        }
        
        .PanelBody{
        padding: 0.3em; 
        background-color: #fff; 
        border: 1px solid transparent;
        border-color: #337ab7;
        border-bottom-left-radius: 3px;
        border-bottom-right-radius: 3px;
        border-top-right-radius: 3px;
        }
        
        
        .FontWeightCSS{
        font-weight: bold;
        }
        
        
        .DisplayFieldCSS{
        padding: 1em !important;
        }
        
        
        .InputNumberFieldwidth{
        width: 10em !important;
        }
        
        .MethodologyLabel{
        font-weight: bold !important; 
        text-align: right !important;
        }
        
        
        .WeightLeft{
        font-weight: bold !important; 
        text-align: left !important;
        padding-left: 2em !important;
        }
        
        .ApexInputDateField{
        text-align: right;
        padding: 4px 8px; 
        border: 1px solid #ccc; 
        border-radius: 4px;
        width: 10em !important;
        }
        
        .ApexInputNumberField{
        text-align: right;
        padding: 4px 8px; 
        border: 1px solid #ccc; 
        border-radius: 4px;
        width: 10em !important;
        }
        
        
        
        .ApexInputRemarkField{
        padding: 5px 10px; 
        border: 1px solid #ccc; 
        border-radius: 4px;
        }
        
        
        
        .ApexPickListField{
        width: 16em; text-align:
        right; padding: 3px 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
        }
        
        .BorderBottom{
        border-bottom: 1px solid #ddd;
        }
        
        .GridColumn1{
        grid-column-start: 1 !important; 
        grid-column-end: 1 !important;
        }
        
        .GridColumn2{
        grid-column-start: 2 !important; 
        grid-column-end: 2 !important;
        }
        
        .GridColumn3{
        grid-column-start: 3 !important; 
        grid-column-end: 3 !important;
        }
        
        .GridColumn4{
        grid-column-start: 4 !important; 
        grid-column-end: 4 !important;
        }
        
        .GridColumn5{
        grid-column-start: 5 !important; 
        grid-column-end: 5 !important;
        }
        
        
        .GridColumn6{
        grid-column-start: 6 !important; 
        grid-column-end: 6 !important;
        }
        
        .GridColumn7{
        grid-column-start: 7 !important; 
        grid-column-end: 7 !important;
        }
        
        .MethodologyLabel{
        font-weight: bold !important; 
        text-align: right !important;
        }
        
        .requiredField{
        border-left: 3px solid red !important;
        }
        
    </style>
    
    
    <script type='text/javascript'>
    $(document).ready(function() {
        var BrandList=document.getElementsByClassName("bPageFooter");
        for( var i=0; i<BrandList.length ; i++){
            BrandList[i].innerHTML='';
        }
        
    });
    
    window.onload = function() {
        $('input[type=text]').blur(); 
    };
    
    
    $(document).on('mousemove', function(e){
        $('#loadtext').css({
            left:  e.pageX,
            top:   e.pageY
        });
        $('input[type=text]').on('keydown', function(e) {
            if (e.which == 13) {
                e.preventDefault();
            }
        });
    });
    
    
    //**************************************BRSF Function*****************************************************
    
    function SuggestedValueChecking(row,that){
        
        var SuggestedVol= that.parentElement.getAttribute('data-SuggestedVol');
        SuggestedVol = Number(SuggestedVol);
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>SuggestedVol){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
    }
    
    
    function SetBRSFTotalPayableVol(that){
        
        
        var rowId= that.parentElement.getAttribute('data-id');
        var BRSFTotalPayableVol=Number(StringToNumberStr($('#IncentiveBT_'+rowId).attr( 'data-value' ))) * Number(StringToNumberStr($('#BRSFPayableVol_'+rowId)[0].childNodes[0].value));
        $('#BRSFTotalPayableVol_'+rowId)[0].childNodes[0].textContent= formatNumber(BRSFTotalPayableVol);
        CalculateBRSFTotalPayableAmount();
    }
    
    
    function SetBRSFIncentiveBT(that){
        var rowId= that.parentElement.getAttribute('data-id');
        var CurrentAmount =that.value;
        $('#IncentiveBT_'+rowId).attr( 'data-value' ,CurrentAmount);
        
        var BRSFTotalPayableVol=Number(CurrentAmount) * Number(StringToNumberStr($('#BRSFPayableVol_'+rowId)[0].childNodes[0].value) );
        //console.log('BRSFTotalPayableVol: '+BRSFTotalPayableVol );
        BRSFTotalPayableVol=BRSFTotalPayableVol.toFixed(2);
        
        $('#BRSFTotalPayableVol_'+rowId)[0].childNodes[0].textContent= formatNumber(BRSFTotalPayableVol);
        CalculateBRSFTotalPayableAmount();
        CalculateBRSFTotalIncentive();
    }
    
    //Calculate BRSF Total Incentive 
    function CalculateBRSFTotalIncentive (){
        var TotalAmount =0.0;
        $('.BRSFIncentiveBTClass').each(function(){//console.log($(this).attr( 'data-value' ));
            TotalAmount+=Number(StringToNumberStr($(this).attr('data-value')));
        });
        $('#BRSFTotalIncentiveBTId')[0].childNodes[0].textContent= formatNumber(TotalAmount);
        
    }
    
    
    function CalculateBRSFTotalPayableVol(){
        var TotalPayableVol=0.0;
        $('.BRSFPayableVolClass').each(function(){
            if($(this)[0].childNodes[0].value){
                TotalPayableVol +=Number(StringToNumberStr($(this)[0].childNodes[0].value));
            }
        });//TotalPayableVol=TotalPayableVol.toFixed(2);
        $('#BRSFTotalPayableVolId')[0].childNodes[0].textContent = formatNumber(TotalPayableVol.toFixed(0));
    }
    
    
    // Calculate BRSF Total Payable Amount (Last collum), 'Application Payment Amount'
    function CalculateBRSFTotalPayableAmount(){
        CalculateBRSFTotalPayableVol();
        var TotalPayableAmount =0.0;
        $('.BRSFTotalPayableVolClass').each(function(){
            TotalPayableAmount+=Number(StringToNumberStr($(this)[0].childNodes[0].textContent));
        });
        
        $('#BRSFTotalPayableAmountId')[0].childNodes[0].textContent= formatNumber(TotalPayableAmount.toFixed(2));
        
        // setting 'Application Payment Amount'= Total CTD Payable Amount - Historical Paid Amount
        var HistoricalPaidAmount = StringToNumberStr($('#BRSFHistoricalPaidAmountId')[0].childNodes[0].textContent);
        var ApplicationPaymentAmount = TotalPayableAmount - Number(StringToNumberStr($('#BRSFHistoricalPaidAmountId')[0].childNodes[0].textContent));   
        $('#BRSFApplicationPaymentAmountId')[0].childNodes[0].textContent= formatNumber(ApplicationPaymentAmount.toFixed(2));
        SettingActualPayment(ApplicationPaymentAmount);
        
        
    }
    
    
    
    
    //Setting Actual Payment
    function  SettingActualPayment(ApplicationPaymentAmount){
        var HistoricalPaidAmount = StringToNumberStr($('#BRSFHistoricalPaidAmountId')[0].childNodes[0].textContent);
        $('.BRSFAdjustmentclass')[0].textContent=100.00;
        $('#BRSFActualPaymentId')[0].childNodes[0].value= formatNumber((ApplicationPaymentAmount).toFixed(2));
    }
    
    
    function SetAdjustmentPercent(HistoricalPaidAmountId,ApplicationPaymentAmountId,ActualPaymentId,Adjustmentclass){
        var HistoricalPaidAmount = StringToNumberStr($('#'+HistoricalPaidAmountId)[0].childNodes[0].textContent);
        
        var ApplicationAmount=StringToNumberStr($('#'+ApplicationPaymentAmountId)[0].childNodes[0].textContent);
        var ActualPayment= StringToNumberStr($('#'+ActualPaymentId)[0].childNodes[0].value);
        var AdjustmentPercent=100;
        
        if(ActualPayment && ApplicationAmount && ApplicationAmount!=0){
            console.log('ActualPayment'+ActualPayment);
            console.log('ApplicationAmount'+ApplicationAmount);
            console.log('HistoricalPaidAmount'+HistoricalPaidAmount);
            AdjustmentPercent=(ActualPayment/(ApplicationAmount))*100;
        }
        $('.'+Adjustmentclass)[0].textContent=AdjustmentPercent.toFixed(2);
        
    }
    
    
    
    //Onchange the Adjustment
    /*function BRSFChangeAdjustment(that){
        var ApplicationPaymentAmount = Number(StringToNumberStr($('#BRSFTotalPayableAmountId')[0].childNodes[0].textContent)) - Number(StringToNumberStr($('#BRSFHistoricalPaidAmountId')[0].childNodes[0].textContent))
        SettingActualPayment(ApplicationPaymentAmount);
    }*/
    
    function ChangingBRSFEndDate(){
        if(confirm('After Changing BRSF Date, Volume will refresh, confirm?\n更改空瓶回收日期，系统会自动刷新销量，确定？')) {
            ChangingBRSFDate();
        }
    }
    
    
    
    
    // base on user input to check if incentive large then mas incentive 
    function CheckOverPaid(row,that,TypeName){
        var rowId = that.parentElement.getAttribute('data-id');
        var MaxIncentive = Number($('#'+TypeName+rowId).attr('data-Incentive'));
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>MaxIncentive){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
    }
    
    
    //**************************************PSF Function*****************************************************
    
    
    function ChangingPSFEndDate(that){
        if(confirm('After Changing PSF Date, Volume will refresh, confirm?\n更改PSF日期，系统会自动刷新销量，确定？')) {
            ChangingPSFDate(that); 
        }        
    }
    
    //Calculate  PSF Total Payable Amount in 'By Grade/Category/Toal'
    function CalPSFTotalPayableAmount(that){
        var ModuleId= that.parentElement.getAttribute('data-Module');
        var TotalPayableVolAmount =0.0;
        $('.PSFPayableVolAmount_'+ModuleId).each(function(){
            TotalPayableVolAmount+=Number(StringToNumberStr($(this)[0].childNodes[0].value));//console.log($(this)[0].childNodes[0].value);
        });//console.log('TotalPayableVolAmount: '+ TotalPayableVolAmount );
        
        
        $('#PSFTotalPayableAmountId_'+ModuleId)[0].childNodes[0].textContent= formatNumber(TotalPayableVolAmount.toFixed(2));
        
        // setting 'Application Payment Amount'= Total CTD Payable Amount - Historical Paid Amount
        var HistoricalPaidAmount = StringToNumberStr($('#PSFHistoricalPaidAmount_'+ModuleId)[0].childNodes[0].textContent);
        var ApplicationPaymentAmount = TotalPayableVolAmount - Number(StringToNumberStr(HistoricalPaidAmount)); 
        $('#PSFApplicationPaymentAmount_'+ModuleId)[0].childNodes[0].textContent= formatNumber(ApplicationPaymentAmount.toFixed(2));
        
        PSFSettingActualPayment(ApplicationPaymentAmount,ModuleId);
        
    }
    
    //Setting 'CTD Payable Amount' 
    function SetPSFTotalPayableVol(that){
        //console.log('**SetPSFTotalPayableVol**');
        var rowId= that.parentElement.getAttribute('data-id');
        var ModuleId = that.parentElement.getAttribute('data-Module');
        
        var PSFTotalPayableVol=Number(StringToNumberStr($('#PSFIncentiveBT_'+ModuleId+rowId).attr( 'data-value' ))) * Number(StringToNumberStr($('#PSFPayableVol_'+ModuleId+rowId)[0].childNodes[0].value) );
        
        //console.log('#PSFTotalPayableVol_'+ModuleId+rowId +' : '  + $('#PSFTotalPayableVol_'+ModuleId+rowId)[0].childNodes[0].textContent);
        $('#PSFTotalPayableVol_'+ModuleId+rowId)[0].childNodes[0].textContent= formatNumber(PSFTotalPayableVol.toFixed(2));
        
        CalculatePSFTotalPayableAmount(that.parentElement.getAttribute('data-Module'));
        CalculatePSFTotalPayableVol(that.parentElement.getAttribute('data-Module'));
    }
    
    //Set PSF Incentive BT
    function SetPSFIncentiveBT(that){
        var rowId= that.parentElement.getAttribute('data-id');
        var ModuleId = that.parentElement.getAttribute('data-Module');
        var CurrentAmount =that.value;
        $('#PSFIncentiveBT_'+ModuleId+rowId).attr( 'data-value' ,CurrentAmount);
        
        var VolumeBase= that.parentElement.getAttribute('data-Volume-Base');
        if(VolumeBase=='By Sub-Brand'){
            //Total payable = Incentive BT* Payable Vol
            var PSFTotalPayableVol=Number(CurrentAmount) * Number(StringToNumberStr($('#PSFPayableVol_'+ModuleId+rowId)[0].childNodes[0].value));
            console.log('Number(CurrentAmount): '+Number(CurrentAmount));
            console.log('PSFPayableVol_: '+ Number(StringToNumberStr($('#PSFPayableVol_'+ModuleId+rowId)[0].childNodes[0].value)) );
            
            $('#PSFTotalPayableVol_'+ModuleId+rowId)[0].childNodes[0].textContent= formatNumber(PSFTotalPayableVol.toFixed(2));
        }else{
            //CTD Payable Amt.= (Payable Vol by Key Principle /V0.0 Full Contract Target)* Incentive Target
            // var PayableVol= that.parentElement.getAttribute('data-Payable-Vol');
        }
        CalculatePSFTotalIncentive(that.parentElement.getAttribute('data-Module'));
        CalculatePSFTotalPayableAmount(that.parentElement.getAttribute('data-Module'));
    }
    
    
    // Calculate PSF Total Payable Amount (Last collum), 'Application Payment Amount'
    function CalculatePSFTotalPayableAmount(ModuleId){
        var TotalPayableAmount =0.0;
        $('.PSFTotalPayableVolClass_'+ModuleId).each(function(){
            TotalPayableAmount+=Number(StringToNumberStr($(this)[0].childNodes[0].textContent));
        });
        
        $('#PSFTotalPayableAmountId_'+ModuleId)[0].childNodes[0].textContent= formatNumber(TotalPayableAmount.toFixed(2));
        
        // setting 'Application Payment Amount'= Total CTD Payable Amount - Historical Paid Amount
        var HistoricalPaidAmount = StringToNumberStr($('#PSFHistoricalPaidAmount_'+ModuleId)[0].childNodes[0].textContent);
        var ApplicationPaymentAmount = TotalPayableAmount - Number(StringToNumberStr(HistoricalPaidAmount));    
        $('#PSFApplicationPaymentAmount_'+ModuleId)[0].childNodes[0].textContent= formatNumber(ApplicationPaymentAmount.toFixed(2));
        
        PSFSettingActualPayment(ApplicationPaymentAmount,ModuleId);
    }
    
    
    //Setting Actual Payment
    function  PSFSettingActualPayment(ApplicationPaymentAmount,ModuleId){
        var HistoricalPaidAmount = StringToNumberStr($('#PSFHistoricalPaidAmount_'+ModuleId)[0].childNodes[0].textContent);
        $('.PSFAdjustment_'+ModuleId)[0].textContent=100.00;        
        $('#PSFActualPayment_'+ModuleId)[0].childNodes[0].value= formatNumber((ApplicationPaymentAmount).toFixed(2));
        
        //var ActualPayment= ApplicationPaymentAmount*Number($('.PSFAdjustment_'+ModuleId)[0].value)/100;
        //$('#PSFActualPayment_'+ModuleId)[0].childNodes[0].textContent= formatNumber(ActualPayment.toFixed(2));
    }
    
    
    //Changing PSF Adjustment 
    function PSFChangeAdjustment(ModuleId){
        var ApplicationPaymentAmount = Number(StringToNumberStr($('#PSFTotalPayableAmountId_'+ModuleId)[0].childNodes[0].textContent)) - Number(StringToNumberStr($('#PSFHistoricalPaidAmount_'+ModuleId )[0].childNodes[0].textContent));  
        PSFSettingActualPayment(ApplicationPaymentAmount,ModuleId);
    }
    
    
    //Calculate PSF Total Incentive 
    function CalculatePSFTotalIncentive (ModuleId){
        var TotalAmount =0.0;
        $('.PSFIncentiveBTClass_'+ModuleId).each(function(){
            TotalAmount+=Number(StringToNumberStr($(this).attr('data-value')));
        });
        $('#PSFTotalIncentiveBT_'+ModuleId)[0].childNodes[0].textContent= formatNumber(TotalAmount.toFixed(2));
    }
    
    
    function CalculatePSFTotalPayableVol(ModuleId){
        var TotalVol =0.0;
        $('.PSFPayableVolClass_'+ModuleId).each(function(){
            TotalVol+= Number(StringToNumberStr($(this)[0].childNodes[0].value));
        });
        $('#PSFTotalPayableVolId_'+ModuleId)[0].childNodes[0].textContent= formatNumber(TotalVol.toFixed(0));
    }
    
    
    
    //**************************************VEC Function*****************************************************
    
    // Calculate VEC Total Payable Amount (Last collum), 'Application Payment Amount'
    function CalVECTotalPayableAmount(){//console.log('*******CalVECTotalPayableAmount**************');
        var TotalPayableAmount =0.0;
        $('.VECTotalPayableAmountClass').each(function(){
            TotalPayableAmount+=Number(StringToNumberStr($(this)[0].childNodes[0].value));
        });
        $('#VECTotalPayableAmountId')[0].childNodes[0].textContent= formatNumber(TotalPayableAmount.toFixed(2));
        
        // setting 'Application Payment Amount'= Total CTD Payable Amount - Historical Paid Amount
        var HistoricalPaidAmount = StringToNumberStr($('#VECHistoricalPaidAmountId')[0].childNodes[0].textContent);
        var ApplicationPaymentAmount = TotalPayableAmount - Number(StringToNumberStr($('#VECHistoricalPaidAmountId')[0].childNodes[0].textContent));
        $('#VECApplicationPaymentAmountId')[0].childNodes[0].textContent= formatNumber(ApplicationPaymentAmount.toFixed(2));
        //Setting Actual Payment
        VECSettingActualPayment(ApplicationPaymentAmount);
    }
    
    
    function ChangingVECEndDate(){
        if(confirm('After Changing Variable Event Cost Date, Volume will refresh, confirm?\n更改Variable Event Cost日期，系统会自动刷新销量，确定？')) {
            ChangingVECDate();
        }
    }
    
    function SetVECTotalPayableVol(that){
        var rowId= that.parentElement.getAttribute('data-id');
        
        var VECTotalPayableVol=Number($('#VECIncentiveBT_'+rowId).attr( 'data-value' )) * Number($('#VECPayableVol_'+rowId)[0].childNodes[0].value);
        $('#VECTotalPayableVol_'+rowId)[0].childNodes[0].textContent= formatNumber(VECTotalPayableVol.toFixed(2));
        CalculateVECTotalIncentive();
        CalculateVECTotalPayableAmount();
    }
    
    
    function SetVECIncentiveBT(that){
        var rowId= that.parentElement.getAttribute('data-id');
        var CurrentAmount =that.value;
        $('#VECIncentiveBT_'+rowId).attr( 'data-value' ,CurrentAmount);
        
        var VECTotalPayableVol=Number(CurrentAmount) * Number($('#VECPayableVol_'+rowId)[0].childNodes[0].value);
        $('#VECTotalPayableVol_'+rowId)[0].childNodes[0].textContent= formatNumber(VECTotalPayableVol.toFixed(2));
        CalculateVECTotalIncentive();
        CalculateVECTotalPayableAmount();
    }
    
    
    
    //Calculate VEC Total Incentive 
    function CalculateVECTotalIncentive(){
        var TotalAmount =0.0;
        $('.VECIncentiveBTClass').each(function(){//console.log($(this).attr( 'data-value' ));
            TotalAmount+=Number(StringToNumberStr($(this).attr('data-value')));
        });
        $('#VECTotalIncentiveBTId')[0].childNodes[0].textContent= formatNumber(TotalAmount);
        
    }
    
    
    // Calculate VEC Total Payable Amount (Last collum), 'Application Payment Amount'
    function CalculateVECTotalPayableAmount(){
        CalculateVECTotalPayableVol();
        var TotalPayableAmount =0.0;
        $('.VECTotalPayableVolClass').each(function(){//console.log(StringToNumberStr($(this)[0].childNodes[0].textContent));
            TotalPayableAmount+=Number(StringToNumberStr($(this)[0].childNodes[0].textContent));
        });
        $('#VECTotalPayableAmountId')[0].childNodes[0].textContent= formatNumber(TotalPayableAmount.toFixed(2));
        
        // setting 'Application Payment Amount'= Total CTD Payable Amount - Historical Paid Amount
        var HistoricalPaidAmount = StringToNumberStr($('#VECHistoricalPaidAmountId')[0].childNodes[0].textContent);// console.log('HistoricalPaidAmount   : '+HistoricalPaidAmount);
        var ApplicationPaymentAmount = TotalPayableAmount - Number(StringToNumberStr($('#VECHistoricalPaidAmountId')[0].childNodes[0].textContent));//console.log('VECHistoricalPaidAmountId   : '+ApplicationPaymentAmount);
        $('#VECApplicationPaymentAmountId')[0].childNodes[0].textContent= formatNumber(ApplicationPaymentAmount.toFixed(2));
        //Setting Actual Payment
        VECSettingActualPayment(ApplicationPaymentAmount);
    }
    
    
    function CalculateVECTotalPayableVol(){
        var TotalPayableVol=0.0;
        $('.VECPayableVolClass').each(function(){
            if($(this)[0].childNodes[0].value){
                TotalPayableVol +=Number(StringToNumberStr($(this)[0].childNodes[0].value));
            }
        });
        $('#VECTotalPayableVolId')[0].childNodes[0].textContent = formatNumber(TotalPayableVol.toFixed(0));
    }
    
    //Setting Actual Payment
    function  VECSettingActualPayment(ApplicationPaymentAmount){
        var HistoricalPaidAmount = StringToNumberStr($('#VECHistoricalPaidAmountId')[0].childNodes[0].textContent);
        $('.VECAdjustmentclass')[0].textContent=100.00;        
        $('#VECActualPaymentId')[0].childNodes[0].value= formatNumber((ApplicationPaymentAmount).toFixed(2));
        
        
        //var ActualPayment= ApplicationPaymentAmount*Number($('.VECAdjustmentclass')[0].value)/100;
        //$('#VECActualPaymentId')[0].childNodes[0].textContent= formatNumber(ActualPayment.toFixed(2));
    }
    
    //Onchange the Adjustment
    function VECChangeAdjustment(that){//
        var ApplicationPaymentAmount = Number(StringToNumberStr($('#VECTotalPayableAmountId')[0].childNodes[0].textContent)) - Number(StringToNumberStr($('#VECHistoricalPaidAmountId')[0].childNodes[0].textContent))
        console.log($('#VECTotalPayableAmountId')[0].childNodes[0].textContent + '*****|vec| ******' +ApplicationPaymentAmount );
        VECSettingActualPayment(ApplicationPaymentAmount);
    }
    
    function QuickGoTo(ElementId){
        var e = document.getElementById(ElementId);
        if (!!e && e.scrollIntoView) {
            e.scrollIntoView();
        }
    }
    
    //*******************Shared function********************************
    function formatNumber(n) {
        return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    //remove comma
    function StringToNumberStr( i ) {
        return typeof i === 'string' ? i.replace(/\s/g, '').replace(/[\$,]/g, '')*1 : typeof i === 'number' ?   i : 0;
    };
    
    
    function currencyToFloat(currencyStr){
        if (typeof currencyStr === 'string') {
            var numStr = currencyStr.replace(/,/g, '');
            if (/^-?\d+\.?\d*$/.test(numStr)) {
                return parseFloat(numStr);
            }
        }
        return null;
    }        
    
    </script>
    
    <apex:form id="EditHeavyPaymentDetailPageId" >
        <div class="bs ">
            
            <div class="container-fluid" >                
                <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;" >
                    <div style="grid-column-start: 1; grid-column-end: 1;" >
                        <div style="font-weight: bold; font-family: Arial,Helvetica,sans-serif; color: #000; font-size: 1.3em; margin: 0.5em;">
                            {!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Label} 
                        </div> 
                    </div>
                    
                    <div style="grid-column-start: 2; grid-column-end: 2;  margin-top: 0.5em;" >
                        <div>
                            <apex:commandButton styleClass="BSCommandButton"  
                                                value="{!$Label.ASI_CRM_CN_IOM_Save}" 
                                                status="ActionStatus" 
                                                action="{!saveItems}"
                                                reRender="EditHeavyContractDetailPageId,EditHeavyPaymentDetailPageId" >
                                 <apex:param name="IS_QUICK_SAVE" value="false"/>
                            </apex:commandButton>
                            
                             <apex:commandButton styleClass="BSCommandButton"  
                                                value="{!$Label.ASI_CRM_CN_Quick_Save}" 
                                                status="ActionStatus" 
                                                action="{!saveItems}"
                                                 reRender="EditHeavyContractDetailPageId,EditHeavyPaymentDetailPageId" >
                                 <apex:param name="IS_QUICK_SAVE" value="true"/>
                            </apex:commandButton>
                            
                            

                            
                            
                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_IOM_Cancel}" 
                                                action="{!CancelProcess}" />
                            <apex:commandButton value="{!$Label.ASI_CRM_CN_Volume_Report}" styleClass="BSCommandButton" 
                                                onclick="window.open('/apex/ASI_CRM_CN_HeavyContractVolumeReportPage?id={!PH.ASI_TH_CRM_Contract__c}')" />
                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_Quick_to_VEC}"  
                                                onclick="QuickGoTo('VariableEventCostDivIdPart');" oncomplete="return false;"/> 
                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_Quick_to_Fixed_Cost}" 
                                                onclick="QuickGoTo('PaymentFixCostDivIdPart');" oncomplete="return false;"/> 
                        </div>
                    </div>
                </div>
                
                
                <div class="alert alert-danger fade in" style="{!IF(UpsertPermission,'display:none;','')}"  id="SaveFailPart">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                    <strong>Oops, we meet following error:</strong><br/>
                    <apex:outputText escape="false" value="{!msg}"/>
                </div>  
                
                
                <div class="row  ">
                    <div class="col">
                        <div class="panel panel-primary">
                            <div class="panel-heading" style="font-weight: bold" >
                                {!$Label.ASI_CRM_CN_VF_LABEL_Header_Info}
                            </div>
                            <div class="panel-body" style="padding: 0.5em" >
                                <table  style="width:50%"  >
                                    <tr>
                                        <td style="text-align: right; padding-right: 3em;">
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.Name.Label}"  />
                                        </td>
                                        <td>
                                            <apex:outputField value="{!PH.Name}" />
                                        </td>
                                        <td style="text-align: right; padding-right: 3em;" >
                                            <apex:outputLabel value="{!$Label.ASI_CRM_CN_V0_0_Cap_Collection}" />
                                        </td>
                                        <td>
                                            <apex:outputText value="{0,number,0}%">
                                                <apex:param value="{!PH.ASI_TH_CRM_Contract__r.ASI_CRM_CN_Bottle_Collection_Rate__c}"/>
                                            </apex:outputText>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; padding-right: 3em;">
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_PO_Start_Date__c.Label}"  />
                                        </td>
                                        <td>
                                            <apex:outputField value="{!PH.ASI_CRM_CN_PO_Start_Date__c}" />
                                        </td>
                                        <td style="text-align: right; padding-right: 3em;" >
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Martell_BC_Rate__c.Label}" />
                                        </td>
                                        <td>
                                            <apex:outputText value="{0,number,0}%"><apex:param value="{!PH.ASI_TH_CRM_Contract__r.ASI_CRM_Martell_BC_Rate__c}"/></apex:outputText>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td style="text-align: right; padding-right: 3em;">
                                             <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_PO_End_Date__c.Label}" />
                                        </td>
                                        <td>
                                            <apex:outputField value="{!PH.ASI_CRM_CN_PO_End_Date__c}"/>
                                        </td>
                                        <td style="text-align: right; padding-right: 3em;" >
                                           
                                        </td>
                                        <td>
                                            
                                        </td>
                                    </tr>
                                </table>
                            </div> 
                        </div>
                        
                    </div>
                </div>
                
                <apex:actionFunction name="ChangingBRSFDate" action="{!GenerateBRSFVol}" rerender="BRSFPanel,EditHeavyPaymentDetailPageId"  status="ActionStatus"   />       
                
                
                <!-----------------------------------BRSF--------------------------------------------------------->
                <div class="row  ">
                    <div class="col">
                        <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                            <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  >{!$Label.ASI_CRM_CN_VF_LABEL_BRSF}</div>
                            <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                <div style="margin-left: 5em;" >
                                </div>
                            </div> 
                        </div>
                        
                        
                        <div class="PanelBody" >
                            <div class="bs table-responsive" style="padding-bottom: 1em;" > 
                                <table class="bs table table-condensed" style="margin-bottom: 0; width:80%" >
                                    <tr>
                                        <td style="border-left: 1px solid #ddd;width:15%"   class="MethodologyLabel">{!$Label.ASI_CRM_CN_Start_Date}</td>
                                        <td style="width:10% ; border-left: 1px solid #ddd;" ><apex:outputField value="{!PH.ASI_CRM_CN_PO_Start_Date__c}" />     </td>
                                        <td  style="border-left: 1px solid #ddd;  border-right: 1px solid #ddd; width:15% "  class="MethodologyLabel" >{!$Label.ASI_CRM_CN_End_Date}</td>
                                        <td style="border-right: 1px solid #ddd;width:10% "  >
                                            <apex:inputField onchange="ChangingBRSFEndDate();"  value="{!BRSFItemMap.Module.ASI_CRM_End_Date__c}" 
                                                             styleClass="ApexInputDateField"   />
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td style="border-left: 1px solid #ddd;width:15%"   class="MethodologyLabel" >{!$Label.ASI_CRM_CN_Key_Principle}</td>
                                        <td style="width:10% ; border-left: 1px solid #ddd;" >
                                            <apex:outputField value="{!BRSFItemMap.Module.ASI_CRM_Methodology__r.Name} "  rendered="{!!showCN}" />
                                            <apex:outputField value="{!BRSFItemMap.Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} "  rendered="{!showCN}" />
                                        </td>
                                        <td  style="border-left: 1px solid #ddd;  border-right: 1px solid #ddd; width:15% "  class="MethodologyLabel"  > 

                                        </td>
                                        <td style="border-right: 1px solid #ddd;width:10% "   > </td>
                                    </tr>
                                    <tr>
                                        <td style="border-left: 1px solid #ddd;width:15%"   class="MethodologyLabel" >  {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label} </td>
                                        <td style="border-left: 1px solid #ddd;border-right: 1px solid #ddd;"  colspan="3">
                                           {!BRSFItemMap.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Remark__c}
                                        </td>
                                    </tr>
                                     <tr>
                                        <td style="border-left: 1px solid #ddd;width:15%"   class="MethodologyLabel" > {!$Label.ASI_CRM_CN_Contract_Terms_Ref}</td>
                                        <td style="border-left: 1px solid #ddd;border-right: 1px solid #ddd;"  colspan="3">
                                            <apex:outputText escape="false" value="{!BRSFItemMap.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Payment_Reference__c}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td> </td>
                                        <td ><apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_VF_BTN_Regen_Vol}" 
                                                                 onclick="ChangingBRSFEndDate();"   onComplete="return null;"    /> </td>
                                        <td></td>
                                        <td>
                                            <apex:commandButton styleClass="BSCommandButton" 
                                                                value="{!$Label.ASI_CRM_CN_Reset}"  
                                                                action="{!ResetBRSFDetails}"  
                                                                oncomplete="Rerender();"
                                                                rerender="BRSFPanel,EditHeavyPaymentDetailPageId"  status="ActionStatus"    >
                                            </apex:commandButton>
                                        </td>
                                    </tr>
                                    
                                </table>
                                
                            </div>
                            
                            
                            <apex:outputPanel id="BRSFPanel">
                                <table class="bs table table-condensed" style="margin-bottom: 0;" id="BRSFDataTable"  >
                                    <thead>
                                        <tr>
                                            <th>{!$ObjectType.ASI_MFM_Sub_brand__c.Label}</th>
                                            <th>{!$Label.ASI_CRM_CN_Grade}</th>
                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Incentive_Per_Bottle}" /></th>
                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Intake_Std_Btl}<br/>({!$Label.ASI_CRM_CN_Std_Btl})" /></th>
                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Cap_Collection_Vol_Std_Btl}<br/>({!$Label.ASI_CRM_CN_Std_Btl})" /></th>
                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_BC}" /></th>
                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Payable_Vol_Std_Btl}" /></th>
                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Payable_Amount}" /></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <apex:variable value="{!0}" var="Incentive_BT"/>
                                        <apex:variable value="{!0}" var="Actual_Vol"/>
                                        <apex:variable value="{!0}" var="Cap_Collection_Vol"/>
                                        <apex:variable value="{!0}" var="Payable_Vol"/>
                                        <apex:variable value="{!0}" var="Total_Payable"/>
                                        
                                        <apex:repeat value="{!BRSFItemMap.DetailLineMap}"  var="itm" id="item" >
                                            <apex:variable var="Incentive_BT" value="{!Incentive_BT+BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Incentive_BT__c}"/>
                                            <apex:variable var="Actual_Vol" value="{!Actual_Vol+BRSFItemMap.DetailLineMap[itm].ASI_CRM_CTD_Actual_Vol__c}"/>  
                                            <apex:variable var="Cap_Collection_Vol" value="{!Cap_Collection_Vol+BRSFItemMap.DetailLineMap[itm].ASI_CRM_CTD_Cap_Collection_Vol__c}"/>  
                                            <apex:variable var="Payable_Vol" value="{!Payable_Vol+BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Payable_Vol__c}"/>  
                                            <apex:variable var="Total_Payable" value="{!Total_Payable+BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Total_Payable__c}"/>
                                            
                                            <tr>
                                                <td class="BorderBottom" >
                                                    <apex:outputField value="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Sub_Brand__c}"/>
                                                </td> 
                                                
                                                <td class="BorderBottom" >
                                                    <apex:outputLink value="/{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_Sub_Brand_Grade__c}">
                                                        {!BRSFItemMap.DetailLineMap[itm].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                </td> 
                                                <td class="BorderBottom BRSFIncentiveBTClass"  data-id="{!itm}"   id="{!'IncentiveBT_'+itm}" 
                                                    data-value="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Incentive_BT__c}"  
                                                    data-Incentive="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_Max_Incentive__c}">
                                                    <apex:inputField value="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Incentive_BT__c}"
                                                                     styleClass="ApexInputNumberField" onchange="SetBRSFIncentiveBT(this);CheckOverPaid($(this),this,'IncentiveBT_');" 
                                                                     style="{!IF(BRSFItemMap.DetailLineMap[itm].ASI_CRM_Over_Incentive__c,'color: red; font-weight: bold;','')}"
                                                                     rendered="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Allow_Changing_Incentive__c}" />
                                                    <apex:outputField value="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Incentive_BT__c}" rendered="{!!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Allow_Changing_Incentive__c}"/>
                                                </td>
                                                <td class="BorderBottom" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CTD_Actual_Vol__c}"/></apex:outputText>
                                                </td>
                                                <td class="BorderBottom" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CTD_Cap_Collection_Vol__c}"/></apex:outputText>
                                                </td>
                                                
                                                <td class="BorderBottom" >
                                                    <apex:outputText value="{0,number,0}%"><apex:param value="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Collection_Rate__c}"/></apex:outputText>
                                                </td>
                                                
                                                <td class="BorderBottom  BRSFPayableVolClass"  data-id="{!itm}"   id="{!'BRSFPayableVol_'+itm}" 
                                                    data-SuggestedVol="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_Suggested_Volume__c}"    >
                                                    <apex:inputField value="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Payable_Vol__c}" 
                                                                     styleClass="ApexInputNumberField requiredField" 
                                                                     style="{!IF(BRSFItemMap.DetailLineMap[itm].ASI_CRM_Suggested_Volume__c < BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Payable_Vol__c,'color: red; font-weight: bold;','')}"
                                                                     onchange="SetBRSFTotalPayableVol(this);SuggestedValueChecking($(this),this);"  />
                                                </td>
                                                <td class="BorderBottom BRSFTotalPayableVolClass" id="{!'BRSFTotalPayableVol_'+itm}"    >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!BRSFItemMap.DetailLineMap[itm].ASI_CRM_CN_Total_Payable__c}"/>
                                                    </apex:outputText>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                        
                                        <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                            <td>{!$Label.ASI_CRM_CN_Total_Amount} 
                                            </td>
                                            <td></td>
                                            <td id="BRSFTotalIncentiveBTId" >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!Incentive_BT}"/></apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!Actual_Vol}"/></apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!Cap_Collection_Vol}"/></apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0,number,#,###,###}%" rendered="{!Actual_Vol!=null && Cap_Collection_Vol!=null && Cap_Collection_Vol!=0 && Actual_Vol!=0}">
                                                    <apex:param value="{!(Cap_Collection_Vol/Actual_Vol)*100}" />
                                                </apex:outputText>
                                                <apex:outputText value=" - " rendered="{!Actual_Vol==null||Cap_Collection_Vol==0||Actual_Vol==0}" />
                                            </td>
                                            <td id="BRSFTotalPayableVolId">
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!Payable_Vol}"/></apex:outputText>
                                            </td>
                                            <td id="BRSFTotalPayableAmountId" >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!Total_Payable}"/></apex:outputText>
                                            </td>
                                        </tr>
                                        
                                        
                                    </tbody>
                                    
                                </table>
                                
                                
                                
                                <div class="bs table-responsive" style="padding-top: 1em; padding-left: 2em; padding-bottom: 1em;" > 
                                    <table class="bs table table-condensed" style="margin-bottom: 0; width:70%;" >
                                        <tr>
                                            <td style="border-left: 1px solid #ddd; "   class="MethodologyLabel">
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Historical_Paid_Amount__c.Label}
                                            </td>
                                            <td id="BRSFHistoricalPaidAmountId" >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!BRSFItemMap.Module.ASI_CRM_Historical_Paid_Amount__c}"/></apex:outputText>
                                            </td>
                                            <td  style="border-left: 1px solid #ddd; "  class="MethodologyLabel" >
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Application_Payment_Amount__c.Label}
                                            </td>
                                            <td style="border-right: 1px solid #ddd; " id="BRSFApplicationPaymentAmountId" >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!BRSFItemMap.Module.ASI_CRM_Application_Payment_Amount__c}"/></apex:outputText>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel"  >
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Adjustment__c.Label}
                                            </td>
                                            <td > 
                                                <apex:outputText value="{0,number,#,###,##0.00}" styleClass="BRSFAdjustmentclass" >
                                                    <apex:param value="{!BRSFItemMap.Module.ASI_CRM_Adjustment__c}" />
                                                </apex:outputText>%
                                            </td>
                                            <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel"  >
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Actual_Payment__c.Label}
                                            </td>
                                            <td style=" border-right: 1px solid #ddd; " id="BRSFActualPaymentId"   >
                                                <apex:inputField value="{!BRSFItemMap.Module.ASI_CRM_Actual_Payment__c}" 
                                                                 onchange="SetAdjustmentPercent('BRSFHistoricalPaidAmountId','BRSFApplicationPaymentAmountId','BRSFActualPaymentId','BRSFAdjustmentclass');" 
                                                                 styleClass="ApexInputNumberField" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style=" border-left: 1px solid #ddd;  border-bottom: 1px solid #ddd;"  class="MethodologyLabel" >
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Overpayment_Reason__c.Label}
                                            </td>
                                            <td style=" border-bottom: 1px solid #ddd;"  >
                                                <apex:inputField value="{!BRSFItemMap.Module.ASI_CRM_Overpayment_Reason__c}" styleClass="ApexPickListField" />
                                            </td>
                                            <td style=" border-left: 1px solid #ddd; border-bottom: 1px solid #ddd;" class="MethodologyLabel"  >
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Other_Comments__c.Label}
                                            </td>
                                            <td style=" border-right: 1px solid #ddd; border-bottom: 1px solid #ddd;"  >
                                                <apex:inputField value="{!BRSFItemMap.Module.ASI_CRM_Other_Comments__c}"></apex:inputField>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                
                            </apex:outputPanel>
                            
                            
                        </div>
                        
                    </div>
                </div>
                
                
                <!-----------------------------------------------PSF-------------------------------------------------------------->
                
                
                <apex:actionFunction name="ChangingPSFDate" action="{!GeneratePSFVol}" rerender="PSFPanel,EditHeavyPaymentDetailPageId"  status="ActionStatus"   >       
                    <apex:param id="PARAMID" name="PARAMID" value="" />
                </apex:actionFunction>  
                
                
                <div class="row  " style="padding-top: 1em;">
                    <div class="col">
                        <apex:outputPanel id="PSFPanel">
                            <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                                <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  >{!$Label.ASI_CRM_CN_VF_LABEL_PSF}</div>
                                <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                    
                                </div>
                            </div>
                            <div class="PanelBody" >
                                <apex:variable value="{!0}" var="i"/>
                                <apex:repeat value="{!PSF_Item_Map}"  var="itm" id="PSFitem" >
                                    <apex:variable var="i" value="{!i+1}"/>
                                    
                                    <div class="panel panel-primary">
                                        <div class="panel-heading">{!$Label.ASI_CRM_CN_Module} {!i}</div>
                                        
                                        <div class="panel-body">
                                            <div class="bs table-responsive" style="padding-bottom: 1em;" > 
                                                <table class="bs table table-condensed" style="margin-bottom: 0; width:80%" >
                                                    <tr>
                                                        <td style="border-left: 1px solid #ddd;" class="MethodologyLabel" >{!$Label.ASI_CRM_CN_Start_Date}:</td>
                                                        <td><apex:outputField value="{!PH.ASI_CRM_CN_PO_Start_Date__c}" /></td>
                                                        <td style="border-left: 1px solid #ddd;"  class="MethodologyLabel"  >{!$Label.ASI_CRM_CN_End_Date}:</td>
                                                        <td style="border-right: 1px solid #ddd;"  ><apex:inputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_End_Date__c}" styleClass="ApexInputDateField"  onchange="ChangingPSFEndDate('{!itm}');"  /></td>
                                                    </tr>
                                                </table>
                                                <table class="bs table table-condensed" style="margin-bottom: 0; width:80%"  >
                                                    <tr>
                                                        <td style="border-left: 1px solid #ddd; width:10%" class="MethodologyLabel" >{!$Label.ASI_CRM_CN_Key_Principle}</td>
                                                        <td style="width:25%" >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name}"  rendered="{!!showCN}" />
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} "  rendered="{!showCN}" />
                                                        </td>
                                                        <td style="width:15%; border-left: 1px solid #ddd;" class="WeightLeft" >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                                        <td style="width:10%" >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Volume_Base__c}"/>
                                                        </td>
                                                        <td  style="border-left: 1px solid #ddd;width:15%" class="WeightLeft" >
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}
                                                        </td>
                                                        <td style="border-right: 1px solid #ddd;  "  >
                                                             <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/>
                                                        </td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td colspan="1" style="border-left: 1px solid #ddd;border-bottom: 1px solid #ddd; width:20%" class="MethodologyLabel"> 
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}
                                                        </td>
                                                        <td colspan="5" style="border-right: 1px solid #ddd;border-bottom: 1px solid #ddd;" >
                                                            {!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Remark__c}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="1" style="border-left: 1px solid #ddd;border-bottom: 1px solid #ddd; width:20%" class="MethodologyLabel"> 
                                                            {!$Label.ASI_CRM_CN_Contract_Terms_Ref}: 
                                                        </td>
                                                        <td colspan="5" style="border-right: 1px solid #ddd;border-bottom: 1px solid #ddd;" >
                                                            <apex:outputText escape="false" value="{!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Payment_Reference__c}"/>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="text-align: right;" colspan="2" >
                                                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_VF_BTN_Regen_Vol}"  
                                                                                onclick="ChangingPSFEndDate('{!itm}');"   onComplete="return null;"    />    <!--- <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_PSF_Report}"     styleClass="BSCommandButton" onclick="window.open('/apex/ASI_CRM_CN_HeavyPSFFormPage?id={!PH.Id}')"   />-------->
                                                        </td>
                                                        <td colspan="2"  >
                                                            <apex:commandButton styleClass="BSCommandButton" 
                                                                                value="{!$Label.ASI_CRM_CN_Reset}"  
                                                                                action="{!ResetPSFDetails}"  
                                                                                oncomplete="Rerender();"
                                                                                rerender="PSFPanel,EditHeavyPaymentDetailPageId"  status="ActionStatus"    >
                                                                <apex:param name="PARAMID" value="{!itm}" />
                                                            </apex:commandButton>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                            
                                            <apex:outputPanel >
                                                
                                                <table class="bs table table-condensed" style="margin-bottom: 0;"  >
                                                    <thead>
                                                        <tr>
                                                            <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:20%;')}  " >
                                                                {!$ObjectType.ASI_MFM_Sub_brand__c.Label}
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                {!$Label.ASI_CRM_CN_Grade}
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                                            </th>
                                                            <th>
                                                                <div style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Incentive_Per_Bottle}" />
                                                                </div>
                                                                <div style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','display:none;','')}  " >
                                                                    {!$Label.ASI_CRM_CN_CTD_Incentive_Target}
                                                                </div>
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_BC}" />
                                                            </th>
                                                            
                                                            <th> 
                                                                {!$Label.ASI_CRM_CN_CTD_Volume_Target} <br/>
                                                                (<apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/>)
                                                            </th>
                                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Intake_Std_Btl}" /><br/>  (<apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/>)</th>
                                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Cap_Collection_Vol_Std_Btl}" /><br/>   (<apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/>)</th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','display:none;','')}"  >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_BC}" />
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  ><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Payable_Vol_Std_Btl}" /></th>
                                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Payable_Amount}" /></th>
                                                            <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Completion_Ratio}" /></th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  ><apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_Key_Sub_brand__c.Label}"/></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <apex:variable value="{!0}" var="PSFIncentive_BT"/>
                                                        <apex:variable value="{!0}" var="PSFV0_0_Full_Contract_Target"/>
                                                        <apex:variable value="{!0}" var="PSFActual_Vol"/>
                                                        <apex:variable value="{!0}" var="PSFCap_Collection_Vol"/>
                                                        <apex:variable value="{!0}" var="PSFPayable_Vol"/>
                                                        <apex:variable value="{!0}" var="PSFTotal_Payable"/>
                                                        <apex:variable value="{!0}" var="PSFCTDIntake"/>
                                                        <apex:variable value="{!0}" var="PSFCTDBC"/>
                                                        
                                                        
                                                        
                                                        <apex:repeat value="{!PSF_Item_Map[itm].DetailLineMap}"  var="line" id="lineItem" >
                                                            <apex:variable var="PSFIncentive_BT" value="{!PSFIncentive_BT+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Incentive_BT__c}"/>
                                                            <apex:variable var="PSFV0_0_Full_Contract_Target" value="{!PSFV0_0_Full_Contract_Target+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_V0_0_Full_Contract_Target__c}"/>
                                                           
                                                            <apex:variable var="PSFActual_Vol" value="{!PSFActual_Vol+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Actual_Vol__c}"/>  
                                                            <apex:variable var="PSFCap_Collection_Vol" value="{!PSFCap_Collection_Vol+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Bottle_Collected__c}"/>  
                                                            <apex:variable var="PSFCTDIntake" value="{!PSFCTDIntake+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Actual_Vol__c}"/>  
                                                            <apex:variable var="PSFCTDBC" value="{!PSFCTDBC+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Cap_Collection_Vol__c}"/>  
                                                            
                                                            
                                                            <apex:variable var="PSFPayable_Vol" value="{!PSFPayable_Vol+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Payable_Vol__c}"/>  
                                                            <apex:variable var="PSFTotal_Payable" value="{!PSFTotal_Payable+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Total_Payable__c}"/>
                                                            
                                                            <tr>
                                                                <td class="BorderBottom" >
                                                                    <div style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                        <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}"    />
                                                                    </div>
                                                                    <div  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                        <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">
                                                                            {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}
                                                                        </apex:outputLink>
                                                                    </div>
                                                                    <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                        <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Product_Category__c}">
                                                                            {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                                    </div>
                                                                    <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                        {!$Label.ASI_CRM_CN_By_Total}
                                                                    </div>
                                                                </td> 
                                                                <td class="BorderBottom"   style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}
                                                                    </apex:outputLink>
                                                                </td> 
                                                                <td class="BorderBottom  {!'PSFIncentiveBTClass_'+itm}" 
                                                                    data-Volume-Base="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}"
                                                                    data-Payable-Vol="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Suggested_Volume__c}"
                                                                    data-id="{!line}" data-Module="{!itm}" id="{!'PSFIncentiveBT_'+itm+line}"
                                                                    data-Incentive="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c}"
                                                                    data-value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Incentive_BT__c}"  >
                                                                    <apex:inputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Incentive_BT__c}" 
                                                                                     styleClass="ApexInputNumberField" 
                                                                                     onchange="SetPSFIncentiveBT(this);CheckOverPaid($(this),this,'PSFIncentiveBT_{!itm}');" 
                                                                                     style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Over_Incentive__c,'color: red; font-weight: bold;','')}"
                                                                                     rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Allow_Changing_Incentive__c}" />
                                                                    <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Incentive_BT__c}" 
                                                                                      rendered="{!!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Allow_Changing_Incentive__c}"/>
                                                                </td>
                                                                
                                                                <td class="BorderBottom" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','','display:none;')}" >
                                                                    <apex:outputText value="{0,number,0}%">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Collection_Rate__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                
                                                                <td class="BorderBottom" >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_V0_0_Full_Contract_Target__c}"/></apex:outputText>
                                                                </td>
                                                                
                                                                <td class="BorderBottom" >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Actual_Vol__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                
                                                                <td class="BorderBottom" >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Cap_Collection_Vol__c}"/>
                                                                    </apex:outputText>
                                                                    
                                                                </td>
                                                                
                                                                <td class="BorderBottom" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','display:none;','')}" >
                                                                    <apex:outputText value="{0,number,0}%">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Collection_Rate__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                
                                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  
                                                                    class="BorderBottom {!'PSFPayableVolClass_'+itm} " data-id="{!line}"  data-Module="{!itm}" 
                                                                    data-SuggestedVol="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Suggested_Volume__c}"
                                                                    id="{!'PSFPayableVol_'+itm+line}" >
                                                                    <apex:inputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Payable_Vol__c}" 
                                                                                     onchange="SetPSFTotalPayableVol(this);SuggestedValueChecking($(this),this);" 
                                                                                     rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'}"
                                                                                     style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Suggested_Volume__c <PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Payable_Vol__c,'color: red; font-weight: bold;','')}"
                                                                                     styleClass="ApexInputNumberField requiredField " />
                                                                    <!---{!'PSFTotalPayableVol_'+line}---------->
                                                                </td>
                                                                
                                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" 
                                                                    class="BorderBottom {!'PSFTotalPayableVolClass_'+itm} " 
                                                                    id="{!'PSFTotalPayableVol_'+itm+line}"  >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Total_Payable__c}"/>
                                                                    </apex:outputText>
                                                                    
                                                                </td>
                                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','display:none;','')}"  class="{!'PSFPayableVolAmount_'+itm}"
                                                                    data-SuggestedVol="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Suggested_Amount__c}" data-Module="{!itm}"  data-id="{!line}"  
                                                                    Payable-Vol='{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Payable_Vol__c}'  
                                                                    Intake_Martell='{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Actual_Vol_Martell__c}' 
                                                                    BC_Martell='{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_BC_Martell__c}'
                                                                    Intake_Pure='{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Actual_Vol_Pure__c}'
                                                                    BC_Pure='{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_BC_Pure__c}'
                                                                    Intake_Martell_CR12='{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Actual_Vol_Martell_CR12__c}' 
                                                                    BC_Martell_CR12='{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_BC_Martell_CR12__c}'
                                                                    Intake_Pure_CR12='{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Actual_Vol_Pure_CR12__c}'
                                                                    bc_Pure_CR12='{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_BC_Pure_CR12__c}'  >
                                                                    
                                                                    <apex:inputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Total_Payable__c}"  
                                                                                     onchange="CalPSFTotalPayableAmount(this);SuggestedValueChecking($(this),this);"  
                                                                                     rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand'}"
                                                                                     style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Suggested_Amount__c <PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Total_Payable__c,'color: red; font-weight: bold;','')}"
                                                                                     styleClass="ApexInputNumberField requiredField " />
                                                                </td>
                                                                
                                                                <td class="BorderBottom" >
                                                                      <apex:outputText value="{0,number,0.0}%">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Completion_Rate__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                
                                                                <td class="BorderBottom "   style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                    <div style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Key_Sub_Brand__c,'','display:none;')}"   >
                                                                        <input name="chkBox_1" type="checkbox"  value="1" disabled="true" checked="true" />
                                                                    </div>
                                                                    <div style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Key_Sub_Brand__c,'display:none;','')}"   >
                                                                        <input name="chkBox_1" type="checkbox"  value="1" disabled="true"   />
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </apex:repeat>
                                                        
                                                        <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                            <td>{!$Label.ASI_CRM_CN_Total_Amount}</td>
                                                            <td  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" ></td>
                                                            <td id="{!'PSFTotalIncentiveBT_'+itm}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFIncentive_BT}"/></apex:outputText>
                                                            </td>
                                                            <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','','display:none;')}" >
                                                                <apex:outputText value="{0,number,#,###,###}%" rendered="{!PSFCap_Collection_Vol!=0 && PSFCap_Collection_Vol!=null && PSFActual_Vol!=null && PSFActual_Vol!=0}">
                                                                    <apex:param value="{!(PSFCap_Collection_Vol/PSFActual_Vol)*100}" />
                                                                </apex:outputText>
                                                                <apex:outputText value=" - " rendered="{!PSFActual_Vol==null||PSFCap_Collection_Vol==0 || PSFCap_Collection_Vol==0 || PSFCap_Collection_Vol==null}" />
                                                            </td>
                                                            <td>
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFV0_0_Full_Contract_Target}"/></apex:outputText>
                                                            </td>
                                                            <td>
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFCTDIntake}"/></apex:outputText>
                                                            </td>
                                                            <td>
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFCTDBC}"/></apex:outputText>
                                                            </td>
                                                            <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','display:none;','')}" >
                                                                <apex:outputText value="{0,number,#,###,###}%" rendered="{!PSFCap_Collection_Vol!=null && PSFActual_Vol!=null && PSFActual_Vol!=0}">
                                                                    <apex:param value="{!(PSFCap_Collection_Vol/PSFActual_Vol)*100}" />
                                                                </apex:outputText>
                                                                <apex:outputText value=" - " rendered="{!PSFActual_Vol==null || PSFCap_Collection_Vol==0 || PSFActual_Vol==0 || PSFCap_Collection_Vol==null}" />
                                                                
                                                            </td>
                                                            
                                                            <td id="{!'PSFTotalPayableVolId_'+itm}" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"   >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFPayable_Vol}"/></apex:outputText>
                                                            </td>
                                                            <td id="{!'PSFTotalPayableAmountId_'+itm}"  >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFTotal_Payable}"/></apex:outputText>
                                                            </td>
                                                            
                                                            <td>
                                                                <apex:outputText value="{0,number,#,###,##0.0}%" 
                                                                                 rendered="{!PSF_Item_Map[itm].VolumeTarget!=null && PSF_Item_Map[itm].VolumeTarget!=0 && PSF_Item_Map[itm].RealVolume!=0}">
                                                                    <apex:param value="{!(PSF_Item_Map[itm].RealVolume/PSF_Item_Map[itm].VolumeTarget)*100}"/>
                                                                </apex:outputText>
                                                                <apex:outputText value=" - " rendered="{!PSF_Item_Map[itm].RealVolume==null || PSF_Item_Map[itm].VolumeTarget==null || PSF_Item_Map[itm].VolumeTarget==0}" />
                                                            </td>
                                                            <td  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" ></td>
                                                        </tr>
                                                    </tbody>
                                                    
                                                </table>
                                                
                                                
                                                <div class="bs table-responsive" style="padding-top: 1em; padding-left: 2em; padding-bottom: 1em;" > 
                                                    <table class="bs table table-condensed" style="margin-bottom: 0; width:70%;" >
                                                        <tr>
                                                            <td style="border-left: 1px solid #ddd; "   class="MethodologyLabel">
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Historical_Paid_Amount__c.Label}
                                                            </td>
                                                            <td id="{!'PSFHistoricalPaidAmount_'+itm}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].Module.ASI_CRM_Historical_Paid_Amount__c}"/></apex:outputText>
                                                            </td>
                                                            <td  style="border-left: 1px solid #ddd; "  class="MethodologyLabel" >
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Application_Payment_Amount__c.Label}
                                                            </td>
                                                            <td style="border-right: 1px solid #ddd; " id="{!'PSFApplicationPaymentAmount_'+itm}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].Module.ASI_CRM_Application_Payment_Amount__c}"/></apex:outputText>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel"  >
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Adjustment__c.Label}
                                                            </td>
                                                            <td > 
                                                                <apex:outputText value="{0,number,#,###,##0.00}" styleClass="{!'PSFAdjustment_'+itm}" >
                                                                    <apex:param value="{!PSF_Item_Map[itm].Module.ASI_CRM_Adjustment__c}" />
                                                                </apex:outputText>%
                                                            </td>
                                                            <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel" >
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Actual_Payment__c.Label}
                                                            </td>
                                                            <td style=" border-right: 1px solid #ddd; "   id="{!'PSFActualPayment_'+itm}"   >
                                                                <!---<apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].Module.ASI_CRM_Actual_Payment__c}"/></apex:outputText>--->
                                                                <apex:inputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Actual_Payment__c}" 
                                                                                 onchange="SetAdjustmentPercent('{!'PSFHistoricalPaidAmount_'+itm}','{!'PSFApplicationPaymentAmount_'+itm}','{!'PSFActualPayment_'+itm}','{!'PSFAdjustment_'+itm}');" 
                                                                                 styleClass="ApexInputNumberField" />
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td style=" border-left: 1px solid #ddd;  border-bottom: 1px solid #ddd;"  class="MethodologyLabel" >
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Overpayment_Reason__c.Label}
                                                            </td>
                                                            <td style=" border-bottom: 1px solid #ddd;"  >
                                                                <apex:inputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_PSF_Overpayment_Reason__c}" styleClass="ApexPickListField" />
                                                            </td>
                                                            <td style=" border-left: 1px solid #ddd; border-bottom: 1px solid #ddd;" class="MethodologyLabel"  >
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Other_Comments__c.Label}
                                                            </td>
                                                            <td style=" border-right: 1px solid #ddd; border-bottom: 1px solid #ddd;"  >
                                                                <apex:inputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Other_Comments__c}"></apex:inputField>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </apex:outputPanel>
                                        </div>
                                    </div>
                                </apex:repeat>
                            </div>
                            
                            
                            
                        </apex:outputPanel>
                    </div>
                    
                </div>
                
                
                <apex:outputPanel rendered="{!DisplayVEC}">
                    <apex:actionFunction name="ChangingVECDate" action="{!GenerateVECVol}" rerender="VECPanel,EditHeavyPaymentDetailPageId"  status="ActionStatus"   />       
                    <!--------------------------------Variable Event Cost -------------------------------------------------------------->
                    
                    <div class="row  " style="padding-top: 1em;"  id="VariableEventCostDivIdPart">
                        <div class="col">
                            <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                                <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  >{!$Label.ASI_CRM_CN_Variable_Event_Cost}</div>
                                <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                    <div style="margin-left: 5em;" >
                                    </div>
                                    
                                </div> 
                            </div>
                            
                            
                            <div class="PanelBody" >
                                
                                <div class="bs table-responsive" style="padding-bottom: 1em;" > 
                                    
                                    <table class="bs table table-condensed" style="margin-bottom: 0; width:80%" >
                                        <tr>
                                            <td style="border-left: 1px solid #ddd;width:10%" class="MethodologyLabel" >{!$Label.ASI_CRM_CN_Start_Date}:</td>
                                            <td style="width:10%"><apex:outputField value="{!PH.ASI_CRM_CN_PO_Start_Date__c}" /></td>
                                            <td style="border-left: 1px solid #ddd;width:10%"  class="MethodologyLabel"  >{!$Label.ASI_CRM_CN_End_Date}:</td>
                                            <td style="border-right: 1px solid #ddd;"  >
                                                <apex:inputField onchange="ChangingVECEndDate();"  value="{!VariableEventCost.Module.ASI_CRM_End_Date__c}" styleClass="ApexInputDateField"  />
                                            </td>
                                        </tr>
                                    </table>
                                    <table class="bs table table-condensed" style="margin-bottom: 0; width:80%"  >
                                        <tr>
                                            <td style="border-left: 1px solid #ddd; width:10%" class="MethodologyLabel" >{!$Label.ASI_CRM_CN_Key_Principle}</td>
                                            <td style="width:25%" > <!---{!VariableEventCost.MethodologyValue}--->
                                                <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Methodology__r.Name}"  rendered="{!!showCN}" />
                                                <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} "  rendered="{!showCN}" />
                                            </td>
                                            <td style="width:15%; border-left: 1px solid #ddd;" class="WeightLeft" >
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                            </td>
                                            <td style="width:10%" >
                                                <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Volume_Base__c}"/>
                                            </td>
                                            <td  style="border-left: 1px solid #ddd;width:15%" class="WeightLeft" >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}</td>
                                            <td style="border-right: 1px solid #ddd;  "  >  <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/></td>
                                        </tr>
                                        
                                        <tr>
                                            <td colspan="1" style="border-left: 1px solid #ddd;border-bottom: 1px solid #ddd; width:20%" class="MethodologyLabel"> 
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label} 
                                            </td>
                                            <td colspan="5" style="border-right: 1px solid #ddd;border-bottom: 1px solid #ddd;" >
                                                {!VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Remark__c}
                                            </td>
                                        </tr>
                                          
                                        <tr>
                                            <td colspan="1" style="border-left: 1px solid #ddd;border-bottom: 1px solid #ddd; width:20%" class="MethodologyLabel"> 
                                               {!$Label.ASI_CRM_CN_Contract_Terms_Ref}
                                            </td>
                                            <td colspan="5" style="border-right: 1px solid #ddd;border-bottom: 1px solid #ddd;" >
                                                 <apex:outputText escape="false" value="{!VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Payment_Reference__c}"/>
                                            </td>
                                        </tr>
                                        
                                        <tr>
                                            <td style="text-align: right;" colspan="2" >
                                                <apex:commandButton styleClass="BSCommandButton"  onclick="ChangingVECEndDate();"   onComplete="return null;"  value="{!$Label.ASI_CRM_CN_VF_BTN_Regen_Vol}" />
                                            </td>
                                            <td colspan="2"  >
                                                <apex:commandButton styleClass="BSCommandButton" 
                                                                    value="{!$Label.ASI_CRM_CN_Reset}"  
                                                                    action="{!ResetVECDetails}"  
                                                                    oncomplete="Rerender();"
                                                                    rerender="VECPanel,EditHeavyPaymentDetailPageId"  status="ActionStatus"    >
                                                </apex:commandButton>
                                            </td>
                                        </tr>
                                        
                                        
                                    </table>
                                    
                                </div>
                                
                                
                                <apex:outputPanel id="VECPanel">
                                    <table class="bs table table-condensed" style="margin-bottom: 0;" id="VECDataTable"  >
                                        <thead>
                                            <tr>
                                                <th >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</th>
                                                <th  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                    {!$Label.ASI_CRM_CN_Grade}
                                                </th>
                                                <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  "><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Incentive_Per_Bottle}" /></th>
                                                <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','display:none;','')}">{!$Label.ASI_CRM_CN_CTD_Incentive_Target}</th>
                                                <th style="{!IF(VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','','display:none;')}" ><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_BC}" /></th>
                                                
                                                <th>{!$Label.ASI_CRM_CN_CTD_Volume_Target} <br/>(<apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/>)</th>
                                                <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Intake_Std_Btl}" /><br/>
                                                    (<apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/>)
                                                </th>
                                                <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Cap_Collection_Vol_Std_Btl}" /><br/>(<apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/>)</th>
                                                <th style="{!IF(VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','display:none;','')}" ><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_BC}" /></th>
                                                <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " ><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Payable_Vol_Std_Btl}" /></th>
                                                <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Payable_Amount}" /></th>
                                                <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Completion_Ratio}" /></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <apex:variable value="{!0}" var="Incentive_BT"/>
                                            <apex:variable value="{!0}" var="V0_0_Full_Contract_Target"/>
                                            <apex:variable value="{!0}" var="Actual_Vol"/>
                                            <apex:variable value="{!0}" var="Cap_Collection_Vol"/>
                                            <apex:variable value="{!0}" var="Payable_Vol"/>
                                            <apex:variable value="{!0}" var="Total_Payable"/>
                                            <apex:variable value="{!0}" var="CompletionRatio"/>
                                            
                                            <apex:variable value="{!0}" var="VECCTDIntake"/>
                                            <apex:variable value="{!0}" var="VECCTDBC"/>
                                            
                                            
                                            <apex:repeat value="{!VariableEventCost.DetailLineMap}"  var="itm" id="VECitem" >
                                                
                                                <apex:variable var="Incentive_BT" value="{!Incentive_BT+VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Incentive_BT__c}"/>
                                                <apex:variable var="V0_0_Full_Contract_Target" value="{!V0_0_Full_Contract_Target+VariableEventCost.DetailLineMap[itm].ASI_CRM_V0_0_Full_Contract_Target__c}"/>
                                                <apex:variable var="Actual_Vol" value="{!Actual_Vol+VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Actual_Vol__c}"/>  
                                                <apex:variable var="Cap_Collection_Vol" value="{!Cap_Collection_Vol+VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Bottle_Collected__c}"/>  
                                                <apex:variable var="Payable_Vol" value="{!Payable_Vol+VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Payable_Vol__c}"/>  
                                                <apex:variable var="Total_Payable" value="{!Total_Payable+VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Total_Payable__c}"/>
                                                <apex:variable var="VECCTDIntake" value="{!VECCTDIntake+VariableEventCost.DetailLineMap[itm].ASI_CRM_CTD_Actual_Vol__c}"/>  
                                                <apex:variable var="VECCTDBC" value="{!VECCTDBC+VariableEventCost.DetailLineMap[itm].ASI_CRM_CTD_Cap_Collection_Vol__c}"/>  
                                                
                                                
                                                <tr>
                                                    <td class="BorderBottom" >
                                                        <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                            <apex:outputField value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Sub_Brand__c}" />
                                                        </div>
                                                        <div  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                            <apex:outputLink value="/{!VariableEventCost.DetailLineMap[itm].ASI_CRM_Sub_Brand_Grade__c}">
                                                                            {!VariableEventCost.DetailLineMap[itm].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                        </div>
                                                        <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                            <apex:outputLink value="/{!VariableEventCost.DetailLineMap[itm].ASI_CRM_Product_Category__c}">
                                                                            {!VariableEventCost.DetailLineMap[itm].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                        </div>
                                                        <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                             {!$Label.ASI_CRM_CN_By_Total}
                                                        </div>
                                                    </td>
                                                    <td class="BorderBottom"  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                        <apex:outputLink value="/{!VariableEventCost.DetailLineMap[itm].ASI_CRM_Sub_Brand_Grade__c}">{!VariableEventCost.DetailLineMap[itm].ASI_CRM_Line_Name__c}
                                                        </apex:outputLink>
                                                    </td> 
                                                    <td class="BorderBottom VECIncentiveBTClass"  data-id="{!itm}"   id="{!'VECIncentiveBT_'+itm}"  data-value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Incentive_BT__c}" >
                                                        <apex:inputField value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Incentive_BT__c}"  styleClass="ApexInputNumberField"  onchange="SetVECIncentiveBT(this);"   rendered="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Allow_Changing_Incentive__c}" />
                                                        <apex:outputField value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Incentive_BT__c}" rendered="{!!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Allow_Changing_Incentive__c}"/>
                                                    </td>
                                                    <td class="BorderBottom" style="{!IF(VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','','display:none;')}"  >
                                                        <apex:outputText value="{0,number,0}%"><apex:param value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Collection_Rate__c}"/></apex:outputText>
                                                    </td>
                                                    <td class="BorderBottom" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_V0_0_Full_Contract_Target__c}"/></apex:outputText>
                                                    </td>
                                                    
                                                    <td class="BorderBottom" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CTD_Actual_Vol__c}"/></apex:outputText>
                                                    </td>
                                                    <td class="BorderBottom" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CTD_Cap_Collection_Vol__c}"/></apex:outputText>
                                                    </td>
                                                    <td class="BorderBottom" style="{!IF(VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','display:none;','')}"  >
                                                        <apex:outputText value="{0,number,0}%"><apex:param value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Collection_Rate__c}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " 
                                                        data-SuggestedVol="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_Suggested_Value__c}"
                                                        class="BorderBottom VECPayableVolClass"  data-id="{!itm}"   id="{!'VECPayableVol_'+itm}"  >
                                                        <apex:inputField value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Payable_Vol__c}" 
                                                                         styleClass="ApexInputNumberField requiredField "
                                                                         rendered="{!VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'}"
                                                                         style="{!IF(VariableEventCost.DetailLineMap[itm].ASI_CRM_Suggested_Value__c < VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Payable_Vol__c,'color: red; font-weight: bold;','')}"
                                                                         onchange="SetVECTotalPayableVol(this);SuggestedValueChecking($(this),this);" />
                                                    </td>
                                                    
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " class="BorderBottom VECTotalPayableVolClass"  id="{!'VECTotalPayableVol_'+itm}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Total_Payable__c}"/></apex:outputText>
                                                    </td>
                                                    
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','display:none;','')}  " 
                                                        data-SuggestedVol="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Suggested_Amount__c}"
                                                        class="VECTotalPayableAmountClass"  Hide-PayableVol='{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Payable_Vol__c}'>
                                                        
                                                        <apex:inputField value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Total_Payable__c}" 
                                                                         onchange="CalVECTotalPayableAmount();SuggestedValueChecking($(this),this);" 
                                                                         rendered="{!VariableEventCost.Module.ASI_CRM_Volume_Base__c !='By Sub-Brand'}"
                                                                         style="{!IF(VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Suggested_Amount__c < VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Total_Payable__c,'color: red; font-weight: bold;','')}"
                                                                         styleClass="ApexInputNumberField requiredField " />
                                                    </td>
                                                    <td class="BorderBottom" >
                                                        <apex:outputText value="{0,number,0.0}%">
                                                            <apex:param value="{!VariableEventCost.DetailLineMap[itm].ASI_CRM_CN_Completion_Rate__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                            <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                <apex:variable var="CompletionRatio" value="{!if(V0_0_Full_Contract_Target!=0,Payable_Vol/V0_0_Full_Contract_Target,0.0)}"/>
                                                
                                                <td>{!$Label.ASI_CRM_CN_Total_Amount}</td>
                                                <td  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" ></td>
                                                <td id="VECTotalIncentiveBTId"  >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!Incentive_BT}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','','display:none;')}" >
                                                    <apex:outputText value="{0,number,#,###,###}%" rendered="{!Actual_Vol!=null && Actual_Vol!=0 && Cap_Collection_Vol!=0 && Cap_Collection_Vol!=Null}">
                                                        <apex:param value="{!(Cap_Collection_Vol/Actual_Vol)*100}" />
                                                    </apex:outputText>
                                                    <apex:outputText value=" - " rendered="{!Actual_Vol==null||Cap_Collection_Vol==0||Cap_Collection_Vol==null ||Actual_Vol==0}" />
                                                </td>
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!V0_0_Full_Contract_Target}"/></apex:outputText>
                                                </td>
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECCTDIntake}"/></apex:outputText>
                                                </td>
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECCTDBC}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c=='CR12 Extra Eqv.','display:none;','')}" >
                                                    <apex:outputText value="{0,number,#,###,###}%" rendered="{!Actual_Vol!=null && Actual_Vol!=0 && Cap_Collection_Vol!=0 && Cap_Collection_Vol!=Null}">
                                                        <apex:param value="{!(Cap_Collection_Vol/Actual_Vol)*100}" />
                                                    </apex:outputText>
                                                    <apex:outputText value=" - " rendered="{!Actual_Vol==null||Cap_Collection_Vol==0||Cap_Collection_Vol==null ||Actual_Vol==0}" />
                                                </td>
                                                
                                                <td id="VECTotalPayableVolId"  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!Payable_Vol}"/></apex:outputText>
                                                </td>
                                                <td id="VECTotalPayableAmountId" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!Total_Payable}"/></apex:outputText>
                                                </td>
                                                <td  RealVolume='{!VariableEventCost.RealVolume}' >
                                                    
                                                    <apex:outputText value="{0,number,#,###,##0.0}%" 
                                                                     rendered="{!VariableEventCost.VolumeTarget!=null && VariableEventCost.VolumeTarget!=0 && VariableEventCost.RealVolume!=0}">
                                                        <apex:param value="{!(VariableEventCost.RealVolume/VariableEventCost.VolumeTarget)*100}"/>
                                                    </apex:outputText>
                                                    <apex:outputText value=" - " 
                                                                     rendered="{!VariableEventCost.RealVolume==null || VariableEventCost.VolumeTarget==null || VariableEventCost.VolumeTarget==0}" />                                                
                                                </td>
                                                <td  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" ></td>
                                            </tr>
                                            
                                            
                                        </tbody>
                                        
                                    </table>
                                    
                                    
                                    <div class="bs table-responsive" style="padding-top: 1em; padding-left: 2em; padding-bottom: 1em;" > 
                                        <table class="bs table table-condensed" style="margin-bottom: 0; width:60%;" >
                                            <tr>
                                                <td style="border-left: 1px solid #ddd; "   class="MethodologyLabel">
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Historical_Paid_Amount__c.Label}
                                                </td>
                                                <td id="VECHistoricalPaidAmountId">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.Module.ASI_CRM_Historical_Paid_Amount__c}"/></apex:outputText>
                                                </td>
                                                <td  style="border-left: 1px solid #ddd; "  class="MethodologyLabel" >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Application_Payment_Amount__c.Label}
                                                </td>
                                                <td style="border-right: 1px solid #ddd; " id="VECApplicationPaymentAmountId" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.Module.ASI_CRM_Application_Payment_Amount__c}"/></apex:outputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Adjustment__c.Label}</td>
                                                <td> 
                                                    <apex:outputText value="{0,number,#,###,##0.00}" styleClass="VECAdjustmentclass" >
                                                        <apex:param value="{!VariableEventCost.Module.ASI_CRM_Adjustment__c}" />
                                                    </apex:outputText>%
                                                
                                                </td>
                                                <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Actual_Payment__c.Label}</td>
                                                <td style=" border-right: 1px solid #ddd; "  id="VECActualPaymentId" >
                                                    <apex:inputField value="{!VariableEventCost.Module.ASI_CRM_Actual_Payment__c}" 
                                                                     onchange="SetAdjustmentPercent('VECHistoricalPaidAmountId','VECApplicationPaymentAmountId','VECActualPaymentId','VECAdjustmentclass');" 
                                                                     styleClass="ApexInputNumberField" />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style=" border-left: 1px solid #ddd;  border-bottom: 1px solid #ddd;"  class="MethodologyLabel" >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Overpayment_Reason__c.Label}
                                                </td>
                                                <td style=" border-bottom: 1px solid #ddd;"  >
                                                    <apex:inputField value="{!VariableEventCost.Module.ASI_CRM_VEC_Overpayment_Reason__c}" styleClass="ApexPickListField" />
                                                </td>
                                                <td style=" border-left: 1px solid #ddd; border-bottom: 1px solid #ddd;" class="MethodologyLabel"  >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Other_Comments__c.Label}
                                                </td>
                                                <td style=" border-right: 1px solid #ddd; border-bottom: 1px solid #ddd;"  >
                                                    <apex:inputField value="{!VariableEventCost.Module.ASI_CRM_Other_Comments__c}"></apex:inputField>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </apex:outputPanel>
                                
                            </div>
                            
                            
                        </div>
                    </div>
                    
                </apex:outputPanel>
                
                <!-------------------------------- Other Payment Detail -------------------------------------------------------------->
                
                <div class="row  " style="padding-top: 1em;" id="PaymentFixCostDivIdPart">
                    <div class="col">
                        <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                            <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  >{!$Label.ASI_CRM_CN_Contract_Fix_Cost}</div>
                            <div style="grid-column-start: 2; grid-column-end: 2;  " ></div> 
                        </div>
                        
                        
                        <div class="PanelBody" >
                            
                            <apex:outputPanel id="OtherPaymentDetailPanel">
                                <table class="bs table table-condensed" style="margin-bottom: 0;" id="OtherPaymentDetailDataTable"  >
                                    <thead>
                                        <tr>
                                            <th>{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Expense_Type__c.Label}</th>
                                             <th> {!$Label.ASI_CRM_CN_Contract_Terms_Ref}</th>
                                             <th><apex:outputText value="{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Contract_Amount__c.Label}" /></th>
                                            <th>{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_TH_CRM_Amount__c.Label}</th>
                                            <th>{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Comment__c.Label}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <apex:repeat value="{!OtherPaymentLineList}"  var="OtherPaymentLine" id="OtherPaymentLineTable" >
                                            <tr>
                                                
                                                <td>
                                                    <apex:outputField value="{!OtherPaymentLine.ASI_CRM_CN_Expense_Type__c}"/>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!OtherPaymentLine.ASI_CRM_CN_Contract_Cost__r.ASI_CRM_Contract_Terms__c}"/>
                                                </td> 
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!OtherPaymentLine.ASI_CRM_CN_Contract_Cost__r.ASI_CRM_CN_Contract_Amount__c}"/></apex:outputText>
                                                </td>
                                                <td>
                                                    <apex:inputField value="{!OtherPaymentLine.ASI_TH_CRM_Amount__c}" styleClass="ApexInputNumberField" />
                                                </td>
                                                <td>
                                                    <apex:inputField value="{!OtherPaymentLine.ASI_CRM_CN_Comment__c}" styleClass="ApexInputNumberField" />
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </tbody>
                                    
                                </table>
                            </apex:outputPanel>
                            
                        </div>
                        
                        
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <apex:actionstatus id="ActionStatus">
            <apex:facet name="start">
                <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                                                                     height: 100%; width:100%; opacity:0.65;"> 
                    <div class="waitingHolder" id="loadtext" style="position: absolute;" align="left" valign="top">
                        &nbsp;&nbsp;&nbsp;
                        <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                        <span class="waitingDescription">Please Wait...</span>
                    </div>
                </div>
            </apex:facet>
        </apex:actionstatus>
        
    </apex:form>
    
    
</apex:page>