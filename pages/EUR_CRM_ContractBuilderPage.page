<apex:page standardController="EUR_CRM_Contract__c" extensions="EUR_CRM_ContractBuilderControllerExt">

    <apex:variable var="housePouringWrapper" value="{!mechanicTypeWrapperMap['House Pouring Spirits']}" />
    <apex:variable var="premiumPouringSpiritsWrapper" value="{!mechanicTypeWrapperMap['Premium Pouring Spirits']}" />
    <apex:variable var="housePouringChampagneWrapper" value="{!mechanicTypeWrapperMap['House Pouring Champagne']}" />
    <apex:variable var="mustStockWrapper" value="{!mechanicTypeWrapperMap['Must Stock Item']}" />
    <apex:variable var="mayStockWrapper" value="{!mechanicTypeWrapperMap['May Stock Item']}" />
    <apex:variable var="cocktailWrapper" value="{!mechanicTypeWrapperMap['Cocktail']}" />
    <apex:variable var="mktgSupportWrapper" value="{!mechanicTypeWrapperMap['Marketing Support']}" />
    <apex:variable var="tripWrapper" value="{!mechanicTypeWrapperMap['Trips']}" />
    <apex:variable var="educationWrapper" value="{!mechanicTypeWrapperMap['Educations']}" />
    <apex:variable var="posWrapper" value="{!mechanicTypeWrapperMap['Point of Sales']}" />
    <apex:variable var="freeStockWrapper" value="{!mechanicTypeWrapperMap['Free Stock']}" />
    
<head>
<apex:stylesheet value="/sCSS/21.0/sprites/1297816277000/Theme3/default/gc/versioning.css" />   

<apex:stylesheet value="{!URLFOR($Resource.EUR_CRM_jQuery_Lib, '/libs/jquery/css/redmond/jquery-ui-1.10.3.custom.min.css')}" />
<apex:stylesheet value="{!URLFOR($Resource.EUR_CRM_jQuery_Lib, '/styles/common.css')}" />
<!--
<apex:stylesheet value="/sCSS/21.0/sprites/1297816277000/Theme3/default/gc/extended.css" />
<apex:includeScript value="{!URLFOR($Resource.EUR_CRM_jQuery_Lib, '/libs/DataTables/jquery.dataTables.min.js')}" />
-->

<link href="{!URLFOR($Resource.EUR_CRM_jQuery_DataTables, 'css/jquery.dataTables.css')}" media="screen" rel="stylesheet" type="text/css" />

<apex:includeScript value="{!URLFOR($Resource.EUR_CRM_jQuery_Lib, '/libs/jquery/js/jquery-1.9.1.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.EUR_CRM_jQuery_Lib, '/libs/jquery/js/jquery-ui-1.10.3.custom.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.EUR_CRM_jQuery_DataTables, 'js/jquery.dataTables.js')}"/>

<script>
    $ = jQuery.noConflict();
    
    var isAllInputValid = true;
    
    var varStockDealMap={};
    
    //DataTable Variable
    var cliHousePouring;
    var cmHousePouring;
    var cliPremiumPouringSpirits;
    var cmPremiumPouringSpirits;
    var cliHousePouringChampagne;
    var cmHousePouringChampagne;
    var cliMustStock;
    var cmMustStock;
    var cliMayStock;
    var cmMayStock;
    var cliCocktail;
    var cmCocktail;
    var cliMktgSupport;
    var cmMktgSupport;
    var cliTrip;
    var cmTrip;
    var cliEducation;
    var cmEducation;
    var cliPOS;
    var cmPOS;
    var cliFreeStock;
    var cmFreeStock;
    
    //Common Data Table Properties
    var basicDataTableProperties = {
        "bDestroy":true,
        "bStateSave":true,
        "aaSorting": [[1, "asc"]],
        "bSearch":false,
        "bFilter" : true
    };
    
    var colLabel_Action = "{!$Label.EUR_CRM_Action}";
    var colLabel_BrandQuality = "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_Brand_Quality__c.label}";
    
    //Contract Mechanic Column Definition
    var contractMechanicColumns = [
            {"sTitle": colLabel_Action},
            {"sTitle": colLabel_BrandQuality},
            {"sTitle": "Category"}
        ]
    
    $(document).ready(
        function(){
            console.log("##INIT - Contract Builder Page");
            preventReturnKeyPress();
            removeSymbol();

            setTables();

            console.log('Check - Var Stock Deal Map:' + JSON.stringify(varStockDealMap));
        }        
    );
    
    //fix to remove charster ','
    function removeSymbol(){
        $('.cliQty, .cliRetro').each(function(index, elem ){
            elem.value = elem.value.replace(/\,/g,'');
        });
    }

    function preventReturnKeyPress(){
        $("input,select").keypress(function(e){
            return e.keyCode!==13;
        });
    }
    
    function setTables(){
        setHousePouringTable();
        setPremiumPouringSpiritsTable();
        setHousePouringChampagneTable();
        setMuskStockTable();
        setMayStockTable();
        setCocktailTable();
        setMarketingPackageTables();
    }
    
    function setHousePouringTable(){
        var cliHousePouring_dataTableProperties = basicDataTableProperties;
        cliHousePouring_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_Min_Qty_Per_Annum_9L__c.label}"},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_Retro_Per_9L__c.label}"},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_Stock_Deal__c.label}"},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_TotalSpend__c.label}"}
        ];
        
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}');

        cliHousePouring = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}").dataTable(cliHousePouring_dataTableProperties);
        
        var cmHousePouring_dataTableProperties = basicDataTableProperties;
        cmHousePouring_dataTableProperties["aoColumns"] = contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}');
        cmHousePouring = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}").dataTable(cmHousePouring_dataTableProperties);
        
        //Set Total Spend per Row
        console.log("Processing table - #{!CONTRACT_MECHANIC_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}");
        calculateAllTotalSpend($("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}"));
        //Set Total Spend (SUM)
        $('#span_footer_total_housePouring').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}')));
    }
    
    function setPremiumPouringSpiritsTable(){
        var cliPremiumPouringSpirits_dataTableProperties = basicDataTableProperties;
        cliPremiumPouringSpirits_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_Min_Qty_Per_Annum_9L__c.label}"},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_Retro_Per_9L__c.label}"},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_Stock_Deal__c.label}"},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_TotalSpend__c.label}"}
        ];
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}');
        cliPremiumPouringSpirits = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}").dataTable(cliPremiumPouringSpirits_dataTableProperties);
        
        var cmPremiumPouringSpirits_dataTableProperties = basicDataTableProperties;
        cmPremiumPouringSpirits_dataTableProperties["aoColumns"] = contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}');
        cmPremiumPouringSpirits = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}").dataTable(cmPremiumPouringSpirits_dataTableProperties);
        
        //Set Total Spend per Row
        console.log("Processing table - Premium Pouring - #{!CONTRACT_MECHANIC_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}");
        calculateAllTotalSpend($("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}"));
        $('#span_footer_total_premiumPouring').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}')));
    }
    
    function setHousePouringChampagneTable(){
        var cliHousePouringChampagne_dataTableProperties = basicDataTableProperties;
        cliHousePouringChampagne_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_Min_Qty_Per_Annum_9L__c.label}"},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_Retro_Per_9L__c.label}"},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_Available_by_the_Glass__c.label}"},
            {"sTitle": "{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_TotalSpend__c.label}"}
        ];
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}');
        cliHousePouringChampagne = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}").dataTable(cliHousePouringChampagne_dataTableProperties);
        
        var cmHousePouringChampagne_dataTableProperties = basicDataTableProperties;
        cmHousePouringChampagne_dataTableProperties["aoColumns"] = contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}');
        cmHousePouringChampagne = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}").dataTable(cmHousePouringChampagne_dataTableProperties);
        
        //Set Total Spend per Row
        console.log("Processing table - Champagne - #{!CONTRACT_MECHANIC_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}");
        calculateAllTotalSpend($("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}"));
        $('#span_footer_total_housePouringChampagne').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}')))
    }

    
    function setMuskStockTable(){
        var cliMustStock_dataTableProperties = basicDataTableProperties;
        cliMustStock_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality}
        ];
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!mustStockWrapper.mechanicTypeId}');
        cliMustStock = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!mustStockWrapper.mechanicTypeId}").dataTable(cliMustStock_dataTableProperties);
        
        var cmMustStock_dataTableProperties = basicDataTableProperties;
        cmMustStock_dataTableProperties["aoColumns"] = contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!mustStockWrapper.mechanicTypeId}');
        cmMustStock = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!mustStockWrapper.mechanicTypeId}").dataTable(cmMustStock_dataTableProperties);
    }
    
    function setMayStockTable(){
        var cliMayStock_dataTableProperties = basicDataTableProperties;
        cliMayStock_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality}
        ];
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!mayStockWrapper.mechanicTypeId}');
        cliMayStock = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!mayStockWrapper.mechanicTypeId}").dataTable(cliMayStock_dataTableProperties);
        
        var cmMayStock_dataTableProperties = basicDataTableProperties;
        cmMayStock_dataTableProperties["aoColumns"] = contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!mayStockWrapper.mechanicTypeId}');
        cmMayStock = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!mayStockWrapper.mechanicTypeId}").dataTable(cmMayStock_dataTableProperties);
    }
    
    function setCocktailTable(){
        setCocktailLineItemTable();
        
        var cmCocktail_dataTableProperties = basicDataTableProperties;
        cmCocktail_dataTableProperties["aoColumns"] = contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!cocktailWrapper.mechanicTypeId}');
        cmCocktail = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!cocktailWrapper.mechanicTypeId}").dataTable(cmCocktail_dataTableProperties);
    }
    
     function setCocktailLineItemTable(){
        var cliCocktail_dataTableProperties = basicDataTableProperties;
         cliCocktail_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality},
            {"sTitle":"{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_No_of_Cocktails__c.label}"},
            {"sTitle":"Cocktail Name/s"}
        ];
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!cocktailWrapper.mechanicTypeId}');
        cliCocktail = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!cocktailWrapper.mechanicTypeId}").dataTable(cliCocktail_dataTableProperties);
    }
    
    function setMktgSupportTable(){
        var cliMktgSupport_dataTableProperties = basicDataTableProperties;
        cliMktgSupport_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality},
            {"sTitle":"Marketing Support Value"}
        ];
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!mktgSupportWrapper.mechanicTypeId}');
        cliMktgSupport = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!mktgSupportWrapper.mechanicTypeId}").dataTable(cliMktgSupport_dataTableProperties);
        
        var cmMktgSupport_dataTableProperties = basicDataTableProperties;
        cmMktgSupport_dataTableProperties["aoColumns"] = contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!mktgSupportWrapper.mechanicTypeId}');
        cmMktgSupport = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!mktgSupportWrapper.mechanicTypeId}").dataTable(cmMktgSupport_dataTableProperties);
    }
    
    function setTripTable(){
        var cliTrip_dataTableProperties = basicDataTableProperties;
        cliTrip_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality},
            {"sTitle":"Trip Name"},
            {"sTitle":"{!$ObjectType.EUR_CRM_Contract_Line_Item__c.fields.EUR_CRM_No_of_People__c.label}"},
            {"sTitle":"Trip Value"}
        ];
        
        var cmTrip_contractMechanicColumns = [
            {"sTitle": colLabel_Action},
            {"sTitle": colLabel_BrandQuality},
            {"sTitle": "Trip Name"},
            {"sTitle": "Category"}
        ]
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!tripWrapper.mechanicTypeId}');
        cliTrip = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!tripWrapper.mechanicTypeId}").dataTable(cliTrip_dataTableProperties);
        
        var cmTrip_dataTableProperties = basicDataTableProperties;
        cmTrip_dataTableProperties["aoColumns"] = cmTrip_contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!tripWrapper.mechanicTypeId}');
        cmTrip = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!tripWrapper.mechanicTypeId}").dataTable(cmTrip_dataTableProperties);
    }
    
    function setEducationTable(){
        var cliEducation_dataTableProperties = basicDataTableProperties;
        cliEducation_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality},
            {"sTitle": "Education Name"},
            {"sTitle":"Education Value"}
        ];
        
        var cmEducation_contractMechanicColumns = [
            {"sTitle": colLabel_Action},
            {"sTitle": colLabel_BrandQuality},
            {"sTitle": "Education Name"},
            {"sTitle": "Category"}
        ]
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!educationWrapper.mechanicTypeId}');
        cliEducation = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!educationWrapper.mechanicTypeId}").dataTable(cliEducation_dataTableProperties);
        
        var cmEducation_dataTableProperties = basicDataTableProperties;
        cmEducation_dataTableProperties["aoColumns"] = cmEducation_contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!educationWrapper.mechanicTypeId}');
        cmEducation = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!educationWrapper.mechanicTypeId}").dataTable(cmEducation_dataTableProperties);
    }
    
    function setPOSTable(){
        var cliPOS_dataTableProperties = basicDataTableProperties;
        cliPOS_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality},
            {"sTitle":"POS Value"}
        ];
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!posWrapper.mechanicTypeId}');
        cliPOS = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!posWrapper.mechanicTypeId}").dataTable(cliPOS_dataTableProperties);
        
        var cmPOS_dataTableProperties = basicDataTableProperties;
        cmPOS_dataTableProperties["aoColumns"] = contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!posWrapper.mechanicTypeId}');
        cmPOS = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!posWrapper.mechanicTypeId}").dataTable(cmPOS_dataTableProperties);
    }
    
    function setFreeStockTable(){
        var cliFreeStock_dataTableProperties = basicDataTableProperties;
        cliFreeStock_dataTableProperties["aoColumns"] = [
            {"sTitle":colLabel_Action},
            {"sTitle":colLabel_BrandQuality},
            {"sTitle":"Stock Value"}
        ];
        console.log('Set - {!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!freeStockWrapper.mechanicTypeId}');
        cliFreeStock = $("#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!freeStockWrapper.mechanicTypeId}").dataTable(cliFreeStock_dataTableProperties);
        
        var cmFreeStock_dataTableProperties = basicDataTableProperties;
        cmFreeStock_dataTableProperties["aoColumns"] = contractMechanicColumns;
        console.log('Set - {!CONTRACT_MECHANIC_TABLE_PREFIX}{!freeStockWrapper.mechanicTypeId}');
        cmFreeStock = $("#{!CONTRACT_MECHANIC_TABLE_PREFIX}{!freeStockWrapper.mechanicTypeId}").dataTable(cmFreeStock_dataTableProperties);

    }
    
    function setMarketingPackageTables(){
        setMktgSupportTable();
        setTripTable();
        setEducationTable();
        setPOSTable();
        setFreeStockTable();
    }
    
    function resetPouring(groupName){
        //TODO Add reset for Cocktail
        //reset cocktail every reset of any pouring mechanic type (group name)
    }
    
    function validateQty(input){
        var decimal=  /^([+]?)([0-9]*)(\.[0-9]{1})?$/; 
        return decimal.test(input);
    }
    
    function validateDecimal(input){
        var decimal=  /^([+]?)([0-9]*)(\.[0-9]+)?$/; 
        return decimal.test(input);
    }

    
    function calculateTotalSpend(lineItemId, cliRow){
        var totalSpendVal=0;
        var discountAmount = 0;
        
        var isInputValid = false;
        
        var qty = cliRow.find("input.cliQty").val();//cliRow.children().children(".cliQty").val();
        if (validateQty(qty)){
            cliRow.find("input.cliQty").removeClass('error-input');
            isInputValid = true;
        }else{
            cliRow.find("input.cliQty").addClass('error-input');
            isAllInputValid = false;
        }
        
        var retro = cliRow.find("input.cliRetro").val();//cliRow.children().children(".cliRetro").val();
        if (validateDecimal(retro)){
            cliRow.find("input.cliRetro").removeClass('error-input');
            isInputValid = true;
        }else{
            cliRow.find("input.cliRetro").addClass('error-input');
            isAllInputValid = false;
        }
        console.log('Check - Calculate Total Spend:' + lineItemId + '-' + qty +'-'+retro);
        
        if (isInputValid){
            qty = (qty!=null&&qty!=undefined&&qty!="NaN")?parseFloat(qty):0;
            retro = (retro!=null&&retro!=undefined&&retro!="NaN")?parseFloat(retro):0;
            var stockDealId = cliRow.find("select.cliStockDeal").val();//cliRow.children().children(".cliStockDeal").val();
            console.log('Check - Calculate Total Spend:' + lineItemId + '-' + qty +'-'+retro+'-'+ stockDealId);

            if(stockDealId!=null && stockDealId!=undefined && stockDealId!="NaN"&& stockDealId.length>0){
                var stockDeal = varStockDealMap[stockDealId];
                discountAmount = ((stockDeal.EUR_CRM_Litres_per_Case__c/stockDeal.EUR_CRM_Bottles_per_Case_BQ__c/stockDeal.EUR_CRM_Liquid_per_Bottle_litre__c/stockDeal.EUR_CRM_Qty_Buy__c)*stockDeal.EUR_CRM_Qty_Free__c)*stockDeal.EUR_CRM_RTM_Price__c;
                console.log('Check - Calculate TotalSpend - Discount Amount:' + discountAmount);
            }
            console.log('Calculate Total Spend - Check result:' + qty*(retro + discountAmount));
            totalSpendVal = precise_round(qty*(retro + discountAmount), 2);

            var temp = (retro + discountAmount);
            console.log('Check - Calculate Total Spend - totalSpendVal:'+totalSpendVal);
            
            totalSpendVal = isNaN(totalSpendVal)?0:totalSpendVal;
            return totalSpendVal;
        }
        
        return 0;
    }
    
    function calculateAllTotalSpend(tableEle){
        var allCliContentRow = tableEle.find(".cliContent");
        
        console.log("allCliContentRow:" +allCliContentRow+'-'+allCliContentRow.length);
        for (i=0; i<allCliContentRow.length; i++){
            var cliContentRow = $(allCliContentRow[i]);
            console.log('Check - Calculate All Total Spend:' + cliContentRow);
            //calculateTotalSpend("", cliContentRow);
            var tSpend = calculateTotalSpend("", cliContentRow);
            console.log("CALCULATE ALL - TSpend:"+ tSpend);
            cliContentRow.find("span.cliTotalSpend").text(tSpend);//cliContentRow.children().children(".cliTotalSpend").text(tSpend);
            console.log("Check - Calculate All Total Spend - Assign:" +cliContentRow.find("span.cliTotalSpend") + "-"+cliContentRow.find("span.cliTotalSpend").val());//console.log("Calculate ALL - Assign:" +cliContentRow.children().children(".cliTotalSpend") + "-"+cliContentRow.children().children(".cliTotalSpend").val());
        }
    }
    
    function sumTotalSpend(tableEle){
        var sTotalSpend = 0;
        var totalSpendArr = tableEle.find("span.cliTotalSpend");
        console.log('Table Element:'+tableEle +'-'+totalSpendArr);
        
        for (i=0; i<totalSpendArr.length; i++){
            var totalSpendEle = $(totalSpendArr[i]);
            console.log('totalSpendEle:' + totalSpendEle);
            //sTotalSpend += parseFloat(totalSpendEle.text());
            var fTotalSpend = parseFloat(totalSpendEle.text())
            fTotalSpend = isNaN(fTotalSpend)?0:fTotalSpend;
            sTotalSpend += fTotalSpend;
        }
        
        console.log("sTotalSpend:" + sTotalSpend);
        sTotalSpend = isNaN(sTotalSpend)?0:sTotalSpend;
        return precise_round(sTotalSpend, 2);
    }
    
    function precise_round(num,decimals){
        return Math.round(num*Math.pow(10,decimals))/Math.pow(10,decimals);
    }
    
</script>

<style>
body {
    margin-top: 40px;
    font-size: 12px;
    font-family: Helvetica,Arial,Verdana,sans-serif;
    width:100%;
}
        
.loadingOverlay{
    opacity: 0.4;
    postion: absolute;
    top:0px;
    left:0px;
    background-color:#001100;
    width:100%;
    z-index: 5000
}

#container1{
    width:100%;
}

#tabLink{
    font-size: 9px;
}

input.error-input {
    border-color: red;
}
</style>
</head>


<body>
    
<apex:actionStatus id="loading" >
    <apex:facet name="start">
         <c:EUR_CRM_LoadingStatus BackColor="#ffffff"
                                    borderColor="#6B6B6B"
                                    borderSize="1"
                                    height="50px"
                                    width="120px"
                                    margintop="-25px"
                                    marginleft="-60px"
                                    ImageUrl="{!$Resource.loadingStatus}"
                                    Message="Loading..."/>
    </apex:facet>
</apex:actionStatus>

<apex:form >
    <div id="contentLoading" style="display:none;">
        <div style="text-align: center;">
            <p>Loading...
            <img src="/img/loading.gif" alt="Loading graphic" /></p>
        </div>
    </div>
    
    <apex:repeat var="stockDealKey" value="{!stockDealMap}">
        <script>
            var litrePerCase = "{!stockDealMap[stockDealKey].EUR_CRM_Litres_per_Case__c}";
            var bottlePerCase = "{!stockDealMap[stockDealKey].EUR_CRM_Bottles_per_Case_BQ__c}"; 
            var liquidPerBottle = "{!stockDealMap[stockDealKey].EUR_CRM_Liquid_per_Bottle_litre__c}"; 
            var qtyBuy = "{!stockDealMap[stockDealKey].EUR_CRM_Qty_Buy__c}"; 
            var qtyFree = "{!stockDealMap[stockDealKey].EUR_CRM_Qty_Free__c}"; 
            var rtmPrice = "{!stockDealMap[stockDealKey].EUR_CRM_RTM_Price__c}"; 
            
            var stockDealItem = {};
            stockDealItem["EUR_CRM_Litres_per_Case__c"] = litrePerCase;
            stockDealItem["EUR_CRM_Bottles_per_Case_BQ__c"] = bottlePerCase;
            stockDealItem["EUR_CRM_Liquid_per_Bottle_litre__c"] = liquidPerBottle;
            stockDealItem["EUR_CRM_Qty_Buy__c"] = qtyBuy;
            stockDealItem["EUR_CRM_Qty_Free__c"] = qtyFree;
            stockDealItem["EUR_CRM_RTM_Price__c"] = rtmPrice;
            
            varStockDealMap["{!stockDealKey}"] = stockDealItem;//JSON.parse("{!stockDealMap[stockDealKey]}");
            </script>
    </apex:repeat>
    
    
    <div class="container1">
    <apex:pageBlock id="main_pageBlock">
        <apex:pageblockButtons >
        <apex:commandButton value="{!$Label.EUR_CRM_Save}" 
            action="{!saveContract}" rerender="none"
            status="loading">
            <apex:param name="IS_QUICK_SAVE" value="false"/>
        </apex:commandButton>
        <apex:commandButton value="Quick Save" 
            action="{!saveContract}" rerender="main_pageBlock"
            oncomplete="preventReturnKeyPress(); removeSymbol(); setTables();"
            status="loading">
            <apex:param name="IS_QUICK_SAVE" value="true"/>
        </apex:commandButton>
        <apex:commandButton value="{!$Label.EUR_CRM_Exit}" action="{!cancel}" 
            rerender="none"
            status="loading"/>
        </apex:pageblockButtons>
    

    
    
        <div id="mechanicTypeTabs" class="tabLink">
            <ul>
                <li><a href="#tab_HousePouring">{!housePouringWrapper.mechanicTypeName}</a></li>
                <li><a href="#tab_PremiumPouringSpirits">{!premiumPouringSpiritsWrapper.mechanicTypeName}</a></li>
                <li><a href="#tab_HousePouringChampagne">{!housePouringChampagneWrapper.mechanicTypeName}</a></li>
                <li><a href="#tab_MustStock">{!mustStockWrapper.mechanicTypeName}</a></li>
                <li><a href="#tab_MayStock">{!mayStockWrapper.mechanicTypeName}</a></li>
                <li><a href="#tab_Cocktail">{!cocktailWrapper.mechanicTypeName}</a></li>
                <li><a href="#tab_MarketingPackage">Marketing Package</a></li>
            </ul>
            
            <div id="tab_HousePouring">
                <apex:pageBlock id="pageBlock_HousePouring">
                    <apex:pageBlockSection id="pageblock_lineItem_housepouring" title="Edit Contract Line Items" columns="1">
                        <apex:outputPanel layout="block">
                        <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}">
                            <apex:repeat value="{!housePouringWrapper.contractLineItemMap}" var="cliKey">
                            <apex:repeat value="{!housePouringWrapper.contractLineItemMap[cliKey]}" var="cliItem">
                                <!-- <script>console.log('Check - CLI:{!cliKey} - {!cliItem}')</script> -->
                                <tr id="row_housePouring_{!cliItem.EUR_CRM_Contract_Mechanic__c}" class="cliContent">
                                    <td>
                                        <apex:commandLink value="Remove"
                                            action="{!addContractMechanic}"
                                            rerender="pageBlock_HousePouring, pageBlock_Cocktail"
                                            onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setHousePouringTable(); setCocktailTable();"
                                            status="loading">
                                            <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!housePouringWrapper.mechanicTypeName}"/>
                                            <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                        </apex:commandLink>
                                    </td>
                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                    <td><apex:inputField styleclass="cliQty"
                                        value="{!cliItem.EUR_Min_Qty_Per_Annum_9L__c}"
                                        onchange=" $('#housePouring_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}').text(calculateTotalSpend('{!cliItem}',$(row_housePouring_{!cliItem.EUR_CRM_Contract_Mechanic__c}))); $('#span_footer_total_housePouring').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}')));">
                                        </apex:inputField>
                                    </td>
                                    <td><apex:inputField styleclass="cliRetro"
                                        value="{!cliItem.EUR_CRM_Retro_Per_9L__c}"
                                        onchange=" $('#housePouring_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}').text(calculateTotalSpend('{!cliItem}',$(row_housePouring_{!cliItem.EUR_CRM_Contract_Mechanic__c}))); $('#span_footer_total_housePouring').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}')));">
                                        </apex:inputField>
                                    </td>
                                    <td style="width:10%">
                                        <apex:selectList styleclass="cliStockDeal"
                                        value="{!cliItem.EUR_CRM_Stock_Deal__c}" size="1"
                                        rendered="{!IF(CONTAINS(stockDealKeyReference, cliItem.EUR_CRM_Brand_Quality_Name__c), true, false)}"
                                        onchange=" $('#housePouring_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}').text(calculateTotalSpend('{!cliItem}',$(row_housePouring_{!cliItem.EUR_CRM_Contract_Mechanic__c}))); $('#span_footer_total_housePouring').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}')));">
                                            <apex:selectOptions value="{!stockDealSelectionMap[cliItem.EUR_CRM_Brand_Quality_Name__c]}"/>
                                        </apex:selectList>
                                    </td>
                                    <td>
                                        <span class="cliTotalSpend" id="housePouring_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}">{!cliItem.EUR_CRM_Total_Value_Reference__c}</span>
                                    </td>
                                </tr>
                            </apex:repeat>
                            </apex:repeat>
                            <tfoot>
                                <tr>
                                    <th style="text-align:right;" colspan="5" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                    <th id="footer_total_housePouring" rowspan="1" colspan="1">
                                        <span id="span_footer_total_housePouring"/>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <br/>
                    <apex:pageBlockSection id="pageblock_contractMechanic_housepouring" title="Contract Mechanics" columns="1">
                        <apex:outputPanel layout="block">
                        <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!housePouringWrapper.mechanicTypeId}">
                            <apex:repeat value="{!housePouringWrapper.contractMechanicList}" var="cmItem">
                                <tr>
                                    <td>
                                        <apex:commandLink value="Add"
                                            action="{!addContractLineItem}"
                                            rerender="pageBlock_HousePouring, pageBlock_Cocktail"
                                            onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setHousePouringTable(); setCocktailTable();"
                                            status="loading">
                                            <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!housePouringWrapper.mechanicTypeName}"/>
                                            <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                        </apex:commandLink>
                                    </td>
                                    <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                    <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td>   
                                </tr>
                            </apex:repeat>
                        </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </div>
            
                        <div id="tab_PremiumPouringSpirits">
                <apex:pageBlock id="pageBlock_PremiumPouringSpirits">
                    <apex:pageBlockSection id="pageBlock_LineItem_PremiumPouringSpirits" title="Edit Contract Line Items" columns="1">
                        <apex:outputPanel layout="block">
                            <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}">
                                <apex:repeat value="{!premiumPouringSpiritsWrapper.contractLineItemMap}" var="cliKey">
                                <apex:repeat value="{!premiumPouringSpiritsWrapper.contractLineItemMap[cliKey]}" var="cliItem">
                                <tr id="row_premiumPouring_{!cliItem.EUR_CRM_Contract_Mechanic__c}" class="cliContent">
                                    <td>
                                        <apex:commandLink value="Remove"
                                        action="{!addContractMechanic}"
                                        rerender="pageBlock_PremiumPouringSpirits, pageBlock_Cocktail"
                                        onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setPremiumPouringSpiritsTable(); setCocktailTable();"
                                        status="loading">
                                        <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!premiumPouringSpiritsWrapper.mechanicTypeName}"/>
                                        <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                        </apex:commandLink>
                                    </td>
                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                    <td><apex:inputField styleclass="cliQty"
                                        value="{!cliItem.EUR_Min_Qty_Per_Annum_9L__c}"
                                        onchange=" $('#premiumPouring_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}').text(calculateTotalSpend('{!cliItem}',$(row_premiumPouring_{!cliItem.EUR_CRM_Contract_Mechanic__c}))); $('#span_footer_total_premiumPouring').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}')));">
                                        </apex:inputField>
                                    </td>
                                    <td><apex:inputField styleclass="cliRetro"
                                        value="{!cliItem.EUR_CRM_Retro_Per_9L__c}"
                                        onchange=" $('#premiumPouring_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}').text(calculateTotalSpend('{!cliItem}',$(row_premiumPouring_{!cliItem.EUR_CRM_Contract_Mechanic__c}))); $('#span_footer_total_premiumPouring').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}')));">
                                        </apex:inputField>
                                    </td>
                                    <td style="width:10%">
                                        <apex:selectList styleclass="cliStockDeal"
                                        value="{!cliItem.EUR_CRM_Stock_Deal__c}" size="1"
                                        rendered="{!IF(CONTAINS(stockDealKeyReference, cliItem.EUR_CRM_Brand_Quality_Name__c), true, false)}"
                                        onchange=" $('#premiumPouring_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}').text(calculateTotalSpend('{!cliItem}',$(row_premiumPouring_{!cliItem.EUR_CRM_Contract_Mechanic__c}))); $('#span_footer_total_premiumPouring').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}')));">
                                            <apex:selectOptions value="{!stockDealSelectionMap[cliItem.EUR_CRM_Brand_Quality_Name__c]}"/>
                                        </apex:selectList>
                                    </td>
                                    <td>
                                        <span class="cliTotalSpend" id="premiumPouring_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}">{!cliItem.EUR_CRM_Total_Value_Reference__c}</span>
                                    </td>
                                </tr>
                            </apex:repeat>
                            </apex:repeat>
                            <tfoot>
                                <tr>
                                    <th style="text-align:right;" colspan="5" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                    <th id="footer_total_premiumPouringSpirits" rowspan="1" colspan="1">
                                        <span id="span_footer_total_premiumPouring"/>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:pageBlockSection id="pageBlock_ContractMechanic_PremiumPouringSpirits" title="Contract Mechanics" columns="1">
                        <apex:outputPanel layout="block">
                            <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!premiumPouringSpiritsWrapper.mechanicTypeId}">
                                <apex:repeat value="{!premiumPouringSpiritsWrapper.contractMechanicList}" var="cmItem">
                                    <tr>
                                        <td>
                                            <apex:commandLink value="Add"
                                                action="{!addContractLineItem}"
                                                rerender="pageBlock_PremiumPouringSpirits, pageBlock_Cocktail"
                                                onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setPremiumPouringSpiritsTable(); setCocktailTable();"
                                                status="loading">
                                                <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!premiumPouringSpiritsWrapper.mechanicTypeName}"/>
                                                <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                            </apex:commandLink>
                                        </td>
                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td> 
                                    </tr>
                                </apex:repeat>
                            </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </div>
            
            <div id="tab_HousePouringChampagne">
                <apex:pageBlock id="pageBlock_HousePouringChampagne">
                    <apex:pageBlockSection id="pageblock_lineItem_HousePouringChampagne" title="Edit Contract Line Items" columns="1">
                        <apex:outputPanel layout="block">
                        <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}">
                            <apex:repeat value="{!housePouringChampagneWrapper.contractLineItemMap}" var="cliKey">
                            <apex:repeat value="{!housePouringChampagneWrapper.contractLineItemMap[cliKey]}" var="cliItem">
                                <tr id="row_housePouringChampagne_{!cliItem.EUR_CRM_Contract_Mechanic__c}" class="cliContent">
                                    <td>
                                        <apex:commandLink value="Remove"
                                            action="{!addContractMechanic}"
                                            rerender="pageBlock_HousePouringChampagne, pageBlock_Cocktail"
                                            onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setHousePouringChampagneTable(); setCocktailTable();"
                                            status="loading">
                                            <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!housePouringChampagneWrapper.mechanicTypeName}"/>
                                            <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                        </apex:commandLink>
                                    </td>
                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                    <td><apex:inputField styleclass="cliQty"
                                        value="{!cliItem.EUR_Min_Qty_Per_Annum_9L__c}"
                                        onchange=" $('#housePouringChampagne_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}').text(calculateTotalSpend('{!cliItem}',$(row_housePouringChampagne_{!cliItem.EUR_CRM_Contract_Mechanic__c}))); $('#span_footer_total_housePouringChampagne').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}')));">
                                        </apex:inputField>
                                    </td>
                                    <td><apex:inputField styleclass="cliRetro"
                                        value="{!cliItem.EUR_CRM_Retro_Per_9L__c}"
                                        onchange=" $('#housePouringChampagne_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}').text(calculateTotalSpend('{!cliItem}',$(row_housePouringChampagne_{!cliItem.EUR_CRM_Contract_Mechanic__c}))); $('#span_footer_total_housePouringChampagne').text(sumTotalSpend($('#{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}')));">
                                        </apex:inputField>
                                    </td>
                                    <td><apex:inputField value="{!cliItem.EUR_CRM_Available_by_the_Glass__c}"/></td>
                                    <td>
                                        <span class="cliTotalSpend" id="housePouringChampagne_totalSpend_{!cliItem.EUR_CRM_Contract_Mechanic__c}">{!cliItem.EUR_CRM_Total_Value_Reference__c}</span>
                                    </td>
                                </tr>
                            </apex:repeat>
                            </apex:repeat>
                            <tfoot>
                                <tr>
                                    <th style="text-align:right;" colspan="5" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                    <th id="footer_total_housePouringChampagne" rowspan="1" colspan="1">
                                        <span id="span_footer_total_housePouringChampagne"/>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <br/>
                    <apex:pageBlockSection id="pageblock_contractMechanic_HousePouringChampagne" title="Contract Mechanics" columns="1">
                        <apex:outputPanel layout="block">
                        <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!housePouringChampagneWrapper.mechanicTypeId}">
                            <apex:repeat value="{!housePouringChampagneWrapper.contractMechanicList}" var="cmItem">
                                <tr>
                                    <td>
                                        <apex:commandLink value="Add"
                                            action="{!addContractLineItem}"
                                            rerender="pageBlock_HousePouringChampagne, pageBlock_Cocktail"
                                            onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setHousePouringChampagneTable(); setCocktailTable();"
                                            status="loading">
                                            <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!housePouringChampagneWrapper.mechanicTypeName}"/>
                                            <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                        </apex:commandLink>
                                    </td>
                                    <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                    <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td>   
                                </tr>
                            </apex:repeat>
                        </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </div>
           
                <div id="tab_MustStock">
                <apex:pageBlock id="pageBlock_MustStock">
                    <apex:outputPanel id="panel_LumpSum_MustStock" layout="block"
                        rendered="{!mustStockWrapper.mechanicType.EUR_CRM_Has_Lump_Sum__c}">
                        <apex:pageBlock ><apex:pageBlockSection ><apex:pageBlockSectionItem >
                            <apex:outputLabel value="Lump Sum:"/>
                            <apex:inputField value="{!mustStockWrapper.contractLineItemLumpSum.EUR_CRM_Value__c}"/>
                        </apex:pageBlockSectionItem></apex:pageBlockSection></apex:pageBlock>
                    </apex:outputPanel>
                    <br/>
                    <apex:pageBlockSection id="pageBlock_LineItem_MustStock" title="Edit Contract Line Items" columns="1">
                        <apex:outputPanel layout="block">
                            <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!mustStockWrapper.mechanicTypeId}">
                                <apex:repeat value="{!mustStockWrapper.contractLineItemMap}" var="cliKey">
                                <apex:repeat value="{!mustStockWrapper.contractLineItemMap[cliKey]}" var="cliItem">                                <tr>
                                    <td>
                                        <apex:commandLink value="Remove"
                                        action="{!addContractMechanic}"
                                        rerender="pageBlock_MustStock, pageBlock_Cocktail"
                                        onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setMuskStockTable(); setCocktailTable();"
                                        status="loading">
                                        <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!mustStockWrapper.mechanicTypeName}"/>
                                        <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                        </apex:commandLink>
                                    </td>
                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                </tr>
                                </apex:repeat>
                                </apex:repeat>
                            </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:pageBlockSection id="pageBlock_ContractMechanic_MustStock" title="Contract Mechanics" columns="1">
                        <apex:outputPanel layout="block">
                            <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!mustStockWrapper.mechanicTypeId}">
                                <apex:repeat value="{!mustStockWrapper.contractMechanicList}" var="cmItem">
                                    <tr>
                                        <td>
                                            <apex:commandLink value="Add"
                                                action="{!addContractLineItem}"
                                                rerender="pageBlock_MustStock, pageBlock_Cocktail"
                                                onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setMuskStockTable(); setCocktailTable();"
                                                status="loading">
                                                <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!mustStockWrapper.mechanicTypeName}"/>
                                                <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                            </apex:commandLink>
                                        </td>
                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td> 
                                    </tr>
                                </apex:repeat>
                            </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </div>         
           
            <div id="tab_MayStock">
                <apex:pageBlock id="pageBlock_MayStock">
                    <apex:outputPanel id="panel_LumpSum_MayStock" layout="block"
                        rendered="{!mayStockWrapper.hasBothMechanicType}">
                        <apex:pageBlock ><apex:pageBlockSection ><apex:pageBlockSectionItem >
                            <apex:outputLabel value="Lump Sum:"/>
                            <apex:inputField value="{!mayStockWrapper.contractLineItemLumpSum.EUR_CRM_Value__c}"/>
                        </apex:pageBlockSectionItem></apex:pageBlockSection></apex:pageBlock>
                    </apex:outputPanel>
                    <br/>
                    <apex:pageBlockSection id="pageBlock_LineItem_MayStock" title="Edit Contract Line Items" columns="1">
                        <apex:outputPanel layout="block">
                            <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!mayStockWrapper.mechanicTypeId}">
                                <apex:repeat value="{!mayStockWrapper.contractLineItemMap}" var="cliKey">
                                <apex:repeat value="{!mayStockWrapper.contractLineItemMap[cliKey]}" var="cliItem">                                
                                <tr>
                                    <td>
                                        <apex:commandLink value="Remove"
                                        action="{!addContractMechanic}"
                                        rerender="pageBlock_MayStock, pageBlock_Cocktail"
                                        onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setMayStockTable(); setCocktailTable();"
                                        status="loading">
                                        <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!mayStockWrapper.mechanicTypeName}"/>
                                        <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                        </apex:commandLink>
                                    </td>
                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                </tr>
                                </apex:repeat>
                                </apex:repeat>
                            </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:pageBlockSection id="pageBlock_ContractMechanic_MayStock" title="Contract Mechanics" columns="1">
                        <apex:outputPanel layout="block">
                            <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!mayStockWrapper.mechanicTypeId}">
                                <apex:repeat value="{!mayStockWrapper.contractMechanicList}" var="cmItem">
                                    <tr>
                                        <td>
                                            <apex:commandLink value="Add"
                                                action="{!addContractLineItem}"
                                                rerender="pageBlock_MayStock, pageBlock_Cocktail"
                                                onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setMayStockTable(); setCocktailTable();"
                                                status="loading">
                                                <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!mayStockWrapper.mechanicTypeName}"/>
                                                <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                            </apex:commandLink>
                                        </td>
                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td>   
                                    </tr>
                                </apex:repeat>
                            </table>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </div>      

            <div id="tab_Cocktail">
                <apex:outputPanel id="CocktailContainer">
                    <apex:outputPanel id="CocktailContainer_LumpSum" layout="block"
                        rendered="true">
                        <apex:pageBlock ><apex:pageBlockSection ><apex:pageBlockSectionItem >
                            <apex:outputLabel value="Cocktail Percentage:"/>
                            <apex:inputField value="{!contractObj.EUR_CRM_Cocktail_Percent__c}"/>
                        </apex:pageBlockSectionItem></apex:pageBlockSection></apex:pageBlock>
                    </apex:outputPanel>
                    <apex:outputPanel id="CocktailContainer_PerBQ" layout="block"
                        rendered="true">
                        <apex:pageBlock id="pageBlock_Cocktail">
                            <apex:pageBlockSection id="pageBlock_LineItem_Cocktail" title="Edit Contract Line Items" columns="1">
                                <apex:outputPanel layout="block">
                                    <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!cocktailWrapper.mechanicTypeId}">
                                        <apex:repeat value="{!cocktailWrapper.contractLineItemMap}" var="cliKey">
                                        <apex:repeat value="{!cocktailWrapper.contractLineItemWrapperMap[cliKey]}" var="cliItem">
                                        <tr>
                                            <td>
                                                <apex:commandLink value="Remove"
                                                action="{!addContractMechanic}"
                                                rerender="pageBlock_Cocktail"
                                                onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setCocktailTable();"
                                                status="loading">
                                                <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!cocktailWrapper.mechanicTypeName}"/>
                                                <apex:param name="PARAM_BQ_NAME" value="{!cliItem.contractLineItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                                </apex:commandLink>
                                            </td>
                                            <td><apex:outputField value="{!cliItem.contractLineItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                            <td><apex:inputField value="{!cliItem.contractLineItem.EUR_CRM_No_of_Cocktails__c}"/></td>
                                            <td width="50%">
                                                <table width="100%">
                                                <tr>
                                                <td width="90%">
                                                <apex:outputPanel rendered="{!IF(cliItem.cocktailOnEdit, false, true)}">
                                                <apex:variable var="iCount" value="{!0}"/>
                                                <apex:repeat value="{!cliItem.cocktailsSelected}" var="cSelected">
                                                    <apex:variable var="iCount" value="{!iCount+1}"/>
                                                    <apex:outputText value="{!cSelected.label}"/> 
                                                    <apex:outputText value=", " rendered="{!IF(iCount>=cliItem.cocktailSelectedSize,false, true)}"/>
                                                </apex:repeat>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!IF(cliItem.cocktailOnEdit, true, false)}">
                                                <!--<c:EUR_CRM_MultiselectPicklist leftLabel="Cocktail Names" rightLabel="Selected Cocktails" size="5" width="25" leftOptions="{!cocktailNameSelection}" rightOptions="{!cliItem.cocktailsSelected}"/>-->
                                                <c:EUR_CRM_MultiselectPicklist leftLabel="Cocktail Names" rightLabel="Selected Cocktails" size="5" width="25" leftOptions="{!cliItem.cocktailNameSelection}" rightOptions="{!cliItem.cocktailsSelected}"/>
                                                </apex:outputPanel>
                                                </td>
                                                <td>
                                                <apex:commandLink action="{!editSelectedCocktail}" rerender="pageBlock_Cocktail" 
                                                    onclick="console.log('TEST ACTIVATED')"
                                                    onComplete="console.log ('Test onComplete - TEST'); preventReturnKeyPress(); setCocktailTable();"
                                                    status="loading">
                                                    <apex:image url="{!URLFOR($Resource.EUR_CRM_Icons,IF(cliItem.cocktailOnEdit,'editDoneIcon.png','editIcon.png'))}"/>
                                                    <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!cocktailWrapper.mechanicTypeName}"/>
                                                    <apex:param name="PARAM_BQ_NAME" value="{!cliItem.contractLineItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                                </apex:commandLink>
                                                </td>
                                                </tr></table>
                                            </td>
                                        </tr>
                                        </apex:repeat>
                                        </apex:repeat>
                                    </table>
                                </apex:outputPanel>
                            </apex:pageBlockSection>
                            <apex:pageBlockSection id="pageBlock_ContractMechanic_Cocktail" title="Contract Mechanics" columns="1">
                                <apex:outputPanel layout="block">
                                    <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!cocktailWrapper.mechanicTypeId}">
                                        <apex:repeat value="{!cocktailWrapper.contractMechanicList}" var="cmItem">
                                            <tr>
                                                <td>
                                                    <apex:commandLink value="Add"
                                                        action="{!addContractLineItem}"
                                                        rerender="pageBlock_Cocktail"
                                                        onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setCocktailTable();"
                                                        status="loading">
                                                        <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!cocktailWrapper.mechanicTypeName}"/>
                                                        <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                                    </apex:commandLink>
                                                </td>
                                                <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name_Ref__c}"/></td>
                                                <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category_Ref__c}"/></td>   
                                            </tr>
                                        </apex:repeat>
                                    </table>
                                </apex:outputPanel>
                            </apex:pageBlockSection>
                        </apex:pageBlock>
                    </apex:outputPanel>
                </apex:outputPanel>
            </div>      

        <div id="tab_MarketingPackage">
                <!--
                <apex:inputField value="{!contractObj.EUR_CRM_Mktg_Package_Mechanic_Handling__c}">
                    <apex:actionSupport event="onchange" rerender="MarketingContainer" action="{!resetMarketingLumpSum}" 
                        onComplete="preventReturnKeyPress(); if ('{!contractObj.EUR_CRM_Mktg_Package_Mechanic_Handling__c}' == '{!PER_BQ}'){setMarketingPackageTables();}"
                    status="loading"/>
                </apex:inputField>
                
                <br/>-->
                <apex:outputPanel id="MarketingContainer" layout="block">
                    <!--
                    <apex:outputPanel id="MarketingContainer_LumpSum" layout="block"
                        rendered="{!IF(contractObj.EUR_CRM_Mktg_Package_Mechanic_Handling__c=LUMP_SUM,true, false)}">
                        
                        <apex:pageBlock ><apex:pageBlockSection ><apex:pageBlockSectionItem >
                            <apex:outputLabel value="Marketing Package Lump Sum:"/>
                            <apex:inputField value="{!contractObj.EUR_CRM_Marketing_Package_Lump_Sum__c}"/>
                        </apex:pageBlockSectionItem></apex:pageBlockSection></apex:pageBlock>
                    </apex:outputPanel>
                    <apex:outputPanel id="MarketingContainer_PerBQ" layout="block"
                        rendered="{!IF(contractObj.EUR_CRM_Mktg_Package_Mechanic_Handling__c=PER_BQ,true, false)}">

                    -->
                    <apex:outputPanel id="MarketingContainer_PerBQ" layout="block"  >
                        <div id="SubTabs_MktgPackage">
                            <ul>
                                <li><a href="#tab_MarketingSupport">Marketing Support</a></li>
                                <li><a href="#tab_Trip">Trip</a></li>
                                <li><a href="#tab_Education">Education</a></li>
                                <li><a href="#tab_PointOfSale">Point of Sale</a></li>
                                <li><a href="#tab_FreeStock">Free Stock</a></li>
                            </ul>
                            
                            <div id="tab_MarketingSupport">
                                <apex:outputPanel id="panel_LumpSum_MarketingSupport" layout="block"
                                    rendered="{!mktgSupportWrapper.hasBothMechanicType}">
                                    <apex:pageBlock ><apex:pageBlockSection ><apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Lump Sum:"/>
                                        <apex:inputField value="{!mktgSupportWrapper.contractLineItemLumpSum.EUR_CRM_Value__c}"/>
                                    </apex:pageBlockSectionItem></apex:pageBlockSection></apex:pageBlock>
                                </apex:outputPanel>
                                <br/>
                                <apex:pageBlock id="pageBlock_MktgSupport">
                                    <apex:pageBlockSection id="pageBlock_lineItem_mktgSupport" title="Edit Contract Line Items" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!mktgSupportWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!mktgSupportWrapper.contractLineItemMap}" var="cliKey">
                                                <apex:repeat value="{!mktgSupportWrapper.contractLineItemMap[cliKey]}" var="cliItem">
                                                <tr>
                                                    <td>
                                                        <apex:commandLink value="Remove"
                                                        action="{!addContractMechanic}"
                                                        rerender="pageBlock_MktgSupport"
                                                        onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setMktgSupportTable();"
                                                        status="loading">
                                                        <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!mktgSupportWrapper.mechanicTypeName}"/>
                                                        <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                                        </apex:commandLink>
                                                    </td>
                                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                    <td><apex:inputField value="{!cliItem.EUR_CRM_Value__c}"/></td>
                                                </tr>
                                                </apex:repeat>
                                                </apex:repeat>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="pageBlock_contractMechanic_mktgSupport" title="Contract Mechanics" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!mktgSupportWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!mktgSupportWrapper.contractMechanicList}" var="cmItem">
                                                    <tr>
                                                        <td>
                                                            <apex:commandLink value="Add"
                                                                action="{!addContractLineItem}"
                                                                rerender="pageBlock_MktgSupport"
                                                                onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setMktgSupportTable();"
                                                                status="loading">
                                                                <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!mktgSupportWrapper.mechanicTypeName}"/>
                                                                <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                                            </apex:commandLink>
                                                        </td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td>    
                                                    </tr>
                                                </apex:repeat>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                            </div>
                            
                            <div id="tab_Trip">
                                <apex:outputPanel id="panel_LumpSum_Trip" layout="block"
                                    rendered="{!tripWrapper.hasBothMechanicType}">
                                    <apex:pageBlock ><apex:pageBlockSection ><apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Lump Sum:"/>
                                        <apex:inputField value="{!tripWrapper.contractLineItemLumpSum.EUR_CRM_Value__c}"/>
                                    </apex:pageBlockSectionItem></apex:pageBlockSection></apex:pageBlock>
                                </apex:outputPanel>
                                <br/>
                                <apex:pageBlock id="pageBlock_Trip">
                                    <apex:pageBlockSection id="pageBlock_LineItem_Trip" title="Edit Contract Line Items" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!tripWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!tripWrapper.contractLineItemMap}" var="cliKey">
                                                <apex:repeat value="{!tripWrapper.contractLineItemMap[cliKey]}" var="cliItem">                                                <tr>
                                                    <td>
                                                        <apex:commandLink value="Remove"
                                                        action="{!addContractMechanic}"
                                                        rerender="pageBlock_Trip"
                                                        onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setTripTable();"
                                                        status="loading">
                                                        <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!tripWrapper.mechanicTypeName}"/>
                                                        <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                                        </apex:commandLink>
                                                    </td>
                                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Mechanic_Name__c}"/></td>
                                                    <td><apex:inputField value="{!cliItem.EUR_CRM_No_of_People__c}"/></td>
                                                    <td><apex:inputField value="{!cliItem.EUR_CRM_Value__c}">
                                                        <apex:actionSupport event="onchange" rerender="totalValueField"/>
                                                        </apex:inputField>
                                                    </td>
                                                </tr>
                                                </apex:repeat>
                                                </apex:repeat>
                                                <tfoot>
                                                    <tr>
                                                        <th style="text-align:right;" colspan="4" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                                        <th id="footer_total_Trip" rowspan="1" colspan="1"><apex:outputText id="totalValueField" value="{!tripWrapper.totalValue}">
                                                        </apex:outputText></th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="pageBlock_ContractMechanic_Trip" title="Contract Mechanics" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!tripWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!tripWrapper.contractMechanicList}" var="cmItem">
                                                    <tr>
                                                        <td>
                                                            <apex:commandLink value="Add"
                                                                action="{!addContractLineItem}"
                                                                rerender="pageBlock_Trip"
                                                                onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setTripTable();"
                                                                status="loading">
                                                                <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!tripWrapper.mechanicTypeName}"/>
                                                                <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                                            </apex:commandLink>
                                                        </td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Mechanic_Name__c}"/></td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td>   
                                                    </tr>
                                                </apex:repeat>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                            </div>
                            
                            <div id="tab_Education">
                                <apex:outputPanel id="panel_LumpSum_Education" layout="block"
                                    rendered="{!educationWrapper.hasBothMechanicType}">
                                    <apex:pageBlock ><apex:pageBlockSection ><apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Lump Sum:"/>
                                        <apex:inputField value="{!educationWrapper.contractLineItemLumpSum.EUR_CRM_Value__c}"/>
                                    </apex:pageBlockSectionItem></apex:pageBlockSection></apex:pageBlock>
                                </apex:outputPanel>
                                <br/>
                                <apex:pageBlock id="pageBlock_Education">
                                    <apex:pageBlockSection id="pageBlock_LineItem_Education" title="Edit Contract Line Items" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!educationWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!educationWrapper.contractLineItemMap}" var="cliKey">
                                                <apex:repeat value="{!educationWrapper.contractLineItemMap[cliKey]}" var="cliItem">                                                <tr>
                                                    <td>
                                                        <apex:commandLink value="Remove"
                                                        action="{!addContractMechanic}"
                                                        rerender="pageBlock_Education"
                                                        onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setEducationTable();"
                                                        status="loading">
                                                        <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!educationWrapper.mechanicTypeName}"/>
                                                        <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                                        </apex:commandLink>
                                                    </td>
                                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Mechanic_Name__c}"/></td>
                                                    <td><apex:inputField value="{!cliItem.EUR_CRM_Value__c}">
                                                            <apex:actionSupport event="onchange" rerender="totalValueField"/>
                                                        </apex:inputField>
                                                    </td>
                                                </tr>
                                                </apex:repeat>
                                                </apex:repeat>
                                                <tfoot>
                                                    <tr>
                                                        <th style="text-align:right;" colspan="3" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                                        <th id="footer_total_Trip" rowspan="1" colspan="1"><apex:outputText id="totalValueField" value="{!educationWrapper.totalValue}">
                                                        </apex:outputText></th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="pageBlock_ContractMechanic_Education" title="Contract Mechanics" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!educationWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!educationWrapper.contractMechanicList}" var="cmItem">
                                                    <tr>
                                                        <td>
                                                            <apex:commandLink value="Add"
                                                                action="{!addContractLineItem}"
                                                                rerender="pageBlock_Education"
                                                                onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setEducationTable();"
                                                                status="loading">
                                                                <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!educationWrapper.mechanicTypeName}"/>
                                                                <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                                            </apex:commandLink>
                                                        </td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Mechanic_Name__c}"/></td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td>    
                                                    </tr>
                                                </apex:repeat>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                            </div>
                            
                            <div id="tab_PointOfSale">
                                <apex:outputPanel id="panel_LumpSum_POS" layout="block"
                                    rendered="{!posWrapper.hasBothMechanicType}">
                                    <apex:pageBlock ><apex:pageBlockSection ><apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Lump Sum:"/>
                                        <apex:inputField value="{!posWrapper.contractLineItemLumpSum.EUR_CRM_Value__c}"/>
                                    </apex:pageBlockSectionItem></apex:pageBlockSection></apex:pageBlock>
                                </apex:outputPanel>
                                <br/>
                                <apex:pageBlock id="pageBlock_POS">
                                    <apex:pageBlockSection id="pageBlock_LineItem_POS" title="Edit Contract Line Items" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!posWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!posWrapper.contractLineItemMap}" var="cliKey">
                                                <apex:repeat value="{!posWrapper.contractLineItemMap[cliKey]}" var="cliItem">                                                <tr>
                                                    <td>
                                                        <apex:commandLink value="Remove"
                                                        action="{!addContractMechanic}"
                                                        rerender="pageBlock_POS"
                                                        onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setPOSTable();"
                                                        status="loading">
                                                        <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!posWrapper.mechanicTypeName}"/>
                                                        <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                                        </apex:commandLink>
                                                    </td>
                                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                    <td><apex:inputField value="{!cliItem.EUR_CRM_Value__c}">
                                                            <apex:actionSupport event="onchange" rerender="totalValueField"/>
                                                        </apex:inputField>
                                                    </td>
                                                </tr>
                                                </apex:repeat>
                                                </apex:repeat>
                                                <tfoot>
                                                    <tr>
                                                        <th style="text-align:right;" colspan="2" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                                        <th id="footer_total_POS" rowspan="1" colspan="1"><apex:outputText id="totalValueField" value="{!posWrapper.totalValue}">
                                                        </apex:outputText></th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="pageBlock_ContractMechanic_POS" title="Contract Mechanics" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!posWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!posWrapper.contractMechanicList}" var="cmItem">
                                                    <tr>
                                                        <td>
                                                            <apex:commandLink value="Add"
                                                                action="{!addContractLineItem}"
                                                                rerender="pageBlock_POS"
                                                                onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setPOSTable();"
                                                                status="loading">
                                                                <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!posWrapper.mechanicTypeName}"/>
                                                                <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                                            </apex:commandLink>
                                                        </td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td>  
                                                    </tr>
                                                </apex:repeat>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                            </div>
                            
                            <div id="tab_FreeStock">
                                <apex:outputPanel id="panel_LumpSum_FreeStock" layout="block"
                                    rendered="{!freeStockWrapper.hasBothMechanicType}">
                                    <apex:pageBlock ><apex:pageBlockSection ><apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Lump Sum:"/>
                                        <apex:inputField value="{!freeStockWrapper.contractLineItemLumpSum.EUR_CRM_Value__c}"/>
                                    </apex:pageBlockSectionItem></apex:pageBlockSection></apex:pageBlock>
                                </apex:outputPanel>
                                <br/>
                                <apex:pageBlock id="pageBlock_FreeStock">
                                    <apex:pageBlockSection id="pageBlock_LineItem_FreeStock" title="Edit Contract Line Items" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_LINE_ITEM_TABLE_PREFIX}{!freeStockWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!freeStockWrapper.contractLineItemMap}" var="cliKey">
                                                <apex:repeat value="{!freeStockWrapper.contractLineItemMap[cliKey]}" var="cliItem">                                                <tr>
                                                    <td>
                                                        <apex:commandLink value="Remove"
                                                        action="{!addContractMechanic}"
                                                        rerender="pageBlock_FreeStock"
                                                        onComplete="console.log ('Test onComplete - REMOVE'); preventReturnKeyPress(); setFreeStockTable();"
                                                        status="loading">
                                                        <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!freeStockWrapper.mechanicTypeName}"/>
                                                        <apex:param name="PARAM_BQ_NAME" value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/>
                                                        </apex:commandLink>
                                                    </td>
                                                    <td><apex:outputField value="{!cliItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                    <td><apex:inputField value="{!cliItem.EUR_CRM_Value__c}">
                                                            <apex:actionSupport event="onchange" rerender="totalValueField"/>
                                                        </apex:inputField>
                                                    </td>
                                                </tr>
                                                </apex:repeat>
                                                </apex:repeat>
                                                <tfoot>
                                                    <tr>
                                                        <th style="text-align:right;" colspan="2" rowspan="1"><apex:outputLabel value="Total Value: "/></th>
                                                        <th id="footer_total_Trip" rowspan="1" colspan="1"><apex:outputText id="totalValueField" value="{!freeStockWrapper.totalValue}">
                                                        </apex:outputText></th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="pageBlock_ContractMechanic_FreeStock" title="Contract Mechanics" columns="1">
                                        <apex:outputPanel layout="block">
                                            <table id="{!CONTRACT_MECHANIC_TABLE_PREFIX}{!freeStockWrapper.mechanicTypeId}">
                                                <apex:repeat value="{!freeStockWrapper.contractMechanicList}" var="cmItem">
                                                    <tr>
                                                        <td>
                                                            <apex:commandLink value="Add"
                                                                action="{!addContractLineItem}"
                                                                rerender="pageBlock_FreeStock"
                                                                onComplete="console.log ('Test onComplete - ADD'); preventReturnKeyPress(); setFreeStockTable();"
                                                                status="loading">
                                                                <apex:param name="PARAM_MECHANIC_TYPE_NAME" value="{!freeStockWrapper.mechanicTypeName}"/>
                                                                <apex:param name="PARAM_CONTRACT_MECHANIC_ID" value="{!cmItem.Id}"/>                                
                                                            </apex:commandLink>
                                                        </td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Name__c}"/></td>
                                                        <td><apex:outputField value="{!cmItem.EUR_CRM_Brand_Quality_Category__c}"/></td>   
                                                    </tr>
                                                </apex:repeat>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                            </div>
                            
                        </div>
                        <script>
                            $('#SubTabs_MktgPackage').tabs();
                        </script>
                    </apex:outputPanel>
                </apex:outputPanel>
            </div>

            
        </div>
        <script>
            $('#mechanicTypeTabs').tabs();
        </script>

    </apex:pageBlock>
    </div>
</apex:form>

</body>

</apex:page>