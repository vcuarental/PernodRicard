<apex:page standardController="ASI_TH_CRM_Contract__c" extensions="ASI_CRM_CN_EditHeavyContractDetailCtrl" docType="html-5.0" sidebar="false">
    
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv='cache-control' content='no-cache'/>
    <meta http-equiv='expires' content='0'/>
    <meta http-equiv='pragma' content='no-cache'/>
    
    <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, '/bower_components/Font-Awesome/css/font-awesome.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, '/bower_components/Font-Awesome/css/font-awesome.min.css')}" />    
    <apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.ASI_Library, 'dist/css/bootstrap.min.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery1.10.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_Library, 'dist/js/bootstrap.min.js')}" />
    
    <style>
        .AlignRight{
        text-align: right  !important;
        font-weight: bold !important;
        }
        
        .BSCommandButton{
        color: #333 !important;
        background-color: #fff !important;
        border-color: #ccc !important;
        margin-left: 0.5em !important; 
        margin-right: 0.5em !important; 
        margin-bottom: 0.5em !important;
        padding: 3px 6px !important; 
        }
        
        .BSCommandButtonSM{
        font-size: 12px;
        color: #333 !important;
        background-color: #fff !important;
        border-color: #ccc !important;
        margin-left: 0.5em !important;
        margin-right: 0.5em !important;
        margin-bottom: 0 !important;
        padding: 2.5px 5px !important;
        margin-top: -0.3em;
        }
        
        .HeaderCss{
        color: #fff;
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
        background-color: #337ab7;
        border: 1px solid transparent;
        border-color: #337ab7;
        padding: 10px 15px;
        text-align: center;
        }
        
        .PanelBody{
        padding: 0.3em; 
        background-color: #fff; 
        border: 1px solid transparent;
        border-color: #337ab7;
        border-bottom-left-radius: 3px;
        border-bottom-right-radius: 3px;
        border-top-right-radius: 3px;
        }
        
        
        .FontWeightCSS{
        font-weight: bold;
        }
        
        .ApexInputNumberField{
        text-align: right;
        padding: 3px 6px; 
        border: 1px solid #ccc; 
        border-radius: 4px;
        }
        
        .InputNumberFieldwidth{
        width: 10em !important;
        }
        
        
        
        
        .style-1 input[type="text"] {
        padding: 5px 10px;
        font-size: 12px;
        line-height: 1.5;
        border-radius: 3px;
        width:80%;
        color: #555;
        background-color: #fff;
        background-image: none;
        border: 1px solid #ccc;
        
        }
        
        .GridColumn1{
        grid-column-start: 1 !important; 
        grid-column-end: 1 !important;
        }
        
        .GridColumn2{
        grid-column-start: 2 !important; 
        grid-column-end: 2 !important;
        }
        
        .GridColumn3{
        grid-column-start: 3 !important; 
        grid-column-end: 3 !important;
        }
        
        .GridColumn4{
        grid-column-start: 4 !important; 
        grid-column-end: 4 !important;
        }
        
        .GridColumn5{
        grid-column-start: 5 !important; 
        grid-column-end: 5 !important;
        }
        
        
        .GridColumn6{
        grid-column-start: 6 !important; 
        grid-column-end: 6 !important;
        }
        
        .GridColumn7{
        grid-column-start: 7 !important; 
        grid-column-end: 7 !important;
        }
        
        .MethodologyLabel{
        font-weight: bold !important; 
        text-align: right !important;
        }
        
        .requiredField{
        border-left: 3px solid red !important;
        }
        
        
        
        .ui-autocomplete span.hl_results {
        background-color: #ffff66;
        }
        
        /* loading - the AJAX indicator */
        .ui-autocomplete-loading {
        background: white url('/img/loading.gif') right center no-repeat;
        }
        
        .ui-autocomplete {
        height: 200px;
        overflow-y: auto;
        /* prevent horizontal scrollbar */
        overflow-x: hidden;
        overflow:auto;
        /* add padding to account for vertical scrollbar */
        padding-right: 20px;
        left: 0;
        }
        
        .overPaid{
        color: red;
        font-weight: bold;
        }
    </style>
    
    
    <script type='text/javascript'>
    
    var NoOfMonths=1;
    var BRSFClickAddNew= false; // BRSF Onclick new Line
    var PSFClickAddNew= false; // PSF Onclick new Line
    var FCClickAddNew= false; // 3.16新增 FC Onclick new Line
    var VECClickAddNew= false;// VEC Onclick new Line
    var SubBrands =[];
    var CommercialTeam='';
    var Region='';
    var CityTier='';
    
    $(document).on('mousemove', function(e){
        $('#loadtext').css({
            left:  e.pageX,
            top:   e.pageY
        });
        
        $('input[type=text]').on('keydown', function(e) {
            if (e.which == 13) {
                e.preventDefault();
            }
        });
    });
    
    
    
    window.onload = function() {

        // if ('{!ContractSelected.ASI_CRM_CN_CTD_Monthly_Default_Date__c}' != '' || '{!ContractSelected.ASI_CRM_CN_Last_PO_version__r.ASI_CRM_CN_CTD_Monthly_Default_Date__c}' != '') {
        //     $('#CTDMothlySelect').val('CTD monthly value');
        // } 
        // else {
        //     var selectedval = $('#CTDMothlySelect option:selected').val();
        //     if (selectedval != 'V0.0') {
        //         $('#CTDMothlySelect').val('--无--');
        //     }
        // }

        // if ('{!ContractSelected.ASI_CRM_CN_Last_PO_version__r.ASI_CRM_CN_CTD_Monthly_Default_Date__c}' != '') {
        //     $('#CTDMothlySelect').attr("disabled",true);
        // }
        if ('{!ContractSelected.ASI_CRM_CN_Last_PO_version__r.ASI_CRM_CN_CTD_Monthly_Default_Date__c}' != '') {
            $('#CTDMothlySelect').find("option[id='v00']").remove();
        }

        // if ('{!ContractSelected.ASI_CRM_CN_CTD_Monthly_Default_Date__c}' != '' || '{!ContractSelected.ASI_CRM_CN_Last_PO_version__r.ASI_CRM_CN_CTD_Monthly_Default_Date__c}' != '') {
        //     $('#CTDMothlySelect').val('CTD monthly value');
        // } 
        // disabled=""
        $('input[type=text]').blur(); 
        $('input[type=text]').on('keydown', function(e) {
            if (e.which == 13) {
                e.preventDefault();
            }
        });
    };
    
    
    $(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip();  
        CommercialTeam='{!ContractSelected.ASI_CRM_CN_Outlet_WS__r.ASI_CRM_CN_Commercial_Team__c}';
        Region='{!ContractSelected.ASI_CRM_CN_Outlet_WS__r.ASI_CRM_CN_Region__c}';
        CityTier='{!ContractSelected.ASI_CRM_CN_Outlet_WS__r.ASI_CRM_CN_CCity__r.ASI_CRM_CN_City_Tier__c}';
        
        NoOfMonths = '{!ContractSelected.ASI_CRM_CN_No_of_Months__c}';
        var BrandList=document.getElementsByClassName("bPageFooter");
        for( var i=0; i<BrandList.length ; i++){
            BrandList[i].innerHTML='';
        }
        BRSFClickAddNew= false;
        CheckingVolumeBase();
        retrieveSBBrand();
    });
    
    
    
    
    //Sub-Brand
    function retrieveSBBrand(){
        var ContractSelected = '{!ContractSelected.Id}';
        var whereClause =   ' WHERE RecordType.DeveloperName = \'ASI_FOC_CN_Sub_brand\'  and ASI_CRM_CN_Sub_brand_Grade__c!=null and  ASI_MFM_Brand__r.ASI_CRM_CN_Competitor__c =FALSE and ASI_MFM_Active_for_CRM__c=TRUE  and ASI_MFM_Sub_brand_Code__c != \'999\'  '
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.ASI_CRM_CN_EditHeavyContractDetailCtrl.FindSubBrandList2nd}','ASI_MFM_Sub_brand__c', whereClause ,CommercialTeam,Region,CityTier,ContractSelected
            , callbackSBBrand
            , {escape: true}
        );       
    }
    
    
    function callbackSBBrand(result, event){
        if (event.status) {
            if (result) {
                SubBrands = [];
                var size = result.length;
                console.log(result.length);
                for (var i = 0; i < size; i++) {
                    var sb = new Object(); 
                    
                    sb.label =  htmlEncode(result[i]["Name"]);
                    sb.value =  htmlEncode(result[i]["Id"]);
                    sb.SBGradeId =  htmlEncode(result[i]["ASI_CRM_CN_Sub_brand_Grade__c"]);
                    sb.SBGrade =  htmlEncode(result[i]["ASI_CRM_CN_Sub_brand_Grade__r"]["ASI_CRM_Chinese_Name__c"]);// console.log(result[i]["ASI_CRM_CN_Sub_brand_Grade__r"]["Name"]);
                    sb.BRSFIncentive=result[i]["ASI_CRM_Incentive_Central__c"];
                    sb.BRSFMaxIncentive=result[i]["ASI_CRM_Incentive_East__c"];
                    sb.PSFIncentive=result[i]["ASI_CRM_Incentive_North__c"];
                    sb.PSFMaxIncentive=result[i]["ASI_CRM_Incentive_North_West__c"];
                    sb.FCIncentive = new Map();
                    sb.FCMaxIncentive = new Map();
                    //3.23add
                    if (result[i]["ASI_CRM_Incentive_FC__c"] !== '{}') {
                        var objStr = escape2Html(result[i]["ASI_CRM_Incentive_FC__c"]);
                        var objMap = new Map();
                        var obj = $.parseJSON(objStr);
                        for (let k of Object.keys(obj)) {
                            objMap.set(k,obj[k]);
                        }
                        sb.FCIncentive = objMap;
                    }

                    if (result[i]["ASI_CRM_MaxIncentive_FC__c"] !== '{}') {
                        var objStr = escape2Html(result[i]["ASI_CRM_MaxIncentive_FC__c"]);
                        var objMap = new Map();
                        var obj = $.parseJSON(objStr);
                        for (let k of Object.keys(obj)) {
                            objMap.set(k,obj[k]);
                        }
                        sb.FCMaxIncentive = objMap;
                    }
                    SubBrands.push(sb);
                }
                console.log('Finished initalizeAutoCompleteComponent ');
            }
        } else {
            
        }   
        initalizeAutoCompleteComponent();
    }
    
    
    function initalizeAutoCompleteComponent(){
        // SuB-Brand
        $(".SubBrandClass").autocomplete({
            source: 
            SubBrands,
            response: function(event, ui) {
                console.log('response');
                if(ui.content.length===0){ 
                    console.log("No result found");
                }
            },
            minLength: 0,
            scroll: true,
            change: function (event, ui) {
                console.log('change');
                if(!ui.item) {//this.value = '';//
                    console.log('remove!!!');
                }
            },select: function(event, ui){
                $(this).val(ui.item.label);
                $(this).next().next().children().val(ui.item.value);
                
                
                var ClassNames = $(this).attr("class"); 
                var ClassNameList = ClassNames.split(" ");
                
                var IsBRSF=false;
                var IsPSF=false;
                var IsVEC=false;


                var IsFC = false;
                
                for(var j=1;j<ClassNameList.length;j++){//console.log(ClassNameList[j]);
                    if(ClassNameList[j].indexOf('BRSFSubBrandsClass')!== -1){
                        IsBRSF=true;
                    }
                    if(ClassNameList[j].indexOf('PSFSubBrandsClass')!== -1){
                        IsPSF=true;
                    }


                    if(ClassNameList[j].indexOf('FCSubBrandsClass')!== -1){
                        IsFC=true;
                    }
                }
                
                if(ClassNameList[0].indexOf('SubBrandsClass_') !== -1){
                    var LineId= ClassNameList[0].replace('SubBrandsClass_','');
                    //changing Sub-Brand Grade
                    $('#SBGrade_'+LineId).html('<a  href="/"'+ui.item.SBGradeId+'" >'+ui.item.SBGrade +'</a>'); 
                    console.log('IsBRSF'+IsBRSF);
                    if(IsBRSF){
                        $('#ContractPerBottle_'+LineId).attr('data-Incentive',ui.item.BRSFMaxIncentive)
                        $('#ContractPerBottle_'+LineId)[0].childNodes[0].value=ui.item.BRSFIncentive;
                        $('#ContractPerBottle_'+LineId)[0].childNodes[0].style='';                        
                        if(BRSFClickAddNew){
                            $('#EstPerBottle_'+LineId)[0].textContent= formatNumber(ui.item.BRSFIncentive.toFixed(2));
                        }else{
                            $('#EstPerBottle_'+LineId)[0].childNodes[0].textContent= formatNumber(ui.item.BRSFIncentive.toFixed(2));
                        }
                    }
                    
                    if(IsPSF){
                        $('#PSFContractPerBottle_'+LineId).attr('data-Incentive',ui.item.PSFMaxIncentive)
                        $('#PSFContractPerBottle_'+LineId)[0].childNodes[0].value=ui.item.PSFIncentive;
                        $('#PSFContractPerBottle_'+LineId)[0].childNodes[0].style='';
                        
                        if(PSFClickAddNew){
                            $('#PSFEstPerBottle_'+LineId)[0].textContent= formatNumber(ui.item.PSFIncentive.toFixed(2));
                        }else{
                            $('#PSFEstPerBottle_'+LineId)[0].childNodes[0].textContent= formatNumber(ui.item.PSFIncentive.toFixed(2));
                        }
                    }
                    console.log();

                    if (IsFC) {
                        var incentive = 0.00;
                        var maxIncentive = 99999.00;
                        var tdId = $('#FCContractPerBottle_'+LineId).attr('data-Item');
                        if (ui.item.FCMaxIncentive.has(tdId)) {
                            maxIncentive = ui.item.FCMaxIncentive.get(tdId);
                        }
                        if (ui.item.FCIncentive.has(tdId)) {
                            incentive = ui.item.FCIncentive.get(tdId);
                        }
                        $('#FCContractPerBottle_'+LineId).attr('data-Incentive',maxIncentive)
                        $('#FCContractPerBottle_'+LineId)[0].childNodes[0].value=incentive;
                        $('#FCContractPerBottle_'+LineId)[0].childNodes[0].style='';
                        
                        if(FCClickAddNew){
                            $('#FCEstPerBottle_'+LineId)[0].textContent= formatNumber(incentive.toFixed(2));
                        }else{
                            $('#FCEstPerBottle_'+LineId)[0].childNodes[0].textContent= formatNumber(incentive.toFixed(2));
                        }
                    }
                }
                
                console.log(ui.item.BRSFIncentive);
                event.preventDefault();
            },
            focus: function(event, ui){//$j(this).val(ui.item.label);
                event.preventDefault();
            }
        })
        
        
    }
    
    
    
    
    //After interface with database
    function Rerender(){
        initalizeAutoCompleteComponent();
        CheckingVolumeBase();
        $('[data-toggle="tooltip"]').tooltip(); 
    }
    function InitTooltip(){
        $('[data-toggle="tooltip"]').tooltip(); 
    }
    
    
    //******************************************BRSF function******************************************
    function BRSFNewLine(){
        BRSFClickAddNew=true;
    }

    function FCChangeEstDummyTotalAmount(that){
        formatTotal(that);
        var ModuleId = that.parentElement.getAttribute('data-Item');
        // CalculateTotalInputField('FCContractTotalDummy_'+ModuleId,'FCContractTotalPart_'+ModuleId);
        CalculateTotalInputField('FCEstTotalDummy_'+ModuleId,'FCEstTotalPart_'+ModuleId);
        

        var idArr = document.getElementById('FCEstTotalPart_'+ModuleId);
        var total = idArr.childNodes[0].textContent;

        var esexceptTotalDiv = document.getElementById('Expected_FC_Est_Total_'+ModuleId);
        esexceptTotalDiv.childNodes[0].value = total;
    }
    
    
    
    function ChangingSubBrand(thatId,PSFModuleId){
        //SubBrands                                   
        var SelectedSBBrand = $('.SubBrandsClass_'+thatId).val();//console.log($('.SubBrandsClass_'+thatId).attr('class'));
        
        var ClassNames = $('.SubBrandsClass_'+thatId).attr('class'); 
        
        var ClassNameList = ClassNames.split(" ");
        
        var IsBRSF=false;
        var IsPSF=false;
        for(var j=1;j<ClassNameList.length;j++){
            if(ClassNameList[j].indexOf('BRSFSubBrandsClass')!== -1){
                IsBRSF=true;
            }
            if(ClassNameList[j].indexOf('PSFSubBrandsClass')!== -1){
                IsPSF=true;
            }
            
        }
        
        for (var i = 0; i <SubBrands.length; i++) {
            if(SubBrands[i].label ==SelectedSBBrand){
                console.log(SubBrands[i]);
                $('#SBGrade_'+thatId).html('<a  href="/"'+SubBrands[i].SBGradeId+'" >'+ SubBrands[i].SBGrade +'</a>'); 
                
                if(IsBRSF){
                    $('#ContractPerBottle_'+thatId).attr('data-Incentive',SubBrands[i].BRSFMaxIncentive)
                    $('#ContractPerBottle_'+thatId)[0].childNodes[0].value=SubBrands[i].BRSFIncentive;
                    $('#ContractPerBottle_'+thatId)[0].childNodes[0].style='';                        
                    if(BRSFClickAddNew){
                        $('#EstPerBottle_'+thatId)[0].textContent= formatNumber(SubBrands[i].BRSFIncentive.toFixed(2));
                    }else{
                        $('#EstPerBottle_'+thatId)[0].childNodes[0].textContent= formatNumber(SubBrands[i].BRSFIncentive.toFixed(2));
                    }
                    BRSFCalculation();
                }
                
                if(IsPSF){
                    $('#PSFContractPerBottle_'+thatId).attr('data-Incentive',SubBrands[i].PSFMaxIncentive)
                    $('#PSFContractPerBottle_'+thatId)[0].childNodes[0].value=SubBrands[i].PSFIncentive;
                    $('#PSFContractPerBottle_'+thatId)[0].childNodes[0].style='';
                    
                    if(PSFClickAddNew){
                        $('#PSFEstPerBottle_'+thatId)[0].textContent= formatNumber(SubBrands[i].PSFIncentive.toFixed(2));
                    }else{
                        $('#PSFEstPerBottle_'+thatId)[0].childNodes[0].textContent= formatNumber(SubBrands[i].PSFIncentive.toFixed(2));
                    }
                    PSFCalculation(PSFModuleId);
                }

                if(IsFC){
                    var incentive = 0.00;
                    var maxIncentive = 99999.00;
                    var tdId = $('#FCContractPerBottle_'+thatId).attr('data-Item');
                    if (SubBrands[i].FCMaxIncentive.has(tdId)) {
                        maxIncentive = SubBrands[i].FCMaxIncentive.get(tdId);
                    }
                    if (SubBrands[i].FCIncentive.has(tdId)) {
                        incentive = SubBrands[i].FCIncentive.get(tdId);
                    }
                    $('#FCContractPerBottle_'+thatId).attr('data-Incentive',maxIncentive)
                    $('#FCContractPerBottle_'+thatId)[0].childNodes[0].value=incentive;
                    $('#FCContractPerBottle_'+thatId)[0].childNodes[0].style='';
                    
                    if(FCClickAddNew){
                        $('#FCEstPerBottle_'+thatId)[0].textContent= formatNumber(incentive.toFixed(2));
                    }else{
                        $('#FCEstPerBottle_'+thatId)[0].childNodes[0].textContent= formatNumber(incentive.toFixed(2));
                    }
                    FCCalculation(PSFModuleId);
                }
                
            }
        }
        
    }

    String.prototype.replaceAll  = function(s1,s2){     
        return this.replace(new RegExp(s1,"gm"),s2);     
    } 
    
    function formatTotal(obj) {
        var amount = obj.value;
        amount = amount.replaceAll(',','');
        obj.value = formatNumber(Number(amount).toFixed(2));
    }
    
    function BRSFCalculation(){
        //Contract Volume
        CalculateTotalInputField('BRSFContractQtyClass','BRSFTotalContractMonthlyQty');
        //Estimate Volume
        CalculateTotalInputField('BRSFContractEstClass','BRSFTotalEstMonthlyQty');
        //Contract Incentive  //CalculateTotalInputField('BRSFContractIncentive','BRSFTotalEstBRSFPerBottle');
        //Estimate Incentive   // CalculateReadOnlyFieldAmount('BRSFEstimateIncentive','BRSFTotalContractBRSFPerBottle');
        //Contract Total 
        CalculateReadOnlyFieldAmount('BRSFContractTotal','BRSFContractTotalPart');
        //Estimate Total
        CalculateReadOnlyFieldAmount('BRSFEstimateTotal','BRSFEstTotalPart');
        
    }

    function AllPSFCalculation() {
        var LFixCost2nd = '{!psfmoduleIds}';
        LFixCost2nd.replace('[','').replace(']','');
        var idArr = LFixCost2nd.split(',');
        for (var i = idArr.length - 1; i >= 0; i--) {
            var str = idArr[i].replace('[','').replace(']','').replace(' ','');
            PSFCalculation(str);
        }
    }
    
    function PSFCalculation(ModuleId){
        CalculateTotalInputField('PSFContractMonthlyQty_'+ModuleId,'TotalPSFContractQty_'+ModuleId);
        CalculateTotalInputField('PSFEstimateMonthlyQty_'+ModuleId,'TotalPSFEstimateQty_'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFContractDummyTotalClass_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFEstDummyTotalClass_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        console.log('* Enter PSFCalculation **');
    }

    function AllFCCalculation() {
        var LFixCost2nd = '{!fcmoduleIds}';
        var idArr = LFixCost2nd.split(',');
        for (var i = idArr.length - 1; i >= 0; i--) {
            var str = idArr[i].replace('[','').replace(']','').replace(' ','');
            FCCalculation(str);
        }
    }

    function FCCalculation(ModuleId){
        CalculateTotalInputField('FCContractMonthlyQty_'+ModuleId,'TotalFCContractQty_'+ModuleId);
        
        CalculateTotalInputField('FCEstimateMonthlyQty_'+ModuleId,'TotalFCEstimateQty_'+ModuleId);
        
        CalculateReadOnlyFieldAmount('FCContractDummyTotalClass_'+ModuleId,'FCEstTotalPart_'+ModuleId);
        
        CalculateReadOnlyFieldAmount('FCEstDummyTotalClass_'+ModuleId,'FCContractTotalPart_'+ModuleId);
    }
    
    function SettingNextAmount(that){
        var CurrentAmount =that.value;
        if(!CurrentAmount){
            CurrentAmount=0;
        }//console.log(CurrentAmount);
        if(BRSFClickAddNew){
            //that.parentElement.nextSibling.textContent=formatNumber(Number(CurrentAmount).toFixed(2));
            that.parentElement.nextElementSibling.textContent=formatNumber(Number(CurrentAmount).toFixed(2));
        }else{
            //that.parentElement.nextSibling.nextSibling.childNodes[0].textContent=formatNumber(Number(CurrentAmount).toFixed(2));
            that.parentElement.nextElementSibling.nextElementSibling.childNodes[0].textContent=formatNumber(Number(CurrentAmount).toFixed(2));
        }
        // CalBRSF_ContractTotal(that.parentElement.getAttribute('data-id'));
        CalBRSF_EstTotal(that.parentElement.getAttribute('data-id'));
    }
    
    
    
    
    
    
    
    //BRSF  : base on user input to check if incentive large then mas incentive 
    function BRSFCheckOverPaid(row,that){
        var rowId = that.parentElement.getAttribute('data-id');
        var MaxIncentive = Number($('#EstPerBottle_'+rowId).attr('data-Incentive'));
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>MaxIncentive){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
    }
    
    //Calculate BRSF ContractTotal Field
    function CalBRSF_ContractTotal(rowId){    
        var ContractTotal =0.0,ContractQty=0.0,ContractPerBottle=0.0;
        ContractQty=$('#ContractQty_'+rowId)[0].childNodes[0].value;
        ContractPerBottle=$('#ContractPerBottle_'+rowId)[0].childNodes[0].value;
        
        if(!ContractQty){
            ContractQty=0;
        }
        if(!ContractPerBottle){
            ContractPerBottle=0;
        }
        if(ContractPerBottle && ContractQty){
            ContractTotal=Number(ContractQty.replace(/,/g, ''))* Number(ContractPerBottle.replace(/,/g, '')) * Number(NoOfMonths); //console.log('ContractTotal : '+ContractTotal);
            if(BRSFClickAddNew){
                $('#ContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
            }else{
                $('#ContractTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(ContractTotal.toFixed(2));
            }
        }
        CalculateReadOnlyFieldAmount('BRSFContractTotal','BRSFContractTotalPart');
    }
    
    
    
    function ChangingPSFSubBrand(ModuleID, LineId){
        ChangingPSFSubBrandActionFunction(ModuleID,LineId); 
    }
    
    
    function CalBRSF_EstTotal(rowId){
        var EstTotal =0.0;
        var EstQty=$('#EstQty_'+rowId)[0].childNodes[0].value;
        var EstPerBottle=0.0; 
        
        if(BRSFClickAddNew){
            EstPerBottle=$('#EstPerBottle_'+rowId)[0].value;
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);//console.log('log 2.3 :  : ' +  EstTotal );console.log($('#EstTotal_'+rowId)[0].textContent);
                $('#EstTotal_'+rowId)[0].textContent=formatNumber(EstTotal.toFixed(2));//'EstTotal ; 
            }
        }else{
            EstPerBottle=$('#EstPerBottle_'+rowId)[0].childNodes[0].value;
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#EstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
            }
        }
        
        CalculateTotalInputField('BRSFContractEstClass','BRSFTotalEstMonthlyQty');
        CalculateReadOnlyFieldAmount('BRSFEstimateTotal','BRSFEstTotalPart');

         var esttotal = document.getElementById('BRSFEstTotalPart');
        $('#Expected_BRSF_Est_Total')[0].childNodes[0].value=formatNumber(esttotal.childNodes[0].textContent);
    }

    function calAllBrsf() {
        var esttotal = document.getElementById('BRSFEstTotalPart');
        $('#Expected_BRSF_Est_Total')[0].childNodes[0].value=formatNumber(esttotal.childNodes[0].textContent);
    }
    
    
    function PSFNewLine(){
        PSFClickAddNew=true;
    }
    
    
    
    function ChangingVECSubBrand(that){
        ChangingVECSubBrandActionFunction(that); 
    }
    
    
    function SettingEstTotal(that){
        CalBRSF_EstTotal(that.parentElement.getAttribute('data-id'));
    }
    
    //Shared function
    function formatNumber(n) {
        return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    function CheckingVolumeBase(){    //By Sub-Brand :0; By Grade     :1; By Category  :2; By Total     :3         
        $('.VolumeBaseCls').each(function() {
            var SectionId=$(this)[0].id;
            SettingUnit(SectionId);
        });
    }
    
    
    function changingVolumeBase(that){
        SettingUnit(that.parentElement.getAttribute('id'));
    }    
    
    
    function SettingUnit (ThatId){
        var SelectSection= document.getElementById(ThatId).children[0];
        var selectOpt;
        var SelectValue;
        
        if(SelectSection){
            selectOpt = SelectSection.options; 
            SelectValue = selectOpt[SelectSection.selectedIndex].value;
        }else{
            SelectValue = document.getElementById('VB2_'+ThatId.substring(3, ThatId.length)).title;
        }
        
        
        var rowId = ThatId.substring(3, ThatId.length);
        var UnitSection = document.getElementById('UN_'+rowId).children[0];
        
        var UnitOpt ;//= UnitSection.options;
        if(UnitSection && (SelectSection || SelectValue)){
            UnitOpt = UnitSection.options;
            if(typeof UnitOpt.length != 'undefined') {
                for(var i=UnitOpt.length;i>0;i--){//console.log(i);
                    UnitOpt.remove((i-1));
                }
            }
            if(SelectValue =='By Sub-Brand'){//UnitOpt.remove(1);
                var newOption = document.createElement("option");
                newOption.text = 'Std. Btl.(标准瓶)';
                newOption.value = 'Std. Btl.';
                UnitSection.appendChild(newOption);
            }
            
            if(SelectValue =='By Category' || SelectValue=='By Total'){//UnitOpt.remove(0);
                var newOption = document.createElement("option");
                newOption.text = 'CR12 Extra Eqv.(折芝华士新境12年)';
                newOption.value = 'CR12 Extra Eqv.';
                UnitSection.appendChild(newOption);
            }
            
            if(SelectValue =='By Grade'){
                var newOption1 = document.createElement("option");
                newOption1.text = 'CR12 Extra Eqv.(折芝华士新境12年)';
                newOption1.value = 'CR12 Extra Eqv.';
                newOption1.selected =true;
                UnitSection.appendChild(newOption1);
                
                // var newOption2 = document.createElement("option");
                // newOption2.text = 'Std. Btl.(标准瓶)';
                // newOption2.value = 'Std. Btl.';
                
                // UnitSection.appendChild(newOption2);
            }
            
        }
        
        
    }
    
    
    
    //**************************PSF Function Start**************************************************************************************************************************
    
    
    //PSF Changing next amount
    function PSFChangingNextAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        
        
        //Set Estimate Volume Field 
        $('#PSFEstQty_'+rowId)[0].childNodes[0].value=that.value;
        CalPSFContractTotal(rowId);
        CalPSF_EstTotal(rowId);
        //Calculate Total Amount
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('PSFContractMonthlyQty_'+ModuleId,'TotalPSFContractQty_'+ModuleId);
        CalculateTotalInputField('PSFEstimateMonthlyQty_'+ModuleId,'TotalPSFEstimateQty_'+ModuleId);
        
        CalculateReadOnlyFieldAmount('PSFContractDummyTotalClass_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        
        CalculateReadOnlyFieldAmount('PSFEstDummyTotalClass_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
        
    }

    function FCChangingNextAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        
        
        //Set Estimate Volume Field 
        $('#FCEstQty_'+rowId)[0].childNodes[0].textContent=that.value;
        CalFCContractTotal(rowId);
        CalFC_EstTotal(rowId);
        //Calculate Total Amount
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('FCContractMonthlyQty_'+ModuleId,'TotalFCContractQty_'+ModuleId);
        CalculateTotalInputField('FCEstimateMonthlyQty_'+ModuleId,'TotalFCEstimateQty_'+ModuleId);
        
        CalculateReadOnlyFieldAmount('FCContractDummyTotalClass_'+ModuleId,'FCContractTotalPart_'+ModuleId);
        
        CalculateReadOnlyFieldAmount('FCEstDummyTotalClass_'+ModuleId,'FCEstTotalPart_'+ModuleId);
        
    }
    
    //Batch 2: Calculate Total Estimate Amount By Sub-Brand 
    function SetEstimatePSFPerBottle(that){
        var CurrentAmount =that.value;
        
        //console.log('SetEstimatePSFPerBottle  ' + CurrentAmount );
        //attr("Incentive",CurrentAmount); 
        var rowId= that.parentElement.getAttribute('data-id');
        that.parentElement.setAttribute("Incentive",CurrentAmount);
        
        
        if(PSFClickAddNew){//
            $('#PSFEstPerBottle_'+rowId)[0].textContent=that.value;
        }else{
            $('#PSFEstPerBottle_'+rowId)[0].childNodes[0].textContent= that.value;
        }
        //CalPSFContractTotal(rowId);
        CalPSF_EstTotal(rowId);
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        Cal999Line(ModuleId);
        //CalculateReadOnlyFieldAmount('PSFContractDummyTotalClass_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFEstDummyTotalClass_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
        CalculateAllPSFEstimateAmount();
    }

    function SetEstimatePSFPerBottle2nd(that){
        var CurrentAmount =that.value;
        
        //console.log('SetEstimatePSFPerBottle  ' + CurrentAmount );
        //attr("Incentive",CurrentAmount); 
        var rowId= that.parentElement.getAttribute('data-id');
        that.parentElement.setAttribute("Incentive",CurrentAmount);
        
        
        // if(PSFClickAddNew){//
        //     $('#PSFEstPerBottle_'+rowId)[0].textContent=that.value;
        // }else{
        //     $('#PSFEstPerBottle_'+rowId)[0].childNodes[0].textContent= that.value;
        // }
        //CalPSFContractTotal(rowId);
        CalPSF_EstTotal2nd(rowId);
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        Cal999Line(ModuleId);
        //CalculateReadOnlyFieldAmount('PSFContractDummyTotalClass_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFEstDummyTotalClass_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
        CalculateAllPSFEstimateAmount();
    }

    function SetEstimateFCPerBottle(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        if(FCClickAddNew){//
            $('#FCEstPerBottle_'+rowId)[0].textContent=that.value;
        }else{
            $('#FCEstPerBottle_'+rowId)[0].childNodes[0].textContent= that.value;
        }
        CalFCContractTotal(rowId);
        CalFC_EstTotal(rowId);
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateReadOnlyFieldAmount('FCContractDummyTotalClass_'+ModuleId,'FCContractTotalPart_'+ModuleId);//FCContractTotalPart_ FCContractTotalPart_
        CalculateReadOnlyFieldAmount('FCEstDummyTotalClass_'+ModuleId,'FCEstTotalPart_'+ModuleId);
    }

    function CalFC_EstTotal(rowId){
        var EstTotal =0.0;
        var EstQty=$('#FCEstQty_'+rowId)[0].childNodes[0].textContent;//console.log('Now EstQty !!:'+EstQty);
        var EstPerBottle=0.0;
        if(FCClickAddNew){
            EstPerBottle=$('#FCEstPerBottle_'+rowId)[0].textContent;
            if(EstQty && EstPerBottle){//console.log(EstQty+ 'enter FCClickAddNew  '+EstPerBottle);
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#FCEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal.toFixed(2));
            }
        }else{
            EstPerBottle=$('#FCEstPerBottle_'+rowId)[0].childNodes[0].textContent;
            if(EstQty && EstPerBottle){//console.log('enter EstPerBottle : '+EstPerBottle);
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);// console.log('Now EstTotal : '+EstTotal);
                try {
                    $('#FCEstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
                }catch(err) {
                    $('#FCEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal.toFixed(2));
                }
            }
        }
    }

    function CalFC_EstTotal2nd(rowId){
        var EstTotal =0.0;
        var EstQty=$('#FCEstQty_'+rowId)[0].childNodes[0].textContent;//console.log('Now EstQty !!:'+EstQty);
        var EstPerBottle=0.0;
        if(FCClickAddNew){
            EstPerBottle=$('#FCEstPerBottle_'+rowId)[0].value;
            if(EstQty && EstPerBottle){//console.log(EstQty+ 'enter FCClickAddNew  '+EstPerBottle);
                EstTotal=Number(EstQty.replace(/,/g, '').replace(' ','')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#FCEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal.toFixed(2));
            }
        }else{
            EstPerBottle=$('#FCEstPerBottle_'+rowId)[0].childNodes[0].value;
            if(EstQty && EstPerBottle){//console.log('enter EstPerBottle : '+EstPerBottle);
                EstTotal=Number(EstQty.replace(/,/g, '').replace(' ','')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);// console.log('Now EstTotal : '+EstTotal);
                try {
                    $('#FCEstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
                }catch(err) {
                    $('#FCEstDummyTotal_'+rowId)[0].childNodes[0].textContent= formatNumber(EstTotal.toFixed(2));
                }
            }
        }
    }

    function CalFCContractTotal(rowId){
        var ContractTotal =0.0,ContractQty=0.0,ContractPerBottle=0.0;
        
        ContractQty=$('#FCContractQty_'+rowId)[0].childNodes[0].textContent;
        ContractPerBottle=$('#FCContractPerBottle_'+rowId)[0].childNodes[0].value;
        if(ContractPerBottle && ContractQty){
            ContractTotal=Number(ContractQty.replace(/,/g, ''))* Number(ContractPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
            if(FCClickAddNew){
                $('#FCContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
            }else{
                try {
                    $('#FCContractTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(ContractTotal.toFixed(2));
                }  catch(err) {
                    $('#FCContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
                }
            }
        }
    }
    
    function Cal999Line(ModuleId){
        var AdjustAmount=0;
        var DiffMonth= Number('{!DiffMonth}');
        console.log('----DiffMonth : '+DiffMonth);
        
        $('.PSFEstimateIncentiveClass_'+ModuleId).each(function(){
            //console.log($(this).attr('data-Volume'));
            var Volume=Number( StringToNumberStr($(this).attr('data-Volume')));
            //console.log( 'PSF Incentive Now : ' + StringToNumberStr($(this).attr('Incentive') )   );//.context.textContent  Incentive 
            //var Incentive = Number( StringToNumberStr($(this).children().context.textContent));;
            var Incentive = Number( StringToNumberStr($(this).attr('Incentive') ) );;
            
            AdjustAmount += Incentive*Volume*DiffMonth;
            console.log('$$$ Calculate by Line '+ Incentive+'*'+Volume+'*'+DiffMonth);
        });
        //console.log('Now AdjustAmount : '+AdjustAmount);
        
        
        $('.AdjustmentLine_'+ModuleId).each(function(){
            // console.log('*&****AdjustmentLine_  ');
            //console.log( $(this).children().context.textContent );
            
            $(this).children().context.textContent = formatNumber(AdjustAmount.toFixed(2)) ;
        });
        
        //AdjustmentLine_
    }
    
    //Batch 2:  Calculate All PSF Estimate Amount in All Module(Read-Only // Read Module)
    function CalculateAllPSFEstimateAmount(){
        console.log('***********CalculateAllPSFEstimateAmount*********');
        var TotalAmount=0;
        $('.EstimateTotalClass').each(function(){//
            console.log( $(this).children().context.textContent );
            TotalAmount+=Number( StringToNumberStr($(this).children().context.textContent) );
        });
        
        //set Expected_PSF_Est_Total Amount  console.log($('#Expected_PSF_Est_Total')[0].childNodes[0].value+'***&&***'+TotalAmount); 
        $('#Expected_PSF_Est_Total')[0].childNodes[0].value=TotalAmount;
        PSFGrandEstimateTotal( $('#Expected_PSF_Est_Total')[0].childNodes[0]);
    }
    
    function PSFCheckEStOverPaid(row,that){
        var rowId = that.parentElement.getAttribute('data-id');
        var MaxIncentive = Number($('#PSFContractPerBottle_'+rowId).attr('data-Incentive'));
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>MaxIncentive){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
        
    }
    
    function PSFESTCheckOverPaid(row,that){
        var rowId = that.parentElement.getAttribute('data-id');
        var MaxIncentive = Number($('#PSFEstPerBottle_'+rowId).attr('data-Incentive'));
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>MaxIncentive){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
        
    }

    function VECESTCheckOverPaid(row,that){
        var rowId = that.parentElement.getAttribute('data-id');
        var MaxIncentive = Number($('#VECEstPerBottle_'+rowId).attr('data-Incentive'));
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>MaxIncentive){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
        
    }

    function FCCheckOverPaid(row,that){
        var rowId = that.parentElement.getAttribute('data-id');
        var MaxIncentive = Number($('#FCContractPerBottle_'+rowId).attr('data-Incentive'));
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>MaxIncentive){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
        
    }

    function FCESTCheckOverPaid(row,that){
        var rowId = that.parentElement.getAttribute('data-id');
        var MaxIncentive = Number($('#FCEstPerBottle_'+rowId).attr('data-Incentive'));
        var CurrentValue= currencyToFloat($(row).val());
        if(CurrentValue>MaxIncentive){
            $(row).attr('style', 'color: red;font-weight: bold;');
        }else{
            $(row).attr('style', ' ');
        }
        
    }
    
    
    //Calculate PSF Contract total
    function CalPSFContractTotal(rowId){
        var ContractTotal =0.0,ContractQty=0.0,ContractPerBottle=0.0;
        ContractQty=$('#PSFContractQty_'+rowId)[0].childNodes[0].value;
        ContractPerBottle=$('#PSFContractPerBottle_'+rowId)[0].childNodes[0].value;
        if(ContractPerBottle && ContractQty){
            ContractTotal=Number(ContractQty.replace(/,/g, ''))* Number(ContractPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
            if(PSFClickAddNew){
                $('#PSFContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
            }else{
                try {
                    $('#PSFContractTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(ContractTotal.toFixed(2));
                }  catch(err) {
                    $('#PSFContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
                }
            }
        }
    }
    
    
    
    function SettingPSFEstTotal(that){//console.log('***********SettingPSFEstTotal  ');
        CalPSF_EstTotal(that.parentElement.getAttribute('data-id'));
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('PSFEstimateMonthlyQty_'+ModuleId,'TotalPSFEstimateQty_'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFContractDummyTotalClass_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        CalculateReadOnlyFieldAmount('PSFEstDummyTotalClass_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
    }

    function SettingFCEstTotal(that){//console.log('***********SettingPSFEstTotal  ');
        CalFC_EstTotal(that.parentElement.getAttribute('data-id'));
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('FCEstimateMonthlyQty_'+ModuleId,'TotalFCEstimateQty_'+ModuleId);
        CalculateReadOnlyFieldAmount('FCContractDummyTotalClass_'+ModuleId,'FCContractTotalPart_'+ModuleId);
        CalculateReadOnlyFieldAmount('FCEstDummyTotalClass_'+ModuleId,'FCEstTotalPart_'+ModuleId);//PSFContractTotalPart  PSFEstTotalPart_
    }

    function SettingFCEstTotal2nd(that){//console.log('***********SettingPSFEstTotal  ');
        CalFC_EstTotal2nd(that.parentElement.getAttribute('data-id'));
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        // CalculateTotalInputField('FCEstimateMonthlyQty_'+ModuleId,'TotalFCEstimateQty_'+ModuleId);
        // CalculateReadOnlyFieldAmount('FCContractDummyTotalClass_'+ModuleId,'FCContractTotalPart_'+ModuleId);
        CalculateReadOnlyFieldAmount('FCEstDummyTotalClass_'+ModuleId,'FCEstTotalPart_'+ModuleId);//

        var idArr = document.getElementById('FCEstTotalPart_'+ModuleId);
        var total = idArr.childNodes[0].textContent;

        var esexceptTotalDiv = document.getElementById('Expected_FC_Est_Total_'+ModuleId);
        esexceptTotalDiv.childNodes[0].value = total;
    }
    
    
    function CalPSF_EstTotal(rowId){
        var EstTotal =0.0;
        var EstQty=$('#PSFEstQty_'+rowId)[0].textContent; //var EstQty=$('#PSFEstQty_'+rowId)[0].childNodes[0].value;//
        console.log($('#PSFEstQty_'+rowId)[0].textContent+    ' $$$ Now EstQty !!:'+EstQty);
        var EstPerBottle=0.0;
        if(PSFClickAddNew){
            EstPerBottle=$('#PSFEstPerBottle_'+rowId)[0].textContent;
            if(EstQty && EstPerBottle){//
                console.log(EstQty+ 'enter PSFClickAddNew  '+EstPerBottle);
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#PSFEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal.toFixed(2));
            }
        }else{
            EstPerBottle=$('#PSFEstPerBottle_'+rowId)[0].childNodes[0].textContent;
            if(EstQty && EstPerBottle){//
                console.log('enter EstPerBottle : '+EstPerBottle);
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);// 
                console.log('Now EstTotal : '+EstTotal);
                try {
                    $('#PSFEstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
                }catch(err) {
                    $('#PSFEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal.toFixed(2));
                }
            }
        }
    }

    function CalPSF_EstTotal2nd(rowId){
        var EstTotal =0.0;
        var EstQty=$('#PSFEstQty_'+rowId)[0].textContent; //var EstQty=$('#PSFEstQty_'+rowId)[0].childNodes[0].value;//
        console.log($('#PSFEstQty_'+rowId)[0].textContent+    ' $$$ Now EstQty !!:'+EstQty);
        var EstPerBottle=0.0;
        if(PSFClickAddNew){
            EstPerBottle=$('#PSFEstPerBottle_'+rowId)[0].value;
            if(EstQty && EstPerBottle){//
                console.log(EstQty+ 'enter PSFClickAddNew  '+EstPerBottle);
                EstTotal=parseFloat(EstQty.replace(/,/g, '').replace(' ','')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#PSFEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal.toFixed(2));
            }
        }else{
            EstPerBottle=$('#PSFEstPerBottle_'+rowId)[0].childNodes[0].value;
            if(EstQty && EstPerBottle){//
                console.log('enter EstPerBottle : '+EstPerBottle);
                EstTotal=parseFloat(EstQty.replace(/,/g, '').replace(' ','')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);// 
                console.log('Now EstTotal : '+EstTotal);
                try {
                    $('#PSFEstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
                }catch(err) {
                    $('#PSFEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal.toFixed(2));
                }
            }
        }
    }
    
    
    //Delete PSF Module
    function DeleteModule(that){
        paraDeletePSFModule(that.id);
    }
    
    
    //Setting Estimate Dummy Total Amount when changing contract total input field
    function PSFSetEstDummyTotalAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        $('#PSFEstDummyTotal_'+rowId)[0].childNodes[0].value=that.value;
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('PSFContractTotalDummy_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        CalculateTotalInputField('PSFEstTotalDummy_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
    }

    function FCSetEstDummyTotalAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        $('#FCEstDummyTotal_'+rowId)[0].childNodes[0].value=that.value;
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('FCContractTotalDummy_'+ModuleId,'FCContractTotalPart_'+ModuleId);
        CalculateTotalInputField('FCEstTotalDummy_'+ModuleId,'FCEstTotalPart_'+ModuleId);
    }
    
    
    function PSFChangeEstDummyTotalAmount(that){
        formatTotal(that);
        var ModuleId = that.parentElement.getAttribute('data-Item');
        console.log('PSFContractTotalDummy_ 1');
        // CalculateTotalInputField('PSFContractTotalDummy_'+ModuleId,'PSFContractTotalPart'+ModuleId);
        console.log('PSFEstTotalDummy_2 ');
        CalculateTotalInputField('PSFEstTotalDummy_'+ModuleId,'PSFEstTotalPart_'+ModuleId);
    }
    
    
    //**************************PSF Function End**************************************************************************************************************************
    
    //**********************Variable Event Cost Function************************************************************************************
    
    
    function VECNewLine(){
        VECClickAddNew=true;
    }
    
    
    
    //VEC Changing next amount
    function VECChangingNextAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        $('#VECEstQty_'+rowId)[0].childNodes[0].value=that.value;
        
        CalVECContractTotal(that.parentElement.getAttribute('data-id'));
        CalVEC_EstTotal(that.parentElement.getAttribute('data-id'));
        
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('VECContractQtyClass','VECTotalContractMonthlyQty');
        CalculateTotalInputField('VECEstimateQtyClass','VECContractMonthlyQtyPart');
        CalculateReadOnlyFieldAmount('VECContractTotalDummyTD','VECContractTotalPart'); 
        CalculateReadOnlyFieldAmount('VECEstimateTotalDummyTD','VECEstTotalPart');   
        
        
    }
    
    
    //Calculate VEC Contract total
    function CalVECContractTotal(rowId){
        var ContractTotal =0.0,ContractQty=0.0,ContractPerBottle=0.0;
        ContractQty=$('#VECContractQty_'+rowId)[0].childNodes[0].value;
        ContractPerBottle=$('#VECContractPerBottle_'+rowId)[0].childNodes[0].value;
        if(ContractPerBottle && ContractQty){
            ContractTotal=Number(ContractQty.replace(/,/g, ''))* Number(ContractPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
            if(VECClickAddNew){
                $('#VECContractTotal_'+rowId)[0].textContent= formatNumber(ContractTotal.toFixed(2));
            }else{
                $('#VECContractTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(ContractTotal.toFixed(2));
            }
        }
    }
    
    //batch2 VEC By Subbrand 
    function SetEstimateVECPerBottle(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');
        CalVEC_EstTotal2nd(rowId);
        
        /*if(VECClickAddNew){
            $('#VECEstPerBottle_'+rowId)[0].textContent=that.value;
        }else{
            $('#VECEstPerBottle_'+rowId)[0].childNodes[0].textContent= that.value;
        }
        CalVECContractTotal(rowId);
        
        
        var ModuleId = that.parentElement.getAttribute('data-Item');*/
        
        //CalculateReadOnlyFieldAmount('VECContractTotalDummyTD','VECContractTotalPart'); 
        CalculateReadOnlyFieldAmount('VECEstimateTotalDummyTD','VECEstTotalPart');   
        calallvecest();
    }
    
    function SettingVECEstTotal(that){
        CalVEC_EstTotal(that.parentElement.getAttribute('data-id'));
        var ModuleId = that.parentElement.getAttribute('data-Item');
        CalculateTotalInputField('VECEstimateQtyClass','VECContractMonthlyQtyPart');
        CalculateReadOnlyFieldAmount('VECContractTotalDummyTD','VECContractTotalPart'); 
        CalculateReadOnlyFieldAmount('VECEstimateTotalDummyTD','VECEstTotalPart');   
    }
    
    
    function SettingVECContractTotal(that){
        CalVECContractTotal(that.parentElement.getAttribute('data-id'));
    }
    
    function CalVEC_EstTotal2nd(rowId){
        var EstTotal =0.0;
        var EstQty=$('#VECEstQty_'+rowId)[0].textContent; //var EstQty=$('#VECEstQty_'+rowId)[0].childNodes[0].value;
        
        console.log('enter EstQty:  '+EstQty);
        
        var EstPerBottle=0.0;
        if(VECClickAddNew){
            console.log('enter VECClickAddNew : '+  '#VECEstPerBottle_'+rowId  );
            EstPerBottle=$('#VECEstPerBottle_'+rowId)[0].childNodes[0].value;// $('#VECEstPerBottle_'+rowId)[0].textContent;
            console.log($('#VECEstPerBottle_'+rowId)[0].childNodes[0].value);
            
            console.log( '111enter EstPerBottle : ' + EstPerBottle);
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#VECEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal); 
            }
        }else{
            console.log('enter 1 : ');
            EstPerBottle=$('#VECEstPerBottle_'+rowId)[0].childNodes[0].value;
            console.log('enter EstPerBottle : ' + EstPerBottle);
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#VECEstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
            }
        }
        
        
        
    }
    
    function CalVEC_EstTotal(rowId){
        var EstTotal =0.0;
        var EstQty=$('#VECEstQty_'+rowId)[0].textContent; //var EstQty=$('#VECEstQty_'+rowId)[0].childNodes[0].value;
        
        console.log('enter EstQty:  '+EstQty);
        
        var EstPerBottle=0.0;
        if(VECClickAddNew){
            console.log('enter VECClickAddNew : '+  '#VECEstPerBottle_'+rowId  );
            EstPerBottle=$('#VECEstPerBottle_'+rowId)[0].childNodes[0].value;// $('#VECEstPerBottle_'+rowId)[0].textContent;
            console.log($('#VECEstPerBottle_'+rowId)[0].childNodes[0].value);
            
            console.log( '111enter EstPerBottle : ' + EstPerBottle);
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#VECEstTotal_'+rowId)[0].textContent= formatNumber(EstTotal); 
            }
        }else{
            console.log('enter 1 : ');
            EstPerBottle=$('#VECEstPerBottle_'+rowId)[0].childNodes[0].textContent;
            console.log('enter EstPerBottle : ' + EstPerBottle);
            if(EstQty && EstPerBottle){
                EstTotal=Number(EstQty.replace(/,/g, '')) * Number(EstPerBottle.replace(/,/g, '')) * Number(NoOfMonths);
                $('#VECEstTotal_'+rowId)[0].childNodes[0].textContent=formatNumber(EstTotal.toFixed(2));
            }
        }
        
        
        
    }
    
    
    //Setting Estimate Dummy Total Amount when changing contract total input field
    function VECSetEstDummyTotalAmount(that){
        var CurrentAmount =that.value;
        var rowId= that.parentElement.getAttribute('data-id');// console.log('VECSetEstDummyTotalAmount  :  '+rowId);
        $('#VECEstDummyTotal_'+rowId)[0].childNodes[0].value=that.value;
    }
    
    
    //**********************Variable Event Cost Function End************************************************************************************
    
    
    
    //Calculate total Amount function (Input Field)
    function CalculateTotalInputField( InputFieldId,TotalDivId){
        var TotalAmount =0;
        var objArr = document.getElementsByClassName(InputFieldId);
        $.each(objArr, function() {
            TotalAmount+=Number(StringToNumberStr($(this).val()));
        });
        

        var idArr = document.getElementById(TotalDivId);
        try {
            idArr.childNodes[0].textContent= formatNumber(TotalAmount.toFixed(2));
        }catch(err) {
            idArr.textContent= formatNumber(TotalAmount.toFixed(2));
        }
        // $('.'+InputFieldId).each(function(){
        //     TotalAmount+=Number(StringToNumberStr($(this).val()));
        // });// console.log('TotalAmount  : ' + TotalAmount);
        
        // try {
        //     $('#'+TotalDivId)[0].childNodes[0].textContent= formatNumber(TotalAmount.toFixed(2));
        // }  catch(err) {
        //     $('#'+TotalDivId)[0].textContent=formatNumber(TotalAmount.toFixed(2));//console.log( $('#'+TotalDivId)[0].textContent);
        // }
    }

    function CalculateTotalInputField2nd( InputFieldId,TotalDivId){
        var TotalAmount =0;
        var objArr = document.getElementsByClassName(InputFieldId);
        $.each(objArr, function() {
            TotalAmount+=Number(StringToNumberStr($(this).val()));
        });
        

        var idArr = document.getElementById(TotalDivId);


        try {
            idArr.childNodes[0].textContent= formatNumber(TotalAmount.toFixed(2));
        }catch(err) {
            idArr.textContent= formatNumber(TotalAmount.toFixed(2));
        }

        if (TotalDivId =='VECEstTotalPart') {
            var idArr2nd = document.getElementById(TotalDivId+'2nd');
            try {
                idArr2nd.childNodes[0].value= formatNumber(TotalAmount.toFixed(2));
            }catch(err) {
                idArr2nd.value= formatNumber(TotalAmount.toFixed(2));
            }
        }
        
    }
    
    function refreshBrsf(obj) {
        console.log(obj.value);
        refreshBrsfQty(obj.value);
    }

    function calallvecest() {
        var TotalAmount=0;
        // document.getElementsByClassName('FCContractDummyTotalClass_夜店活动费用(固定)');
        // console.log('11');
        // $('.FCContractDummyTotalClass_夜店活动费用(固定)').each(function() {
        //     console.log($(this).children().context.textContent);
        // });
        var objArr = document.getElementsByClassName('VECEstimateTotalDummyTD');
        $.each(objArr, function() {
            TotalAmount+=Number(StringToNumberStr($(this).children().context.textContent));
        });
        

        var idArr = document.getElementById('VECEstTotalPart');
        try {
            idArr.childNodes[0].textContent= formatNumber(TotalAmount.toFixed(2));
        }catch(err) {
            idArr.textContent= formatNumber(TotalAmount.toFixed(2));
        }

        var idArr2nd = document.getElementById('VECEstTotalPart2nd');
        try {
            idArr2nd.childNodes[0].value= formatNumber(TotalAmount.toFixed(2));
        }catch(err) {
            idArr2nd.value= formatNumber(TotalAmount.toFixed(2));
        }
        // CalculateReadOnlyFieldAmount('VECEstimateTotalDummyTD','VECEstTotalPart');
    }
    
    //Calculate total Amount function (Output Field)
    function CalculateReadOnlyFieldAmount( FieldId,TotalDivId){
        var TotalAmount=0;
        // document.getElementsByClassName('FCContractDummyTotalClass_夜店活动费用(固定)');
        // console.log('11');
        // $('.FCContractDummyTotalClass_夜店活动费用(固定)').each(function() {
        //     console.log($(this).children().context.textContent);
        // });
        var objArr = document.getElementsByClassName(FieldId);
        $.each(objArr, function() {
            TotalAmount+=Number(StringToNumberStr($(this).children().context.textContent));
        });
        

        var idArr = document.getElementById(TotalDivId);
        try {
            idArr.childNodes[0].textContent= formatNumber(TotalAmount.toFixed(2));
        }catch(err) {
            idArr.textContent= formatNumber(TotalAmount.toFixed(2));
        }
    }
    
    
    
    
    
    //changing PSF Grand Estimate Total  
    function PSFGrandEstimateTotal(that){
        var PSFGrandEstimateTotalAmount = that.value;
        var AdjustmentAmount=Number(StringToNumberStr(that.value)) - Number(StringToNumberStr($('#PSFGrandEstimateTotalBeforeAdjustmentId')[0].childNodes[0].textContent)) ;
        console.log('PSF Grand Estimate Total'+AdjustmentAmount);
        $('#PSFAdjustmentAmountId')[0].childNodes[0].textContent= formatNumber(AdjustmentAmount.toFixed(2));
        formatTotal(that);
    }
    
    
    
    
    
    
    
    
    //******************************************************************************
    
    //remove comma
    function StringToNumberStr( i ) {
        return typeof i === 'string' ? i.replace(/\s/g, '').replace(/[\$,]/g, '')*1 : typeof i === 'number' ?   i : 0;
    };
    
    
    function htmlEncode(input){
        var e = document.createElement('div');
        e.innerHTML = input;
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }
    
    //Covered Outlet select all checkboxes
    function selectAllCheckboxes(obj,receivedInputID){
        var inputCheckBox = document.getElementsByTagName("input");                  
        for(var i=0; i<inputCheckBox.length; i++){          
            if(inputCheckBox[i].id.indexOf(receivedInputID)!=-1){                                     
                inputCheckBox[i].checked = obj.checked;
            }
        }
    }
    
    
    function currencyToFloat(currencyStr){
        if (typeof currencyStr === 'string') {
            var numStr = currencyStr.replace(/,/g, '');
            if (/^-?\d+\.?\d*$/.test(numStr)) {
                return parseFloat(numStr);
            }
        }
        return null;
    }        
    
    function CalculateAllEstimateAmount() {
        
    }
    </script>
    
    <apex:form id="EditHeavyContractDetailPageId" >
        
        
        <div class="bs ">
            
            
            
            <div class="container-fluid" >
                <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;" >
                    <div style="grid-column-start: 1; grid-column-end: 1;" >
                        <div style="font-weight: bold; font-family: Arial,Helvetica,sans-serif; color: #000; font-size: 1.3em; margin: 0.5em;">
                            {!$ObjectType.ASI_TH_CRM_Contract__c.Label} 
                        </div> 
                    </div>
                    
                    <div style="grid-column-start: 2; grid-column-end: 2;  margin-top: 0.5em;" >
                        <div>
                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_IOM_Save}" status="ActionStatus" action="{!saveItems}"
                                                oncomplete="Rerender();InitTooltip();BRSFCalculation();"
                                                reRender="EditHeavyContractDetailPageId" >
                                <apex:param name="IS_QUICK_SAVE" value="false"/>
                            </apex:commandButton>
                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_Quick_Save}" status="ActionStatus" action="{!saveItems}"
                                                oncomplete="Rerender();InitTooltip();BRSFCalculation();"
                                                reRender="EditHeavyContractDetailPageId" >
                                <apex:param name="IS_QUICK_SAVE" value="true"/>
                            </apex:commandButton>
                            <apex:commandButton styleClass="BSCommandButton"  value="{!$Label.ASI_CRM_CN_IOM_Cancel}" action="{!CancelProcess}" /> 
                        </div>
                    </div>
                </div>
                
                <div class="bs row  " >
                    <div class="col">
                        <div class="alert alert-danger " style="{!IF(UpsertPermission,'display:none;','')}"  id="SaveFailPart">
                            <div>
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                <strong>Error!</strong><br/>
                                <apex:outputText escape="false" value="{!msg}"/>
                            </div>                 
                        </div> 
                        
                        <div class="alert alert-warning fade in" style="{!IF(WarningTimes==1,'','display:none;')}"    id="SaveFailPart2">
                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                            <strong>Warning!</strong><br/>
                            <apex:outputText escape="false" value="{!WarningMsg}"/>
                        </div> 
                        
                        
                    </div>
                </div>
                
                <!-- <div class="row  ">
                    <div class="col">
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                {!$Label.ASI_CRM_CN_Contract_Fix_Cost}
                            </div>
                            <div class="panel-body" style="padding: 0.5em" >
                                
                                <div class="bs table-responsive" > 
                                    <table class="bs table table-condensed" style="margin-bottom: 0;" >
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th><apex:outputText value="{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Contract_Amount__c.Label}" /></th>
                                                <th><apex:outputText value="{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Estimate_Amount__c.Label}" /></th>
                                            </tr>
                                        </thead>
                                        <apex:variable value="{!0}" var="ContractAmount"/>
                                        <apex:variable value="{!0}" var="EstimateAmount"/>
                                        <tbody>
                                            
                                            <apex:repeat value="{!LFixCost2nd}" var="FCLine">
                                                <apex:variable var="ContractAmount" value="{!ContractAmount+FCLine.ASI_CRM_CN_Contract_Amount__c}" />  
                                                <apex:variable var="EstimateAmount" value="{!EstimateAmount+FCLine.ASI_CRM_CN_Estimate_Amount__c}" />  
                                                <tr>
                                                    <td>
                                                        <apex:outputField value="{!FCLine.Name}"  rendered="{!!showCN}" />
                                                        <apex:outputField value="{!FCLine.ASI_CRM_CN_Chinese_Description__c}"  rendered="{!showCN}" />
                                                    </td>
                                                    <td >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCLine.ASI_CRM_CN_Contract_Amount__c}"/></apex:outputText>
                                                    </td>
                                                    <td>
                                                        <apex:inputField value="{!FCLine.ASI_CRM_CN_Estimate_Amount__c}" 
                                                                         styleClass="ApexInputNumberField FixCostEstimateAmount"  onchange=" CalculateTotalInputField('FixCostEstimateAmount','FixCostTotalEstimateAmount');"/>
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                            <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                <td>{!$Label.ASI_CRM_CN_Contract_Fix_Cost}{!$Label.ASI_CRM_CN_Total_Amount} 
                                                </td>
                                                <td id="FixCostTotalContractAmount"   >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractAmount}"/></apex:outputText>
                                                </td>
                                                <td id="FixCostTotalEstimateAmount" style="padding-left: 11em; " >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!EstimateAmount}"/></apex:outputText>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div> 
                        </div>
                        
                    </div>
                </div> -->
                
                
                
                <!---------------------------BRSF------------------------------------------------------------------------>
                <apex:actionFunction action="{!refreshBrsfItem}" name="refreshBrsfQty" reRender="EditHeavyContractDetailPageId" status="ActionStatus" oncomplete="Rerender();calAllBrsf();CalculateAllPSFEstimateAmount();calallvecest();">
                    <apex:param id="SelectValue" name="SelectValue" value="" />
                </apex:actionFunction>
            
                <div class="row  ">
                    <div class="col">
                        
                        
                        <div class="panel panel-primary">
                            <div class="panel-heading" style="font-weight: bold" >
                                {!$Label.ASI_CRM_CN_VF_LABEL_BRSF}
                            </div>
                            <div class="panel-body" style="padding: 0.5em" >
                                <div class="bs table-responsive" > 
                                    
                                    <table class="bs table table-condensed" style="margin-bottom: 0; width:70%" >
                                        <tr>
                                            <td style="border-left: 1px solid #ddd;border-bottom: 1px solid #ddd; width:15%"   class="MethodologyLabel">{!$Label.ASI_CRM_CN_Key_Principle}</td>
                                            <td style="width:10%; border-left: 1px solid #ddd;border-bottom: 1px solid #ddd;" >
                                                <apex:outputField value="{!BRSFItemMap.Module.ASI_CRM_Methodology__r.Name} "  rendered="{!!showCN}" />
                                                <apex:outputField value="{!BRSFItemMap.Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} "  rendered="{!showCN}" />
                                            </td>
                                            <td  style="border-left: 1px solid #ddd;  border-right: 1px solid #ddd; border-bottom: 1px solid #ddd; width:15% "  class="MethodologyLabel" >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}</td>
                                            <td style="border-right: 1px solid #ddd;border-bottom: 1px solid #ddd; width:10% "  >
                                                {!BRSFItemMap.Module.ASI_CRM_Remark_Display__c}
                                            </td>
                                            <td  style="border-left: 1px solid #ddd;  border-right: 1px solid #ddd; border-bottom: 1px solid #ddd; width:15% "  class="MethodologyLabel" >预估销量方法</td>
                                            <td style="border-right: 1px solid #ddd;border-bottom: 1px solid #ddd; width:10% "  >
                                                <select onchange="refreshBrsf(this);" id="CTDMothlySelect" class="form-control"  style="width: 12em;" >
                                                    <option value="--无--" label="--无--"/>
                                                    <option label="V0.0" value="V0.0" id="v00"/>
                                                    <option value="CTD Monthly Volume" label="CTD Monthly Volume" id="ctdMonthly" />
                                                </select>
                                                <!-- <apex:selectList size="1"  onchange="refreshBrsf(this);"  styleClass="form-control" disabled="" style="width: 12em;" value="{!IF(ContractSelected.ASI_CRM_CN_CTD_Monthly_Default_Date__c != null || ContractSelected.ASI_CRM_CN_Last_PO_version__r.ASI_CRM_CN_CTD_Monthly_Default_Date__c != null,'CTD monthly value','V0.0')}" >
                                                    <apex:selectOption itemValue="V0.0" itemLabel="V0.0" />
                                                    <apex:selectOption  rendered="{!ContractSelected.ASI_CRM_CN_Last_PO_version__r.ASI_CRM_CN_CTD_Monthly_Default_Date__c == null}" itemValue="CTD monthly value"  itemLabel="CTD monthly value"  />
                                                </apex:selectList> -->
                                            </td>
                                            <td style="border-right: 1px solid #ddd;border-bottom: 1px solid #ddd; width:10% "  >
                                                <apex:commandButton styleClass="BSCommandButton"  
                                                                            value="刷新Module 预计销售量" 
                                                                            reRender="EditHeavyContractDetailPageId" 
                                                                            oncomplete="CalculateAllPSFEstimateAmount();Rerender();InitTooltip();calallvecest();calAllBrsf();"
                                                                            action="{!updateModuleQty}"  
                                                                            status="ActionStatus">
                                                        </apex:commandButton>
                                                <!-- <button onclick="refreshQty();" class="btn BSCommandButton">刷新Module 预计销售量</button> -->
                                            </td>
                                            <td style="border-right: 1px solid #ddd;border-bottom: 1px solid #ddd; width:10% "  >
                                                <apex:outputText value="{0,date,yyyy'-'MM'-'dd}">
                                                    <apex:param value="{!ctdmothDate}"/>
                                                </apex:outputText>
                                                <!-- <apex:outputField value="{!ContractSelected.ASI_CRM_CN_CTD_Monthly_Default_Date__c}" /> -->
                                            </td>
                                        </tr>
                                    </table>
                                    
                                </div>
                                
                                <div class="bs table-responsive" > 
                                    <table class="bs table table-condensed" style="margin-bottom: 0;padding-top: 0.5em;" >
                                        <thead>
                                            <tr>
                                                <th>{!$ObjectType.ASI_MFM_Sub_brand__c.Label}</th>
                                                <th>{!$Label.ASI_CRM_CN_Grade}</th>
                                                <th >
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                </th>
                                                <th > 
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                </th>
                                                <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_BRSF_Per_Bottle}"/></th>
                                                <th><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_BRSF_Per_Bottle}"/></th>
                                                <th>
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                </th>
                                                <th>
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                </th>
                                            </tr>
                                        </thead>
                                        
                                        <apex:variable value="{!0}" var="EstMonthlyQty"/>
                                        <apex:variable value="{!0}" var="ContractMonthlyQty"/>
                                        <apex:variable value="{!0}" var="EstBRSFPerBottle"/>
                                        <apex:variable value="{!0}" var="ContractBRSFPerBottle"/>
                                        <apex:variable value="{!0}" var="EstTotal"/>
                                        <apex:variable value="{!0}" var="ContractTotal"/>
                                        
                                        <tbody>
                                            
                                            <apex:repeat value="{!BRSFItemMap.DetailLineMap}" var="Line" >
                                                <apex:variable var="EstMonthlyQty" value="{!EstMonthlyQty+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                <apex:variable var="ContractMonthlyQty" value="{!ContractMonthlyQty+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>  
                                                <apex:variable var="EstTotal" value="{!EstTotal+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                <apex:variable var="ContractTotal" value="{!ContractTotal+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>  
                                                
                                                <tr>
                                                    <td>
                                                        <apex:outputField value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Sub_Brand__c}"  />
                                                    </td>
                                                    <td>
                                                        <apex:outputLink value="/{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__c}" >
                                                        <apex:outputText value="{!BLANKVALUE(BRSFItemMap.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c, BRSFItemMap.DetailLineMap[Line].ASI_CRM_Line_Name__c)}"/></apex:outputLink>
                                                    </td>
                                                    <td >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(BRSFItemMap.DetailLineMap[Line].ASI_CRM_Adjustment_Line__c,'','display: none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(BRSFItemMap.DetailLineMap[Line].ASI_CRM_Adjustment_Line__c,'display: none;','width:5%;')}"  id="{!'EstQty_'+Line}"   data-id="{!Line}" >
                                                    <apex:inputField value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"  onchange="SettingEstTotal(this);" 
                                                                     styleclass="ApexInputNumberField InputNumberFieldwidth requiredField BRSFContractEstClass "     ></apex:inputField>
                                                    </td> 
                                                    <td>
                                                        <!-- <apex:outputText value="{0, number, ###,###,###,###,##0.00}" 
                                                                         style="{!IF(BRSFItemMap.DetailLineMap[Line].ASI_CRM_Max_Incentive__c < BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}" >  -->
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}" 
                                                                         style="" > 
                                                            <apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                        </apex:outputText>
                                                    </td>

                                                    <td style="{!IF(BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Is_Payment_New__c,'display: none;','')}" data-Incentive="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Max_Incentive__c}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}" 
                                                                         style="{!IF(BRSFItemMap.DetailLineMap[Line].ASI_CRM_Max_Incentive__c < BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}" > 
                                                            <apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td style="{!IF(BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Is_Payment_New__c,'width:5%;','display: none;')}" id="{!'EstPerBottle_'+Line}" data-Incentive="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Max_Incentive__c}" class="BRSFEstimateIncentive"   data-id="{!Line}" >
                                                    <apex:inputField value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                     onchange="SettingNextAmount(this);BRSFCheckOverPaid($(this),this)" 
                                                                     style=""
                                                                     styleclass="ApexInputNumberField InputNumberFieldwidth BRSFContractIncentive"  > 
                                                    </apex:inputField>
                                                    </td>
                                                    <td>
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/></apex:outputText>
                                                    </td>
                                                    <td id="{!'EstTotal_'+Line}"  class="BRSFEstimateTotal"    data-id="{!Line}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/></apex:outputText>
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </tbody>
                                        <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                            <td>{!$Label.ASI_CRM_CN_VF_LABEL_BRSF}{!$Label.ASI_CRM_CN_Total_Amount} 
                                            </td>
                                            <td></td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!ContractMonthlyQty}"/></apex:outputText>
                                            </td>
                                            <td id="BRSFTotalEstMonthlyQty">
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!EstMonthlyQty}"/></apex:outputText>
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractTotal}"/></apex:outputText>
                                            </td>
                                            <td id="BRSFEstTotalPart" >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!EstTotal}"/></apex:outputText>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                
                                <div class="bs table-responsive" > 
                                    <table   style="margin-bottom: 0; width:50%; margin-top: 0.5em;" >
                                        <tr>
                                            <td style=" font-weight: bold; text-align: right; padding-top: 0.3em; padding-right: 1em;"> 
                                                {!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Expected_BRSF_Est_Total__c.Label} 
                                            </td>
                                            <td id="Expected_BRSF_Est_Total"> <apex:inputField value="{!ContractSelected.ASI_CRM_CN_Expected_BRSF_Est_Total__c}" styleClass="ApexInputNumberField" onchange="formatTotal(this);"/></td>
                                        </tr>
                                    </table>
                                </div>
                                
                            </div> 
                        </div>
                        
                    </div>
                </div>
                
                
                
                <apex:actionFunction name="paraDeletePSFModule" action="{!DeletePSFModule}" rerender="PSFPanel"  status="ActionStatus"   oncomplete="CalculateAllPSFEstimateAmount();">       
                    <apex:param id="PARAMID" name="PARAMID" value="" />
                </apex:actionFunction>  
                
                <!--------------------------------------------------------------------------------PSF-------------------------------------------------------------------->
                
                <div class="row  " style="padding-top: 1em;">
                    <div class="col">
                        <apex:outputPanel id="PSFPanel">
                            <apex:actionFunction name="ChangingPSFSubBrandActionFunction" action="{!PSFChangingSB}" rerender="PSFPanel"  status="ActionStatus"   >       
                                <apex:param name="PARAM_Module_ID" value="" />
                                <apex:param name="PARAM_Line_ID" value="" />
                            </apex:actionFunction>  
                            <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                                <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  > {!$Label.ASI_CRM_CN_VF_LABEL_PSF} </div>
                                <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                    <div style="margin-left: 5em;" >
                                        <apex:commandButton styleClass="BSCommandButton" 
                                                            rendered="{!ContractSelected.ASI_CRM_CN_Group_Contract__c ==null}"
                                                            value="{!$Label.ASI_CRM_CN_Add_New_Module}"
                                                            reRender="PSFPanel"
                                                            oncomplete="Rerender();"
                                                            action="{!PSFAddModule}" 
                                                            status="ActionStatus"  />
                                    </div> 
                                </div>
                            </div>
                            <div class="PanelBody" >
                                <apex:variable value="{!0}" var="i"/>
                                <apex:repeat value="{!PSF_Item_Map}"  var="itm" id="PSFitem" >
                                    
                                    
                                    <apex:variable var="i" value="{!i+1}"/>
                                    
                                    <apex:outputPanel rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Created_PO_Version__c==ContractSelected.ASI_CRM_CN_PO_Version__c}" >
                                        <div class="panel panel-primary" >
                                            <div class="panel-heading">{!$Label.ASI_CRM_CN_Module}-{!i}
                                                <span id="{!itm}" class="pull-right clickable" data-effect="fadeOut"   
                                                      onclick="DeleteModule(this);InitTooltip();" oncomplete="CalculateAllPSFEstimateAmount();InitTooltip();"  >
                                                    <i class="fa fa-times"></i>
                                                </span> 
                                            </div>
                                            <div class="panel-body">
                                                <div style="display: grid; grid-template-columns: 15% 30% 10% 10% 10% 15%; grid-template-rows: auto;" >
                                                    <div style="padding: 1em;"  class="GridColumn1" >
                                                        <div class="MethodologyLabel" >
                                                            <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Key_Principle_Help_text}"  >{!$Label.ASI_CRM_CN_Key_Principle} <i class="fa fa-info-circle" aria-hidden="true"></i> </span>
                                                        </div> 
                                                    </div>
                                                    <div  class="GridColumn2"   >
                                                        <div style="{!IF(IsGroupContract,'display:none;','')}"  >
                                                            <apex:selectList size="1"  styleClass="form-control" style="width: 25em;" value="{!PSF_Item_Map[itm].MethodologyValue}">
                                                                <apex:selectOptions value="{!DisplayMethod.PSFMethod}" />
                                                            </apex:selectList> 
                                                        </div>
                                                        <div style="{!IF(IsGroupContract,'padding-right: 1em;padding-top: 1em;padding-bottom: 1em;','display:none;')}"  >
                                                            {!PSF_Item_Map[itm].MethodologyDisplay} 
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn3"  >
                                                        <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                            <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Volume_Base_Help_text}"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i> </span>
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn4"  >
                                                        <div class="VolumeBaseCls" id="{!'VB_'+itm}" style="{!IF(PSF_Item_Map[itm].HaveRefresh,'display:none;','')}"   >                       
                                                            <apex:selectList size="1" onchange="changingVolumeBase(this);" styleClass="form-control" style="width: 10em;" 
                                                                             rendered="{!!PSF_Item_Map[itm].HaveRefresh}"
                                                                             value="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}" >
                                                                <apex:selectOptions value="{!VolumeBasePickList}" />
                                                            </apex:selectList>   
                                                        </div>
                                                        <!-- <div style="{!IF(PSF_Item_Map[itm].HaveRefresh,'padding-right: 1em; padding-top: 0.6em;','display:none;')}"  >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}"/>
                                                        </div> -->
                                                        <div id="{!'VB2_'+itm}" style="{!IF(PSF_Item_Map[itm].HaveRefresh,'padding-right: 1em; padding-top: 0.6em;','display:none;')}" title="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}" >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}"/>
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn5"   >
                                                        <div class="MethodologyLabel"  style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                            <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Unit_Help_text}"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i></span>
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn6"   >
                                                        <div id="{!'UN_'+itm}"   >
                                                            <apex:selectList size="1"   styleClass="form-control" style="width: 17em;" 
                                                                             value="{!PSF_Item_Map[itm].Module.ASI_CRM_Unit__c}" 
                                                                             rendered="{! !PSF_Item_Map[itm].HaveRefresh || PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Grade'}">
                                                                <!-- <apex:selectOption rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'}" itemValue="Std. Btl."  itemLabel="Std. Btl.(标准瓶)" /> -->
                                                                <apex:selectOption itemValue="Std. Btl."  itemLabel="Std. Btl.(标准瓶)" />
                                                                <apex:selectOption itemValue="CR12 Extra Eqv."  itemLabel="CR12 Extra Eqv.(折芝华士新境12年)"  />
                                                            </apex:selectList>   
                                                        </div>
                                                        <div style="{!IF(PSF_Item_Map[itm].HaveRefresh && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Grade','padding-right: 1em; padding-top: 0.6em;','display:none;')}"  >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Unit__c}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div style="display: grid; grid-template-columns: 10% 20% 10% 20% 20% 20%; grid-template-rows: auto;" >
                                                    <div class="GridColumn1" >
                                                        <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                            <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Remark_Help_text}"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i></span>
                                                        </div>
                                                    </div>
                                                    <div class="GridColumn2" style="padding-top: 0.3em;" > <!------------ style="width: 10em;" -------------->
                                                        <apex:inputfield value="{!PSF_Item_Map[itm].Module.ASI_CRM_Remark_Options__c}" styleClass="form-control  input-sm"   />
                                                    </div>
                                                    <div class="GridColumn3" style="padding-top: 0.3em;" >
                                                        <apex:inputText value="{!PSF_Item_Map[itm].Module.ASI_CRM_Remark__c}"  styleClass="form-control  input-sm"   />
                                                    </div>
                                                    <div class="GridColumn4" style="padding-top: 0.3em;" >
                                                        <apex:commandButton styleClass="BSCommandButton"  
                                                                            value="{!$Label.ASI_CRM_CN_Refresh}" 
                                                                            reRender="PSFPanel" 
                                                                            oncomplete="CalculateAllPSFEstimateAmount();Rerender();InitTooltip();PSFCalculation('{itm}');"
                                                                            action="{!RefreshPSFModule}"
                                                                            status="ActionStatus">
                                                            <apex:param name="PARAM_Line_ID" value="{!itm}" />
                                                        </apex:commandButton>
                                                    </div>
                                                    <div class="GridColumn5" style="padding-top: 0.3em;" >
                                                        <apex:commandButton styleClass="BSCommandButton"  
                                                                            value="{!$Label.ASI_CRM_CN_Reset}" 
                                                                            reRender="PSFPanel" 
                                                                            oncomplete="CalculateAllPSFEstimateAmount();Rerender();InitTooltip();PSFCalculation('{itm}');"
                                                                            action="{!ResetPSFDetails}"  
                                                                            status="ActionStatus">
                                                            <apex:param name="PARAM_Line_ID" value="{!itm}" />
                                                        </apex:commandButton>
                                                    </div>
                                                    <div class="GridColumn6"><div></div></div>
                                                </div>
                                                
                                                <apex:outputPanel rendered="{!PSF_Item_Map[itm].HaveRefresh }" >
                                                    <table class="bs table table-condensed" style="margin-bottom: 0;"  >
                                                        <thead>
                                                            <tr>
                                                                <th  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  "  >
                                                                </th>
                                                                <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:20%;')}  " >{!$ObjectType.ASI_MFM_Sub_brand__c.Label}</th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >{!$Label.ASI_CRM_CN_Grade}</th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                                                </th>
                                                                <th>                                                               
                                                                    <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" > 
                                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                                                    </span>
                                                                    <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" > 
                                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                                    </span>
                                                                </th>
                                                                <th> 
                                                                    <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                                    </span>
                                                                    <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                                    </span>
                                                                    <br/>
                                                                </th>
                                                                
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                                </th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                                </th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_PSF_Per_Bottle}"/>
                                                                </th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_PSF_Per_Bottle}"/>
                                                                </th>
                                                                <th>
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                                </th>
                                                                <th>
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                                </th>
                                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                    <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_Key_Sub_brand__c.Label}"/>
                                                                </th> 
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <apex:variable value="{!0}" var="PSFEstMonthlyQty"/>
                                                            <apex:variable value="{!0}" var="PSFContractMonthlyQty"/>
                                                            <apex:variable value="{!0}" var="PSFEstTotalQTY"/>
                                                            <apex:variable value="{!0}" var="PSFContractTotalQTY"/>
                                                            <apex:variable value="{!0}" var="PSFEstTotalQTYCR12"/>
                                                            <apex:variable value="{!0}" var="PSFContractTotalQTYCR12"/>
                                                            <apex:variable value="{!0}" var="PSFEstBRSFPerBottle"/>
                                                            <apex:variable value="{!0}" var="PSFContractBRSFPerBottle"/>
                                                            <apex:variable value="{!0}" var="PSFEstTotal"/>
                                                            <apex:variable value="{!0}" var="PSFContractTotal"/>
                                                            
                                                            <apex:repeat value="{!PSF_Item_Map[itm].DetailLineMap}"  var="line" id="lineItem" >
                                                                
                                                                <apex:variable var="PSFEstMonthlyQty" 
                                                                               value="{!PSFEstMonthlyQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c!=null}" />
                                                                <apex:variable var="PSFContractMonthlyQty" 
                                                                               value="{!PSFContractMonthlyQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c!=null}"/>
                                                                
                                                                <apex:variable var="PSFEstTotalQTY" 
                                                                               value="{!PSFEstTotalQTY+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c!=null}" />
                                                                
                                                                <apex:variable var="PSFContractTotalQTY" 
                                                                               value="{!PSFContractTotalQTY+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c!=null}"/> 
                                                                
                                                                <apex:variable var="PSFEstTotalQTYCR12" value="{!PSFEstTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>
                                                                <apex:variable var="PSFContractTotalQTYCR12" value="{!PSFContractTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/> 
                                                                
                                                                <apex:variable var="PSFEstBRSFPerBottle" 
                                                                               value="{!PSFEstBRSFPerBottle+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c!=null}"/>  
                                                                <apex:variable var="PSFContractBRSFPerBottle" 
                                                                               value="{!PSFContractBRSFPerBottle+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c!=null}"/>
                                                                <apex:variable var="PSFEstTotal" 
                                                                               value="{!PSFEstTotal+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c!=null}" />  
                                                                <apex:variable var="PSFContractTotal" 
                                                                               value="{!PSFContractTotal+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}" 
                                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c!=null}"/>
                                                                
                                                                <tr>
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  ">
                                                                        
                                                                        <apex:commandLink styleClass="bs btn btn-default btn-round pull-left btn-sm"
                                                                                          style="border: none;background-color: transparent;"
                                                                                          reRender="PSFPanel" rendered="{!!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Adjustment_Line__c}"
                                                                                          oncomplete="Rerender();InitTooltip();PSFCalculation('{itm}');"
                                                                                          action="{!RemovePSFLine}"
                                                                                          status="ActionStatus">
                                                                            <span class="bs glyphicon glyphicon-trash"  style="color:red;font-size: 20px;"></span>
                                                                            <apex:param name="PARAM_item_ID" value="{!itm}" />
                                                                            <apex:param name="PARAM_Unit_ID" value="{!PSF_Item_Map[itm].Module.ASI_CRM_Unit__c}" />
                                                                            <apex:param name="PARAM_Line_ID" value="{!line}" />
                                                                        </apex:commandLink>
                                                                    </td>
                                                                    <td > 
                                                                        <div  class="style-1" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:20%;')}  " >
                                                                            <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}" ></apex:outputField>
                                                                        </div>
                                                                        <div  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                            <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">
                                                                                {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                                        </div>
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                            <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Product_Category__c}">
                                                                                {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                                        </div>
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                            {!$Label.ASI_CRM_CN_By_Total}
                                                                        </div>
                                                                    </td>
                                                                    <td id="{!'SBGrade_'+line}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%;')}  " >
                                                                        <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c} 
                                                                        </apex:outputLink>
                                                                    </td>
                                                                    <td >
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" data-Item="{!itm}"   data-id="{!line}"   id="{!'PSFContractQty_'+line}"  >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                                        </div>
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                        </div>
                                                                    </td>
                                                                    <td >
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  
                                                                             class="PSFEstimateVolumeClass"   data-Item="{!itm}"   data-id="{!line}"    id="{!'PSFEstQty_'+line}"  >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText>
                                                                        </div>
                                                                        
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                        </div>
                                                                    </td> 
                                                                    
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: left; padding-right: 2em; ','display:none;')}"    >
                                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                    </td>
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: left; padding-right: 2em; ','display:none;')}" >
                                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                    </td>
                                                                    
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"   data-id="{!line}"  
                                                                        data-Incentive="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c}"  data-Item="{!itm}"  
                                                                        id="{!'PSFContractPerBottle_'+line}"  >
                                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                                        </apex:outputText>
                                                                    </td>
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.9em; padding-right: 2em; ','display:none;')}" 
                                                                        data-id="{!line}" data-Volume="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"
                                                                        id="{!'PSFEstPerBottle_'+line}"   data-Item="{!itm}" class="{!'PSFEstimateIncentiveClass_'+itm}"  
                                                                        Incentive="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" data-Incentive="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c}">
                                                                        <apex:inputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                                         onchange="SetEstimatePSFPerBottle2nd(this); PSFESTCheckOverPaid($(this),this);"  
                                                                                         rendered="{!!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Adjustment_Line__c}"
                                                                                         style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c<PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}"
                                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'PSFEstimateIncentive_'+itm} "    >
                                                                        </apex:inputField>
                                                                        <apex:outputText value="0.00" rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Adjustment_Line__c}"  />
                                                                    </td>
                                                                    <td>
                                                                        <div data-Item="{!itm}"  data-id="{!line}"  id="{!'PSFContractDummyTotal_'+line}"> <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                                    </apex:outputText>
                                                                        </div>
                                                                    </td>
                                                                    <td class="" >
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" 
                                                                             data-Item="{!itm}"   data-id="{!line}"   id="{!'PSFEstDummyTotal_'+line}"  >
                                                                            <apex:inputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"  
                                                                                             onchange="PSFChangeEstDummyTotalAmount(this);CalculateAllPSFEstimateAmount();"  
                                                                                             styleclass="ApexInputNumberField InputNumberFieldwidth {!'PSFEstTotalDummy_'+itm}"    />
                                                                        </div> 
                                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.9em; padding-right: 2em; ','display:none;')}"  
                                                                             id="{!'PSFEstTotal_'+line}" class="{!'PSFEstDummyTotalClass_'+itm}  {!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Adjustment_Line__c,'AdjustmentLine_'+itm ,'')} " >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                                <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/></apex:outputText>
                                                                        </div>
                                                                    </td>
                                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%; ')}"  >
                                                                        <apex:inputfield value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Key_Sub_brand__c}"   />
                                                                    </td>
                                                                </tr>
                                                            </apex:repeat>
                                                            
                                                            <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                                <td colspan="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','1','2')} " >{!$Label.ASI_CRM_CN_VF_LABEL_PSF} {!$Label.ASI_CRM_CN_Total_Amount} 
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                </td>
                                                                <td id="{!'TotalPSFContractQty_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFContractMonthlyQty}"/></apex:outputText>
                                                                </td>
                                                                <td id="{!'TotalPSFEstimateQty_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFEstMonthlyQty}"/></apex:outputText>
                                                                </td>
                                                                <td  id="{!'PSFContractTotalQTY_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotalQTY}"/></apex:outputText>
                                                                </td>
                                                                <td id="{!'PSFEstTotalQTY_'+itm}" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotalQTY}"/></apex:outputText>
                                                                </td>
                                                                <td  id="{!'TotalPSFContractTotalQTYCR12_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotalQTYCR12}"/></apex:outputText>
                                                                </td>
                                                                <td id="{!'TotalPSFEstTotalQTYCR12_'+itm}" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotalQTYCR12}"/></apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                </td>
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','display:none;')}  ">
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','')}"   id="{!'PSFContractTotalPart'+itm}"  >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotal}"/></apex:outputText>
                                                                </td>
                                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;',' ')}" 
                                                                    id="{!'PSFEstTotalPart_'+itm}" class="EstimateTotalClass"  >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotal}"/></apex:outputText>
                                                                </td>
                                                                <td></td>
                                                            </tr>
                                                        </tbody>
                                                        
                                                    </table>
                                                </apex:outputPanel>
                                                
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                    
                                    <br/>
                                    <apex:outputPanel rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Created_PO_Version__c!=ContractSelected.ASI_CRM_CN_PO_Version__c && psfSize[itm] > 0}">
                                        <div style="display: grid; grid-template-columns: 10% 90% ; grid-template-rows: auto; padding-top:0.5em;"   >
                                            <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;font-weight: bold;"  >  {!$Label.ASI_CRM_CN_Module}-{!i}</div>
                                            <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                            </div> 
                                        </div>
                                        <div class="PanelBody" >
                                            <div class="bs table-responsive" >
                                                
                                                <table class="bs table table-condensed" style="margin-bottom: 0; width:70%" >
                                                    <tr>
                                                        <td style=" border-left: 1px solid #ddd;"   class="MethodologyLabel">{!$Label.ASI_CRM_CN_Key_Principle} </td>
                                                        <td style="border-right: 1px solid #ddd;">
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name}"  rendered="{!!showCN}" />
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} "  rendered="{!showCN}" />
                                                        </td>
                                                        <td  style=" "  class="MethodologyLabel" >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                                        <td style=" border-right: 1px solid #ddd;"  >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}"/>
                                                        </td>
                                                        
                                                        <td  style=" "  class="MethodologyLabel">{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label} </td>
                                                        <td style="border-right: 1px solid #ddd;"   >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Unit__c}"/>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style=" border-left: 1px solid #ddd;border-bottom: 1px solid #ddd;"  class="MethodologyLabel"  >
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label} 
                                                        </td>
                                                        <td style=" border-left: 1px solid #ddd; border-right: 1px solid #ddd;border-bottom: 1px solid #ddd;"  colspan="5" > 
                                                            {!PSF_Item_Map[itm].Module.ASI_CRM_Remark_Display__c} 
                                                        </td>
                                                        
                                                    </tr>
                                                    
                                                </table>
                                                
                                            </div>
                                            
                                            <div class="bs table-responsive"  style="padding-top: 0.5em;"> 
                                                <table class="bs table table-condensed" style="margin-bottom: 0; "  >
                                                    <thead>
                                                        <tr>
                                                            <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','width:20%','display:none;')}  " >
                                                                {!$ObjectType.ASI_MFM_Sub_brand__c.Label}
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >{!$Label.ASI_CRM_CN_Grade}</th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</th>
                                                            <th> 
                                                                <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" > 
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/> </span>
                                                                <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                                </span>
                                                            </th>
                                                            <th> 
                                                                <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                                </span>
                                                                <span style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                                </span>
                                                                <br/>
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                            </th>
                                                            
                                                            <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_PSF_Per_Bottle}"/>
                                                            </th>
                                                            <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_PSF_Per_Bottle}"/>
                                                            </th>
                                                            <th>
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                            </th>
                                                            <th>
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                            </th>
                                                            <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_Key_Sub_brand__c.Label}"/>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <apex:variable value="{!0}" var="PSFEstMonthlyQty"/>
                                                        <apex:variable value="{!0}" var="PSFContractMonthlyQty"/>
                                                        <apex:variable value="{!0}" var="PSFEstTotalQty"/>
                                                        <apex:variable value="{!0}" var="PSFContractTotalQty"/>
                                                        <apex:variable value="{!0}" var="PSFEstBRSFPerBottle"/>
                                                        <apex:variable value="{!0}" var="PSFContractBRSFPerBottle"/>
                                                        <apex:variable value="{!0}" var="PSFEstTotalQTYCR12"/>
                                                        <apex:variable value="{!0}" var="PSFContractTotalQTYCR12"/>
                                                        <apex:variable value="{!0}" var="PSFEstTotal"/>
                                                        <apex:variable value="{!0}" var="PSFContractTotal"/>
                                                        
                                                        <apex:repeat value="{!PSF_Item_Map[itm].DetailLineMap}"  var="line" id="PSFlineItem2" >
                                                            <apex:variable var="PSFEstMonthlyQty" value="{!PSFEstMonthlyQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                            <apex:variable var="PSFContractMonthlyQty" value="{!PSFContractMonthlyQty+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>  
                                                            
                                                            <apex:variable var="PSFContractTotalQty" 
                                                                           rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c!=null}"
                                                                           value="{!PSFContractTotalQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>
                                                            <apex:variable var="PSFEstTotalQty" 
                                                                           rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c!=null}"
                                                                           value="{!PSFEstTotalQty+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>
                                                            <apex:variable var="PSFEstTotalQTYCR12" value="{!PSFEstTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>  
                                                            <apex:variable var="PSFContractTotalQTYCR12" value="{!PSFContractTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>  
                                                            <apex:variable var="PSFEstTotal" value="{!PSFEstTotal+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>  
                                                            <apex:variable var="PSFContractTotal" value="{!PSFContractTotal+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>                                                        
                                                            
                                                            <tr>
                                                                <td>
                                                                    <div  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                        <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}" />
                                                                    </div>
                                                                    <div  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                        <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}</apex:outputLink>
                                                                    </div>
                                                                    <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                        <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Product_Category__c}" />
                                                                    </div>
                                                                    <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                        {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Volume_Base__c}
                                                                    </div>
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <!-- <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}</apex:outputLink> -->
                                                                    <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                                    <!-- <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}" /> -->
                                                                </td>
                                                                
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                                </td>
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <div style=""  
                                                                             class="PSFEstimateVolumeClass"   data-Item="{!itm}"   data-id="{!line}"    id="{!'PSFEstQty_'+line}"  >
                                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText>
                                                                        </div>
                                                                        
                                                                </td>
                                                                
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                </td>
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                </td>

                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                </td>
                                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display: none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}" 
                                                                                     style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c < PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}"  >
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                                    </apex:outputText>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Is_Payment_New__c,'width:5%;','display: none;')}" data-id="{!line}" data-Volume="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"
                                                                        id="{!'PSFEstPerBottle_'+line}"   data-Item="{!itm}" class="{!'PSFEstimateIncentiveClass_'+itm}"  
                                                                        Incentive="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" data-Incentive="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c}">
                                                                        <apex:inputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                                         onchange="SetEstimatePSFPerBottle2nd(this); PSFESTCheckOverPaid($(this),this);"  
                                                                                         rendered="{!!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Adjustment_Line__c}"
                                                                                         style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c<PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}"
                                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'PSFEstimateIncentive_'+itm} "    >
                                                                        </apex:inputField>
                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && !PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Is_Payment_New__c,'','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}" 
                                                                                     style=""  >
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                <!-- <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                                    </apex:outputText>
                                                                </td> -->
                                                                <td >
                                                                    <div data-Item="{!itm}"  data-id="{!line}"  id="{!'PSFContractDummyTotal_'+line}"> <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                                    </apex:outputText>
                                                                </div>
                                                                    
                                                                </td>
                                                                <td >
                                                                    <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="{!'PSFEstTotal_'+line}" class="{!'PSFEstDummyTotalClass_'+itm}"><apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                                    </apex:outputText></div>
                                                                    
                                                                    <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" 
                                                                             data-Item="{!itm}"   data-id="{!line}"   id="{!'PSFEstDummyTotal_'+line}"  >
                                                                             <apex:inputField onchange="PSFChangeEstDummyTotalAmount(this);CalculateAllPSFEstimateAmount();"  
                                                                                             styleclass="ApexInputNumberField InputNumberFieldwidth {!'PSFEstTotalDummy_'+itm}"  value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                                    </div>
                                                                    
                                                                </td>
                                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%; ')}"  >
                                                                    
                                                                    <div style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Key_Sub_brand__c,'','display:none;')}"   >
                                                                        <input name="chkBox_1" type="checkbox"  value="1" disabled="true" checked="true" />
                                                                    </div>
                                                                    <div style="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Key_Sub_brand__c,'display:none;','')}"   >
                                                                        <input name="chkBox_1" type="checkbox"  value="1" disabled="true"   />
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </apex:repeat>
                                                        

                                                        <!-- <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                                <td colspan="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','1','2')} " >{!$Label.ASI_CRM_CN_VF_LABEL_PSF} {!$Label.ASI_CRM_CN_Total_Amount} 
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                </td>
                                                                <td id="{!'TotalPSFContractQty_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFContractMonthlyQty}"/></apex:outputText>
                                                                </td>
                                                                <td id="{!'TotalPSFEstimateQty_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFEstMonthlyQty}"/></apex:outputText>
                                                                </td>
                                                                <td  id="{!'PSFContractTotalQTY_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotalQTY}"/></apex:outputText>
                                                                </td>
                                                                <td id="{!'PSFEstTotalQTY_'+itm}" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotalQTY}"/></apex:outputText>
                                                                </td>
                                                                <td  id="{!'TotalPSFContractTotalQTYCR12_'+itm}"  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotalQTYCR12}"/></apex:outputText>
                                                                </td>
                                                                <td id="{!'TotalPSFEstTotalQTYCR12_'+itm}" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotalQTYCR12}"/></apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                </td>
                                                                <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','display:none;')}  ">
                                                                </td>
                                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','')}"   id="{!'PSFContractTotalPart'+itm}"  >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotal}"/></apex:outputText>
                                                                </td>
                                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;',' ')}" 
                                                                    id="{!'PSFEstTotalPart_'+itm}" class="EstimateTotalClass"  >
                                                                    <apex:inputField value="{!PSFEstTotal}"
                                                                    styleclass="ApexInputNumberField InputNumberFieldwidth" />
                                                                </td>
                                                                <td></td>
                                                            </tr> -->
                                                        <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                            <td>{!$Label.ASI_CRM_CN_Total_Amount} 
                                                            </td>
                                                            <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                            </td>
                                                            <td id="{!'TotalPSFContractQty_'+itm}" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFContractMonthlyQty}"/></apex:outputText>
                                                            </td>
                                                            <td id="{!'TotalPSFEstimateQty_'+itm}" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFEstMonthlyQty}"/></apex:outputText>
                                                            </td>
                                                            <td id="{!'PSFContractTotalQTY_'+itm}" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFContractTotalQty}"/></apex:outputText>
                                                            </td>
                                                            <td id="{!'PSFEstTotalQTY_'+itm}" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!PSFEstTotalQty}"/></apex:outputText>
                                                            </td>
                                                            <td id="{!'TotalPSFContractTotalQTYCR12_'+itm}" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotalQTYCR12}"/></apex:outputText>
                                                            </td>                                                            
                                                            <td id="{!'TotalPSFEstTotalQTYCR12_'+itm}" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotalQTYCR12}"/></apex:outputText>
                                                            </td>
                                                            <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                            </td>
                                                            <td  style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','display:none;')}  ">
                                                            </td>
                                                            <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','')}"   id="{!'PSFContractTotalPart'+itm}"  > 
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFContractTotal}"/></apex:outputText>
                                                            </td>
                                                            <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;',' ')}" 
                                                                    id="{!'PSFEstTotalPart_'+itm}" class="EstimateTotalClass"  >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!PSFEstTotal}"/></apex:outputText>
                                                                    <!-- <input type="text"  value="{!PSFEstTotal
                                                                }" class="ApexInputNumberField InputNumberFieldwidth" /> -->
                                                                </td>
                                                            <td></td>
                                                        </tr>
                                                        
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        
                                    </apex:outputPanel>
                                    
                                    <br/>
                                    
                                </apex:repeat>
                                
                                
                                
                                <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto; padding-top:0.5em;"   >
                                    <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;font-weight: bold;"  >
                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Adjustment_and_Grand_Total}"/>
                                    </div>
                                    <div style="grid-column-start: 2; grid-column-end: 2;  " ></div> 
                                </div>
                                <div class="PanelBody" style="width:70%" >
                                    <div class="bs table-responsive" > 
                                        <table class="bs table table-condensed" style="margin-bottom: 0; width:100%" >
                                            <tr>
                                                <td class="PSFAdjLabel" >
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_V0_PSF_Contract_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em;" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_V0_PSF_Contract_Total__c}"/></apex:outputText>
                                                </td>
                                                <td class="PSFAdjLabel"  >
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Expected_V0_PSF_Estimated_Total__c.Label}"/>
                                                </td>
                                                <td > 
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_Expected_V0_PSF_Estimated_Total__c}"/></apex:outputText>
                                                </td>
                                            </tr>
                                            
                                            <tr>
                                                <td></td>
                                                <td ></td>
                                                <td class="PSFAdjLabel" >
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Previous_Version_PSF_Est_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em; " id="PSFGrandEstimateTotalBeforeAdjustmentId"  > 
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_Previous_Version_PSF_Est_Total__c}"/></apex:outputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="PSFAdjLabel" ></td>
                                                <td style="padding-top: 0.8em;" ></td>
                                                <td  class="PSFAdjLabel" > 
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Adjustment}"/>
                                                </td>
                                                <td id="PSFAdjustmentAmountId">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!ContractSelected.ASI_CRM_PSF_Estimate_Adjustment_Amount__c}"/>
                                                    </apex:outputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="PSFAdjLabel" ></td>
                                                <td></td>
                                                <td  class="PSFAdjLabel" >
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Expected_PSF_Est_Total}"/>
                                                </td>
                                                <td  id="Expected_PSF_Est_Total"  style="{!IF(SizeOfPSFMap > 0 ,'','display:none;')}" >
                                                    <apex:inputField value="{!ContractSelected.ASI_CRM_CN_Expected_PSF_Est_Total__c}"
                                                                     onchange="PSFGrandEstimateTotal(this);"  styleClass="ApexInputNumberField" />
                                                </td>
                                                <td  style="{!IF(SizeOfPSFMap > 0 ,'display:none;','')}"  >
                                                    0.00
                                                </td>
                                            </tr>
                                            
                                            
                                        </table>
                                    </div>
                                </div> 
                                
                                
                            </div>
                            
                        </apex:outputPanel>
                    </div>
                </div>
                
                <!--------------------------------------------VEC------------------------------------------------------------------------>
                
                
                <div class="row  " style="padding-top: 1em;{!IF(ShowVECPart,'','display:none;')}">
                    <div class="col">
                        <apex:outputPanel id="VECPanel">
                            <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                                <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  >{!$Label.ASI_CRM_CN_Variable_Event_Cost}</div>
                                <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                    <div style="margin-left: 5em;" >
                                    </div> 
                                </div>
                            </div>
                            <apex:outputPanel rendered="{!VariableEventCost.Module.ASI_CRM_Created_PO_Version__c==ContractSelected.ASI_CRM_CN_PO_Version__c}" >
                                <div class="PanelBody" >
                                    <div style="display: grid; grid-template-columns: 15% 30% 10% 10% 10% 15%; grid-template-rows: auto;" >
                                        <div style="padding: 1em;"  class="GridColumn1" >
                                            <div class="MethodologyLabel" >
                                                <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_VEC_Key_Principle_Help_text}"  >
                                                    {!$Label.ASI_CRM_CN_Key_Principle} <i class="fa fa-info-circle" aria-hidden="true"></i>
                                                </span>
                                            </div> 
                                        </div>
                                        <div  class="GridColumn2"   >
                                            <div style="{!IF(IsGroupContract,'display:none;','')}">
                                                <apex:selectList size="1"  styleClass="form-control" style="width: 25em;" 
                                                                 value="{!VariableEventCost.MethodologyValue}" >
                                                    <apex:selectOptions value="{!DisplayMethod.VECMethod}" />
                                                </apex:selectList> 
                                            </div>
                                            <div style="{!IF(IsGroupContract,'padding-right: 1em;padding-top: 1em;padding-bottom: 1em;','display:none; ')}" >
                                                {!VariableEventCost.MethodologyDisplay} 
                                            </div>
                                        </div>
                                        <div class="GridColumn3"  >
                                            <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_VEC_Volume_Base_Help_text} "  >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="GridColumn4"  >
                                            <div class="VolumeBaseCls" id="VB_VariableEventCost" style="{!IF(VariableEventCost.HaveRefresh,'display:none;','')}" >
                                                <apex:selectList size="1" onchange="changingVolumeBase(this);"  
                                                                 rendered="{!!VariableEventCost.HaveRefresh}"
                                                                 styleClass="form-control" style="width: 10em;" value="{!VariableEventCost.Module.ASI_CRM_Volume_Base__c}">
                                                    <apex:selectOptions value="{!VolumeBasePickList}" />
                                                </apex:selectList>   
                                            </div>
                                            <div style="{!IF(VariableEventCost.HaveRefresh,'padding-right: 1em; padding-top: 0.6em;','display:none;')}" >
                                                <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Volume_Base__c}"/>
                                            </div>
                                        </div>
                                        <div class="GridColumn5"   >
                                            <div class="MethodologyLabel"  style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_VEC_Unit_Help_text}  "  >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}<i class="fa fa-info-circle" aria-hidden="true"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="GridColumn6"   >
                                            <div id="UN_VariableEventCost"    >
                                                <apex:selectList size="1"   styleClass="form-control" style="width: 12em;" 
                                                                 rendered="{!!VariableEventCost.HaveRefresh || VariableEventCost.Module.ASI_CRM_Volume_Base__c =='By Grade'}"
                                                                 value="{!VariableEventCost.Module.ASI_CRM_Unit__c}" >
                                                    <apex:selectOption rendered="{!VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'}" itemValue="Std. Btl." itemLabel="Std. Btl.(标准瓶)" />
                                                    <apex:selectOption itemValue="CR12 Extra Eqv."  itemLabel="CR12 Extra Eqv.(折芝华士新境12年)"  />
                                                </apex:selectList>   
                                            </div>
                                            <div style="{!IF(VariableEventCost.HaveRefresh && VariableEventCost.Module.ASI_CRM_Volume_Base__c !='By Grade','padding-right: 1em; padding-top: 0.6em;','display:none;')}"  >
                                                <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Unit__c}"/>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: 10% 10% 20% 20% 20% 20%; grid-template-rows: auto;" >
                                        <div class="GridColumn1" >
                                            <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                                <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_VEC_Remark_Help_text}"  >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}<i class="fa fa-info-circle" aria-hidden="true"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="GridColumn2"  style="padding-top: 0.3em;" > <!---------------style="width: 10em;"-------------------->
                                            <apex:inputfield value="{!VariableEventCost.Module.ASI_CRM_Remark_Options__c}"   styleClass="form-control  input-sm"   />
                                        </div>
                                        <div class="GridColumn3" style="padding-top: 0.3em;" >
                                            <apex:inputText value="{!VariableEventCost.Module.ASI_CRM_Remark__c}"  styleClass="form-control input-sm"  />
                                        </div>
                                        <div class="GridColumn4" style="padding-top: 0.3em;"  >
                                            <apex:commandButton styleClass="BSCommandButton" 
                                                                value="{!$Label.ASI_CRM_CN_Refresh}" onclick="VECNewLine();"
                                                                action="{!RefreshVECModule}" 
                                                                oncomplete="Rerender();"
                                                                reRender="VECPanel" status="ActionStatus"    >
                                            </apex:commandButton>
                                        </div>
                                        <div class="GridColumn5" style="padding-top: 0.3em;" >
                                            <apex:commandButton styleClass="BSCommandButton" 
                                                                value="{!$Label.ASI_CRM_CN_Reset}"  rendered="{!!IsGroupContract}"
                                                                action="{!ResetVECDetails}"  
                                                                oncomplete="Rerender();"
                                                                reRender="VECPanel" status="ActionStatus"    >
                                            </apex:commandButton>
                                        </div>
                                        <div class="GridColumn6"   ><div></div></div>
                                    </div>
                                    
                                    
                                    
                                    <apex:actionFunction name="ChangingVECSubBrandActionFunction" action="{!VECChangingSB}" rerender="VECPanel"  status="ActionStatus"   >       
                                        <apex:param name="PARAM_Line_ID" value="" />
                                    </apex:actionFunction>  
                                    
                                    <apex:outputPanel rendered="{!VariableEventCost.HaveRefresh}"  >
                                        <table class="bs table table-condensed" style="margin-bottom: 0;"  >
                                            <thead>
                                                <tr>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  "  >
                                                        <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                            <apex:commandButton styleClass="BSCommandButtonSM" 
                                                                                reRender="VECPanel"
                                                                                onclick="VECNewLine();"
                                                                                status="ActionStatus" 
                                                                                oncomplete="Rerender();"
                                                                                value="{!$Label.ASI_CRM_CN_Add_New}" 
                                                                                action="{!AddNewVECLine}" />
                                                        </div>
                                                    </th>
                                                    <th style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  "   >
                                                        {!$ObjectType.ASI_MFM_Sub_brand__c.Label}
                                                    </th>
                                                    <th style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  "   >
                                                        {!$Label.ASI_CRM_CN_Grade}
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                                    </th>
                                                    <th > 
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                                        </span>
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                        </span>
                                                    </th>
                                                    <th > 
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                        </span>
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                        </span>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_VEC_Per_Bottle}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_VEC_Per_Bottle}"/>
                                                    </th>
                                                    
                                                    <th  style="text-align: center;">
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                    </th>
                                                    <th  style="text-align: center;" >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                
                                                <apex:variable value="{!0}" var="VECEstMonthlyQty"/>
                                                <apex:variable value="{!0}" var="VECContractMonthlyQty"/>
                                                <apex:variable value="{!0}" var="VECContractTotalQty"/>
                                                <apex:variable value="{!0}" var="VECEstTotalQty"/>
                                                <apex:variable value="{!0}" var="VECContractTotalQtyCR12"/>
                                                <apex:variable value="{!0}" var="VECEstTotalQtyCR12"/>
                                                <apex:variable value="{!0}" var="VECContractBRSFPerBottle"/>
                                                <apex:variable value="{!0}" var="VECEstBRSFPerBottle"/>
                                                <apex:variable value="{!0}" var="VECContractTotal"/>
                                                <apex:variable value="{!0}" var="VECEstTotal"/>
                                                
                                                <apex:repeat value="{!VariableEventCost.DetailLineMap}"  var="line" id="VECLine" >
                                                    <apex:variable var="VECEstMonthlyQty" value="{!VECEstMonthlyQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                    <apex:variable var="VECContractMonthlyQty" value="{!VECContractMonthlyQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>  
                                                    <apex:variable var="VECEstBRSFPerBottle" value="{!VECEstBRSFPerBottle+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>  
                                                    <apex:variable var="VECContractBRSFPerBottle" value="{!VECContractBRSFPerBottle+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>  
                                                    <apex:variable var="VECEstTotal" value="{!VECEstTotal+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>  
                                                    <apex:variable var="VECContractTotal" value="{!VECContractTotal+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>  
                                                    <apex:variable var="VECContractTotalQty" value="{!VECContractTotalQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>  
                                                    <apex:variable var="VECEstTotalQty" value="{!VECEstTotalQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>  
                                                    <apex:variable var="VECContractTotalQtyCR12" value="{!VECContractTotalQtyCR12+VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>  
                                                    <apex:variable var="VECEstTotalQtyCR12" value="{!VECEstTotalQtyCR12+VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>  
                                                    
                                                    <tr >
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Total','width:5%','display:none;')}  "  >
                                                            <apex:commandLink styleClass="bs btn btn-default btn-round pull-left btn-sm"
                                                                              style="border: none;background-color: transparent;"
                                                                              reRender="VECPanel" 
                                                                              action="{!RemoveVECLine}"
                                                                              oncomplete="Rerender();"
                                                                              status="ActionStatus"
                                                                              html-formnovalidate="formnovalidate">
                                                                <span class="bs glyphicon glyphicon-trash"  style="color:red;font-size: 20px;"></span>
                                                                <apex:param name="PARAM_Line_ID" value="{!line}" />
                                                            </apex:commandLink>
                                                        </td>
                                                        <td > 
                                                            <div class="style-1"    style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                <apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}"  
                                                                                 styleClass="{!'SubBrandsClass_'+line} SBClass SubBrandClass VECSubBrandsClass" 
                                                                                 onchange="ChangingSubBrand('{!line}','');" />
                                                            </div>
                                                            <div  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                <apex:outputLink value="/{!VariableEventCost.DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">
                                                                    {!VariableEventCost.DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                <apex:outputLink value="/{!VariableEventCost.DetailLineMap[line].ASI_CRM_Product_Category__c}">
                                                                    {!VariableEventCost.DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                {!$Label.ASI_CRM_CN_By_Total}
                                                            </div>
                                                        </td>
                                                        <td id="{!'SBGrade_'+line}"  style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','width:5%;','display:none;')}  " >
                                                            <apex:outputLink value="/{!VariableEventCost.DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!VariableEventCost.DetailLineMap[line].ASI_CRM_Line_Name__c}
                                                            </apex:outputLink>  
                                                        </td>
                                                        <td >
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  id="{!'VECContractQty_'+line}"   data-id="{!line}"  >
                                                                <!---------<apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"  
                                                                                 styleClass="ApexInputNumberField InputNumberFieldwidth requiredField VECContractQtyClass" 
                                                                                 onchange="VECChangingNextAmount(this);"    />  ---->
                                                                 <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                     <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>
                                                                </apex:outputText>                                                                
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                            </div>
                                                        </td>
                                                        <td >
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="{!'VECEstQty_'+line}" data-id="{!line}"  >
                                                            
                                                                 <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                     <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                                </apex:outputText>        
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                    <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>
                                                                </apex:outputText>
                                                            </div>
                                                        </td> 
                                                        
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','width:5%;padding-top: 0.9em;text-align: right; padding-right: 2em;','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                <apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','width:5%;padding-top: 0.9em;text-align: right; padding-right: 2em;','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                <apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','width:5%','display:none;')}"  id="{!'VECContractPerBottle_'+line}"  data-id="{!line}"  >
                                                            <!----<apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}" 
                                                                             styleclass="ApexInputNumberField InputNumberFieldwidth requiredField VECContractIncentive" 
                                                                             onchange="SetEstimateVECPerBottle(this);"     />--->
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                            </apex:outputText>

                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','width:5%;padding-top: 0.9em; padding-right: 2em;','display:none;')}" 
                                                            id="{!'VECEstPerBottle_'+line}" data-Incentive="{!VariableEventCost.DetailLineMap[line].ASI_CRM_Max_Incentive__c}" data-id="{!line}" class="VECEstimateIncentive"   >
                                                            <apex:inputField rendered="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Is_Payment_New__c}" value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                             onchange="SetEstimateVECPerBottle(this);  VECESTCheckOverPaid($(this),this)"  
                                                                             styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'VECEstPerBottle_'+line} "    >
                                                            </apex:inputField>
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}" rendered="{!!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Is_Payment_New__c}">
                                                                <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        
                                                        <td style="text-align: center;" >
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" data-id="{!line}"   >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/></apex:outputText>
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.5em; padding-right: 2em;','display:none;')}" 
                                                                 id="{!'VECContractTotal_'+line}"  data-id="{!line}" class="VECContractTotalDummyTD" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"  styleclass="VECContractTotalDummy"   >
                                                                    <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                                </apex:outputText>
                                                            </div>
                                                        </td>
                                                        
                                                        <td style="text-align: center;" >
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" data-id="{!line}"  id="{!'VECEstDummyTotal_'+line}" >
                                                                <apex:inputField value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}" 
                                                                                 styleclass="ApexInputNumberField InputNumberFieldwidth VECEstimateTotal" 
                                                                                 onchange="formatTotal(this); CalculateTotalInputField2nd('VECEstimateTotal','VECEstTotalPart');"     />
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.5em; padding-right: 2em;','display:none;')}" 
                                                                 id="{!'VECEstTotal_'+line}" data-id="{!line}" class="VECEstimateTotalDummyTD"    >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}" styleclass="VECEstimateTotalDummy" >
                                                                    <apex:param value="{!VariableEventCost.DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                                </apex:outputText>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </apex:repeat>
                                                
                                                <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                    <td>
                                                        {!$Label.ASI_CRM_CN_Total_Amount} 
                                                    </td>
                                                    <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Total','display:none;','')}  ">
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand',' ','display:none;')}  " >
                                                    </td>
                                                    
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="VECContractMonthlyQtyPart" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECContractMonthlyQty}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="VECTotalContractMonthlyQty" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECEstMonthlyQty}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"   >
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','text-align: right;','display:none;')}" >
                                                    </td>                                                    
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECContractTotalQty}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECEstTotalQty}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: right; padding-right: 2em; ','display:none;')}"><!-----    padding-left: 5em;--->
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECContractTotalQtyCR12}"/></apex:outputText>
                                                    </td>
                                                    <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: right; padding-right: 2em; ','display:none;')}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECEstTotalQtyCR12}"/></apex:outputText>
                                                    </td>
                                                    <td id="VECContractTotalPart"  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','text-align: center;',' text-align: center;')}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECContractTotal}"/></apex:outputText>
                                                    </td>
                                                    <td id="VECEstTotalPart" style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','text-align: center;',' text-align: center;')}"  >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECEstTotal}"/></apex:outputText>
                                                    </td>
                                                    
                                                </tr>
                                                
                                            </tbody>
                                            
                                        </table>
                                    </apex:outputPanel>
                                </div>
                                
                            </apex:outputPanel>
                            
                            <!---------------------------------------VEC Previous Version---------------------------------------------------------------->
                            <apex:outputPanel rendered="{!VariableEventCost.Module.ASI_CRM_Created_PO_Version__c!=ContractSelected.ASI_CRM_CN_PO_Version__c}" >
                                <div class="PanelBody" style="padding: 0.5em" >
                                    
                                    <div class="bs table-responsive" > 
                                        
                                        <table class="bs table table-condensed" style="margin-bottom: 0; width:70%" >
                                            <tr>
                                                <td style=" border-left: 1px solid #ddd;"   class="MethodologyLabel">{!$Label.ASI_CRM_CN_Key_Principle}</td>
                                                <td style="border-right: 1px solid #ddd;">{!VariableEventCost.MethodologyValue}  </td>
                                                <td  style=" "  class="MethodologyLabel" >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                                <td style=" border-right: 1px solid #ddd;"  >
                                                    <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Volume_Base__c}"/>
                                                </td>
                                                <td  style=" "  class="MethodologyLabel">{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}</td>
                                                <td style="border-right: 1px solid #ddd;"   >
                                                    <apex:outputField value="{!VariableEventCost.Module.ASI_CRM_Unit__c}"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style=" border-left: 1px solid #ddd;border-bottom: 1px solid #ddd;"  class="MethodologyLabel"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}</td>
                                                <td style=" border-left: 1px solid #ddd; border-right: 1px solid #ddd;border-bottom: 1px solid #ddd;"  colspan="5" > 
                                                    {!VariableEventCost.Module.ASI_CRM_Remark_Display__c} 
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    
                                    <div class="bs table-responsive" style="padding-top: 0.5em;" > 
                                        <table class="bs table table-condensed" style="margin-bottom: 0; " >
                                            <thead>
                                                <tr>
                                                    <th style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  "   >
                                                        {!$ObjectType.ASI_MFM_Sub_brand__c.Label}
                                                    </th>
                                                    <th style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  "   >
                                                        {!$Label.ASI_CRM_CN_Grade}
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                                    </th>
                                                    <th > 
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                                        </span>
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                        </span>
                                                    </th>
                                                    <th > 
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                        </span>
                                                        <span style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                        </span>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}">
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_VEC_Per_Bottle}"/> 
                                                    </th>
                                                    <th style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_VEC_Per_Bottle}"/>
                                                    </th>
                                                    <th>
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                    </th>
                                                    <th>
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                    </th>
                                                </tr>
                                            </thead>
                                            
                                            <apex:variable value="{!0}" var="VECEstMonthlyQty"/>
                                            <apex:variable value="{!0}" var="VECContractMonthlyQty"/>
                                            <apex:variable value="{!0}" var="VECContractTotalQty"/>
                                            <apex:variable value="{!0}" var="VECEstTotalQty"/>
                                            <apex:variable value="{!0}" var="VECContractTotalQtyCR12"/>
                                            <apex:variable value="{!0}" var="VECEstTotalQtyCR12"/>
                                            <apex:variable value="{!0}" var="VECContractBRSFPerBottle"/>
                                            <apex:variable value="{!0}" var="VECEstBRSFPerBottle"/>
                                            <apex:variable value="{!0}" var="VECContractTotal"/>
                                            <apex:variable value="{!0}" var="VECEstTotal"/>
                                            
                                            <tbody>
                                                <apex:repeat value="{!VariableEventCost.DetailLineMap}" var="Line" >
                                                    <apex:variable var="VECEstMonthlyQty" value="{!VECEstMonthlyQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                    <apex:variable var="VECContractMonthlyQty" value="{!VECContractMonthlyQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>
                                                    <apex:variable var="VECEstTotal" value="{!VECEstTotal+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>  
                                                    <apex:variable var="VECContractTotal" value="{!VECContractTotal+VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>  
                                                    <apex:variable var="VECContractTotalQty" value="{!VECContractTotalQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>  
                                                    <apex:variable var="VECEstTotalQty" value="{!VECEstTotalQty+VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>  
                                                    <apex:variable var="VECContractTotalQtyCR12" value="{!VECContractTotalQtyCR12+VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>  
                                                    <apex:variable var="VECEstTotalQtyCR12" value="{!VECEstTotalQtyCR12+VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>  
                                                    
                                                    <tr>
                                                        
                                                        <td > 
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                <apex:outputField value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Sub_Brand__c}"  html-placeholder="Sub-Brand"    />
                                                            </div>
                                                            <div  style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                <apex:outputLink value="/{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__c}">{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}</apex:outputLink>
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                <apex:outputField value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Product_Category__c}" />
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                {!VariableEventCost.DetailLineMap[Line].ASI_CRM_Volume_Base__c} 
                                                            </div>
                                                        </td>
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand',' ','display:none;')}  " >
                                                            <apex:outputLink value="/{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__c}">{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="{!'VECEstQty_'+Line}" data-id="{!Line}"  >
                                                                
                                                                 <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                     <apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                                </apex:outputText>
                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/></apex:outputText>
                                                        </td>
                                                        <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="{!'VECEstPerBottle_'+Line}" data-id="{!Line}" class="VECEstimateIncentive" data-Incentive="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Max_Incentive__c}"  >
                                                            <apex:inputField rendered="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Is_Payment_New__c}" value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                             onchange="SetEstimateVECPerBottle(this); VECESTCheckOverPaid($(this),this)"  
                                                                             styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'VECEstPerBottle_'+Line} "    >
                                                            </apex:inputField>
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}" rendered="{!!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Is_Payment_New__c}">
                                                                <apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        
                                                        
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                        </td>
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                        </td>
                                                        
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                        </td>
                                                        <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                        </td>                                       
                                                        <td >
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/></apex:outputText>
                                                        </td>
                                                        <td data-id="{!Line}" class="VECEstimateTotalDummyTD">
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" data-id="{!Line}"  id="{!'VECEstDummyTotal_'+Line}" >
                                                                <apex:inputField value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}" 
                                                                                 styleclass="ApexInputNumberField InputNumberFieldwidth VECEstimateTotal" 
                                                                                 onchange="formatTotal(this);CalculateTotalInputField2nd('VECEstimateTotal','VECEstTotalPart');"     />
                                                            </div>
                                                            <div style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.5em; padding-right: 2em;','display:none;')}" 
                                                                 id="{!'VECEstTotal_'+Line}" data-id="{!Line}"    >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}" styleclass="VECEstimateTotalDummy" >
                                                                    <apex:param value="{!VariableEventCost.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                                </apex:outputText>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </apex:repeat>
                                            </tbody>
                                            <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                <td>{!$Label.ASI_CRM_CN_Total_Amount} 
                                                </td>
                                                <td style=" {!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand',' ','display:none;')}  " >
                                                </td>
                                                
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECContractMonthlyQty}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" id="VECTotalContractMonthlyQty" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!VECEstMonthlyQty}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}">
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                </td>
                                                
                                                
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECContractTotalQty}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECEstTotalQty}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECContractTotalQtyCR12}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(VariableEventCost.Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECEstTotalQtyCR12}"/></apex:outputText>
                                                </td>
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECContractTotal}"/></apex:outputText>
                                                </td>
                                                <td id="VECEstTotalPart">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!VECEstTotal}"/></apex:outputText>
                                                </td>
                                                
                                            </tr>
                                        </table>
                                    </div>
                                    
                                    
                                    
                                    
                                    <div class="bs table-responsive" > 
                                        <table style="margin-bottom: 0; width:50%;margin-top: 0.5em;" >
                                            <tr>
                                                <td style=" font-weight: bold; text-align: right; padding-top: 0.3em; padding-right: 1em;">
                                                    {!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_EVC_Cost_Estimate_Total__c.Label} </td>
                                                <td id="VECEstTotalPart2nd"> <apex:inputField value="{!ContractSelected.ASI_CRM_EVC_Cost_Estimate_Total__c}" styleClass="ApexInputNumberField" onchange="formatTotal(this);"/></td>
                                            </tr>
                                        </table>
                                    </div>
                                    
                                    
                                </div> 
                                
                                
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </div>
                </div>

                <!-- FC -->
                <div class="row  " style="padding-top: 1em;">
                    <div class="col">
                        <apex:outputPanel id="FCPanel">
                            <!-- <apex:actionFunction name="ChangingPSFSubBrandActionFunction" action="{!PSFChangingSB}" rerender="PSFPanel"  status="ActionStatus"   >       
                                <apex:param name="PARAM_Module_ID" value="" />
                                <apex:param name="PARAM_Line_ID" value="" />
                            </apex:actionFunction>   -->
                            <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                                <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  > {!$Label.ASI_CRM_CN_Contract_Fix_Cost} </div>
                                <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                    <div style="margin-left: 5em;" >
                                        <!-- <apex:commandButton styleClass="BSCommandButton" 
                                                            value="{!$Label.ASI_CRM_CN_Add_New_Module}"
                                                            reRender="PSFPanel"
                                                            oncomplete="Rerender();"
                                                            action="{!PSFAddModule}" 
                                                            status="ActionStatus"  /> -->
                                    </div> 
                                </div>
                            </div>
                            <div class="PanelBody" >
                                <apex:variable value="{!0}" var="i"/>
                                <apex:repeat value="{!LFixCost2nd}"  var="itm" id="FCitem" >
                                    
                                    
                                    <apex:variable var="i" value="{!i+1}"/>
                                    
                                    <apex:outputPanel rendered="{!LFixCost2nd[itm].Module.ASI_CRM_Created_PO_Version__c==ContractSelected.ASI_CRM_CN_PO_Version__c}" >
                    <div class="panel panel-primary">
                        <div class="panel-heading">{!itm}
                            <!-- <span id="{!itm}" class="pull-right clickable" data-effect="fadeOut"  style="{!IF(IsGroupContract,'display:none;','')}  "  
                                  onclick="DeleteModule1(this);InitTooltip();" oncomplete="InitTooltip();"  >
                                <i class="fa fa-times"></i></span>  -->
                        </div>
                        <div class="panel-body">
                            
                            <div style="display: grid; grid-template-columns: 15% 28% 10% 14% 8% 8% 8% 9%; grid-template-rows: auto;" >
                                <div style=""  class="GridColumn1" >
                                    <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;"  >
                                        <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Volume_Base_Help_text}"  >
                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i> </span>
                                    </div>
                                   <!--  <div class="MethodologyLabel" >
                                        <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Key_Principle_Help_text}"  >{!$Label.ASI_CRM_CN_Key_Principle} <i class="fa fa-info-circle" aria-hidden="true"></i> </span>
                                    </div>  -->
                                </div>
                                <div  class="GridColumn2"   >
                                    <div class="VolumeBaseCls" id="{!'VB_'+itm}" style="padding-right: 1em;{!IF(LFixCost2nd[itm].HaveRefresh ,'display:none;','')}"   >                       
                                        <apex:selectList size="1" onchange="changingVolumeBase(this);" styleClass="form-control" 
                                                         rendered="{!!LFixCost2nd[itm].HaveRefresh}"
                                                         value="{!LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c}" >
                                            <apex:selectOptions value="{!VolumeBasePickList}" />
                                        </apex:selectList>   
                                    </div>
                                    <div style="{!IF(LFixCost2nd[itm].HaveRefresh,'padding-right: 1em;','display:none;')}"  >
                                        <apex:outputField value="{!LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c}"/>
                                    </div>
                                    <!-- <div style="{!IF(IsGroupContract,'display:none;','')}"  >
                                        <apex:selectList size="1"  styleClass="form-control" value="{!LFixCost2nd[itm].MethodologyValue}">
                                            <apex:selectOptions value="{!DisplayMethod.PSFMethod}" />
                                        </apex:selectList> 
                                    </div>
                                    <div style="{!IF(IsGroupContract,'padding-right: 1em;padding-top: 1em;padding-bottom: 1em;','display:none;')}"  >
                                        {!LFixCost2nd[itm].MethodologyDisplay} 
                                    </div> -->
                                </div>
                                <div class="GridColumn3"  >
                                    <div class="MethodologyLabel"  style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                        <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Unit_Help_text}"  >
                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i></span>
                                    </div>
                                </div>
                                <div class="GridColumn4"  > <!-----------style="width: 8em;" ----------->
                                    <div id="{!'UN_'+itm}"  style=""   >
                                        <apex:selectList size="1"   styleClass="form-control" 
                                                         value="{!LFixCost2nd[itm].Module.ASI_CRM_Unit__c}" 
                                                         rendered="{!( !LFixCost2nd[itm].HaveRefresh || LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Grade' ) }">
                                            <apex:selectOption rendered="{!LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'}" itemValue="Std. Btl."  itemLabel="Std. Btl.(标准瓶)" />
                                            <apex:selectOption itemValue="CR12 Extra Eqv."  itemLabel="CR12 Extra Eqv.(折芝华士新境12年)"  />
                                        </apex:selectList>   
                                    </div>
                                    <div style="{!IF( LFixCost2nd[itm].HaveRefresh && LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Grade','padding-right: 1em; padding-top: 0.6em;','display:none;')}"  >
                                        <apex:outputField value="{!LFixCost2nd[itm].Module.ASI_CRM_Unit__c}" rendered="{! LFixCost2nd[itm].HaveRefresh && LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Grade'}"/>
                                    </div>
                                    <!-- <div style="{!IF( IsGroupContract,'padding-right: 1em; padding-top: 0.6em;','display:none;')}"  >
                                        <apex:outputField value="{!LFixCost2nd[itm].Module.ASI_CRM_Unit__c}" rendered="{!IsGroupContract}"/>
                                    </div> -->
                                </div>
                                <div class="GridColumn5"   >
                                    
                                </div>
                                <div class="GridColumn6"   >
                                    
                                    
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 10% 10% 20% 20% 20% 20%; grid-template-rows: auto;" >
                                <div class="GridColumn1" >
                                    <div class="MethodologyLabel" style="padding-top: 0.5em;text-align: right;padding-right: 1em;" >
                                        <span data-toggle="tooltip" title="{!$Label.ASI_CRM_CN_PSF_Remark_Help_text}"  >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label} <i class="fa fa-info-circle" aria-hidden="true"></i></span>
                                    </div>
                                </div>
                                <div class="GridColumn2" style="padding-top: 0.3em;" > <!------------ style="width: 10em;" -------------->
                                    <apex:inputfield value="{!LFixCost2nd[itm].Module.ASI_CRM_Remark_Options__c}" styleClass="form-control  input-sm"   />
                                    
                                </div>
                                <div class="GridColumn3" style="padding-top: 0.3em;" >
                                    <apex:inputText value="{!LFixCost2nd[itm].Module.ASI_CRM_Remark__c}"  styleClass="form-control  input-sm"   />
                                </div>
                                <div class="GridColumn4" style="padding-top: 0.3em;" >
                                    <apex:commandButton styleClass="BSCommandButton"  
                                                        value="{!$Label.ASI_CRM_CN_Refresh}" 
                                                        reRender="FCPanel" 
                                                        oncomplete="Rerender();InitTooltip();FCCalculation('{itm}');"
                                                        action="{!RefreshFCModule}"  
                                                        status="ActionStatus">
                                        <apex:param name="PARAM_Line_ID" value="{!itm}" />
                                    </apex:commandButton>
                                </div>
                                <div class="GridColumn5" style="padding-top: 0.3em;" >
                                    <apex:commandButton styleClass="BSCommandButton"  
                                                        value="{!$Label.ASI_CRM_CN_Reset}" 
                                                        reRender="FCPanel"
                                                        oncomplete="Rerender();InitTooltip();FCCalculation('{itm}');"
                                                        action="{!ResetFCDetails}"  
                                                        status="ActionStatus">
                                        <apex:param name="PARAM_Line_ID" value="{!itm}" />
                                    </apex:commandButton>
                                </div>
                                <div class="GridColumn6"><div></div></div>
                            </div>
                            
                            
                            <apex:outputPanel rendered="{!LFixCost2nd[itm].HaveRefresh}" >
                                
                                <table class="bs table table-condensed" style="margin-bottom: 0;"  >
                                    <thead>
                                        <tr>
                                            <th  style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  "  >
                                                <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                    <apex:commandButton styleClass="BSCommandButtonSM" 
                                                                        status="ActionStatus"
                                                                        onclick="FCNewLine();"
                                                                        reRender="FCPanel"
                                                                        oncomplete="Rerender();InitTooltip();FCCalculation('{itm}');"
                                                                        value="{!$Label.ASI_CRM_CN_Add_New}" 
                                                                        action="{!AddNewFCLine}"    >
                                                        <apex:param name="PARAM_Line_ID" value="{!itm}" />
                                                    </apex:commandButton>
                                                </div>
                                            </th>
                                            <th style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:20%;')}  " >{!$ObjectType.ASI_MFM_Sub_brand__c.Label}</th>
                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >{!$Label.ASI_CRM_CN_Grade}</th>
                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                            </th>
                                            <th>                                                               
                                                <span style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" > 
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                                </span>
                                                <span style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" > 
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                </span>
                                            </th>
                                            <th> 
                                                <span style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                </span>
                                                <span style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                </span>
                                                <br/>
                                            </th>
                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                            </th>
                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                            </th>
                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_FC_Per_Bottle}"/>
                                            </th>
                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  ><apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_FC_Per_Bottle}"/></th>
                                            <th>
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                            </th>
                                            <th>
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                            </th>
                                            <!-- <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_Key_Sub_brand__c.Label}"/>
                                            </th> -->
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <apex:variable value="{!0}" var="FCEstMonthlyQty"/>
                                        <apex:variable value="{!0}" var="FCContractMonthlyQty"/>
                                        <apex:variable value="{!0}" var="FCEstTotalQTY"/>
                                        <apex:variable value="{!0}" var="FCContractTotalQTY"/>
                                        <apex:variable value="{!0}" var="FCEstTotalQTYCR12"/>
                                        <apex:variable value="{!0}" var="FCContractTotalQTYCR12"/>
                                        <apex:variable value="{!0}" var="FCEstBRSFPerBottle"/>
                                        <apex:variable value="{!0}" var="FCContractBRSFPerBottle"/>
                                        <apex:variable value="{!0}" var="FCEstTotal"/>
                                        <apex:variable value="{!0}" var="FCContractTotal"/>
                                        
                                        <apex:repeat value="{!LFixCost2nd[itm].DetailLineMap}"  var="line" id="lineItem" >
                                            <apex:variable var="FCEstMonthlyQty" 
                                                           value="{!FCEstMonthlyQty+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}" 
                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c!=null}" />
                                            <apex:variable var="FCContractMonthlyQty" 
                                                           value="{!FCContractMonthlyQty+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}" 
                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c!=null}"/>
                                            
                                            <apex:variable var="FCEstTotalQTY" 
                                                           value="{!FCEstTotalQTY+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}" 
                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c!=null}" />
                                            
                                            <apex:variable var="FCContractTotalQTY" 
                                                           value="{!FCContractTotalQTY+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}" 
                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c!=null}"/> 
                                            
                                            <apex:variable var="FCEstTotalQTYCR12" value="{!FCEstTotalQTYCR12+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>
                                            <apex:variable var="FCContractTotalQTYCR12" value="{!FCContractTotalQTYCR12+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/> 
                                            
                                            <apex:variable var="FCEstBRSFPerBottle" 
                                                           value="{!FCEstBRSFPerBottle+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c!=null}"/>  
                                            <apex:variable var="FCContractBRSFPerBottle" 
                                                           value="{!FCContractBRSFPerBottle+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}" 
                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c!=null}"/>  
                                            
                                            <apex:variable var="FCEstTotal" 
                                                           value="{!FCEstTotal+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"
                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c!=null}" />  
                                            <apex:variable var="FCContractTotal" 
                                                           value="{!FCContractTotal+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}" 
                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c!=null}"/>                                                        
                                            
                                            
                                            <tr>
                                                <td style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  ">
                                                    <apex:commandLink styleClass="bs btn btn-default btn-round pull-left btn-sm"
                                                                      style="border: none;background-color: transparent;"
                                                                      reRender="FCPanel" 
                                                                      oncomplete="Rerender();InitTooltip();FCCalculation('{itm}');"
                                                                      action="{!RemoveFCLine}"
                                                                      status="ActionStatus">
                                                        <span class="bs glyphicon glyphicon-trash"  style="color:red;font-size: 20px;"></span>
                                                        <apex:param name="PARAM_item_ID" value="{!itm}" />
                                                        <apex:param name="PARAM_Unit_ID" value="{!LFixCost2nd[itm].Module.ASI_CRM_Unit__c}" />
                                                        <apex:param name="PARAM_Line_ID" value="{!line}" />
                                                    </apex:commandLink>
                                                </td>
                                                
                                                <td > 
                                                    <div  class="style-1" style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:20%;')}  " >
                                                        <apex:inputField value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}" 
                                                                         styleClass="{!'SubBrandsClass_'+line} SBClass SubBrandClass FCSubBrandsClass"
                                                                         onchange="ChangingSubBrand('{!line}','{!itm}');"  />
                                                    </div>
                                                    <div  style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                        <apex:outputLink value="/{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">
                                                            {!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                    </div>
                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                        <apex:outputLink value="/{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Product_Category__c}">
                                                            {!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                    </div>
                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                        {!$Label.ASI_CRM_CN_By_Total}
                                                    </div>
                                                </td>
                                                
                                                <td id="{!'SBGrade_'+line}"  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%;')}  " >
                                                    <apex:outputLink value="/{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}
                                                    </apex:outputLink>
                                                </td>
                                                <td >
                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" data-Item="{!itm}"   data-id="{!line}"   id="{!'FCContractQty_'+line}"  >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                        <!-- <apex:inputField value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}" 
                                                                         styleClass="ApexInputNumberField InputNumberFieldwidth requiredField {!'FCContractMonthlyQty_'+itm} " 
                                                                         onchange="FCChangingNextAmount(this);">
                                                        </apex:inputField> -->
                                                    </div>
                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                    </div>
                                                </td>
                                                <td >
                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"   data-Item="{!itm}"   data-id="{!line}"    id="{!'FCEstQty_'+line}"  >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText>
                                                    </div>
                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                    </div>
                                                </td> 
                                                
                                                <td style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: left; padding-right: 2em; ','display:none;')}"    >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                </td>
                                                <td style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','padding-top: 0.9em;text-align: left; padding-right: 2em; ','display:none;')}" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                </td>
                                                
                                                <td style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"   data-id="{!line}"  
                                                    data-Incentive="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c}"  data-Item="{!itm}"  
                                                    id="{!'FCContractPerBottle_'+line}"  >
                                                    <apex:outputText style="{!IF(LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c<LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}" value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/></apex:outputText>
                                                    <!-- <apex:inputField value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}" 
                                                                     onchange="SetEstimateFCPerBottle(this);FCCheckOverPaid($(this),this);" 
                                                                     style="{!IF(LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c<LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}"
                                                                     styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'FCContractIncentive_'+itm} "    > -->
                                                    <!-- </apex:inputField> -->
                                                </td>
                                                <!-- <td style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.9em; padding-right: 2em; ','display:none;')}"  data-id="{!line}" data-Incentive="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c}"   id="{!'FCEstPerBottle_'+line}" data-Item="{!itm}" >
                                                    <apex:inputField rendered="{!LFixCost2nd[itm].DetailLineMap[line].Id == null}" value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                         onchange="SettingFCEstTotal2nd(this);FCESTCheckOverPaid($(this),this)"  
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'FCContractIncentive_'+itm} "     ></apex:inputField>


                                                </td> -->
                                                <td  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <div    data-Item="{!itm}"   data-id="{!line}"  data-Incentive="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c}"  id="{!'FCEstPerBottle_'+line}"  >
                                                        <apex:outputText rendered="{!!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Is_Payment_New__c }" value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/></apex:outputText>
                                                        <apex:inputField rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Is_Payment_New__c}" value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                         onchange="SettingFCEstTotal2nd(this);FCESTCheckOverPaid($(this),this)"  
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'FCContractIncentive_'+itm} "     ></apex:inputField>
                                                    </div>
                                                                </td>
                                                <td>
                                                    <!-- <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  
                                                         data-Item="{!itm}"  data-id="{!line}"  id="{!'FCContractDummyTotal_'+line}">
                                                        <apex:inputField value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}" 
                                                                         onchange="FCSetEstDummyTotalAmount(this);"  
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth {!'FCContractTotalDummy_'+itm} "     />
                                                    </div> -->
                                                    <div style=""
                                                         id="{!'FCContractTotal_'+line}" class="{!'FCContractDummyTotalClass_'+itm}"   >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/></apex:outputText>
                                                    </div>
                                                </td>
                                                <td >
                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" 
                                                         data-Item="{!itm}"   data-id="{!line}"   id="{!'FCEstDummyTotal_'+line}"  >
                                                        <apex:inputField value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"  onchange="FCChangeEstDummyTotalAmount(this);"  
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth {!'FCEstTotalDummy_'+itm}"    />
                                                    </div>
                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-top: 0.9em;padding-right: 2em; ','display:none;')}"  
                                                         id="{!'FCEstTotal_'+line}" class="{!'FCEstDummyTotalClass_'+itm}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/></apex:outputText>
                                                    </div>
                                                </td>
                                                <!-- <td style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%; ')}"  >
                                                    <apex:inputfield value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Key_Sub_brand__c}"   />
                                                </td> -->
                                            </tr>
                                        </apex:repeat>
                                        
                                        
                                        
                                        <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                            <td colspan="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Total','1','2')} " >{!$Label.ASI_CRM_CN_Total_Amount} 
                                            </td>
                                            <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                            </td>
                                            
                                            <td id="{!'TotalFCContractQty_'+itm}"  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!FCContractMonthlyQty}"/></apex:outputText>
                                            </td>
                                            <td id="{!'TotalFCEstimateQty_'+itm}"  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!FCEstMonthlyQty}"/></apex:outputText>
                                            </td>
                                            
                                            <td  id="{!'FCContractTotalQTY_'+itm}"  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCContractTotalQTY}"/></apex:outputText>
                                            </td>
                                            <td id="{!'FCEstTotalQTY_'+itm}" style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCEstTotalQTY}"/></apex:outputText>
                                            </td>
                                            
                                            <td  id="{!'TotalFCContractTotalQTYCR12_'+itm}"  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCContractTotalQTYCR12}"/></apex:outputText>
                                            </td>
                                            <td id="{!'TotalFCEstTotalQTYCR12_'+itm}" style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCEstTotalQTYCR12}"/></apex:outputText>
                                            </td>
                                            <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                            </td>
                                            <td  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','display:none;')}  ">
                                            </td>
                                            <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','')}"   id="{!'FCContractTotalPart_'+itm}"  >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCContractTotal}"/></apex:outputText>
                                            </td>
                                            <td style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','')}" id="{!'FCEstTotalPart_'+itm}"  >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCEstTotal}"/></apex:outputText>
                                            </td>
                                            <td></td>
                                        </tr>
                                        
                                        
                                    </tbody>
                                    
                                </table>
                            </apex:outputPanel>
                            
                        </div>
                    </div>
                                    </apex:outputPanel>
                                    
                                    <br/>
                                    <apex:outputPanel rendered="{!LFixCost2nd[itm].Module.ASI_CRM_Created_PO_Version__c!=ContractSelected.ASI_CRM_CN_PO_Version__c}">
                                        <div style="display: grid; grid-template-columns: 10% 90% ; grid-template-rows: auto; padding-top:0.5em;"   >
                                            <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;font-weight: bold;"  >  {!itm}</div>
                                            <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                            </div> 
                                        </div>
                                        <div class="PanelBody" >
                                            <div class="bs table-responsive" >
                                                
                                                <table class="bs table table-condensed" style="margin-bottom: 0; width:70%" >
                                                    <tr>
                                                        <td  style=" "  class="MethodologyLabel" >{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                                        <td style=" border-right: 1px solid #ddd;"  >
                                                            <apex:outputField value="{!LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c}"/>
                                                        </td>
                                                        
                                                        <td  style=" "  class="MethodologyLabel">{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label} </td>
                                                        <td style="border-right: 1px solid #ddd;"   >
                                                            <apex:outputField value="{!LFixCost2nd[itm].Module.ASI_CRM_Unit__c}"/>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style=" border-left: 1px solid #ddd;border-bottom: 1px solid #ddd;"  class="MethodologyLabel"  >
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label} 
                                                        </td>
                                                        <td style=" border-left: 1px solid #ddd; border-right: 1px solid #ddd;border-bottom: 1px solid #ddd;"  colspan="5" > 
                                                            {!LFixCost2nd[itm].Module.ASI_CRM_Remark_Display__c} 
                                                        </td>
                                                        
                                                    </tr>
                                                    
                                                </table>
                                                
                                            </div>
                                            
                                            <div class="bs table-responsive"  style="padding-top: 0.5em;"> 
                                                <table class="bs table table-condensed" style="margin-bottom: 0; "  >
                                                    <thead>
                                                        <tr>
                                                            <th style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','width:20%','display:none;')}  " >
                                                                {!$ObjectType.ASI_MFM_Sub_brand__c.Label}
                                                            </th>
                                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >{!$Label.ASI_CRM_CN_Grade}</th>
                                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</th>
                                                            <th> 
                                                                <span style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" > 
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/> </span>
                                                                <span style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                                </span>
                                                            </th>
                                                            <th> 
                                                                <span style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                                </span>
                                                                <span style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                                </span>
                                                                <br/>
                                                            </th>
                                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                            </th>
                                                            <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                            </th>
                                                            
                                                            <th style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_FC_Per_Bottle}"/>
                                                            </th>
                                                            <th style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_FC_Per_Bottle}"/>
                                                            </th>
                                                            <th>
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                            </th>
                                                            <th>
                                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                            </th>
                                                            <!-- <th style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >
                                                                <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_Key_Sub_brand__c.Label}"/>
                                                            </th> -->
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <apex:variable value="{!0}" var="FCEstMonthlyQty"/>
                                                        <apex:variable value="{!0}" var="FCContractMonthlyQty"/>
                                                        <apex:variable value="{!0}" var="FCEstTotalQty"/>
                                                        <apex:variable value="{!0}" var="FCContractTotalQty"/>
                                                        <apex:variable value="{!0}" var="FCEstBRSFPerBottle"/>
                                                        <apex:variable value="{!0}" var="FCContractBRSFPerBottle"/>
                                                        <apex:variable value="{!0}" var="FCEstTotalQTYCR12"/>
                                                        <apex:variable value="{!0}" var="FCContractTotalQTYCR12"/>
                                                        <apex:variable value="{!0}" var="FCEstTotal"/>
                                                        <apex:variable value="{!0}" var="FCContractTotal"/>
                                                        
                                                        <apex:repeat value="{!LFixCost2nd[itm].DetailLineMap}"  var="line" id="FClineItem2" >
                                                            <apex:variable var="FCEstMonthlyQty" value="{!FCEstMonthlyQty+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                            <apex:variable var="FCContractMonthlyQty" value="{!FCContractMonthlyQty+LFixCost2nd[itm].DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>  
                                                            
                                                            <apex:variable var="FCContractTotalQty" 
                                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c!=null}"
                                                                           value="{!FCContractTotalQty+LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>
                                                            <apex:variable var="FCEstTotalQty" 
                                                                           rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c!=null}"
                                                                           value="{!FCEstTotalQty+LFixCost2nd[itm].DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>
                                                            <apex:variable var="FCEstTotalQTYCR12" value="{!FCEstTotalQTYCR12+LFixCost2nd[itm].DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>  
                                                            <apex:variable var="FCContractTotalQTYCR12" value="{!FCContractTotalQTYCR12+LFixCost2nd[itm].DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>  
                                                            <apex:variable var="FCEstTotal" value="{!FCEstTotal+LFixCost2nd[itm].DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>  
                                                            <apex:variable var="FCContractTotal" value="{!FCContractTotal+LFixCost2nd[itm].DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>                                                        
                                                            
                                                            <tr>
                                                                <td>
                                                                    <div  style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                        <apex:outputField value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}" />
                                                                    </div>
                                                                    <div  style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Grade','','display:none;')}  " >
                                                                        <apex:outputLink value="/{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}</apex:outputLink>
                                                                    </div>
                                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                                        <apex:outputField value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Product_Category__c}" />
                                                                    </div>
                                                                    <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                                        {!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Volume_Base__c}
                                                                    </div>
                                                                </td>
                                                                <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <!-- <apex:outputField value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}" /> -->
                                                                    <!-- <apex:outputLink value="/{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}</apex:outputLink> -->
                                                                    <apex:outputLink value="/{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                                </td>
                                                                
                                                                <td  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                                        <apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/></apex:outputText>
                                                                </td>

                                                                <td  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <div    data-Item="{!itm}"   data-id="{!line}"    id="{!'FCEstQty_'+line}"  >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/></apex:outputText>
                                                    
                                                    </div>
                                                                </td>
                                                                
                                                                <td  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                </td>
                                                                <td  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/></apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/></apex:outputText>
                                                                </td>
                                                                <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                <td  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                                    <div    data-Item="{!itm}"   data-id="{!line}"  data-Incentive="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c}"  id="{!'FCEstPerBottle_'+line}"  >
                                                        <apex:outputText rendered="{!!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Is_Payment_New__c}" value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/></apex:outputText>
                                                        <apex:inputField rendered="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Is_Payment_New__c}" value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}" 
                                                                         onchange="SettingFCEstTotal2nd(this);FCESTCheckOverPaid($(this),this)"  
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth requiredField  {!'FCContractIncentive_'+itm} "     ></apex:inputField>
                                                    </div>
                                                                <!-- <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}" 
                                                                                     style="{!IF(LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c < LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c,'color: red; font-weight: bold;','')}"  >
                                                                        <apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>
                                                                    </apex:outputText> -->
                                                                </td>
                                                                
                                                                <td >
                                                                    <div data-Item="{!itm}"  data-id="{!line}"  id="{!'FCContractDummyTotal_'+line}">
                                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                                    </apex:outputText>
                                                                    </div>
                                                                    
                                                                </td>
                                                                <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " data-Item="{!itm}"   data-id="{!line}" class="{!'FCEstDummyTotalClass_'+itm}"  id="{!'FCEstDummyTotal_'+line}">
                                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                        <apex:param value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                                    </apex:outputText>
                                                                </td>
                                                                <td>
                                                                <div style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" 
                                                         data-Item="{!itm}"   data-id="{!line}"   id="{!'FCEstDummyTotal_'+line}"  >
                                                                    <apex:inputField styleClass="ApexInputNumberField" value="{!LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}" onchange="FCChangeEstDummyTotalAmount(this);"  
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth {!'FCEstTotalDummy_'+itm}"/>
                                                                     </div>
                                                           </td>
                                                                <!-- <td style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%; ')}"  >
                                                                    
                                                                    <div style="{!IF(LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Key_Sub_brand__c,'','display:none;')}"   >
                                                                        <input name="chkBox_1" type="checkbox"  value="1" disabled="true" checked="true" />
                                                                    </div>
                                                                    <div style="{!IF(LFixCost2nd[itm].DetailLineMap[line].ASI_CRM_Key_Sub_brand__c,'display:none;','')}"   >
                                                                        <input name="chkBox_1" type="checkbox"  value="1" disabled="true"   />
                                                                    </div>
                                                                </td> -->
                                                            </tr>
                                                        </apex:repeat>
                                                        <tr class="FontWeightCSS" style="background-color: #e3e3d7;" >
                                                            <td>{!$Label.ASI_CRM_CN_Total_Amount} 
                                                            </td>
                                                            <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                            </td>
                                                            <td id="{!'TotalFCContractQty_'+itm}" style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!FCContractMonthlyQty}"/></apex:outputText>
                                                            </td>
                                                            <td id="{!'TotalFCEstimateQty_'+itm}" style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!FCEstMonthlyQty}"/></apex:outputText>
                                                            </td>
                                                            <td id="{!'FCContractTotalQTY_'+itm}" style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!FCContractTotalQty}"/></apex:outputText>
                                                            </td>
                                                            <td id="{!'FCEstTotalQTY_'+itm}" style="{!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}" >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!FCEstTotalQty}"/></apex:outputText>
                                                            </td>
                                                            <td id="{!'TotalFCContractTotalQTYCR12_'+itm}"  style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  " >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCContractTotalQTYCR12}"/></apex:outputText>
                                                            </td>                                                            
                                                            <td id="{!'TotalFCEstTotalQTYCR12_'+itm}" style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCEstTotalQTYCR12}"/></apex:outputText>
                                                            </td>
                                                            <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                            </td>
                                                            <td style=" {!IF(LFixCost2nd[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  " >
                                                            </td>
                                                            <td id="{!'FCContractTotalPart_'+itm}">  
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCContractTotal}"/></apex:outputText>
                                                            </td>
                                                            <td  id="{!'FCEstTotalPart_'+itm}" class="FCEstimateTotalClass"  >
                                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!FCEstTotal}"/></apex:outputText>
                                                            </td>
                                                            <td></td>
                                                        </tr>
                                                        
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        
                                    </apex:outputPanel>
                                    
                                    <br/>
                                    <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto; padding-top:0.5em;"   >
                                    <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;font-weight: bold;"  >
                                        <apex:outputText escape="false" value="{!itm + '金额调整与汇总'}"/>
                                    </div>
                                    <div style="grid-column-start: 2; grid-column-end: 2;  " ></div> 
                                </div>
                                <div class="PanelBody" style="width:70%" >
                                    <div class="bs table-responsive" > 
                                        <table class="bs table table-condensed" style="margin-bottom: 0; width:100%" >
                                            <!-- <tr>
                                                <td class="PSFAdjLabel" >
                                                    <apex:outputText value="{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_V0_FC_Contract_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em;" >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].Module.ASI_CRM_V0_FC_Contract_Total__c}"/></apex:outputText>
                                                </td>
                                                <td class="PSFAdjLabel"  >
                                                    <apex:outputText value="{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Expected_V0_FC_Estimated_Total__c.Label}"/>
                                                </td>
                                                <td > 
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].Module.ASI_CRM_Expected_V0_FC_Estimated_Total__c}"/></apex:outputText>
                                                </td>
                                            </tr>
                                            
                                            <tr>
                                                <td></td>
                                                <td ></td>
                                                <td class="PSFAdjLabel" >
                                                    <apex:outputText value="{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Previous_Version_FC_Est_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em; " id="PSFGrandEstimateTotalBeforeAdjustmentId"  > 
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!LFixCost2nd[itm].Module.ASI_CRM_Previous_Version_FC_Est_Total__c}"/></apex:outputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="PSFAdjLabel" ></td>
                                                <td style="padding-top: 0.8em;" ></td>
                                                <td  class="PSFAdjLabel" > 
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Adjustment}"/>
                                                </td>
                                                <td id="PSFAdjustmentAmountId">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!LFixCost2nd[itm].Module.ASI_CRM_FC_Estimate_Adjustment_Amount__c}"/>
                                                    </apex:outputText>
                                                </td>
                                            </tr> -->
                                            <tr>
                                                <td class="FCAdjLabel" ></td>
                                                <td></td>
                                                <td  class="FCAdjLabel" >
                                                    <apex:outputText escape="false" value="预计总金额"/>
                                                </td>
                                                <td  id="{!'Expected_FC_Est_Total_'+itm}"  style="{!IF(lfSize[itm] > 0 ,'','display:none;')}" >
                                                    <apex:inputField value="{!LFixCost2nd[itm].Module.ASI_CRM_CN_Expected_Est_Total__c}"
                                                                     onchange="formatTotal(this);"  styleClass="ApexInputNumberField" />
                                                </td>
                                                <td  style="{!IF(lfSize[itm] > 0 ,'display:none;','')}"  >
                                                    0.00
                                                </td>
                                            </tr>
                                            
                                            
                                        </table>
                                    </div>
                                </div> 

                                <br/>
                                </apex:repeat>
                            </div>
                            
                        </apex:outputPanel>
                    </div>
                </div>
                
                
                <!------------------ Covered Outlet ------------------------------------------->
                
                <div class="row  " style="padding-top: 1em;">
                    <div class="col">
                        <apex:outputPanel id="CoveredOutletPanel">
                            <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;"   >
                                
                                <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  >{!$Label.ASI_CRM_CN_Covered_Outlet}</div>
                                
                                <div style="grid-column-start: 2; grid-column-end: 2;  " >
                                    <div style="margin-left: 5em;" >
                                        <apex:commandButton styleClass="BSCommandButton" 
                                                            value="{!$Label.ASI_CRM_CN_Add_New}" 
                                                            action="{!AddNew_CoveredOutlet}" 
                                                            reRender="CoveredOutletPanel"  
                                                            status="ActionStatus" />
                                        <apex:commandButton styleClass="BSCommandButton" 
                                                            value="{!$Label.ASI_CRM_CN_Add_All_Child_Outlet}" 
                                                            action="{!AddAllChildOutlets}" 
                                                            reRender="CoveredOutletPanel"  status="ActionStatus" />
                                    </div> 
                                </div>
                            </div>
                            
                            <div class="PanelBody" >
                                
                                <apex:outputPanel >
                                    
                                    <table class="bs table table-condensed" style="margin-bottom: 0;"  >
                                        <thead>
                                            <tr>
                                                <th>
                                                    {!$Label.ASI_CRM_CN_Select_All}<br/>
                                                    <apex:inputCheckbox onclick="selectAllCheckboxes(this,'inputId')"   />
                                                </th>
                                                <th>{!$Label.ASI_CRM_CN_Outlet}</th>
                                                <th style="{!IF(showSuggestedAmountAndTargetVolume,'','display:none;')}"  >Suggested Amount </th>
                                                <th style="{!IF(showSuggestedAmountAndTargetVolume,'','display:none;')}"  >Target Volume (Std Btl)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                            <apex:repeat value="{!CoveredOutlet_Item_Map}"  var="itm" id="CoveredOutletLine" >
                                                <tr>
                                                    <td> 
                                                        <apex:inputfield value="{!CoveredOutlet_Item_Map[itm].ASI_CRM_CN_Selected_Covered_Outlet__c }" id="inputId"  />    
                                                    </td> 
                                                    <td> 
                                                        <div class="style-1"  >
                                                            <apex:inputField value="{!CoveredOutlet_Item_Map[itm].ASI_CRM_CN_Outlet__c}" />
                                                        </div>
                                                    </td>
                                                    <td  style="{!IF(showSuggestedAmountAndTargetVolume,'width:30%','display:none;')}"  >
                                                        <apex:inputField value="{!CoveredOutlet_Item_Map[itm].ASI_CRM_CN_Suggested_Amount__c}" 
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth  " />
                                                    </td>
                                                    <td style="{!IF(showSuggestedAmountAndTargetVolume,'width:30%','display:none;')}"  >
                                                        <apex:inputField value="{!CoveredOutlet_Item_Map[itm].ASI_CRM_CN_Target_Volume_Std_Btl__c}" 
                                                                         styleclass="ApexInputNumberField InputNumberFieldwidth  " />
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </tbody>
                                        
                                    </table>
                                </apex:outputPanel>
                                
                                
                            </div>
                        </apex:outputPanel>
                        
                    </div>
                </div>
                                
                <apex:actionstatus id="ActionStatus">
                    <apex:facet name="start">
                        <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                                                                             height: 100%; width:100%; opacity:0.65;"> 
                            <div class="waitingHolder" id="loadtext" style="position: absolute;" align="left" valign="top">
                                &nbsp;&nbsp;&nbsp;
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                                <span class="waitingDescription">Please Wait...</span>
                            </div>
                        </div>
                    </apex:facet>
                </apex:actionstatus>   
                
            </div>
        </div>
        
    </apex:form>
    
</apex:page>