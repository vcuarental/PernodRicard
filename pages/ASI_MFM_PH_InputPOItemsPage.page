<apex:page standardController="ASI_MFM_PO_Line_Item__c" sidebar="false"  docType="html-5.0" recordSetVar="POLineItems" extensions="ASI_MFM_PH_InputPOItemsController" action="{!init}">

    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
            
        
        <apex:stylesheet value="{!URLFOR($Resource.ASI_MFM_PH_Library, 'dist/css/bootstrap.min.css')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.ASI_MFM_PH_Datatable, 'DataTables-1.10.7/media/css/jquery.dataTables.min.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.ASI_MFM_PH_Library, 'dist/css/SimpleTable.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.ASI_MFM_PH_Jqueryui,'jquery-ui-1.11.4.custom/jquery-ui.css')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, 'build.css')}" />
                <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, '/bower_components/Font-Awesome/css/font-awesome.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, '/bower_components/Font-Awesome/css/font-awesome.min.css')}" />
        
          <apex:includeScript value="{!URLFOR($Resource.ASI_MFM_PH_Library, 'dist/js/jquery.min.js')}" />   
        <apex:includeScript value="{!URLFOR($Resource.ASI_MFM_PH_Library,  'dist/js/jquery-ui.min.js')}" />  
        <apex:includeScript value="{!URLFOR($Resource.ASI_MFM_PH_Library, 'dist/js/calx_js/numeral.min.js')}" />  
        <apex:includeScript value="{!URLFOR($Resource.ASI_MFM_PH_Library, 'dist/js/jquery-calx-2.2.3.min.js')}" />               
        
        <apex:includeScript value="{!URLFOR($Resource.ASI_MFM_PH_Library, 'dist/js/bootstrap.min.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.ASI_MFM_PH_Datatable, 'DataTables-1.10.7/media/js/jquery.dataTables.min.js')}" />
        
        <apex:includeScript value="{!URLFOR($Resource.ASI_MFM_PH_Library, 'dist/js/numericInput.min.js')}" />
        
        <apex:includeScript value="{!URLFOR($Resource.ASI_MFM_PH_Library, 'dist/js/CurrencyUtil.js')}" />

        <style type="text/css">
             th {
                 white-space: nowrap; 
                }
            .thtitle{
                color: red;
                }
            
            div.hid {display: none;}
    
            /* highlight results */ 
            .ui-autocomplete span.hl_results {
                background-color: #ffff66;
            }
             
            /* loading - the AJAX indicator */
            .ui-autocomplete-loading {
                background: white url('/img/loading.gif') right center no-repeat;
            }
            
            
            .ui-autocomplete-input{ 
                border-left: 3px solid darkred !important;    
            }
        
            .ui-autocomplete {
                height: 200px;
                overflow-y: auto;
                /* prevent horizontal scrollbar */
                overflow-x: hidden;
                overflow:auto;
                /* add padding to account for vertical scrollbar */
                padding-right: 20px;
                left: 0;
            }
            // IE 6 doesn't support max-height
            // we use height instead, but this forces the menu to always be this tall
             
             *html .ui-autocomplete {
                height: 200x;
            }
            
            
           .bs.panel-heading.div-size {
           border-radius: 10px;
           }
           
           body {
           font-family: Arial;
           font-size: 9pt;
           }
           
           th { 
           white-space: nowrap; 
           }    

            .required {
                border-left: 3px solid darkred !important;  
            }
            
           .ui-helper-hidden-accessible { display:none !important;} 
           
            .ui-helper-hidden-accessible { position: absolute; left:-999em !important;}
      
        
         </style>
         
        
    <script type="text/javascript">
        
        $j = jQuery.noConflict();
        var headerId = null;
        var Customers = [];
        var ACCodes = [];
        var APCodes = [];
        var SubBrands = [];
        var calc ;
        var resultTable;
        var sheet;
        var returnURL;
        var currentForm = null;
        var resultTable;
        var SubBrandRecordTypeName = null;
        var ACCodeRecordTypeName = null;
        var APCodeRecordTypeName = null;
        var CustomerTypeName = null;
        var datatableILength = 15;     
        var PHDFCustomerDefault= null;
        var currentAPIndex=0;
        var setAP=false;
        var apClassList=null;
                               
        var aismfm = aismfm  || {};
        aismfm.component = aismfm.component || {};
                                                        
        
        aismfm.component.manageAllFunction = function(){
            
            function init() {
                
                // $j('.unitPrice_manageAll_input input').change();
                
                // $j('.qty_manageAll_input input').change();
                
                $j('.totalAmount_manageAll_input input').change();
                
                $j('.lookupCen input').change();
            }
            
            function calculateTotalAmount(Id){
                console.log($j('#unitPrice_manageAll_' + Id + '_unitPrice input').val());                       
                var cellId  = $j('#unitPrice_manageAll_' + Id + '_unitPrice input').attr('data-cell');
                var unitCost = toNumber($j('#unitPrice_manageAll_' + Id + '_unitPrice input').val(), 0);
                var addr = cellId.substring(1, 2);
                var qty  = toNumber($j('#qty_manageAll_' + Id + '_qty input').val(), 0);
                
                if(qty && unitCost && qty>0 && unitCost>0){
                    
                    //$j('#unitPrice_manageAll_' + Id + '_unitPrice input').val(parseFloat(unitCost).toFixed(2));
                    
                    //console.log ("A"+addr + "*" + "B"+ addr +" need to calculate the total amount" );
                    var totalAmount  = qty * unitCost; 
                    //$j('input[data-cell=C'+addr+']').val(totalAmount);
                    $j('input[data-cell=C'+addr+']').attr('value',parseFloat(totalAmount).toFixed(2));
                    $j('#totalAmount_manageAll_' + Id + '_totalAmount input').val(parseFloat(totalAmount).toFixed(2));
                }        
            }
            
            
            
            
            function toNumber(value, ifNaNValue) {               
                num = Number(value);
                return isNaN(num) ? ifNaNValue : num;
            } 
            
            
            return {
                init: init,
                calculateTotalAmount : calculateTotalAmount          
            };
        }();        
        
        



        function initPOItemPage(config) {
            if (config) {
                SubBrandRecordTypeName = config.SubBrandRecordTypeName;
                ACCodeRecordTypeName=config.ACCodeRecordTypeName;
                APCodeRecordTypeName=config.APCodeRecordTypeName;
                CustomerTypeName=config.CustomerTypeName;
                PHDFCustomerDefault = config.PHDFCustomerDefault;
                headerId = config.headerId;
                setResultTable(true);
                retrieveSubBrands();
                retrieveAPCode();
                //retrieveACCode();
                retrieveCustomer();
            }
        }      
        
 
       
       
        $j(document).on('mousemove', function(e){
            $j('#loadtext').css({
                left:  e.pageX,
                top:   e.pageY
            });
        });
        

        /*method for stop enter to submit form*/
         function stopRKey(evt) {
           var evt = (evt) ? evt : ((event) ? event : null);
           var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null);
           if ((evt.keyCode == 13) && (node.type=="text")) {return false;}
        }
        
        document.onkeypress = stopRKey; 
        
        
        /*method for encode auto-complete result*/

        function htmlEncode( input ) {
          var e = document.createElement('div');
          e.innerHTML = input;
          return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
          //return String(input).replace(/\&amp;/g,'&').replace(/\&lt;/g,'<').replace(/\&rt;/g,'>');
        };
     
        
        // Retrieve Customer
        function retrieveCustomer() {
            
            var whereClause =   ' WHERE RecordType.DeveloperName = \''+ CustomerTypeName + '\' '
            
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.ASI_MFM_PH_InputPOItemsController.findSObjects}','Account', whereClause 
                , callbackCustomer
                , {escape: true, timeout: 10000}
            );       
        }
        
        
        function callbackCustomer(result, event){
            if (event.status) {
                if (result) {
            
                    Customers = [];
                    var size = result.length;
                    for (var i = 0; i < size; i++) {
                        var cu = new Object();
                        cu.label =  htmlEncode(result[i]["Name"]);
                        cu.value =  htmlEncode(result[i]["Id"]);
                        Customers.push(cu);
                    }
                }
            } else {
                // TODO: Handle error
                //displayErrorMsg(event.message);
            }   
            initalizeAutoCompleteComponent();
        }
        
                
        // Retrieve A/C Code
        function retrieveACCode() {
            
            var whereClause =   ' WHERE RecordType.DeveloperName = \''+ ACCodeRecordTypeName + '\' and Id != null';
            console.log('Finding A/C Code : '+ whereClause);
            
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.ASI_MFM_PH_InputPOItemsController.findSObjects}','ASI_MFM_A_C_Code__c', whereClause 
                , callbackAPcode
                , {escape: true, timeout: 10000}
            );       
        }                
        function callbackACcode(result, event){
            if (event.status) {
                if (result) {
            
                    ACCodes = [];
                    var size = result.length;
                    for (var i = 0; i < size; i++) {

                        //AC Code
                        var ac = new Object();
                        ac.label =  htmlEncode(result[i]["Name"]);
                        ac.value =  htmlEncode(result[i]["Id"]);                                          
                        ACCodes.push(ac);
                    }
                }
            } else {
                // TODO: Handle error
                //displayErrorMsg(event.message);
            }   
            initalizeAutoCompleteComponent();
        }
        
        
        // Retrieve AP Code
        function retrieveAPCode(APSegmentFilter) {
            var whereClause =   ' WHERE RecordType.DeveloperName = \''+ APCodeRecordTypeName + '\' and Id != null';
            if(APSegmentFilter.length>0)
                whereClause += APSegmentFilter;
            console.log('Finding AP Code : '+ whereClause);
           
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.ASI_MFM_PH_InputPOItemsController.findSObjects}','ASI_MFM_AP_Code__c', whereClause 
                , callbackAPcode
                , {escape: true, timeout: 10000}
            );       
        }
        function callbackAPcode(result, event){
            if (event.status) {
                if (result) {                  
                    var PickOption = [];
                    var size = result.length;
                    for (var i = 0; i < size; i++) {
                        //AP Code
                        var ap = new Object();
                        ap.label =  htmlEncode(result[i]["Name"]);
                        ap.value =  htmlEncode(result[i]["Id"]); 
                        ap.desc = htmlEncode(result[i]["ASI_MFM_AP_Code__c"]);                  
                        PickOption.push(ap);
                    }
                //  alert(result.length);
                    
                    $j(apClassList[currentAPIndex]).autocomplete({
                    source: 
                        PickOption,
                    response: function(event, ui) 
                            {
                                if(ui.content.length===0){ 
                                    console.log("No result found");
                                }
                            }           
                    ,
                    minLength: 0,
                       delay: 300,
                    scroll: true,
                    change: function (event, ui) {
                        if (!ui.item) {
                            this.value = '';
                        }
                    },
                    select: function(event, ui){
                                $j(this).val(ui.item.label);
                                $j(this).next().next().children().val(ui.item.value);                
                                event.preventDefault();
                            },
                     focus: function(event, ui){
                                $j(this).val(ui.item.label);
                                event.preventDefault();
                     }  
                    
                    })
                    .focus(function () {
                        $j(this).autocomplete("search", "");
                    }).each(function() {
                    $j(this).data('ui-autocomplete')._renderItem = function( ul, item ) {
                        return $j("<li>").html("<a style='margin-left: 2px;'><span><strong>" + item.label + "</strong></span><span style='margin-right: 2px; float:right;'>&nbsp;&nbsp;&nbsp;" + item.desc + "</span><a>")  
                        .appendTo(ul); 
                        };                        
                    });
                    currentAPIndex++;                 
                }
            } else {
                // TODO: Handle error
                //displayErrorMsg(event.message);
            }   
   //         initalizeAutoCompleteComponent();
        }
        function getAPsegmentFromAC(event){
             var newname=event.name;
             newname=newname.substring(0,newname.length-1)+"5"; // get the name of position of AP Segment
             var x = document.getElementsByName(newname)[0];
             var segName=x.value;
             //alert(segName);
             retrieveAPCode(' and name like \''+segName+'%\'');    
         }

        // Retrieve Sub brand
        function retrieveSubBrands() {
            
            var whereClause =   ' WHERE RecordType.DeveloperName = \''+ SubBrandRecordTypeName + '\' and ASI_TH_CRM_Active__c=true '
            console.log('Finding Sub-Brands : '+ whereClause);
            
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.ASI_MFM_PH_InputPOItemsController.findSObjects}','ASI_MFM_Sub_brand__c', whereClause 
                , callbackSubBrands
                , {escape: true, timeout: 10000}
            );       
        }        
        function callbackSubBrands(result, event){
            if (event.status) {
                if (result) {
            
                    SubBrands = [];
                    var size = result.length;
                    for (var i = 0; i < size; i++) {

                        //Subbrand
                        var SubBrand = new Object();
                        SubBrand.label =  htmlEncode(result[i]["Name"]);
                        SubBrand.value =  htmlEncode(result[i]["Id"]);
                        
                        SubBrands.push(SubBrand);
                    }
                }
            } else {
                // TODO: Handle error
                //displayErrorMsg(event.message);
            }   
            
            initalizeAutoCompleteComponent();
        }
        
                
        //DataTable Variable
        var polineSubBrand;
        var polineItems;

        
           
        function initalizeAutoCompleteComponent() {
            
                //console.log(ACCodes);
            
                $j(".SubBrandClass").autocomplete({
                    source: 
                        SubBrands,
                    response: function(event, ui) 
                            {
                                if(ui.content.length===0){ 
                                    console.log("No result found");
                                }
                            }                 
                ,
                minLength: 0,
                delay: 300,
                scroll: true,
                change: function (event, ui) {
                    if (!ui.item) {
                        this.value = '';
                    }
                },
                select: function(event, ui){
                            $j(this).val(ui.item.label);
                            $j(this).next().next().children().val(ui.item.value);                
                            event.preventDefault();
                        },
                 focus: function(event, ui){
                            $j(this).val(ui.item.label);
                            event.preventDefault();
                 }  
                
                })
                .focus(function () {
                    $j(this).autocomplete("search", "");
                    $j(this).autocomplete("option", "delay", 0);
                });
                        
            
              $j(".ACCodeClass").autocomplete({
                    source: 
                        ACCodes,
                    response: function(event, ui) 
                            {
                                if(ui.content.length===0){ 
                                    console.log("No result found");
                                }
                            }  
                    
                ,
                minLength: 0,
                   delay: 300,
                scroll: true,
                change: function (event, ui) {
                    if (!ui.item) {
                        this.value = '';
                    }
                },
                select: function(event, ui){
                            $j(this).val(ui.item.label);
                            $j(this).next().next().children().val(ui.item.value);                
                            event.preventDefault();
                        },
                 focus: function(event, ui){
                            $j(this).val(ui.item.label);
                            event.preventDefault();
                 }  
                
                })
                .focus(function () {
                    $j(this).autocomplete("search", "");
                });
                
                
                if(!setAP){
                    apClassList = $j(".APCodeClass");
                    for (var i = 0; i < apClassList.length; i++) {
                        setTimeout(getAPsegmentFromAC(apClassList[i]), 500);
                    }
                    setAP=true;
                }
     /*         
             
              $j(".APCodeClass").autocomplete({
                    source: 
                        APCodes,
                    response: function(event, ui) 
                            {
                                if(ui.content.length===0){ 
                                    console.log("No result found");
                                }
                            }  
                    
                ,
                minLength: 0,
                   delay: 300,
                scroll: true,
                change: function (event, ui) {
                    if (!ui.item) {
                        this.value = '';
                    }
                },
                select: function(event, ui){
                            $j(this).val(ui.item.label);
                            $j(this).next().next().children().val(ui.item.value);                
                            event.preventDefault();
                        },
                 focus: function(event, ui){
                            $j(this).val(ui.item.label);
                            event.preventDefault();
                 }  
                
                })
                .focus(function () {
                    $j(this).autocomplete("search", "");
                }).each(function() {
                $j(this).data('ui-autocomplete')._renderItem = function( ul, item ) {
                    return $j("<li>").html("<a style='margin-left: 2px;'><span><strong>" + item.label + "</strong></span><span style='margin-right: 2px; float:right;'>&nbsp;&nbsp;&nbsp;" + item.desc + "</span><a>")  
                    .appendTo(ul); 
                    };                        
                });
      */    
            
              if(!PHDFCustomerDefault){
                  console.log('t-enter'+Customers);
              $j(".CustomerClass").autocomplete({
                    source: 
                        Customers,
                    response: function(event, ui) 
                            {
                                if(ui.content.length===0){ 
                                    console.log("No result found");
                                }
                            }  
                    
                ,
                  delay: 300,
                minLength: 0,
                scroll: true,
                change: function (event, ui) {
                    if (!ui.item) {
                        this.value = '';
                    }
                },
                select: function(event, ui){
                            $j(this).val(ui.item.label);
                            $j(this).next().next().children().val(ui.item.value);                
                            event.preventDefault();
                        },
                 focus: function(event, ui){
                            $j(this).val(ui.item.label);
                            event.preventDefault();
                 }  
                
                })
                .focus(function () {
                    $j(this).autocomplete("search", "");
                    $(this).autocomplete("option", "delay", 0);
                });
            
              }else
                {
                    
                   $j('.Customer_lkup input').each(function()
                      {
                          $j(this).attr('disabled',true);
                          
                      });
                  
     
                    
                }
            
        }
        
        function setResultTable(newTable){
            
            //console.log(newTable);
            
            //resultTable =  $j("#dt_LineItems").DataTable(basicDataTableProperties);
            
            resultTable =  $j('#dt_LineItems').on( 'init.dt', function () {
                
                initalizeAutoCompleteComponent();
                
            }).DataTable({                                         
                "bDestroy":true,
                          "bStateSave":true,
                          "bSearch":false,
                          "dom": '<"top">irt<"bottom"p><"clear">',
                          "bAutoWidth":false,                       
                          "bSort": false, 
                          "iDisplayLength":datatableILength,
                          "sPaginationType": "full_numbers",
                          "bLengthChange": false,
                          "columnDefs": [{
                              "targets": [ 0 ],
                              "searchable": false,
                              "orderable": false
                          }   
                                        ],
                          "fnDrawCallback": function() {
                              
                              initalizeAutoCompleteComponent();
                              
                              $j('.lookupCen input').change();
                              
                              $j('.unitPrice_manageAll_input input').each(function(idx, elem){
                                  var str = new String($j(this).val());
                                  $j(elem).val(str.replace(',', ''));
                              });                                                                           
                              
                              // $j('.qty_manageAll_input input').change();
                              
                              $j('.totalAmount_manageAll_input input').each(function(idx, elem){
                                  var str = new String($j(this).val());
                                  $j(elem).val(str.replace(',', ''));
                              });      
                              
                              
                          }               
                          
                          
                         });
            
            var info = resultTable.page.info();
            
            
            if(newTable==false){
                addRow(); 
            } 
            
            initalizeAutoCompleteComponent();
            
        }        
        
        function setTables(newTable){
            setResultTable(newTable);
            

        }
        
        function addRow(){
              resultTable.page('last').draw(false);             
        }
        
         function Amountfunction(Id){
             //If total amount not equel to qty*unit, clear qty and unity
             if(($j('#qty_manageAll_' + Id + '_qty input').val()*$j('#unitPrice_manageAll_' + Id + '_unitPrice input').val())!=$j('#totalAmount_manageAll_' + Id + '_totalAmount input').val()){
                 $j('#qty_manageAll_' + Id + '_qty input').val("");
                 $j('#unitPrice_manageAll_' + Id + '_unitPrice input').val("");
             }
         }

 
         $j(document).ready(function() {


            initPOItemPage({
                headerId: '{!header.Id}',
                SubBrandRecordTypeName : '{!subBrand_RecordType_Developer_Name}',
                ACCodeRecordTypeName : '{!a_c_code_RecordType_Developer_Name}',
                APCodeRecordTypeName : '{!ap_code_RecordType_Developer_Name}',
                CustomerTypeName:'{!Customer_RecordType_Developer_Name}',
                PHDFCustomerDefault: '{!PHDFCustomerDefault}'
                
            });
            
           

         });                         
       
        </script>
        

    </head>
    
    
    <apex:form id="objectForm" styleclass="objectFormCls" >
        <div id="divForm" class="bs container-fluid">
            <div class="bs row" style="margin:0;">
                <div class="bs col-xs-12"> 
                
                 
                 <apex:outputPanel styleclass="bs panel-primary" id="paymentDetailPanel">
                        <div class="bs panel-heading div-size">
                            <h5 class="bs panel-title">PO Details</h5>
                        </div>
                         <div class="bs panel-body">                                           
                            <div class="bs table-responsive" >          
                                <table class="bs table">
                                    <tbody>
                                        <tr>
                                            <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.Name.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputLink value="{!LEFT($Api.Partner_Server_URL_140, FIND('.com/',$Api.Partner_Server_URL_140)+3)}/{!Header.ID}" target="_blank">
                                                <apex:outputField value="{!Header.Name}"></apex:outputField>
                                                </apex:outputLink>
                                            </td>
                                             <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_Plan__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_Plan__c}"></apex:outputField></td>
                                         </tr>
                                        <tr>
                                         <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_Plan_Balance__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td>
                                                <apex:outputField value="{!Header.ASI_MFM_Plan_Balance_in_PO_Currency__c}" rendered="{!IF(PHDFCustomerDefault==null,true,false)}"></apex:outputField>
                                                <apex:outputField value="{!Header.ASI_MFM_Plan_Balance__c}" rendered="{!IF(PHDFCustomerDefault==null,false,true)}"></apex:outputField>
                                            
                                            </td>
                                        <td><apex:outputLabel value="Plan Owner" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_Plan__r.ownerId}"></apex:outputField></td>
                                        </tr>
                                             <tr>
                                            <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_PO_Start_Date__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_PO_Start_Date__c}"></apex:outputField></td>
                                            <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_PO_End_Date__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_PO_End_Date__c}" ></apex:outputField></td>                              
                                        </tr>
                                          <tr>
                                            <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_Currency__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_Currency__c}"></apex:outputField></td>
                                               <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_Exchange_Rate__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_Exchange_Rate__c}"></apex:outputField></td>                            
                                        </tr>
                                        
                                        <tr style="{!IF(isnull(PHDFCustomerDefault),'','display:none;')}"  >
                                             <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_JDE_Tax_Code__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_JDE_Tax_Code__c}"></apex:outputField></td>
                                             <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_Tax_Rate__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_Tax_Rate__c}"></apex:outputField></td>
                                        </tr>
                                        
                                        <tr>
                                             <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_Supplier_Name__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_Supplier_Name__c}"></apex:outputField></td>
                                             <td><apex:outputLabel value="{!$ObjectType.ASI_MFM_PO__c.Fields.ASI_MFM_Other_Remark__c.Label}" styleclass="control-label" style="color: #4a4a56; font-size: 9pt; vertical-align: middle; padding-right: 10px;"/></td>
                                            <td><apex:outputField value="{!Header.ASI_MFM_Other_Remark__c}"></apex:outputField></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                                            
                  </apex:outputPanel> 


                 
                  <apex:outputPanel styleclass="bs panel-primary" id="LinePanel">
                        <div class="bs panel-heading div-size" >
                            <h5 class="bs panel-title">PO Line Items</h5>
                        </div>  
                        <div class="bs panel-body">
                        
                          <div class="alert alert-danger fade in" style="{!IF(UpsertPermission,'display:none;','')}"  id="SaveFailPart">
                              
                              <strong>Error,Can not Save!</strong><br/>
                                <apex:outputText escape="false" value="{!Msg}"/>
                            </div>  
                            
                            
                            <div class="alert alert-success fade in" style="{!IF(SaveSuccess,'','display:none;')}" id="SaveSuccessPart">
                                <strong>Quick Save Success!</strong>
                                <apex:outputText escape="false" value="{!Msg}"/>
                            </div>                            
                            
                            <div class='bs wrapper text-center' id='bs toolbar' >
                                <div class="bs btn-group " role="group" >
                                    <apex:commandLink styleClass="bs btn btn-default btn-size" 
                                                      value="Save"
                                                      style="font-weight: bold"
                                                      action="{!saveItems}"  
                                                      onclick="resultTable.page.len( -1 ).draw(false);"
                                                      oncomplete="console.log('Save Done');setTables(true);"
                                                      reRender="LinePanel,SaveFailPart,SaveSuccessPart"
                                                      rendered="true"
                                                      target="_parent" >
                                        <apex:param name="IS_QUICK_SAVE" value="false"/>
                                    </apex:commandLink>
                                </div>&nbsp;
                                <div class="bs btn-group " role="group" >
                                    <apex:commandButton styleClass="bs btn btn-default btn-size"
                                                        style="font-weight: bold"
                                                        value="Quick Save"
                                                        action="{!saveItems}"
                                                        status="ActionStatus"
                                                        onclick="resultTable.page.len( -1 ).draw(false);"
                                                        oncomplete="console.log('Quick Save Done');setTables(true);"
                                                        reRender="LinePanel,SaveFailPart,SaveSuccessPart"
                                                        rendered="true"
                                                        html-data-loading-text="Loading..." >
                                        <apex:param name="IS_QUICK_SAVE" value="true"/>
                                    </apex:commandButton>
                                </div>&nbsp;
                                <div class="bs btn-group " role="group" >
                                    
                                    <apex:commandButton styleClass="bs btn btn-default btn-size"
                                                        style="font-weight: bold"
                                                        value="Cancel"
                                                        action="{!cancel}" 
                                                        html-data-loading-text="Loading..."
                                                        html-formnovalidate="formnovalidate"/>
                                </div>
                             </div>
                            
                            <div class="bs table-responsive">  
                             
                            <!--<apex:commandButton styleClass="btn btn-success btn-sm" value="Add New PO Line" action="{!addLineItem}"  onComplete="console.log('Add Row');  setTables(false);"
                                                html-formnovalidate="formnovalidate" reRender="LinePanel,SaveFailPart,SaveSuccessPart"  status="ActionStatus" ></apex:commandButton>-->
                                                
                        
                            <table id="dt_LineItems" class="hover responsive no-wrap compact" style="width: 100%;" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>
                                        </th>
                                        <th>Spread <span class="thtitle" ></span></th>
                                        <th>Customer Name <span class="thtitle" >*</span></th>
                                        <th>Sub Brand <span class="thtitle" >*</span></th>
                                        <th>A/C Code <span class="thtitle" >*</span></th>
                                        <th>A&amp;P Segment <span class="thtitle" >*</span></th>
                                        <th>List Item Description</th>
                                        <th>Unit Price</th>
                                        <th>Quantity</th>
                                        <th>Amount</th>
                                        <th>G/L Date</th>
                                        
                                    </tr>
                                </thead>
                                <tbody> 
                                
                                <apex:variable value="{!0}" var="i"/>
                                
                                <apex:repeat value="{!allLineItemMap}" var="PId">
                                
                                    <apex:variable var="i" value="{!i+1}"/>
                                 
                                    <tr>
                                     <td>
                                     <!--<apex:commandLink styleClass="bs btn btn-default btn-round pull-left btn-xs"
                                                                                    style="border: none;background-color: transparent;"
                                                                                    reRender="LinePanel,SaveFailPart,SaveSuccessPart"
                                                                                    action="{!cloneLine}"
                                                                                    status="ActionStatus"       
                                                                                    onclick="resultTable.page.len( -1 ).draw(false);"
                                                                                    onComplete="console.log('Clone Row'); setTables(false);"
                                                                                    html-formnovalidate="formnovalidate" 
                                                                                    title="Clone line {!i}"
                                                                                    html-data-loading-text="Loading..."
                                                                                    >
                                                                 <span class="bs glyphicon glyphicon-duplicate"  style="color:black;font-size: 20px;"></span>
                                                                <apex:param name="PARAM_clone_ID" value="{!PId}" />
                                                                </apex:commandLink>-->
                                                                
                                     <apex:commandLink styleClass="bs btn btn-default btn-round pull-left btn-sm"
                                                                                    style="border: none;background-color: transparent;"
                                                                                    reRender="LinePanel,SaveFailPart,SaveSuccessPart"
                                                                                    action="{!removeLine}"
                                                                                    status="ActionStatus"
                                                                                    onclick="resultTable.page.len( -1 ).draw(false);"
                                                                                    onComplete="console.log('Remove Row'); setTables(true);"                                                          
                                                                                    html-formnovalidate="formnovalidate"
                                                                                    title="Remove line {!i}"
                                                                                    html-data-loading-text="Loading..." >
                                                                 <span class="bs glyphicon glyphicon-trash"  style="color:red;font-size: 20px;"></span>
                                                                <apex:param name="PARAM_Line_ID" value="{!PId}" />
                                                                </apex:commandLink>
                                        </td>
                                         
                                        <td> 
                                            <div class="checkbox checkbox-primary">
                                                <apex:inputCheckbox value="{!allLineItemMap[PId].Spread}"  ></apex:inputCheckbox>
                                                <label ></label>
                                            </div>
                                        </td>
                                        <!--<td>
                                            <apex:inputField value="{!allLineItemMap[PId].linetems.ASI_MFM_Sub_brand_Code__c}" styleClass="mandatory" ></apex:inputField>
                                        </td>-->
                                         <td class="Customer_lkup">
                                          <apex:input value="{!allLineItemMap[PId].Customer}" styleclass="CustomerClass required" rendered="{!!isFinal}"/>
                                          <apex:outputText value="{!allLineItemMap[PId].Customer}" styleclass="value" rendered="{!isFinal}"/>
                                            <div class="hid">
                                            <apex:inputText value="{!allLineItemMap[PId].CustomerId}" styleclass="value"/>
                                            </div>
                                           <!--- <apex:inputField value="{!allLineItemMap[PId].linetems.ASI_MFM_Customer_Name__c}" styleClass="mandatory" ></apex:inputField>--->
                                             
                                        </td>
                                        <td class="lookupCen">
                                          <!--<apex:input value="{!allLineItemMap[PId].SubBrand}" styleclass="SubBrandClass required" rendered="{!!isFinal}"/>-->
                                          <apex:outputText value="{!allLineItemMap[PId].SubBrand}" styleclass="value" rendered="true"/>
                                            <div class="hid">
                                            <apex:inputText value="{!allLineItemMap[PId].SubBrandId}" styleclass="value"/>
                                            </div>
                                       </td>
                                        <td class="lookupCen">
                                          <!--<apex:input value="{!allLineItemMap[PId].ACCode}" styleclass="ACCodeClass required" rendered="{!!isFinal}"/>-->
                                          <apex:outputText value="{!allLineItemMap[PId].ACCode}" styleclass="value" rendered="true"/>
                                            <div class="hid">
                                            <apex:inputText value="{!allLineItemMap[PId].ACCodeId}" styleclass="value"/>
                                            <apex:inputText value="{!allLineItemMap[PId].APSegment}"/>
                                            </div>
                                          <!--  <apex:inputField value="{!allLineItemMap[PId].linetems.ASI_MFM_A_C_Code__c}" styleClass="mandatory"  ></apex:inputField>---->
                                        </td>
                                        <!--Adding A&P Segment to identify AP type *************Added by 2018-06-26 Linus@introv -->
                                        <td class="lookupCen">
                                         <apex:input value="{!allLineItemMap[PId].APCode}" styleclass="APCodeClass required" rendered="{!!isFinal}"/>
                                          <apex:outputText value="{!allLineItemMap[PId].APCode}" styleclass="value" rendered="{!isFinal}"/>
                                            <div class="hid">
                                            <apex:inputText value="{!allLineItemMap[PId].APCodeId}" styleclass="value"/>
                                            </div>                                            
                                        </td> 
                                        <td>
                                            <apex:inputField value="{!allLineItemMap[PId].linetems.ASI_MFM_List_Item_Description__c}"></apex:inputField>
                                        </td> 
                                        
                                         <td  class="unitPrice_manageAll_input" id="unitPrice_manageAll_{!PId}_unitPrice">
                                            <apex:inputField html-data-id="'{!PId}'" value="{!allLineItemMap[PId].linetems.ASI_MFM_Unit_Price__c}" html-data-cell="A{!i}" onchange="aismfm.component.manageAllFunction.calculateTotalAmount('{!PId}');"/>
                                        </td>
                                        
                                        <td  class="qty_manageAll_input" id="qty_manageAll_{!PId}_qty">
                                            <apex:inputField value="{!allLineItemMap[PId].linetems.ASI_MFM_Quantity__c}" style="white-space: pre-wrap; width: 5em; " html-data-cell="B{!i}" onchange="aismfm.component.manageAllFunction.calculateTotalAmount('{!PId}');"/>
                                        </td>
                                        
                                         <td class="totalAmount_manageAll_input" id="totalAmount_manageAll_{!PId}_totalAmount"> 
                                            <apex:inputField value="{!allLineItemMap[PId].linetems.ASI_MFM_Amount__c}" html-data-cell="C{!i}" onchange="Amountfunction('{!PId}');" styleclass="required" />
                                        </td>
                                        
                                        <td>
                                            <apex:inputField value="{!allLineItemMap[PId].linetems.ASI_MFM_G_L_Date__c}" rendered="{!!isFinal}"/>
                                            <apex:outputText value="{!allLineItemMap[PId].linetems.ASI_MFM_G_L_Date__c}" rendered="{!isFinal}"/>
                                        </td>
                                        
                                    </tr>
                                </apex:repeat>
                                </tbody>
                            </table>
                            </div> 

                        </div>
                     </apex:outputPanel>                   
                </div>
                </div>
        </div>
    
        <apex:actionstatus id="ActionStatus">
                    <apex:facet name="start">
                        <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                                                                             height: 100%; width:100%; opacity:0.65;"> 
                            <div class="waitingHolder" id="loadtext" style="position: absolute;" align="left" valign="top">
                                &nbsp;&nbsp;&nbsp;
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                                <span class="waitingDescription">Please Wait...</span>
                            </div>
                        </div>
                    </apex:facet>
                </apex:actionstatus> 
    
    
    </apex:form>
    
    
 
</apex:page>