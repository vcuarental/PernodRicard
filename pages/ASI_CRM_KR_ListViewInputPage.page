<apex:page controller="ASI_CRM_KR_ListViewInput" docType="html-5.0" sidebar="false"  readOnly="true" >
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
       <!--------------------------------------------------   Added by Kammy on 3 Mar 2016 Start:--------------------------------------------------------------->
        <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_Bootstrap_V3_3_6, '/ASI_JS_Bootstrap_V3_3_6/dist_less/css/bootstrap.min.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_Datatable_V1_10_7, 'DataTables-1.10.7/media/css/jquery.dataTables.min.css')}" />
       
        <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, 'build.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_AddOn_CSS_V3_3_2, '/bower_components/Font-Awesome/css/font-awesome.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_FixedColumns_V3_2_1, 'FixedColumns-3.2.1/css/fixedColumns.dataTables.min.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.ASI_JS_FixedColumns_V3_2_1, 'FixedColumns-3.2.1/css/fixedColumns.bootstrap.min.css')}" />
        
        <apex:includeScript value="{!URLFOR($Resource.ASI_JS_JQuery_V1_9_1, 'js/jquery.min.js')}" /> 
        <apex:includeScript value="{!URLFOR($Resource.ASI_JS_JQuery_V1_9_1, 'js/jquery-ui.min.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.ASI_JS_DataTables_V1_10_11, 'DataTables-1.10.11/media/js/jquery.dataTables.min.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.ASI_JS_Bootstrap_V3_3_6, '/ASI_JS_Bootstrap_V3_3_6/dist_less/js/bootstrap.min.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.ASI_JS_FixedColumns_V3_2_1, 'FixedColumns-3.2.1/js/dataTables.fixedColumns.min.js')}" />

         <!--------------------------------------------------   Added by Kammy on 3 Mar 2016 End. --------------------------------------------------------------->
        
        
        
        <script type="text/javascript">
        
        $j = jQuery.noConflict();
        var resultTable = null;
        var totalNumberOfItem = 0;
        var CustomerCodeWidth = 5+ "%";
        var AccountNameWidth = 20 + "%";
        var info = null;
        var CurrentsitObj = [];
        Visualforce.remoting.timeout = 120000; // Set timeout at page level
            
        function initKRListViewPage(config) {
            if (config) {
                totalNumberOfItem = config.totalNumberOfItem;
                setResultTable(true);
                // Execute on load
                checkWidth();
               // newTable();
            }
        };

            
             
             

             
         function checkWidth() {
                var windowsize = window.innerWidth;//$j(window).width();
                //var w = window.innerWidth;
                var changesize = windowsize *0.1;
                
                wrapper_size = (windowsize - changesize) +"px";
                //console.log("check window size:" + windowsize);
             /* CHG0030448 BEGIN: Vincent 20190524: only 6 Item Groups left, no need to resize */
             /*   $j(".dataTables_wrapper").css("width",wrapper_size); */
             /* CHG0030448 END */
                /*
                 if(windowsize<1000){
                     wrapper_size = (windowsize - 150) +"px";
                     console.log(wrapper_size);
                     
                 }else{
                      $j(".dataTables_wrapper").css("width","1500px");
                 }*/
            }
    
    
        function setControllerMessage(){
            
            var viewportWidth = $j(window).width();
            
            $j(window).resize(checkWidth);
            
            
            var controllerMsg = $j('input[id$=hiddenBlock]').val();  
            //console.log(controllerMsg);
            if(controllerMsg)
                $j('#message').html('<div class="alert alert-warning fade in"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">Ã—</button><strong>Warning!</strong><br/>'+ controllerMsg +'</div>');
            else 
              clearMessage();
        }

        
        function btnEvent(){
            
 
            $j("#cloneBtn").click(function() {
                  console.log("set event listener");
                  clearMessage();
                });
        }

        function getWidthPrecentage() {
            var averageWidth = (100 - (CustomerCodeWidth - AccountNameWidth ) )/(totalNumberOfItem *2);
            return averageWidth + "%";
        }


        function columnvisibility(colnum){ //Handle table column visibility
            var column = resultTable.column( colnum );  // Get the column API object
            column.visible( ! column.visible() ); // Toggle the visibility console.log(column.visible());
            return column.visible();
        }  

        function ColumnsHideAndShowAction(){
            
            $j('a.toggle-vis').on( 'click', function (e) {
                
                e.preventDefault();
                $j("#dt_SIT_processing").show();
                
                var linkId =($j(this).attr('Id'));
                var tempflag = false;
                //console.log(linkId);
                
                if(linkId=="hideLastMonth"){
                    
                    if($j(this).hasClass('changecss')){
                        //show columns 
                        $j(this).removeClass('changecss');
                        $j("#lastMonthSquare").removeClass('fa fa-minus-square-o').addClass('fa fa-plus-square');
                        tempflag = true;
                        
                    }else{
                        
                        $j(this).addClass('changecss');
                        $j("#lastMonthSquare").removeClass('fa fa-plus-square').addClass('fa fa-minus-square-o');
                        tempflag = false;
                    }
 
 
                     var colStart ='col_';
                     var squareStart = 'Square_';
                     var colgroups = $j('[id^='+ colStart +']');    
                     var squaregroups = $j('[id^='+ squareStart +']'); 
                        
                    if(tempflag){
                        //show all columns 
   
                            $j.each(colgroups, function(key, group) {
                                $j(this).removeClass('changecss');
                            });

                            $j.each(squaregroups, function(key, group) {
                                $j(this).removeClass('fa fa-minus-square-o').addClass('fa fa-plus-square');
                            });
                            
                    }else{

                            $j.each(colgroups, function(key, group) {
                                $j(this).addClass('changecss');
                            });   

                            $j.each(squaregroups, function(key, group) {
                                $j(this).removeClass('fa fa-plus-square').addClass('fa fa-minus-square-o');  
                            });
                    }
                     
                    resultTable.columns('.outputField').visible(tempflag );
                }
                else{
                    // for item group column
                    // Get the column API object
                    var tempcol= Number($j(this).attr('data-column'))+Number(totalNumberOfItem);
                    var squareId = "Square_" + $j(this).attr('data-column');
                    //console.log(tempcol);
                    //console.log(squareId);
                    var column = resultTable.column( $j(this).attr('data-column'));
                    var resultColumn = resultTable.column(tempcol.toString());
                    // Toggle the visibility
                    var showFlag = columnvisibility(column);
                    //columnvisibility(resultColumn);
 
                    if(!showFlag){
                        //hide column
                        resultColumn.visible(showFlag);
                        $j(this).addClass('changecss');
                        $j('#' + squareId).removeClass('fa fa-plus-square').addClass('fa fa-minus-square-o');                        
                    }else{
                        //show column
                        resultColumn.visible(showFlag);
                        $j(this).removeClass('changecss');
                        $j('#' + squareId).removeClass('fa fa-minus-square-o').addClass('fa fa-plus-square');
                    }
                }

                    		setTimeout(function () {
                                					$j("#dt_SIT_processing").hide();
                               }, 1000);
                               
            } );    
            
        }
            
        function formatNumber(n) {
            return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        function clearMessage(){
            $j('#message').html('');
            //$j("#dt_SIT_processing").css("visibility","hidden");
            $j(".alert").alert();
        }
        
        function cloneFromLastMonth(){
            
            console.log("start cloneFromLastMonth method.");
            //CurrentsitObj = [];
            $j('#message').html('');
           	$j("#cloneBtn").button("loading");
           	$j("#saveBtn").addClass('disabled');
            $j("#dt_SIT_processing").show();
                
                
                // use json to replace new stock as old stock
                $j(".endStock").each(function() {
                     
                        var currentCellId = $j(this).attr('name');
            				if (currentCellId !== undefined){// && isNaN(parseFloat(newValue))==false 
                                			
                                           	var customerName = ($j(this).attr('data-customername')).replace(/,/g, "");
                                            var itemGrp = ($j(this).attr('data-itemgrp')).replace(/,/g, "");
                                            var headerStatus = ($j(this).attr('data-headerStatus')).replace(/,/g, "");

                                           	$j.each(CurrentsitObj, function(i, item) { 
                                              if (CurrentsitObj[i].CustomerName == customerName && CurrentsitObj[i].itemGrp == itemGrp && headerStatus=="Editable" ) {
                                                	CurrentsitObj[i].newstock = CurrentsitObj[i].laststock;
                                                	$j( "input[name^='" + currentCellId + "']" ).val(CurrentsitObj[i].newstock );
                                                	//console.log("new value: " + CurrentsitObj[i].newstock);
                                              } 
                                            });
                                            
                                       }    
                               
                });


                    		setTimeout(function () {
                    								$j("#cloneBtn").button("reset");
                    								$j("#saveBtn").removeClass('disabled');
                                					$j("#dt_SIT_processing").hide();
                               }, 3000);
                               

                
                changeInputStyle();
        }
            
        function initJsonObj(){
            
            
            
            
            $j('#message').html('');
           
            console.log("start initJsonObj.");
            var selectedYear = $j( ".selectedyear option:selected" ).text();
            var selectedmonth =  $j( ".selectedmonth option:selected" ).text();
            
            console.log(selectedYear + "|" + selectedmonth);
            
            jsonObject();
            changeInputStyle();
            //console.log(CurrentsitObj); 
        }
		
		function jsonObject(){
		    CurrentsitObj = [];
		                $j(".endStock").each(function() {
                           var tdCellId = $j(this).parent().attr('id');
                           if(tdCellId !== undefined){
                               var lastCellId = tdCellId.replace("Current","last");
                               var lastCellId = lastCellId.replace("input", "output");
                               //console.log(lastCellId);
                           }
                           var currentCellId = $j(this).attr('name');
                           if (currentCellId !== undefined){
                               	var customerName = ($j(this).attr('data-customername')).replace(/,/g, "");
                                var itemGrp = ($j(this).attr('data-itemgrp')).replace(/,/g, "");
                                var headerStatus = ($j(this).attr('data-headerStatus')).replace(/,/g, "");
                               	sitDetail ={};
                               	sitDetail["headerStatus"] = headerStatus;
                                sitDetail["CustomerName"] = customerName;
                                sitDetail["itemGrp"] = itemGrp;
                                sitDetail["newstock"] = $j(this).val();
                                sitDetail["laststock"] =  $j('#'+lastCellId).find('span').text();
                                sitDetail["originalstock"] = $j(this).val();
                                CurrentsitObj.push(sitDetail);
                           }
            });
		}
		
		function changeInputStyle(){
		    
		    // Select all input elements, and loop through them.
                $j(".endStock").each(function(index, item){
                    //check if it is locked
                    var headerStatus = ($j(this).attr('data-headerStatus')).replace(/,/g, "");
                    if(headerStatus=="Locked"){
                        $j(this).prop('readonly', true);
                        $j(this).addClass('input-disabled')
                    }
                    // For each element, check if the val is not equal to an empty string.
                    var newValue = $j(this).val();
                    newValue = newValue.replace(/[^\d\.\-\ ]/g, '');
                    //console.log(newValue);
                    if(newValue!== '' && !isNaN(newValue) && parseInt(newValue)>0) {
                         $j(this).addClass('withValue');   
                    }else{
                        $j(this).removeClass('withValue'); 
                    }
                });
		}
		
		function initChangeEvent(){
		       
		     
		      
		      console.log('initChangeEvent');
              $j(".endStock").on('change', function(){
                $j('#message').html('');
                //console.log('change');
                var newValue = $j(this).val();
                newValue = newValue.replace(/[^\d\.\-\ ]/g, '');
                if(newValue!== '' && !isNaN(newValue) && parseInt(newValue)>0) {
                         $j(this).addClass('withValue');   
                    }else{
                        $j(this).removeClass('withValue'); 
                }
                //console.log(newValue);
                        			
                var currentCellId = $j(this).attr('name');
    				if (currentCellId !== undefined){// && isNaN(parseFloat(newValue))==false 
                        			
                                   	var customerName = ($j(this).attr('data-customername')).replace(/,/g, "");
                                    var itemGrp = ($j(this).attr('data-itemgrp')).replace(/,/g, "");
        
                                   	$j.each(CurrentsitObj, function(i, item) { 
                                      if (CurrentsitObj[i].CustomerName == customerName && CurrentsitObj[i].itemGrp == itemGrp ) {
                                        	this.newstock = newValue;
                                      } 
                                    });
                                    
                               }            
            });
            
            //console.log(CurrentsitObj); 
		}
		
		function saveRecord(){
            console.log("start saveRecord.");
            var isSuccess = false;
            var selectedYear = $j( ".selectedyear option:selected" ).text();
            var selectedmonth =  $j( ".selectedmonth option:selected" ).text();
          
            console.log(selectedYear + "|" + selectedmonth );		    
           	$j("#cloneBtn").addClass('disabled');
           	$j(".searchbtn").addClass('disabled');
           	$j("#saveBtn").button("loading");
            $j("#dt_SIT_processing").show();		    
		    //remote action to save record
		    //1st re-structure list of SIT header and SIT line
		    var Customers = [];
		    var itemGrps  =[];
		    var SITHeaders = [];
		    var SITDetails = [];
            //create set of customers 
            var SITs = new Object();
            SITs.SIT = CurrentsitObj; 
            var CurrentsitObjString = JSON.stringify(SITs);
            //console.log(CurrentsitObjString);
            var editBoolean = true;
            $j.each(SITs.SIT, function(index, value) {
                var SITDetail = new ASI_KOR_WS_Stock_In_Trade_Detail__c();
                editBoolean = true;
                value.newstock = value.newstock.replace(/[^\d\.\-\ ]/g, '');
                value.laststock = value.laststock.replace(/[^\d\.\-\ ]/g, '');
                SITDetail.ASI_KOR_Item_Group_Code__c = value.itemGrp;
                SITDetail.ASI_KOR_WS_SIT_End_Stock__c = value.newstock;
                SITDetail.ASI_KOR_WS_SIT_LastMonthEndingStock__c = value.laststock;
                SITDetail.ASI_CRM_KR_HeaderID_Upload__c =  value.CustomerName; //selectedYear +"_" +selectedmonth +"_" +
                //if(value.newstock!==null && value.headerStatus=="Editable"){
                if(((value.newstock!==null && parseInt(value.newstock) >0) || (value.originalstock!==null && parseInt(value.originalstock) >0 &&  value.newstock !== value.originalstock)) && value.headerStatus=="Editable"){
                    
                    //console.log("insert record:" + SITDetail);
                    SITDetails.push(SITDetail);
                    
                    if ($j.inArray(value.CustomerName, Customers)==-1) {
                    Customers.push(value.CustomerName);
                    }
                   
                    if ($j.inArray(value.itemGrp, itemGrps)==-1) {
                        itemGrps.push(value.itemGrp);
                    }
                }

            }); 
            
            $j.each(Customers, function( index, value ){
    		    var SITHeader = new ASI_KOR_Stock_In_Trade__c();
    		    SITHeader.ASI_KOR_Month__c = selectedmonth ;
    		    //SITHeader.ASI_KOR_Status__c = 'Editable';
    		    SITHeader.ASI_KOR_Year__c = selectedYear;       
    		    SITHeader.ASI_KOR_Wholesaler__c = value;
    		    //SITHeader.ASI_KOR_Sys_Stock_in_trade_header_ID__c = selectedYear +"_" +selectedmonth ;// +"_" + value
    		    SITHeaders.push(SITHeader);
            });
		    
		    //console.log(itemGrps);
            //console.log(Customers); //controller should get the wholeSaler's Customer code to replace headerId last substring
            //console.log(SITHeaders); //upsert SITheader
            //console.log(SITDetails); //upsert SITDetail
                
    		   ASI_CRM_KR_ListViewInput.saveSITRecords(itemGrps,Customers,SITHeaders,SITDetails,selectedYear,selectedmonth, function(result, event){
    		       //console.log(result);
    		       if(event.status){
    		           if(result){
    		                 if(result.substring(0, 12)==='Save Success'){
    		                        jsonObject();
                                    $j('#message').html('<div class="bs alert alert-success fade in"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">Ã—</button><strong>Quick Save Success!</strong><br/>'+result +'</div>');
    		                 }else if(result.substring(0, 12)==='No record(s)'){
    		                        $j('#message').html('<div class="alert alert-warning fade in"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">Ã—</button><strong>Warning!</strong><br/>'+result +'</div>');
    		                 }else{
    		                        $j('#message').html('<div class="alert alert-danger fade in"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">Ã—</button><strong>Error,Can not Save!</strong><br/>'+result +'</div>');
    		                 }
    		                 
    		                 
    		                 $j("#saveBtn").button("reset");
    		                 $j("#cloneBtn").removeClass('disabled');
            		         $j(".searchbtn").removeClass('disabled');
            		         $j("#dt_SIT_processing").hide();
    		           }else{
    		               console.log(event.status);
    		           }
    		              
    		           console.log(event); 
    		       }else{
    		           if(result)
    		            $j('#message').html('<div class="alert alert-danger fade in"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">Ã—</button><strong>Error,Can not Save!</strong><br/>'+result+'</div>');
    		            else
    		            $j('#message').html('<div class="alert alert-danger fade in"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">Ã—</button><strong>Error,Can not Save!</strong><br/>'+ event.message+'</div>');
    		           
    		       }
    		   },
    		   {buffer: false,escape: true, timeout: 120000}
    		   );
		    
		    if(isSuccess){
		        
		         $j("#cloneBtn").removeClass('disabled');
		         $j(".searchbtn").removeClass('disabled');
		         $j("#dt_SIT_processing").hide();
		    }
		}
        
        
        function ASI_KOR_Stock_In_Trade__c(){ }
        function ASI_KOR_WS_Stock_In_Trade_Detail__c(){ } 
        
        
        function setResultTable(newTable){
            
            resultTable =  $j("#dt_SIT").on( 'init.dt', function () {
            }).DataTable({
                "language": {
                    "decimal": ",",
                    "thousands": ".",
                     "emptyTable":     "No available Stock in Trade Details"
                },
                "bDestroy":true,
                "bAutoWidth":false,
                responsive: true,
				"bProcessing": true,
				"stateSave": false,
				"paging": false,
				scrollY:  "500px",
				"sScrollXInner": "150%",
                scrollX:        true,
                scrollCollapse: true,
                fixedColumns:   {
                    leftColumns: 2
                },
				"dom": '<"pull-left"f><"top"i><r<t>p>',
                "initComplete": function(settings) {
                    ColumnsHideAndShowAction();
                    initJsonObj();
                    initChangeEvent();
                    if(!newTable)
                        btnEvent();
                    setControllerMessage();
                    api = this.api();
                    api.columns.adjust().draw();
                    //$j(".dataTables_processing").css('visibility','hidden');
                },
                
                "fnDrawCallback": function() {    
                    api = this.api();
                    $j('.inputField input').each(function() {    
                            //console.log($j(this).val());
                    });
                    $j('.inputField input').change();

                },
                columnDefs: [     

                                  { // prevent sorting on the input column
                                    "render": function ( data, type, row ) {
                                        return formatNumber(data) ; //format inputField
                                    },
                                    "targets": "inputField", 
                                    "bSortable": false,
                                    className: "dt-head-center",
                                    "width":getWidthPrecentage()
                                  },
                                  { // set last month width
                                    /*
                                    "render": function (data, type, row) {
                                            return '<div class="input-group date">' +
                                                 '       <input type="text" class="form-control" data-field="outputField" value="'+ data +'">' +
                                                 '</div>';
                                     },*/
                                    "render": function ( data, type, row ) {
                                        return formatNumber(data) ; //format outputField 
                                    },
                                    "targets": "outputField", 
                                    className: "dt-center",
                                    "width":getWidthPrecentage()
                                  },
                                  { // set customer Code width
                                    "targets": 0, 
                                    "width":CustomerCodeWidth
                                  },
                                  { // set account Name width
                                    "targets": 1, 
                                    "width":AccountNameWidth
                                  }
                              ]
            });
            
            $j("#dt_SIT").on( 'page.dt', function () {
                       
                       info = resultTable.page.info();
                        
                        if(info){
                               $j('.inputField input').change();
                        }                    
                    } );
            

             
        }



        $j(document).ready(function(){

            initKRListViewPage({
                totalNumberOfItem : "{!itemGroupMappingSize}"
            });  
            
            
        });
        </script>
        
        <style type="text/css">

        /* Ensure that the demo table scrolls */
            th, td { white-space: nowrap; }
            div.dataTables_wrapper {
            /* CHG0030448 BEGIN: Vincent 20190524: only 6 Item Groups left, no need to resize */
            /*width: 1500px;*/
          	/* CHG0030448 END */
            }
            
        .tableStyle{
        /*border: 1px solid black;
            border-spacing: 0;
            border-collapse: collapse;
            width:20%;*/
            font-family:century gothic,verdana,arial,helvetica,sans-serif;
            flex-wrap: wrap;
            align-content: center;
            content: 'This is your custom tooltip text';
            }
            
         .td{
            /*border: 1px solid black;       width:30%;*/
            border-spacing: 0;
            border-collapse: collapse;
      /*
            flex-wrap: wrap;*/
            align-content: center;
            }


            .tableStyle th{
                text-align: center !important;
            }
        
            .changecss{
            background-color: #d0e4fe ;
            color: #C0C0C0 !important;
            } 
            
        /*
         * Processing indicator
         */
        .dataTables_processing {
            position: absolute !important;
            top: 50%  !important;
            left: 50%  !important;
            width: 250px  !important;
            height: 50px  !important;
            margin-left: -125px  !important;
            margin-top: -15px  !important;
            padding: 14px 0 2px 0  !important;
            border: 1px solid #ddd  !important;
            text-align: center  !important;
            color: #999 !important;
            font-size: 14px  !important;
            background-color: white  !important;
            z-index: 1000 !important;
        }
        
        .withValue{
             background:#dff0d8;
        }
        
        input:invalid,
        input:out-of-range {
            border-color:hsl(0, 50%, 50%);
            background:hsl(0, 50%, 90%);
        }
        
        .bs .table>thead>tr>th {
            vertical-align: bottom;
            /*border-bottom: 1px solid #000000 !important;*/
        }
        
        .bs .table {
            margin-bottom: 0px !important;
        }
        
        .bs .table>thead>tr:first-child>th:nth-child(-n){
            vertical-align: bottom;
            border-bottom: 1px solid #000000 !important;
        }
        
        .input-disabled{background-color:#EBEBE4;border:1px solid #ABADB3;padding:2px 1px;}
        
        </style>
    </head>
    <body class="bs">

    <apex:form id="KR_Header" styleclass="objectFormCls">
         <div id="HeaderForm" class="bs container-fluid">  
                <div class="bs row" style="margin:0;">
                    <div class="bs col-xs-12"> 
                    
                   
                     <!-----------------------------Input filter------------------------------->
                        <div > <!--class="bs col-xs-12"-->
                            <apex:outputPanel styleclass="bs panel-primary" id="filterPanel"> 
                                <div class="bs panel-heading div-size">
                                    <h5 style="font-weight:bold; " >Filtering Section</h5>
                                </div>     
                                <div class="control-group panel-body ">
                                    <apex:outputPanel id="hiddenBlockPanel" styleClass="hiddenBlockPanel" ><apex:inputHidden id="hiddenBlock" value="{!msg}" /></apex:outputPanel>
                                    
                                    <div class="bs row">
                                        <div class="col-sm-2">
                                            <apex:outputLabel style="font-weight:bold;" >Year:</apex:outputLabel>
                                            <div class="form-group divsearch">
                                                <apex:selectList id="selectYear"  value="{!Selectedyear}" size="1" styleClass="form-control searchcss input-sm selectedyear">
                                                    <apex:selectOption itemValue="2016" itemLabel="2016"/>
                                                    <apex:selectOption itemValue="2017" itemLabel="2017"/>
                                                    <apex:selectOption itemValue="2018" itemLabel="2018"/>
                                                    <apex:selectOption itemValue="2019" itemLabel="2019"/>
                                                    <apex:selectOption itemValue="2020" itemLabel="2020"/>
                                                    <apex:selectOption itemValue="2021" itemLabel="2021"/>
                                            </apex:selectList>
                                            </div>
                                            <apex:outputLabel style="font-weight:bold;" >Month:</apex:outputLabel>
                                            <div class="form-group divsearch">
                                                <apex:selectList id="selectMonth" value="{!selectedmonth}" size="1" styleClass="form-control searchcss input-sm selectedmonth">
                                                    <apex:selectOption itemValue="01" itemLabel="January"/>
                                                    <apex:selectOption itemValue="02" itemLabel="February"/>
                                                    <apex:selectOption itemValue="03" itemLabel="March"/>
                                                    <apex:selectOption itemValue="04" itemLabel="April"/>
                                                    <apex:selectOption itemValue="05" itemLabel="May"/>
                                                    <apex:selectOption itemValue="06" itemLabel="June"/>
                                                    <apex:selectOption itemValue="07" itemLabel="July"/>
                                                    <apex:selectOption itemValue="08" itemLabel="August"/>
                                                    <apex:selectOption itemValue="09" itemLabel="September"/>
                                                    <apex:selectOption itemValue="10" itemLabel="October"/>
                                                    <apex:selectOption itemValue="11" itemLabel="November"/>
                                                    <apex:selectOption itemValue="12" itemLabel="December"/>

                                            </apex:selectList>
                                            </div>   
                                        </div>  

                                    
                                        
                                        <div class="col-sm-2">
                                           
                                              <apex:outputLabel style="font-weight:bold;" >Account Name:</apex:outputLabel>
                                            <div class="form-group divsearch" style="align:left">
                                                <apex:inputField style="width: 19em; text-align:left" value="{!AcctNamefilter.ASI_CRM_Account__c}"/>  
                                            </div>  

                                            <apex:outputLabel style="font-weight:bold;" >Item Code:</apex:outputLabel>
                                            <div class="form-group divsearch" style="align:left">
                                                <apex:inputField style="width: 19em; text-align:left" value="{!ItemCodefilter.ASI_KOR_Item_Group_Code__c}"/>  
                                            </div>
                                        </div>
                                        
                                        <div class="col-sm-12">
                                            
                                        </div>    
                                            
                                        <div class="col-sm-2">
                                            
                                           <div class="bs btn-group " role="group" >
                                                    <apex:commandbutton styleClass="bs btn btn-info btn-size searchbtn" 
                                                      value="Search"
                                                      style="font-weight: bold"
                                                      action="{!runQuery}"
                                                      status="ActionStatus"
                                                      id="searchbtn"             
                                                      onclick="resultTable.page.len(-1).draw(false);"
                                                      oncomplete="console.log('Quick Search');setResultTable(true);setControllerMessage();"
                                                      rerender="sitDetailPanel,filterPanel,SavePanel,hiddenBlockPanel,hiddenBlock" 
                                                      html-data-loading-text="Loading..." 
                                                      html-formnovalidate="formnovalidate">  <!--SearchSIT--> <!-- clearMessage() -->
                                   
                                                </apex:commandbutton>
                                                     <script>
                                               		            if({!withLastMonthData} == false){
                                                                     $j("#cloneBtn").hide(); 
                                                                }else{
                                                                     $j("#cloneBtn").show(); 
                                                                    }
                                                     </script>
                                            </div>
                                        </div>
                                        <div class="col-sm-2">
                                            <div class="bs btn-group " role="group" >

                                            </div>  
                                    </div> 
                                
                                       
                                    </div>
                                </div>
                            </apex:outputPanel>
                        </div>
                            
                        <apex:outputPanel styleclass="bs panel-primary" id="sitDetailPanel" > 
                            <div class="bs panel-heading div-size">
                                <h5 style="font-weight:bold; " >End Stock List View Input Page</h5>  
                            </div>
                       
                              
                            <div class="bs panel-body">  
                            <div class="row">
                                    <div class="col-sm-12">
                                                <apex:outputPanel styleclass="bs panel-primary" id="SavePanel">
                                                   <div class='bs wrapper text-center' id='bs toolbar' >
                                                            <div role="group" >
                                                                <button type="button" 
                                                                   data-toggle="modal"  
                                                                   data-placement="bottom"
                                                                   data-loading-text="<i class='fa fa-spinner fa-spin '></i> Working in progress now. Please wait . Thank you...."
                                                                   title="Save" class="bs btn btn-success btn-size" 
                                                                   data-target="#saveModal" 
                                                                   id="saveBtn">
                                                                   Save
                                                                </button> 
                                                                
                                                                <!---message-->
                                                  			   <!---saveModal--> 
                                                    		   <div class="modal fade" id="saveModal" role="dialog">
                                                                    <div class="modal-dialog  modal-sm">
        
                                                                      <!-- Modal content-->
                                                                      <div class="modal-content">
                                                                                <div class="modal-header">
                                                                                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                                  <h5 class="modal-title"><b>Save</b></h5> 
                                                                                </div>
                                                                                <div class="modal-body">
                                                                                  <p>Record(s) will be saved. Confirm?</p>
                                                                                </div>
                                                                                <div class="modal-footer">
                                                                                   <button type="button" class="btn btn-default" data-dismiss="modal" onclick="saveRecord();" >Confirm</button> 
                                                                                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                                                                </div>
                                                                      </div>
                                                                     </div>
                                                                </div> 

                                                             </div>     
                                                 
                                                            
                                                    </div>  
                                                    
                                                    
                                                   
                                            </apex:outputPanel>      
                                    </div>
                                    

                                     <div class="col-sm-12">
                                            <p></p>
                                            <div id="message">  </div>
                                     </div>    
                                </div>

                               <div class="row">
                                        <div class="col-sm-12">
                                            		
                                            		   <div class="bs btn-group" role="group" >
                                                           <button type="button" 
                                                                   data-toggle="modal"  
                                                                   data-placement="bottom"
                                                                   data-loading-text="<i class='fa fa-spinner fa-spin '></i> Working in progress now. Please wait . Thank you...."
                                                                   title="Clone from Last Month" class="bs btn btn-warning btn-size" 
                                                                   data-target="#CloneModal" 
                                                                   id="cloneBtn">
                                                                   Clone from Last Month
                                                           </button> 
                                                       </div>
                                          			   <!---CloneModal--> 
                                            		   <div class="modal fade" id="CloneModal" role="dialog">
                                                            <div class="modal-dialog  modal-sm">

                                                              <!-- Modal content-->
                                                              <div class="modal-content">
                                                                        <div class="modal-header">
                                                                          <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                          <h5 class="modal-title"><b>Clone From Last Month</b></h5>
                                                                        </div>
                                                                        <div class="modal-body">
                                                                          <p>All current end stocks will be overridden, confirm?</p>
                                                                        </div>
                                                                        <div class="modal-footer">
                                                                           <button type="button" class="btn btn-default" data-dismiss="modal" onclick="cloneFromLastMonth();" >Confirm</button> 
                                                                          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                                                        </div>
                                                              </div>
                                                             </div>
                                                        </div> 
                                           
                                        </div>    
                                   <div class="col-sm-12 col-xs-12">
                                        </div>
                                        <div class="col-sm-12 col-xs-12">
                                           
                                           
                                           <div class="col-sm-12 col-xs-12">                                            
                                            <a role="button" style="bgcolor:#B0B0B0" class="bs btn btn-sm toggle-vis active col-sm-2 col-xs-2" id="hideLastMonth"><i class="fa fa-plus-square" id="lastMonthSquare"></i> <b>Last Month </b></a>
                                            
                                            <apex:variable value="{!2}" var="rowNum"/>
                                                <apex:repeat value="{!itemGroupMapping}" var="itemGrp">
                                                            <a role="button" data-column="{!rowNum}"  style="bgcolor:#B0B0B0" class="bs btn btn-sm toggle-vis active col-sm-2 col-xs-2" id="col_{!rowNum}">
                                                            <i class="fa fa-plus-square" id="Square_{!rowNum}"></i> <b>{!itemGroupMapping[itemGrp]}</b></a>
                                                            <apex:variable value="{!rowNum+1}" var="rowNum"/>
                                                </apex:repeat>                                
                                           </div>
                                            
                                            <br/><br/>
                                            <div class="col-sm-12">  
                                                <br/><br/>
                                            </div>
                                         
                                           <div class="col-sm-12">          
                                            <table id="dt_SIT" cellspacing="0" width="100%" class="tableStyle table responsive table-hover table-condensed display compact " >
                                                <thead>
                                                <tr>
                                                    <th rowspan="2" class="bg-info">{!$ObjectType.Account.fields.ASI_KOR_Customer_Code__c.Label}</th>
                                                    <th rowspan="2" class="bg-info">{!$ObjectType.Account.fields.NameLocal.Label}</th>
                                                    <th rowspan="2" class="bg-info">{!$ObjectType.Account.fields.ASI_KOR_Grade__c.Label}</th>
                                                    <th colspan="{!itemGroupMappingSize}"   class="bg-success" align="center">Current Month (Case) - {!CurrentMonth_Dynamic} </th>
                                                    <th colspan="{!itemGroupMappingSize}" bgcolor="#B0B0B0" align="center">Last Month (Case) - {!Lastmonth_Dynamic} </th>
                                                </tr>
                                                <tr>
            
                                                    <apex:repeat value="{!itemGroupMapping}" var="itemGrp"> 
                                                       <th class="outputField">{!itemGroupMapping[itemGrp]}</th>
                                                    </apex:repeat>
                                                    <apex:repeat value="{!itemGroupMapping}" var="itemGrp">
                                                        <th class="inputField"  >{!itemGroupMapping[itemGrp]}</th>  
                                                    </apex:repeat>
                                                </tr>
                                                </thead>
                                                  
                                                
                                                <tbody>
                                                 <apex:repeat value="{!All_Cust_Brand_QuantityMap}" var="CustomerName">   
                                                 
                                                 <tr>
                                                     <td class="td">{!CustomerMapping[CustomerName].ASI_KOR_Customer_Code__c}</td> 
                                                     <td class="td">{!CustomerMapping[CustomerName].NameLocal}</td>
                                                     <td class="td">{!CustomerMapping[CustomerName].ASI_KOR_Grade__c}</td>
                                                     

                                                     <apex:repeat value="{!itemGroupMapping}" var="itemGrp">
                                                         
                                                         <apex:variable value="{!All_Cust_Brand_QuantityMap[CustomerName][itemGrp]}" var="SIT"/>
                                                            <td class="inputField" html-data-column="value" align="center" id="Current_{!CustomerName}_{!itemGrp}_input">
                                                                <apex:input html-pattern="^-?\d+(,\d+)*(\.\d+(e\d+)?)?$" title="Please input total End Stock for {!CustomerMapping[CustomerName].name}." styleClass="endStock" html-data-customerName="{!CustomerName}" html-data-ItemGrp="{!itemGrp}" html-data-headerStatus="{!All_Cust_Brand_QuantityMap[CustomerName][itemGrp].ASI_CRM_KR_HeaderID_Upload__c}" style="width: 7em; text-align:right" value="{!All_Cust_Brand_QuantityMap[CustomerName][itemGrp].ASI_KOR_WS_SIT_End_Stock__c}"/>
                                                            </td> 
                                                         
                                                     </apex:repeat>

                                                     <apex:repeat value="{!itemGroupMapping}" var="itemGrp">


                                                         <apex:variable value="{!All_Cust_Brand_QuantityMap[CustomerName][itemGrp]}" var="SIT"/>
                                                         <td class="outputField" align="center" bgcolor="#B0B0B0" style="{!IF(SIT.ASI_KOR_WS_SIT_LastMonthEndingStock__c>0,'font-weight: bold;','font-weight: normal;')}" id="last_{!CustomerName}_{!itemGrp}_output">
                                                             <!-- {!SIT.ASI_KOR_WS_SIT_LastMonthEndingStock__c} -->
                                                             <apex:outputField style="width: 8em;" html-data-customerName="{!CustomerName}" html-data-ItemGrp="{!itemGrp}" value="{!SIT.ASI_KOR_WS_SIT_LastMonthEndingStock__c}"/>
                                                         </td>

                                                     </apex:repeat>

                                                 </tr>
                                                </apex:repeat> 
                                               
                                            </tbody>
                                            </table>
                                            </div>
                            
                                        </div>    
                                </div>

                            </div>
                        </apex:outputPanel>
                       
                    </div>

                </div>
         </div>
         <apex:actionstatus id="ActionStatus">
            <apex:facet name="start">
                <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                                                                     height: 100%; width:100%; opacity:0.65;"> 
                    <div class="waitingHolder" id="loadtext" style="position: absolute;" align="left" valign="top">
                        &nbsp;&nbsp;&nbsp;
                        <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                        <span class="waitingDescription">Please Wait...</span>
                    </div>
                </div>
            </apex:facet>
        </apex:actionstatus>
    </apex:form>
        
    </body>
</apex:page>