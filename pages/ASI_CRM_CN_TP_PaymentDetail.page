<!-- Name: ASI_CRM_CN_TP_PaymentDetail -->
<apex:page standardController="ASI_TH_CRM_PaymentRequest__c" extensions="ASI_CRM_CN_TP_PaymentDetailCtrl">
    <apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery1.10.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.min.js')}"/>
    <style>
        .negative{
        color : red;
        font-weight : bold;
        }
    </style>
    <apex:outputPanel ><chatter:feedWithFollowers entityid="{!ASI_TH_CRM_PaymentRequest__c.id}" /></apex:outputPanel>
<script>
function submit_not_allow(){
alert("  Remaining Amount more than 10000 ,Total Amount more than 2000000, Please check Business License Qualify and Overpayment Approval!");

}
</script>
    <apex:form >
        <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                                                         height: 100%; width:100%; opacity:0.65; display: none; z-index: 9999;"> 
            <div class="waitingHolder" id="loadtext" style="position: absolute;" align="left" valign="top">
                &nbsp;&nbsp;&nbsp;
                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                <span class="waitingDescription">Please Wait...</span>
            </div>
        </div>
        <apex:pageBlock rendered="{!showEdit}" title="{!$Label.ASI_CRM_CN_VF_LABEL_Edit_Payment}">
            <apex:pageblockButtons >
               <apex:commandbutton value="{!$Label.ASI_HK_CRM_VF_COMMON_BTN_Save}" onclick="document.getElementById('el_loading').style.display = 'block';" action="{!UpdateRecord}" />
               <apex:commandButton value="{!$Label.ASI_HK_CRM_VF_COMMON_BTN_Cancel}" action="{!doCancel}" immediate="true"/>
            </apex:pageblockButtons>
        <apex:pageBlockSection rendered="{!showEdit}" title="{!$Label.ASI_CRM_CN_VF_LABEL_Header_Info}">

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_TH_CRM_Contract__c.Label}"/>
                    <apex:inputfield value="{!PH.ASI_TH_CRM_Contract__c}" required="true" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Payment_Type__c.Label}" for="paymenttype" />
                    <apex:inputfield value="{!PH.ASI_CRM_CN_Payment_Type__c}" required="true" id="paymenttype" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_OutletWS__c.Label}" for="outlet_ws" />
                    <apex:inputField value="{!PH.ASI_CRM_CN_OutletWS__c}" id="outlet_ws" required="true"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Last_Payment__c.Label}"/>
                    <apex:inputfield value="{!PH.ASI_CRM_CN_Last_Payment__c}"/>
                </apex:pageBlockSectionItem>
               
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Description__c.Label}"/>
                    <apex:inputfield value="{!PH.ASI_CRM_CN_Description__c}" required="true"/><!--20170321,Elufa-->
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Last_Year_Payment__c.Label}"/>
                    <apex:inputfield value="{!PH.ASI_CRM_CN_Last_Year_Payment__c}"/>
                </apex:pageBlockSectionItem>   
            </apex:pageBlockSection>    
        </apex:pageBlock>

        <apex:pageBlock rendered="{!!showEdit}" title="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Label}">
            <apex:pageMessages id="showmsg"></apex:pageMessages>

                <apex:pageBlockButtons location="top">
                    <apex:commandButton value="{!$Label.ASI_HK_CRM_VF_COMMON_BTN_Edit}" onclick="document.getElementById('el_loading').style.display = 'block';" action="{!GoEditHeader}" rendered="{!PH.ASI_TH_CRM_Status__c=='Draft'}"/>
                    <apex:commandButton value="Payment Request Shuttle" onclick="window.open('/apex/ASI_CRM_CN_TP_PaymentRequestPDF?id={!PH.id}')"/>

                    <apex:commandButton value="Trade Plan PDF" onclick="window.open('/apex/ASI_CRM_CN_TP_POPaymentTPListPDF?PaymentId={!PH.id}')"/>

                    <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Submit_Approval}" action="{!submitApproval}"  rendered="{!PH.ASI_TH_CRM_Status__c=='Draft'}"/>

                    <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Payment_Instruction}"  onClick="window.open('/apex/ASI_CRM_CN_PaymentSlipPage?id={!PH.id}&PTSelected=Instruction');" rendered="{!PH.ASI_TH_CRM_Status__c=='Paid'}"/>
                    <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Payment_Receipt}"  onClick="window.open('/apex/ASI_CRM_CN_PaymentSlipPage?id={!PH.id}&PTSelected=Receipt');" rendered="{!PH.ASI_TH_CRM_Status__c=='Paid' }"/> 
                    
                    <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_COMMON_BTN_Return}" action="{!GoReturn}" rendered="{!showReturn}"  rerender="showmsg"/>
                    

                    <apex:commandButton value="{!$Label.ASI_CRM_CN_Auto_PO_Modification}"  styleClass="BSCommandButton" action="{!AutoPOModification}"
                     rendered="{!PH.ASI_TH_CRM_Status__c=='Paid' && PH.ASI_CRM_CN_Last_Payment__c && !PH.ASI_CRM_Auto_PO_Modification__c}" onclick="document.getElementById('el_loading').style.display = 'block';" oncomplete="document.getElementById('el_loading').style.display = 'none';" rerender="showmsg" />
                    
                </apex:pageBlockButtons>

            <apex:pageBlockButtons location="bottom">
                <!-- <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Payee_Detail}" action="{!GoEditDetail}" rendered="{!PH.ASI_TH_CRM_Status__c=='Draft'}"/> -->
                <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Payee_Info}" action="{!GoEditPayee}" rendered="{!PH.ASI_TH_CRM_Status__c=='Draft'}"/>
            </apex:pageBlockButtons>


            <apex:pageBlockSection title="{!$Label.ASI_CRM_CN_VF_LABEL_Header_Info}">
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.Name.Label}" for="paymentrequested_no" />
                    <apex:outputText value="{!PH.name}" id="paymentrequested_no"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Payment_Raised_Date__c.Label}" for="paymentraised_date "/>
                    <apex:outputField value="{!PH.ASI_CRM_CN_Payment_Raised_Date__c}" id="paymentraised_date" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_PO_No__c.Label}" for="pono" />
                    <apex:outputLink value="ASI_CRM_RedirectContractViewPage?id={!PH.ASI_TH_CRM_Contract__c}" id="pono">{!PH.ASI_CRM_CN_PO_No__c}</apex:outputLink>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_PO_Start_Date__c.Label}" for="postartdate" />
                    <apex:outputField value="{!PH.ASI_CRM_CN_PO_Start_Date__c}" id="postartdate"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_OutletWS__c.Label}" for="outlet_ws" />
                    <apex:outputField value="{!PH.ASI_CRM_CN_OutletWS__c}" id="outlet_ws"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_PO_End_Date__c.Label}" for="poenddate"/>
                    <apex:outputField value="{!PH.ASI_CRM_CN_PO_End_Date__c}" id="poenddate"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputText value="{!if(PH.ASI_CRM_New_FY_Payment__c, 'PO Type', 'Promotion Type')}"></apex:outputText>
                    <apex:outputField value="{!PH.ASI_CRM_CN_Promotion_Type__c}" id="promotiontype"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Last_Payment__c.Label}"/>
                    <apex:outputField value="{!PH.ASI_CRM_CN_Last_Payment__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Last_Year_Payment__c.Label}"/>
                    <apex:outputField value="{!PH.ASI_CRM_CN_Last_Year_Payment__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_TH_CRM_Status__c.Label}" for="status"/>
                    <apex:outputField value="{!PH.ASI_TH_CRM_Status__c}" id="status"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.ASI_CRM_CN_Payment_Description}" for="description" />
                    <apex:outputField value="{!PH.ASI_CRM_CN_Description__c}" id="description" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Payment_Type__c.Label}" for="paymenttype" />
                    <apex:outputField value="{!PH.ASI_CRM_CN_Payment_Type__c}" id="paymenttype" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem rendered="{!IF(PH.ASI_TH_CRM_Contract__r.ASI_CRM_CN_Outlet_WS__r.RecordType.DeveloperName == 'ASI_CRM_CN_WS',true,false)}" >
                    <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_Volume_Option__c.Label}" for="paymenttype" />
                    <apex:outputField value="{!PH.ASI_CRM_Volume_Option__c}" id="paymenttype" />
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

               
        </apex:PageBlock>

        <apex:pageblock title="{!$Label.ASI_CRM_CN_Payment_Summary}" >
            <apex:pageblocktable value="{!LPaymentSummary}" var="row">
            
            <apex:column style="{!if(PH.ASI_CRM_New_FY_Payment__c, 'width:19%', 'width:20%')}">
                <apex:facet name="header"><apex:outputLabel value="{!$Label.ASI_CRM_CN_Payment_Summary}" /></apex:facet> 
                <apex:outputText value="{!row.feeChiName}"/>
                <apex:facet name="footer"><apex:outputLabel value="{!strTotal}"/></apex:facet>
            </apex:column>
            
            <apex:column style="{!if(PH.ASI_CRM_New_FY_Payment__c, 'width:9%', 'width:20%')}">
                <apex:facet name="header"><apex:outputLabel value="{!$Label.ASI_CRM_CN_PO_Estimated_Amount}" /></apex:facet> 
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.POEstimateAmt}"/></apex:outputText>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalPOEstAmt}"/></apex:outputText></apex:facet> 
            </apex:column>
            
            <apex:column style="{!if(PH.ASI_CRM_New_FY_Payment__c, 'width:9%', 'width:20%')}">
                <apex:facet name="header"><apex:outputLabel value="{!$Label.ASI_CRM_CN_PO_Remaining_Amount}" /></apex:facet> 
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.PORemainAmt}"/></apex:outputText>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalPORemainAmt}"/></apex:outputText></apex:facet>
            </apex:column>
            
            <apex:column style="{!if(PH.ASI_CRM_New_FY_Payment__c, 'width:9%', 'width:20%')}">
                <apex:facet name="header"><apex:outputLabel value="{!$Label.ASI_CRM_CN_Payment_Request_Amount}" /></apex:facet> 
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.PaymentRequestAmount}"/></apex:outputText>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalRequestAmt}"/></apex:outputText></apex:facet>
            </apex:column>
            <!--20160816, added by Leo-->
            <apex:column style="width:6%" rendered="{!PH.ASI_CRM_New_FY_Payment__c}">
                <apex:facet name="header"><apex:outputLabel value="{!$Label.ASI_CRM_CN_TP_CNY_Request_Amt}" /></apex:facet> 
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.cnyRequest}"/></apex:outputText>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalRequestAmtCNY}"/></apex:outputText></apex:facet> 
            </apex:column>
            <apex:column style="width:6%" rendered="{!PH.ASI_CRM_New_FY_Payment__c}">
                <apex:facet name="header"><apex:outputLabel value="{!$Label.ASI_CRM_CN_TP_MAF_Request_Amt}" /></apex:facet> 
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.mafRequest}"/></apex:outputText>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalRequestAmtMAF}"/></apex:outputText></apex:facet> 
            </apex:column>
            <apex:column style="width:6%" rendered="{!PH.ASI_CRM_New_FY_Payment__c}">
                <apex:facet name="header"><apex:outputLabel value="{!$Label.ASI_CRM_CN_TP_Others_Request_Amt}" /></apex:facet> 
                <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.othersRequest}"/></apex:outputText>
                <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!TotalRequestAmtOthers}"/></apex:outputText></apex:facet> 
            </apex:column>
            </apex:pageblocktable>
        </apex:pageblock>

<div class="apexp">
    <div class="individualPalette">
        <div class="Custom46Block">
            <div id="j_id0:j_id10:j_id115" class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette"><div class="pbHeader">
                <table border="0" cellpadding="0" cellspacing="0">
                    <tbody>
                        <tr>
                            <td class="pbTitle">
                                    <h2 class="mainTitle">{!$Label.ASI_CRM_CN_TP_Trade_Plans}</h2>
                            </td>
                            <td>&nbsp;</td>
                        </tr>
                    </tbody>
                </table>
            </div>
    <div class="pbBody">
        <table border="0" cellpadding="0" cellspacing="0" class="list" id="j_id0:j_id10:j_id228:j_id229">
            <colgroup span="6">
            </colgroup>
            <thead class="">
                <tr class="headerRow">
                    <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id230header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id230header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Activity_NO}
                            </label>
                        </div>
                    </th>
                    <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id238header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id238header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Sub_Brand}
                            </label>
                        </div>
                    </th>
                    <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id238header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id238header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Bottle_Size}
                            </label>
                        </div>
                    </th>
                     <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id233header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id233header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Actual_Volume}
                            </label>
                        </div>
                    </th>
                    <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id233header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id233header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Estimate}
                            </label>
                        </div>
                    </th>
                    <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id248header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id248header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Fixed_Cost}
                            </label>
                        </div>
                    </th>

                    <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id243header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id243header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Contract}
                            </label>
                        </div>
                    </th>
                    <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id243header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id243header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Promotion_Payment}
                            </label>
                        </div>
                    </th>
                    <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id243header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id243header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Fixed_Cost_Payment}
                            </label>
                        </div>
                    </th>
                    <th class="headerRow" colspan="1" id="j_id0:j_id10:j_id228:j_id229:j_id243header" scope="col">
                        <div id="j_id0:j_id10:j_id228:j_id229:j_id243header:sortDiv">
                            <label>
                                {!$Label.ASI_CRM_CN_TP_Payment_Request_Amount}
                            </label>
                        </div>
                    </th>
                </tr>
            </thead>
            <tfoot>
                <tr class="totalRow">
                    <th class="totalRow" colspan="1" scope="col">
                        <label>
                            {!$Label.ASI_CRM_CN_TP_Trade_Plan_Total}
                        </label>
                    </th>
                    <th class="totalRow" colspan="1" scope="col">
                        
                    </th>
                    <th class="totalRow" colspan="1" scope="col">
                        
                    </th>
                    <th class="totalRow" colspan="1" scope="col">
                        <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalAmount.pmtVol}"/></apex:outputText>
                    </th>
                    <th class="totalRow" colspan="1" scope="col">
                        <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalAmount.estAmount}"/></apex:outputText>
                    </th>
                    <th class="totalRow" colspan="1" scope="col">
                        <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalAmount.fixedAmount}"/></apex:outputText>

                        
                    </th>
                    <th class="totalRow" colspan="1" scope="col">
                        <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalAmount.estAmount + totalAmount.fixedAmount}"/></apex:outputText>

                        
                    </th>
                    <th class="totalRow" colspan="1" scope="col">
                        <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalAmount.paymentPromotion}"/></apex:outputText>
                    </th>
                    <th class="totalRow" colspan="1" scope="col">
                        <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalAmount.paymentCost}"/></apex:outputText>
                    </th>


                    <th class="totalRow" colspan="1" scope="col">
                        <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalAmount.paymentCost + totalAmount.paymentPromotion}"/></apex:outputText>
                    </th>
                </tr>
            </tfoot>
            <tbody id="j_id0:j_id10:j_id228:j_id229:tb">
                <apex:repeat value="{!paymentItemList}" var="item">

                <tr class="dataRow even first" onblur="if (window.hiOff){hiOff(this);}" onfocus="if (window.hiOn){hiOn(this);}" onmouseout="if (window.hiOff){hiOff(this);} " onmouseover="if (window.hiOn){hiOn(this);} ">
                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id230">
                        <div class="TRHeader">
                            <apex:outputLink value="/{!item.ASI_CRM_CN_TP_Plan_Line_Item__r.ASI_MFM_Plan__c}" target="_blank">{!item.ASI_CRM_CN_TP_Plan_Line_Item__r.ASI_MFM_Plan__r.Name}</apex:outputLink>
                        </div>
                    </td>
                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id233">
                        <div class="TRHeader">
                            <apex:outputLink value="/{!item.ASI_CRM_CN_TP_Plan_Line_Item__r.ASI_MFM_Sub_brand_Code__c}" target="_blank">{!item.ASI_CRM_CN_TP_Plan_Line_Item__r.ASI_MFM_Sub_brand_Code__r.Name}</apex:outputLink>
                        </div>
                    </td>
                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id233">
                        <span id="j_id0:j_id10:j_id228:j_id229:0:j_id235">
                        {!item.ASI_CRM_CN_TP_Plan_Line_Item__r.ASI_CRM_CN_TP_Bottle_Size__c}
                        </span>

                    </td>
                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id233">
                        <span id="j_id0:j_id10:j_id228:j_id229:0:j_id235">
                        <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!item.ASI_CRM_CN_Actual_Vol__c}"/></apex:outputText>
                        </span>
                    </td>
                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id233">
                        <span id="j_id0:j_id10:j_id228:j_id229:0:j_id235">
                        <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!item.ASI_CRM_CN_TP_Plan_Line_Item__r.ASI_CRM_CN_TP_Estimated_Amount__c}"/></apex:outputText>
                        </span>
                    </td>
                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id248">
                        <span class="OthersEstCost">
                            <span id="j_id0:j_id10:j_id228:j_id229:0:j_id251">
                            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!item.ASI_CRM_CN_TP_Plan_Line_Item__r.ASI_CRM_CN_TP_Fixed_Cost__c}"/></apex:outputText>

                                
                            </span>
                        </span>
                    </td>

                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id248">
                        <span class="OthersEstCost">
                            <span id="j_id0:j_id10:j_id228:j_id229:0:j_id251">
                            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!item.ASI_CRM_CN_TP_Plan_Line_Item__r.ASI_CRM_CN_TP_Estimated_Amount__c + item.ASI_CRM_CN_TP_Plan_Line_Item__r.ASI_CRM_CN_TP_Fixed_Cost__c}"/></apex:outputText>

                            </span>
                        </span>
                    </td>
                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id248">
                        <span class="OthersEstCost">
                            <span id="j_id0:j_id10:j_id228:j_id229:0:j_id251">
                            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!item.ASI_CRM_CN_TP_Promotion_Fee__c}"/></apex:outputText>

                                
                            </span>
                        </span>
                    </td>
                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id248">
                        <span class="OthersEstCost">
                            <span id="j_id0:j_id10:j_id228:j_id229:0:j_id251">
                            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!item.ASI_CRM_CN_TP_Fixed_Cost__c}"/></apex:outputText>

                                
                            </span>
                        </span>
                    </td>
                    <td class="dataCell " colspan="1" id="j_id0:j_id10:j_id228:j_id229:0:j_id248">
                        <span class="OthersEstCost">
                            <span id="j_id0:j_id10:j_id228:j_id229:0:j_id251">
                            <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!item.ASI_CRM_CN_TP_Fixed_Cost__c + item.ASI_CRM_CN_TP_Promotion_Fee__c}"/></apex:outputText>

                                
                            </span>
                        </span>
                    </td>
                </tr>
                </apex:repeat>
            </tbody>
        </table>
    </div>
    <div class="pbFooter secondaryPalette">
        <div class="bg"></div></div></div></div></div></div>

        <apex:pageblock title="{!$Label.ASI_CRM_CN_VF_LABEL_BRSF}">
        <apex:pageblockButtons location="top">
            <!-- <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_BRSF_Report}" onClick="window.open('/apex/ASI_CRM_CN_BRSFFormPDFPage?id={!PH.id}');" rendered="{!PH.ASI_TH_CRM_Status__c!='Draft'}" /> -->
        </apex:pageblockButtons>
            <apex:pageblocktable value="{!BRSFList}" var="row">

                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_MFM_Sub_brand__c.Fields.Name.Label}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Sub_Brand__c}" />
                    <apex:facet name="footer">{!$Label.ASI_CRM_CN_TP_Total}</apex:facet>

                </apex:column>

                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$Label.ASI_CRM_CN_TP_Total_Volume_9L
}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_Volume_9L__c}" />
                    <!-- <apex:facet name="body"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_Volume_9L__c}"/></apex:outputText></apex:facet> -->

                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF2.volumes}"/></apex:outputText></apex:facet>

                </apex:column>

                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$Label.ASI_CRM_CN_TP_Amount}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_TP_Amount__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF2.promotionAmount}"/></apex:outputText></apex:facet>

                </apex:column>

                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$Label.ASI_CRM_CN_TP_Fixed_Cost_Payment}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_TP_Fixed_Cost__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF2.fixedAmount}"/></apex:outputText></apex:facet>

                </apex:column>

                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$Label.ASI_CRM_CN_TP_GS_Amount}"/></apex:facet>
                    <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CN_TP_GS_Amount__c}"/></apex:outputText>
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!totalBRSF2.gs}"/></apex:outputText></apex:facet>

                </apex:column>

                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$Label.ASI_CRM_CN_TP_GS_Percent}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_TP_GS_Percent__c}" />
                    <apex:facet name="footer"><apex:outputText value="{0,number,###,###,##0.00%}"><apex:param value="{!totalBRSF2.gsPercent}"/></apex:outputText></apex:facet>

                </apex:column>
            </apex:pageblocktable>

            <br/>
        </apex:pageblock>
        
       <!--  <apex:pageblock title="{!if(PH.ASI_CRM_New_FY_Payment__c, $Label.ASI_CRM_CN_VF_LABEL_PSF_NewFY, $Label.ASI_CRM_CN_VF_LABEL_PSF)}">
            <apex:pageblockButtons location="top">
            <apex:commandButton value="{!if(PH.ASI_CRM_New_FY_Payment__c, $Label.ASI_CRM_CN_VF_LABEL_PSF_Report_NewFY, $Label.ASI_CRM_CN_VF_BTN_PSF_Report)}" onClick="window.open('/apex/ASI_CRM_CN_PSFFormPDFPage?id={!PH.id}');" rendered="{!PH.ASI_TH_CRM_Status__c!='Draft'}" />
            </apex:pageblockButtons>
            <apex:pageblocktable value="{!PSFList}" var="row">
                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Payment_Description__c.Label}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Payment_Description__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Period_Start__c.Label}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Period_Start__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Period_End__c.Label}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Period_End__c}" />
                </apex:column>
               <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_TH_CRM_Amount__c.Label}"/></apex:facet>
                    <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_TH_CRM_Amount__c}" /></apex:outputText>
                </apex:column>
                <apex:column rendered="{!PH.ASI_CRM_New_FY_Payment__c && isFestivalPSF}">
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CNY_Est__c.Label}"/></apex:facet>
                    <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CNY_Est__c}" /></apex:outputText>
                </apex:column>
                <apex:column rendered="{!PH.ASI_CRM_New_FY_Payment__c && isFestivalPSF}">
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_MAF_Est__c.Label}"/></apex:facet>
                    <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_MAF_Est__c}" /></apex:outputText>
                </apex:column>
                <apex:column rendered="{!PH.ASI_CRM_New_FY_Payment__c && isFestivalPSF}">
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_Other_Est__c.Label}"/></apex:facet>
                    <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_Other_Est__c}" /></apex:outputText>
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Comment__c.Label}</apex:facet> 
                    <apex:outputField value="{!row.ASI_CRM_CN_Comment__c}"/>
                </apex:column>             
            </apex:pageblocktable>
        </apex:pageblock> -->

        <apex:pageblock title="{!$Label.ASI_CRM_CN_VF_LABEL_Other_Payment_Detail}">
            <apex:pageblocktable value="{!OTPList}" var="row">
                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Expense_Type__c.Label}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Expense_Type__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_TH_CRM_Amount__c.Label}"/></apex:facet>
                    <apex:outputText value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_TH_CRM_Amount__c}" /></apex:outputText>
                </apex:column>
                <apex:column rendered="{!PH.ASI_CRM_New_FY_Payment__c}" >
                    <apex:facet name="header">{!$Label.ASI_CRM_CN_TP_MAF_Est}</apex:facet>
                    <apex:outputText rendered="{!festivalMap[row.id]}" value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_MAF_Est__c}" /></apex:outputText>
                </apex:column>
                <apex:column rendered="{!PH.ASI_CRM_New_FY_Payment__c}" >
                    <apex:facet name="header">{!$Label.ASI_CRM_CN_TP_CNY_Est}</apex:facet>
                    <apex:outputText rendered="{!festivalMap[row.id]}" value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_CNY_Est__c}" /></apex:outputText>
                </apex:column>
                <apex:column rendered="{!PH.ASI_CRM_New_FY_Payment__c}" >
                    <apex:facet name="header">{!$Label.ASI_CRM_CN_TP_Others_Est}</apex:facet>
                    <span class="OthersEstCost"><apex:outputText rendered="{!festivalMap[row.id]}" value="{0,number,###,###,##0.00}"><apex:param value="{!row.ASI_CRM_Other_Est__c}" /></apex:outputText></span>
                </apex:column>
                <apex:column >
                    <apex:facet name="header"><apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Comment__c.Label}"/></apex:facet>
                    <apex:outputField value="{!row.ASI_CRM_CN_Comment__c}" />
                </apex:column>
            </apex:pageblocktable>
        </apex:pageblock>       
        <apex:pageblock title="{!$Label.ASI_CRM_CN_VF_LABEL_Cash}" rendered="{!cashtype}">
        <apex:pageblocksection columns="1">
            <apex:pageblocktable value="{!Payee_Item_Map_CASH}" var="itm" id="item">
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Cash_Payee_Name_T1__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CASH[itm].ASI_CRM_CN_Cash_Payee_Name_T1__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Amount__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CASH[itm].ASI_CRM_CN_Amount__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Reason__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CASH[itm].ASI_CRM_CN_Reason__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Comfirm_Receipt__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CASH[itm].ASI_CRM_CN_Comfirm_Receipt__c}" />
                </apex:column>
            </apex:pageblocktable>
        </apex:pageblocksection>
     </apex:pageblock>
     <apex:pageblock title="{!$Label.ASI_CRM_CN_VF_LABEL_Discount}" rendered="{!discounttype}">
        <apex:pageblocksection title="{!$Label.ASI_CRM_CN_VF_LABEL_Discount}" columns="1">
            <apex:pageblocktable value="{!Payee_Item_Map_DISCOUNT}" var="itm" id="item">
                <apex:column >
                    <apex:facet name="header">{!$Label.ASI_CRM_CN_VF_LABEL_T2_WS}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Payee_T2__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$Label.ASI_CRM_CN_VF_LABEL_T1_WS}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Payee_T1__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Discount_Amount__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Amount__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Reason__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Reason__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Instruction_Sent_Time__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Instruction_Sent_Time__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Comfirm_Receipt__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Comfirm_Receipt__c}" />
                </apex:column>
            </apex:pageblocktable>
        </apex:pageblocksection>
        <apex:pageblocksection title="{!$Label.ASI_CRM_CN_VF_LABEL_Others}" columns="1">
            <apex:pageblocktable value="{!Payee_Item_Map_CD}" var="itm" id="item">
                <apex:column >
                    <apex:facet name="header">{!$Label.ASI_CRM_CN_VF_LABEL_T2_WS}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Payee_T2__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$Label.ASI_CRM_CN_VF_LABEL_T1_WS}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Payee_T1__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Discount_Amount__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Amount__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Reason__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Reason__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Instruction_Sent_Time__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Instruction_Sent_Time__c}" />
                </apex:column>
                <apex:column >
                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Comfirm_Receipt__c.Label}:</apex:facet>
                    <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Comfirm_Receipt__c}" />
                </apex:column>
            </apex:pageblocktable>
        </apex:pageblocksection>
     </apex:pageblock>
        
     
    </apex:form>
    
    <apex:relatedList id="Attachments" subject="{!pageid}" list="CombinedAttachments"/>
    <apex:relatedList id="Approval" subject="{!pageid}" list="ProcessSteps"/>
    <apex:relatedList id="ApprovalComment" subject="{!pageid}" list="Payment_Request_Approval_Comments__r" />
    <script type="text/javascript"> 
        function addLoadEvent(func) {   
            var oldonload = window.onload;
            if (typeof window.onload != 'function') {   
                window.onload = func;   }   
            else {  window.onload = function() {    
                if (oldonload) {    oldonload();    }   
                func(); }   
            }   
        }   
        addLoadEvent(   
            function() {    checkPage();    }   ); 
    </script>
    &nbsp;
    <script type="text/javascript">     
        function checkPage() {  
            if (document.getElementsByName("piSubmit")[0] != null)  
                document.getElementsByName("piSubmit")[0].style.display = 'none';   
        }
    var $inputEle = $('td span.OthersEstCost').each(function(){
        
        if($(this).text().indexOf('-') > -1){
            $(this).addClass('negative');
        }else{
            $(this).removeClass('negative');
        }
    });
    </script>
</apex:page>