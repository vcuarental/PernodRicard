<!--
/*********************************************************************************
 * Name: ASI_CRM_SG_ManagePayment_Page
 * Description: VF page to edit Payment Reqeust line item for SG CRM
 *
 * Version History
 * Date             Developer               Comments
 * ---------------  --------------------    --------------------------------------------------------------------------------
 * ??????????       ??????????????          Created
 * 2016-05-04       Laputa: Vincent         [VL 1.0] If payment request header is generated by system, user can edit nothing
 * 2017-11-08       Wilken Lee              [WL 2.0] P4.1A Display different Types for old Contract vs RTM Contract
 * 2018-03-21       Laputa: Vincent         [VL 3.0] P4.2 handle wholesaler back rebates
 * 2018-04-14       Laputa: Vincent         [VL 4.0] P4.2 handle promotion
 */
-->

<apex:page standardController="ASI_TH_CRM_PaymentRequest__c" extensions="ASI_CRM_SG_ManagePayment_Controller" sidebar="false" showheader="false">

<head>
<apex:stylesheet value="/sCSS/21.0/sprites/1297816277000/Theme3/default/gc/versioning.css" />   

<apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_SG_jQuery_Lib, '/libs/jquery/css/redmond/jquery-ui-1.10.3.custom.min.css')}" />
<apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_SG_jQuery_Lib, '/styles/common.css')}" />


<link href="{!URLFOR($Resource.ASI_CRM_SG_jQuery_DataTables, 'css/jquery.dataTables.css')}" media="screen" rel="stylesheet" type="text/css" />

<apex:includeScript value="{!URLFOR($Resource.ASI_CRM_SG_jQuery_Lib, '/libs/jquery/js/jquery-1.9.1.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.ASI_CRM_SG_jQuery_Lib, '/libs/jquery/js/jquery-ui-1.10.3.custom.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.ASI_CRM_SG_jQuery_DataTables, 'js/jquery.dataTables.js')}"/>

<script>
    $ = jQuery.noConflict();
    
    var eventDescriptionItemCount = 0;
    var trainingDescriptionItemCount = 0;
    
    var colLabel_Action = "Action";     
    
    var basicDataTableProperties = {
        "bDestroy":true,
        "bStateSave":true,
        "aaSorting": [[1, "asc"]],
        "bSearch":false,
        "bFilter" : true,
        "aLengthMenu":[10,25,50],
        "iDisplayLength":25,
        "bSort" : false,
        "oLanguage" : {"sSearch": "Filter"}
    };
    
    //DataTable Variable
    var cliSubBrand;
    var cmSubBrand;
    var cliSalesOrderItems;
    var cmSalesOrderItems;
    var cliEvents;
    var cmEvents;
    var summaryEvents;
    var cliCash;
    var cliAP;
    var cliPaymentSchedule1;
    var cliPaymentSchedule2;
    
    $(document).ready(
        function(){
            setTables();
            
        }
    );
    
    function setSubBrandTable(){
        var cliSubBrand_dataTableProperties = basicDataTableProperties;
        /* [VL 3.0] BEGIN */
        if ('{!isWholesalerBackRebate}'=='true'){
            cliSubBrand_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "SKU"},
                {"sTitle": "Sub-Brand"},
                {"sTitle": "Outlet"},
                {"sTitle": "Type"},
                {"sTitle": "Offtake Volume (Bottle)"},
                {"sTitle": "Back Rebate ($/Bottle)"},
                {"sTitle": "Amount"}
            ];
        } else 
        /* [VL 3.0] END */
        /* [VL 4.0] BEGIN */
        if ('{!isPromotion}'=='true'){
            cliSubBrand_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "SKU"},
                {"sTitle": "Sub-Brand"},
                {"sTitle": "Type"},
                {"sTitle": "Offtake Volume (9L)"},
                {"sTitle": "Promotion Mechanic"},
                {"sTitle": "Amount"},
                {"sTitle": "Promotion"}
            ];
        } else 
        /* [VL 4.0] END */
        if ('{!isBottleIncentive}'=='true'){
            cliSubBrand_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "Sub-Brand"},
                {"sTitle": "Type"},
                {"sTitle": "Volume (9L)"},
                {"sTitle": "Contracted Rate (9L)"},
                {"sTitle": "Amount"},
                {"sTitle": "Actual Amount"},
                {"sTitle": "Adjustment Remarks"},
                {"sTitle": "Difference"}
            ];
        } else 
        if ('{!isBackRebates}'=='true'){
            cliSubBrand_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "SKU"},
                {"sTitle": "Type"},
                {"sTitle": "Amount"},
                {"sTitle": "Last Time Issued"},
                {"sTitle": "Achieved"},
                {"sTitle": "This Payment Contribution"}
            ];
        } else {
            cliSubBrand_dataTableProperties["aoColumns"] = [
                {"sTitle": colLabel_Action},
                {"sTitle": "Sub-Brand"},
                {"sTitle": "Type"},
                {"sTitle": "Amount"}
            ];
        }
        
        cliSubBrand =  $("#{!PREFIX_TABLE}SubBrand").dataTable(cliSubBrand_dataTableProperties);

        var cmSubBrand_dataTableProperties = basicDataTableProperties;
        cmSubBrand_dataTableProperties["aoColumns"] = [
            {"sTitle": colLabel_Action},
            {"sTitle": "Sub-Brand"}
        ];
        cmSubBrand =  $("#available_SubBrand").dataTable(cmSubBrand_dataTableProperties);
    
    }
    
    function setTables(){
        setSubBrandTable();
        
        $('#{!PREFIX_TABLE}SubBrand > tbody  > tr').each(function() {
            $(this).find("input.OrderQuantity").trigger("change");
        });
    }
    
    function validateNumber(input){
        input = normalizeFloat(input, [", ", "."]);
        var numRe =  new RegExp("^([+]?)([0-9]*)(\.[0-9]{0})?$"); 
        return numRe.test(input);
    }
    
    function validateFloat(input, precision){
        input = normalizeFloat(input, [", ", "."]);
        var numRe =  new RegExp("^([+]?)([0-9]*)(\.[0-9]{1,"+precision+"})?$"); 
        return numRe.test(input);
    }

    
    function normalizeFloat(number, chars) {
        /*
        var lastIndex = -1;
        for(i=0; i < chars.length; i++) {
            t = number.lastIndexOf(chars[i]);

            if (t > lastIndex) {
                lastIndex = t;
            }
        }

        if (lastIndex == -1) {
            lastIndex = number.length;
        }

        var whole = number.substring(0, lastIndex);   
        var precision = number.substring(lastIndex);
        for (i=0; i < chars.length; i++) {
            whole = whole.replace(chars[i], '');
            precision = precision.replace(chars[i],'.');           
        }
        number = whole + precision;
        */
        if (number==undefined) return 0;
        
        for(i=0; i < chars.length; i++) {
            if (chars[i]==","){
                //number = number.replace(new RegExp('"_0x69b9[' + chars[i] + ']"', 'g'), '');
                number = number.toString().split(',').join('');
                //console.log("Number : "+i+" "+chars[i]+" "+number);
            }
        }
        f = parseFloat(number);
        return f;
    }
    
    function precise_round(num,decimals){
        return Math.round(num*Math.pow(10,decimals))/Math.pow(10,decimals);
    }
    
    function loading(val) {
        if (val) {
          document.getElementById('contentLoading').style.display = 'block';
          document.getElementById('contentLoaded').style.display = 'none';
        }
        else {
          document.getElementById('contentLoading').style.display = 'none';
          document.getElementById('contentLoaded').style.display = 'block';
        }
    }
    
    function startLoading(){
        $('#load_scrl').css('top', $(document).scrollTop() + 200);
        $('.loadingBox').show();
    }
    function endLoading(){
             $('.loadingBox').hide();
    }
    
    function calculateDiff(cpiRow, adjustedAmount, amount){
    
        var diff = 0;
        
        if (cpiRow!=undefined){
                            
            amount = normalizeFloat(amount, [","]);
            amount = (amount!=null&&amount!=undefined&&amount!="NaN")?parseFloat(amount):0;
            adjustedAmount = normalizeFloat(adjustedAmount, [","]);
            adjustedAmount = (adjustedAmount!=null&&adjustedAmount!=undefined&&adjustedAmount!="NaN")?parseFloat(adjustedAmount):0;
             
            diff = adjustedAmount - amount;
        }
        
        return diff;
    
    }
</script>

<style>
body {
    margin-top: 40px;
    font-size: 12px;
    font-family: Helvetica,Arial,Verdana,sans-serif;
    width:100%;
}
        
.loadingOverlay{
    opacity: 0.4;
    postion: absolute;
    top:0px;
    left:0px;
    background-color:#001100;
    width:100%;
    z-index: 5000
}

#container1{
    width:100%;
}

#tabLink{
    font-size: 10px;
}

.overlay {
            display: none;
            height: 100%;
            left: 0;
            position: fixed;
            top: 0;
            opacity: 0.3;
            -moz-opacity: 0.3;
            width: 100%;
            -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=30)";
            filter: alpha(opacity=30);
            background: #000;
            -khtml-opacity: 0.3;
            z-index: 1000;
        }
.loader {
    width: 32px;
    height: 32px;
    position: absolute;
    left: 50%;
}

input.error-input {
    border-color: red;
}
</style>

</head>

<body>
    <apex:actionStatus id="loading" onstart="startLoading();" onstop="endLoading();" />
     
    <apex:form >
    <apex:pageMessages id="pageMsg"></apex:pageMessages>
    
    <div id="contentLoading" style="display:none;">
        <div style="text-align: center;">
            <p>Loading...
            <img src="/img/loading.gif" alt="Loading graphic" /></p>
        </div>
    </div>
    
    <div id="load_scrl" class="loadingBox loader" style="display:none"><div style="text-align: center;">
            <p>Loading...
            <img src="/img/loading.gif" alt="Loading graphic" /></p>
        </div>
    </div>
    <div class="loadingBox overlay"> </div>
        
    <apex:pageBlock id="main_pageBlock">
         <apex:pageblockButtons >
             <!-- [VL 1.0] BEGIN -->
             <!--
                <apex:commandLink value="Save" 
                    status="loading"
                    action="{!saveLinetems}"
                    target="_parent" styleClass="btn" style="text-decoration:none;padding:4px;">
                    <apex:param name="IS_QUICK_SAVE" value="false"/>
                </apex:commandLink>
                <apex:commandButton value="Quick Save" 
                    rerender="pageMsg"
                    oncomplete="console.log('Quick Save Done');"
                    status="loading"
                    action="{!saveLinetems}">
                    <apex:param name="IS_QUICK_SAVE" value="true"/>
                </apex:commandButton>
                    -->
                <!-- [VL 3.0] BEGIN -->
                <!--
                <apex:commandLink value="Save" 
                    status="loading"
                    action="{!saveLinetems}"
                    target="_parent" styleClass="btn" style="text-decoration:none;padding:4px;"
                    rendered="{!AND(isEdit, !AND(isSysGenerated,!isBottleIncentive))}">
                    <apex:param name="IS_QUICK_SAVE" value="false"/>
                </apex:commandLink>
                <apex:commandButton value="Quick Save" 
                    rerender="pageMsg"
                    oncomplete="console.log('Quick Save Done');"
                    status="loading"
                    action="{!saveLinetems}"
                    rendered="{!AND(isEdit, !AND(isSysGenerated,!isBottleIncentive))}">
                    <apex:param name="IS_QUICK_SAVE" value="true"/>
                </apex:commandButton>
                -->
                <apex:commandLink value="Save" 
                    status="loading"
                    action="{!saveLinetems}"
                    target="_parent" styleClass="btn" style="text-decoration:none;padding:4px;"
                    rendered="{!AND(isEdit, !AND(isSysGenerated,!isBottleIncentive))}">
                    <apex:param name="IS_QUICK_SAVE" value="false"/>
                </apex:commandLink>
                <apex:commandButton value="Quick Save" 
                    rerender="pageMsg"
                    oncomplete="console.log('Quick Save Done');"
                    status="loading"
                    action="{!saveLinetems}"
                    rendered="{!AND(isEdit, !AND(isSysGenerated,!isBottleIncentive))}">
                    <apex:param name="IS_QUICK_SAVE" value="true"/>
                </apex:commandButton>
                <!-- [VL 3.0] END -->
             <!-- [VL 1.0] END -->
                <apex:commandLink value="Cancel" action="{!cancel}" 
                    immediate="true"
                    target="_parent" styleClass="btn" style="text-decoration:none;padding:4px;"/>
                </apex:pageblockButtons>
                
                <apex:pageBlockSection columns="1">
                    <apex:outputField value="{!Header.Name}"/>

            
        </apex:pageBlockSection>
        
        
        
        
        <div id="mechanicTypeTabs" class="tabLink">
            <ul>
                <li><apex:outputPanel rendered="true"><a href="#tab_SubBrand">Sub Brand</a></apex:outputPanel></li>
                
            </ul>
            
            <div id="tab_SubBrand">
                    <apex:pageBlock id="pageBlock_SubBrand"> 
                        <!-- [VL 3.0] BEGIN --><!-- [VL 4.0] BEGIN -->
                        <!--
                        <apex:pageBlockSection id="section_lineItem_SubBrand" title="Payment Request Line Items" columns="1" rendered="{!AND(NOT(isBottleIncentive),!isBackRebates)}">
                        -->
                        <apex:pageBlockSection id="section_lineItem_SubBrand" title="Payment Request Line Items" columns="1" rendered="{!AND(NOT(isBottleIncentive),!isBackRebates,!isWholesalerBackRebate,!isPromotion)}">
                        <!-- [VL 3.0] BEGIN --><!-- [VL 4.0] END -->
                            
                            <apex:outputPanel layout="block" >
                                <table id="{!PREFIX_TABLE}SubBrand">
                                    <apex:repeat var="cpiKey" value="{!allLineItemMap}">
                                    <apex:repeat var="cpiObj" value="{!allLineItemMap[cpiKey]}">
                                    <tr id="row_SubBrand_{!cpiKey}" class="cpiContent">
                                        <td>
                                            <!-- [VL 1.0] BEGIN -->
                                            <!--
                                            <apex:commandLink value="Delete"
                                            immediate="true"
                                            action="{!removeLineItem}"
                                            rerender="pageBlock_SubBrand,  pageMsg"
                                            onComplete="console.log('Remove CPI'); setTables();"
                                            status="loading">
                                                <apex:param name="PARAM_PAYMENTLINE_SUBBRAND_ID" value="{!cpiKey}"/>
                                            </apex:commandLink>
                                            -->
                                            <apex:commandLink value="Delete"
                                            immediate="true"
                                            action="{!removeLineItem}"
                                            rerender="pageBlock_SubBrand,  pageMsg"
                                            onComplete="console.log('Remove CPI'); setTables();"
                                            status="loading"
                                            rendered="{!AND(isEdit, !isSysGenerated)}">
                                                <apex:param name="PARAM_PAYMENTLINE_SUBBRAND_ID" value="{!cpiKey}"/>
                                            </apex:commandLink>
                                            <!-- [VL 1.0] END -->
                                        </td>
                                       <td><apex:outputField value="{!cpiObj.ASI_CRM_SG_Sub_brand__c}"/></td>
                                        <td>
                                            <!-- [VL 1.0] BEGIN -->
                                            <!--
                                            <apex:inputField value="{!cpiObj.ASI_CRM_SG_Type__c}"
                                            required="true"
                                            styleclass="type">
                                            </apex:inputField>
                                            -->
                                            <!-- [WL 2.0] BEGIN -->
                                            <apex:selectList value="{!cpiObj.ASI_CRM_SG_Type__c}" size="1" required="true"
                                                styleclass="type"
                                                style="width:250px"
                                                rendered="{!AND(isEdit, !isSysGenerated)}">
                                                    <apex:selectOptions value="{!paymentTypeSelectOptions}"></apex:selectOptions>
                                            </apex:selectList>
                                            <!--<apex:inputField value="{!cpiObj.ASI_CRM_SG_Type__c}" rendered="{!AND(isEdit, !isSysGenerated)}"
                                            required="true"
                                            styleclass="type">
                                            </apex:inputField>-->
                                            <!-- [WL 2.0] END -->
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SG_Type__c}" rendered="{!OR(!isEdit, isSysGenerated)}"
                                            styleclass="type">
                                            </apex:outputField>

                                            <!-- [VL 1.0] END -->
                                        </td>
                                        <td>
                                            <!-- [VL 1.0] BEGIN -->
                                            <!--
                                            <apex:inputField value="{!cpiObj.ASI_TH_CRM_Amount__c}"
                                            required="true"
                                            styleclass="amount">
                                            </apex:inputField>
                                            -->
                                            <apex:inputField value="{!cpiObj.ASI_TH_CRM_Amount__c}" rendered="{!AND(isEdit, !isSysGenerated)}"
                                            required="true"
                                            styleclass="amount">
                                            </apex:inputField>
                                            <apex:outputField value="{!cpiObj.ASI_TH_CRM_Amount__c}" rendered="{!OR(!isEdit, isSysGenerated)}"
                                            styleclass="amount">
                                            </apex:outputField>
                                            <!-- [VL 1.0] END -->
                                        </td>
                                    </tr>
                                    </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                        
                        <!-- [VL 3.0] BEGIN -->
                        <apex:pageBlockSection title="Payment Request Line Items" columns="1" rendered="{!isWholesalerBackRebate}">
                            <apex:outputPanel layout="block">
                                <table id="{!PREFIX_TABLE}SubBrand">
                                    <apex:repeat var="cpiKey" value="{!allLineItemMap}">
                                    <apex:repeat var="cpiObj" value="{!allLineItemMap[cpiKey]}">
                                    <tr id="row_SubBrand_{!cpiKey}" class="cpiContent">
                                        <td>
                                            
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SKU__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SG_Sub_brand__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_Customer__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SG_Type__c}"
                                            styleclass="type">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_CN_Offtake_Vol__c}">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_Back_Rebate_per_Bottle__c}">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_TH_CRM_Amount__c}"
                                            styleclass="amount">
                                            </apex:outputField>
                                        </td>
                                    </tr>
                                    </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                        <!-- [VL 3.0] END -->

                        <!-- [VL 4.0] BEGIN -->
                        <apex:pageBlockSection title="Payment Request Line Items" columns="1" rendered="{!isPromotion}">
                            <apex:outputPanel layout="block">
                                <table id="{!PREFIX_TABLE}SubBrand">
                                    <apex:repeat var="cpiKey" value="{!allLineItemMap}">
                                    <apex:repeat var="cpiObj" value="{!allLineItemMap[cpiKey]}">
                                    <tr id="row_SubBrand_{!cpiKey}" class="cpiContent">
                                        <td>
                                            
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SKU__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SG_Sub_brand__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SG_Type__c}"
                                            styleclass="type">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_Volume_9L__c}">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_Promotion_Mechanic_Text__c}">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_TH_CRM_Amount__c}"
                                            styleclass="amount">
                                            </apex:outputField>
                                        </td>
                                        <td><apex:outputField value="{!cpiObj.ASI_CRM_Promotion_Detail__r.ASI_HK_CRM_Promotion__r.ASI_CRM_Promotion_Plan__c}">
                                            </apex:outputField>
                                        </td>
                                    </tr>
                                    </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>
                        <!-- [VL 4.0] END -->

                        
                        <apex:pageBlockSection title="Payment Request Line Items" columns="1" rendered="{!isBottleIncentive}">
                            <apex:outputPanel layout="block">
                                <table id="{!PREFIX_TABLE}SubBrand">
                                    <apex:repeat var="cpiKey" value="{!allLineItemMap}">
                                    <apex:repeat var="cpiObj" value="{!allLineItemMap[cpiKey]}">
                                    <tr id="row_SubBrand_{!cpiKey}" class="cpiContent">
                                        <td>
                                            
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SG_Sub_brand__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SG_Type__c}"
                                            styleclass="type">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_Volume_9L__c}">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_Contracted_Rate_9L__c}">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_TH_CRM_Amount__c}"
                                            styleclass="amount">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:inputField value="{!cpiObj.ASI_CRM_Adjusted_Amount__c}" required="true"
                                                             styleclass="adjustedAmount"
                                                             onchange="$('#adjustedDiff_{!cpiKey}').text(calculateDiff($('row_SubBrand_{!cpiKey}'), $('#row_SubBrand_{!cpiKey}').find('input.adjustedAmount').val(), '{!cpiObj.ASI_TH_CRM_Amount__c}'))">
                                            </apex:inputField>
                                        </td>
                                        <td>
                                            <apex:inputField value="{!cpiObj.ASI_CRM_Adjustment_Remark__c}">
                                            </apex:inputField>
                                        </td>
                                        <td>
                                            <span id="adjustedDiff_{!cpiKey}">{!cpiObj.ASI_CRM_Difference_Adjusted_Amount__c}</span>
                                        </td>
                                    </tr>
                                    </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>

                        <apex:pageBlockSection title="Payment Request Line Items" columns="1" rendered="{!isBackRebates}">
                            <apex:outputPanel layout="block">
                                <table id="{!PREFIX_TABLE}SubBrand">
                                    <apex:repeat var="cpiKey" value="{!allLineItemMap}">
                                    <apex:repeat var="cpiObj" value="{!allLineItemMap[cpiKey]}">
                                    <tr id="row_SubBrand_{!cpiKey}" class="cpiContent">
                                        <td>
                                            
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SKU__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_SG_Type__c}"
                                            styleclass="type">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_TH_CRM_Amount__c}"
                                            styleclass="amount">
                                            </apex:outputField>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_Contribution_From__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_Contribution_To__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!cpiObj.ASI_CRM_Contribution__c}"/>
                                        </td>
                                    </tr>
                                    </apex:repeat>
                                    </apex:repeat>
                                </table>
                            </apex:outputPanel>
                        </apex:pageBlockSection>

                        <!-- [VL 1.0] BEGIN -->
                        <!--
                        <apex:pageBlockSection id="section_available_SubBrand" title="Sub-Brand" columns="1" rendered="{!isEdit}">
                        -->
                        <apex:pageBlockSection id="section_available_SubBrand" title="Sub-Brand" columns="1" rendered="{!AND(isEdit, NOT(isSysGenerated))}">
                        <!-- [VL 1.0] END -->
                            <apex:pageBlockSectionItem >
                            
                                <apex:outputLabel value="Sub-Brand" />
                                <apex:outputPanel >
                                    <apex:inputText value="{!SubBrandNameFilter}" />
                                </apex:outputPanel>
                                
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem >
                                <apex:outputPanel >
                                    <apex:commandbutton value="Search" action="{!retrieveSubBrandbySubBrand}" rerender="pageBlock_SubBrand, pageMsg" onComplete="setTables();" status="loading"/>
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem >
                                </apex:pageBlockSectionItem>
                            <apex:outputPanel layout="block">
                                <table id="available_SubBrand">
                                    <apex:repeat var="csKey" value="{!allSubBrandMap}">
                                    <apex:repeat var="csObj" value="{!allSubBrandMap[csKey]}">
                                    <tr>
                                        <td>
                                            <apex:commandLink value="Add"
                                            immediate="true"
                                            action="{!addLineItem}"
                                            rerender="pageBlock_SubBrand,  pageMsg"
                                            onComplete="console.log('Add CPI'); setTables();"
                                            status="loading"> 
                                                <apex:param name="PARAM_PAYMENTLINE_SOURCE_ITEM_ID" value="{!csKey}"/>
                                            </apex:commandLink>
                                        </td>
                                        <td><apex:outputField value="{!csObj.Name}"/></td>
                                    </tr>
                                    </apex:repeat>
                                    </apex:repeat>
                                </table>
                           </apex:outputPanel>
                        </apex:pageBlockSection>
                    </apex:pageBlock>
                
            </div>
            
        </div>
        
        
        <script>
            $("#mechanicTypeTabs").tabs();
        </script>
        
    </apex:pageBlock>
    
    </apex:form>

</body>
</apex:page>