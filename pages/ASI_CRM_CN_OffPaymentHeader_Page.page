<!--
 - Created by Jeffrey Cheung on 3/9/2018.
 -->

<apex:page id="ASI_CRM_CN_OffPaymentHeader_Page" standardController="ASI_TH_CRM_PaymentRequest__c" extensions="ASI_CRM_CN_EditOffPaymentDetailCtrl" action="{!Calculation}" sidebar="false">
    <apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.ASI_Library, 'dist/css/bootstrap.min.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery1.10.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_Library, 'dist/js/bootstrap.min.js')}"/>

    <style>
        .module-table td {
            min-width: 15%;
        }

        .module-table tr td:nth-child(odd) {
            font-weight: bold !important;
            text-align: right !important;
        }

        .AlignRight {
            text-align: right !important;
            font-weight: bold !important;
        }

        .BSCommandButton {
            color: #333 !important;
            background-color: #fff !important;
            border-color: #ccc !important;
            margin-left: 0.5em !important;
            margin-right: 0.5em !important;
            margin-bottom: 0.5em !important;
            padding: 3px 6px !important;
        }

        .PanelHeader {
            color: #fff;
            border-top-left-radius: 3px;
            border-top-right-radius: 3px;
            background-color: #337ab7;
            border: 1px solid #337ab7;
            padding: 10px 15px;
            text-align: center;
            width: 20%;
        }

        .PanelBody {
            padding: 0.3em;
            background-color: #fff;
            border: 1px solid #337ab7;
            border-bottom-left-radius: 3px;
            border-bottom-right-radius: 3px;
            border-top-right-radius: 3px;
            margin-bottom: 20px;
        }

        .BorderBottom {
            border-bottom: 1px solid #ddd;
        }

        .MethodologyLabel {
            font-weight: bold !important;
            text-align: right !important;
        }

        .FontWeightCSS {
            font-weight: bold;
        }
        .overpaidIncentive {
            color: red !important;
        }

    </style>
    <apex:outputPanel >
        <chatter:feedWithFollowers entityid="{!ASI_TH_CRM_PaymentRequest__c.id}"/>
    </apex:outputPanel>
    <script type="text/javascript">
        function addLoadEvent(func) {
            var oldonload = window.onload;
            if (typeof window.onload != 'function') {
                window.onload = func;
            }
            else {
                window.onload = function () {
                    if (oldonload) {
                        oldonload();
                    }
                    func();
                }
            }
        }


        function checkPage() {
            if (document.getElementsByName("piSubmit")[0] != null)
                document.getElementsByName("piSubmit")[0].style.display = 'none';
            if (document.getElementsByName("piSubmit")[0] != null)
                document.getElementsByName("piSubmit")[0].style.display = 'none';
            if (document.getElementsByName("piRemove")[0] != null) {
                var orgFunc = document.getElementsByName("piRemove")[0].onclick;
                document.getElementsByName("piRemove")[0].onclick = function () {
                    recallApprovalRequest(orgFunc);
                };
            }
            var anchors = document.getElementsByTagName("a");
            var reassignBackToRelatedList = "apex%2FASI_MFM_TW_Approval_Related_List%3Finline%3D1%26id%3D"; // the pattern of URL returning to related list iframe
            for (var i = 0; i < anchors.length; i++) {
                if (anchors[i].href.indexOf(reassignBackToRelatedList) > 0) {
                    anchors[i].href = anchors[i].href.replace(reassignBackToRelatedList, ""); // remove the url portion of returning to related list iframe
                }
                if (anchors[i].href.indexOf("salesforce.com") > 0) {
                    anchors[i].setAttribute('target', '_top'); // open the link in parent window when user press any links containing "salesforce.com" in URL
                }
            }


        }

        function recallApprovalRequest(func) {
            var recallApprovalRequestBackToRelatedList = "apex%2FASI_MFM_TW_Approval_Related_List%3Finline%3D1%26id%3D";  // the pattern of URL returning to related list iframe
            var funcStr = func.toString();
            var urlIndexStart = funcStr.indexOf("https");
            var funcStr2 = funcStr.substring(urlIndexStart, funcStr.length);
            var urlIndexEnd = funcStr2.indexOf(",") - 1;
            var urlStr = funcStr2.substring(0, urlIndexEnd); // extract the url of cancel button from the original onClick function
            urlStr = urlStr.replace(recallApprovalRequestBackToRelatedList, ""); // remove the url portion of returning to related list iframe
            var newWin = window.open(urlStr, "_top");  // open the window "Recall Approval Request" in parent window when the user press the button "Recall Approval Request"
        }

        addLoadEvent(function () {
            checkPage();
        });

    </script>
    <apex:form style="padding-bottom: 1em;" id="PaymentPageDIV">

        <div class="bs ">

            <div class="container-fluid">

                <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;">
                    <div style="grid-column-start: 1; grid-column-end: 1;">
                        <div style="font-weight: bold; font-family: Arial,Helvetica,sans-serif; color: #000; font-size: 1.3em; margin: 0.5em;">
                            Payment Request
                        </div>
                    </div>

                    <div style="grid-column-start: 2; grid-column-end: 2;  margin-top: 0.5em;">

                        <apex:commandButton value="{!$Label.ASI_HK_CRM_VF_COMMON_BTN_Edit}" styleClass="BSCommandButton" action="{!GoEditHeader}" rendered="{!PH.ASI_TH_CRM_Status__c == 'Draft'}"/>
                        <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Form_Preview}" styleClass="BSCommandButton" onClick="window.open('/apex/ASI_CRM_CN_OffPaymentRequestForm?id={!PH.id}&pdf=1');"/>

                        <!----
                            <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Submit_Approval}" styleClass="BSCommandButton"
                                                onclick="window.location.href='/apex/ASI_CRM_CN_HeavyPaymentCheckPage?id={!PH.Id}&Type=SubmitApproval'"
                                                oncomplete="return false;"
                                                rendered="{!PH.ASI_TH_CRM_Status__c == 'Draft'}"  />
                            ------>
                        <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Submit_Approval}" styleClass="BSCommandButton"
                                            action="{!GoToCheckPoint}" reRender="PaymentPageDIV" status="ActionStatus"
                                            oncomplete="return false;"
                                            rendered="{!PH.ASI_TH_CRM_Status__c == 'Draft'}"/>

                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_View} {!$Label.ASI_CRM_CN_Check_Point}"
                                            onclick="window.location.href='/apex/ASI_CRM_CN_HeavyPaymentCheckPage?id={!PH.Id}&Type=ViewCheckPoint'"
                                            oncomplete="return false;"
                                            rendered="{!PH.ASI_TH_CRM_Status__c != 'Draft'  }"/>


                        <apex:commandButton value="{!$Label.ASI_CRM_CN_Volume_Report}" styleClass="BSCommandButton"
                                            onclick="window.open('/apex/ASI_CRM_CN_HeavyContractVolumeReportPage?id={!PH.ASI_TH_CRM_Contract__c}')"/>

                        <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Payment_Instruction}" styleClass="BSCommandButton"
                                            rendered="{!PH.ASI_TH_CRM_Status__c=='Paid'}"
                                            onClick="window.open('/apex/ASI_CRM_CN_HeavyPaymentSlipPage?id={!PH.id}&PTSelected=Instruction');"/>
                        <apex:commandButton value="{!$Label.ASI_CRM_CN_VF_BTN_Payment_Receipt}" styleClass="BSCommandButton"
                                            onClick="window.open('/apex/ASI_CRM_CN_HeavyPaymentSlipPage?id={!PH.id}&PTSelected=Receipt');"
                                            rendered="{!PH.ASI_TH_CRM_Status__c=='Paid'}"/>
                        <apex:commandButton value="{!$Label.ASI_CRM_CN_Auto_PO_Modification}" styleClass="BSCommandButton"
                                            action="{!AutoPOModification}" status="ActionStatus" reRender="PaymentPageDIV"
                                            rendered="{!PH.ASI_TH_CRM_Status__c=='Paid' && PH.ASI_CRM_CN_Last_Payment__c && !PH.ASI_CRM_Auto_PO_Modification__c}"/>

                        <apex:commandButton value="{!$Label.ASI_CRM_CN_Contract_Return}"
                                            styleClass="BSCommandButton"
                                            action="{!GoReturn}" rendered="{!showReturn}" reRender="PaymentPageDIV"/>


                    </div>
                </div>

                <div class="alert alert-danger fade in" style="{!IF(UpsertPermission,'display:none;','')}" id="SaveFailPart">
                    <strong>Error!!</strong><br/>
                    <apex:outputText escape="false" value="{!Msg}"/>
                </div>


                <!-- Payment Header -->
                <div class="row">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            {!$Label.ASI_CRM_CN_VF_LABEL_Header_Info}
                        </div>
                        <div class="panel-body" style="padding: 0.5em">
                            <div class="bs table-responsive">
                                <table class="bs table table-condensed" style="margin-bottom: 0;">
                                    <tr>
                                        <td class="AlignRight" style="width: 20% ">
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.Name.Label}"/>
                                        </td>
                                        <td style="width: 25% ">
                                            <apex:outputField value="{!PH.name}"/>
                                        </td>
                                        <td class="AlignRight" style="width: 15% ">
                                            <apex:outputText value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Payment_Raised_Date__c.Label}"/>
                                        </td>
                                        <td style="width: 40% ">
                                            <apex:outputField value="{!PH.ASI_CRM_CN_Payment_Raised_Date__c}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="AlignRight" style="width: 20% ">
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_PO_No__c.Label}"/>
                                        </td>
                                        <td style="width: 25% ">
                                            <apex:outputLink value="ASI_CRM_CN_ViewContractOffPage?id={!PH.ASI_TH_CRM_Contract__c}">{!PH.ASI_CRM_CN_PO_No__c}</apex:outputLink>
                                        </td>
                                        <td class="AlignRight" style="width: 15% ">
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_PO_Start_Date__c.Label}"/>
                                        </td>
                                        <td style="width: 40% ">
                                            <apex:outputField value="{!PH.ASI_CRM_CN_PO_Start_Date__c}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="AlignRight" style="width: 20% ">
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_OutletWS__c.Label}"/>
                                        </td>
                                        <td style="width: 25% ">
                                            <apex:outputField value="{!PH.ASI_CRM_CN_OutletWS__c}" id="outlet_ws"/>
                                        </td>
                                        <td class="AlignRight" style="width: 15% ">
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_PO_End_Date__c.Label}"/>
                                        </td>
                                        <td style="width: 40% ">
                                            <apex:outputField value="{!PH.ASI_CRM_CN_PO_End_Date__c}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="AlignRight" style="width: 20% ">
                                            <apex:outputLabel value="PO Type"/>
                                        </td>
                                        <td style="width: 25% ">
                                            <apex:outputField value="{!PH.ASI_CRM_CN_Promotion_Type__c}"/>
                                        </td>
                                        <td class="AlignRight" style="width: 15% ">
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_TH_CRM_Status__c.Label}"/>
                                        </td>
                                        <td style="width: 40% ">
                                            <apex:outputField value="{!PH.ASI_TH_CRM_Status__c}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="AlignRight" style="width: 20% ">
                                            <apex:outputLabel value="{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Last_Payment__c.Label}"/>
                                        </td>
                                        <td style="width: 25% ">
                                            <apex:outputField value="{!PH.ASI_CRM_CN_Last_Payment__c}"/>
                                        </td>
                                        <td class="AlignRight" style="width: 15% ">{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Payment_Type__c.Label}</td>
                                        <td style="width: 40% ">
                                            <apex:outputField value="{!PH.ASI_CRM_CN_Payment_Type__c}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="AlignRight" style="width: 20% ">{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Last_Year_Payment__c.Label}</td>
                                        <td style="width: 25% " colspan="3">
                                            <apex:outputField value="{!PH.ASI_CRM_CN_Last_Year_Payment__c}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="AlignRight" style="width: 20% ">
                                            {!$Label.ASI_CRM_CN_Payment_Description}
                                        </td>
                                        <td style="width: 25% " colspan="3">
                                            <apex:outputField value="{!PH.ASI_CRM_CN_Description__c}"/>
                                        </td>
                                    </tr>

                                    <tr style=" {!IF(PH.ASI_TH_CRM_Contract__r.ASI_CRM_CN_Outlet_WS__r.RecordType.DeveloperName == 'ASI_CRM_CN_WS','','display:none;')}  ">
                                        <td class="AlignRight" style="width: 20% ">
                                            {!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_Volume_Option__c.Label}
                                        </td>
                                        <td style="width: 25% ">
                                            <apex:outputField value="{!PH.ASI_CRM_Volume_Option__c}" id="paymenttype"/>
                                        </td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-offset-4">
                        <apex:commandButton styleClass="BSCommandButton"
                                            rendered="{!PH.ASI_TH_CRM_Status__c == 'Draft'}"
                                            value="{!$Label.ASI_CRM_CN_VF_BTN_Payee_Detail}"
                                            action="{!GoEditDetailPage}"/>
                        <apex:commandButton styleClass="BSCommandButton"
                                            rendered="{!PH.ASI_TH_CRM_Status__c == 'Draft'}"
                                            value="{!$Label.ASI_CRM_CN_VF_BTN_Payee_Info}" action="{!GoEditPayee}"/>
                    </div>
                </div>

                <div class="row ">
                    <div class="PanelHeader">{!$Label.ASI_CRM_CN_Payment_Summary}</div>
                    <div class="PanelBody">
                        <apex:outputPanel id="PaymentSummaryPanel">
                            <table class="bs table table-condensed" style=" margin-bottom: 0;" id="PaymentSummaryDataTable">
                                <thead>
                                <tr>
                                    <th>{!$Label.ASI_CRM_CN_Payment_Summary}</th>
                                    <th>{!$Label.ASI_CRM_CN_PO_Estimated_Amount}</th>
                                    <th>{!$Label.ASI_CRM_CN_PO_Remaining_Amount}</th>
                                    <th>{!$Label.ASI_CRM_CN_Payment_Request_Amount}</th>
                                </tr>
                                </thead>
                                <apex:variable value="{!0}" var="POEstimatedAmountTotal"/>
                                <apex:variable value="{!0}" var="PORemainingAmountTotal"/>
                                <apex:variable value="{!0}" var="PaymentRequestAmountTotal"/>
                                <tbody>
                                <apex:repeat value="{!PaymentSummaryList}" var="PaymentSummary" id="PaymentSummaryListItem">
                                    <apex:variable var="POEstimatedAmountTotal" value="{!POEstimatedAmountTotal+PaymentSummary.POEstimatedAmount}"/>
                                    <apex:variable var="PORemainingAmountTotal" value="{!PORemainingAmountTotal+PaymentSummary.POEstimatedAmount - PaymentSummary.PaidAmount}"/>
                                    <apex:variable var="PaymentRequestAmountTotal" value="{!PaymentRequestAmountTotal+PaymentSummary.PaymentRequestAmount}"/>
                                    <tr>
                                        <td class="BorderBottom">
                                            {!PaymentSummary.Name}
                                        </td>
                                        <td class="BorderBottom">
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                <apex:param value="{!PaymentSummary.POEstimatedAmount}"/>
                                            </apex:outputText>
                                        </td>
                                        <td class="BorderBottom">
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                <apex:param value="{!PaymentSummary.POEstimatedAmount - PaymentSummary.PaidAmount}"/>
                                            </apex:outputText>
                                        </td>
                                        <td class="BorderBottom">
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                <apex:param value="{!PaymentSummary.PaymentRequestAmount}"/>
                                            </apex:outputText>
                                        </td>
                                    </tr>
                                </apex:repeat>
                                <tr class="FontWeightCSS" style="background-color: #e3e3d7;">
                                    <td> {!$Label.ASI_CRM_CN_Total_Amount}
                                    </td>
                                    <td>
                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                            <apex:param value="{!POEstimatedAmountTotal}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                            <apex:param value="{!PORemainingAmountTotal}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                            <apex:param value="{!PaymentRequestAmountTotal}"/>
                                        </apex:outputText>
                                    </td>

                                </tr>
                                </tbody>

                            </table>
                        </apex:outputPanel>
                    </div>

                </div>


                <!-------------------------------- PSF -------------------------------------------------------------->

                <apex:actionFunction name="ChangingPSFDate" action="{!GeneratePSFVol}" rerender="PSFPanel,EditHeavyPaymentDetailPageId" status="ActionStatus">
                    <apex:param name="PARAMID" value=""/>
                </apex:actionFunction>


                <div class="row">
                    <apex:outputPanel id="PSFPanel">
                        <div class="PanelHeader">{!$Label.ASI_CRM_CN_VF_LABEL_PSF}</div>
                        <div class="PanelBody">
                            <apex:variable value="{!0}" var="i"/>
                            <apex:repeat value="{!PSF_Item_Map}" var="itm" id="PSFitem">
                                <apex:variable var="i" value="{!i+1}"/>

                                <div class="panel panel-primary">
                                    <div class="panel-heading">{!$Label.ASI_CRM_CN_Module} {!i}</div>

                                    <div class="panel-body">

                                        <table class="bs table table-condensed module-table" style="margin-bottom: 0; width:80%">
                                            <tr>
                                                <td>{!$Label.ASI_CRM_CN_Start_Date}</td>
                                                <td>
                                                    <apex:outputField value="{!PH.ASI_CRM_CN_PO_Start_Date__c}"/>
                                                </td>
                                                <td>{!$Label.ASI_CRM_CN_End_Date}</td>
                                                <td>
                                                    <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_End_Date__c}"/>
                                                </td>
                                                <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_Minimal_Achievement__c.Label}</td>
                                                <td>
                                                    <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_Minimal_Achievement__c}"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Methodology__c.Label}</td>
                                                <td>
                                                    <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name}" rendered="{!!showCN}"/>
                                                    <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} " rendered="{!showCN}"/>
                                                </td>
                                                <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                                <td>
                                                    <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Volume_Base__c}"/>
                                                </td>
                                                <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_CTD_Minimal_Achievement__c.Label}</td>
                                                <td>
                                                    <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_CTD_Minimal_Achievement__c}"/>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td colspan="1">{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}</td>
                                                <td colspan="5">
                                                    <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="1">
                                                    {!$Label.ASI_CRM_CN_Contract_Terms_Ref}
                                                </td>
                                                <td colspan="5">
                                                    <apex:outputText escape="false" value="{!PSF_Item_Map[itm].Module.ASI_CRM_Parent_Module__r.ASI_CRM_Payment_Reference__c}"/>
                                                </td>
                                            </tr>
                                        </table>


                                        <apex:outputPanel >

                                            <apex:dataTable value="{!PSF_Item_Map[itm].DetailLineMap}" var="line" id="psfLineTable" styleClass="bs table table-condensed">
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'}">
                                                    <apex:facet name="header">{!$ObjectType.ASI_MFM_Sub_brand__c.Label}</apex:facet>
                                                    <apex:facet name="footer">{!$Label.ASI_CRM_CN_Total_Amount}</apex:facet>
                                                    <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}"/>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Category'}">
                                                    <apex:facet name="header">By Category</apex:facet>
                                                    <apex:facet name="footer">{!$Label.ASI_CRM_CN_Total_Amount}</apex:facet>
                                                    <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Product_Category__c}"/>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total'}">
                                                    <apex:facet name="header">Volume/Value Base</apex:facet>
                                                    <apex:outputText value="{!$Label.ASI_CRM_CN_By_Total}"/>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'}">
                                                    <apex:facet name="header">
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Incentive_Per_Bottle}"/>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}" styleClass="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Allow_Changing_Incentive__c && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Incentive_BT__c > 0, 'overpaidIncentive', '')}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Incentive_BT__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'}">
                                                    <apex:facet name="header">{!$Label.ASI_CRM_CN_CTD_Intake_Std_Btl}</apex:facet>
                                                    <apex:facet name="footer">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].TotalCTDIntakeStdBottle}"/>
                                                        </apex:outputText>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Actual_Vol__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Per Incentive Btl'}">
                                                    <apex:facet name="header">{!$Label.ASI_CRM_CN_CTD_Intake_Std_Btl}(CR 12 Extra eqv)</apex:facet>
                                                    <apex:facet name="footer">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].TotalCTDIntakeCR12}"/>
                                                        </apex:outputText>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Actual_Vol__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'}">
                                                    <apex:facet name="header">Contract Target(Std. Bottle)</apex:facet>
                                                    <apex:facet name="footer">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].TotalContractTargetStdBottle}"/>
                                                        </apex:outputText>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!BLANKVALUE(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Line_Item__r.ASI_CRM_Contract_Total_QTY_std_Btl__c, 0)}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Per Incentive Btl'}">
                                                    <apex:facet name="header">Contract Target(CR 12 Extra eqv)</apex:facet>
                                                    <apex:facet name="footer">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].TotalContractTargetCR12}"/>
                                                        </apex:outputText>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Line_Item__r.ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base'}">
                                                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Contract_Purchase_Value__c.Label}</apex:facet>
                                                    <apex:facet name="footer">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].TotalContractTargetValue}"/>
                                                        </apex:outputText>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!BLANKVALUE(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Line_Item__r.ASI_CRM_CN_Contract_Purchase_Value__c,0)}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base'}">
                                                    <apex:facet name="header">{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CTD_Actual_Purchase_Value__c.Label}</apex:facet>
                                                    <apex:facet name="footer">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].TotalCTDPurchaseValue}"/>
                                                        </apex:outputText>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CTD_Actual_Purchase_Value__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand'}">
                                                    <apex:facet name="header">Contract Total Amount</apex:facet>
                                                    <apex:facet name="footer">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].TotalContractTotalAmount}"/>
                                                        </apex:outputText>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_V0_0_Full_Contract_Target__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Rebate%'}">
                                                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Rebate_Percent__c.Label}</apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}%" styleClass="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Allow_Changing_Incentive__c && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Rebate_Percent__c > 0, 'overpaidIncentive', '')}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Rebate_Percent__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Reach X get Y'}">
                                                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Target__c.Label}</apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}" styleClass="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Allow_Changing_Incentive__c && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Target__c > 0, 'overpaidIncentive', '')}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Target__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Reach X get Y'}">
                                                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Rebate__c.Label}</apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}" styleClass="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Allow_Changing_Incentive__c && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Rebate__c > 0, 'overpaidIncentive', '')}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Rebate__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Rebate%' && (PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Ladder' || PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Tax')}">
                                                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Min_Purchase_Target__c.Label}</apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Line_Item__r.ASI_CRM_CN_Min_Purchase_Target__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Rebate%' && (PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Ladder' || PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Tax')}">
                                                    <apex:facet name="header">{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Max_Purchase_Target__c.Label}</apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Line_Item__r.ASI_CRM_CN_Max_Purchase_Target__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column >
                                                    <apex:facet name="header">{!$Label.ASI_CRM_CN_CTD_Payable_Amount}</apex:facet>
                                                    <apex:facet name="footer">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].TotalCTDPayableAmount}"/>
                                                        </apex:outputText>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Total_Payable__c}"/>
                                                    </apex:outputText>
                                                </apex:column>
                                                <apex:column >
                                                    <apex:facet name="header">Actual Achievement%</apex:facet>
                                                    <apex:facet name="footer">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}%">
                                                            <apex:param value="{!PSF_Item_Map[itm].TotalCompletionRatio}"/>
                                                        </apex:outputText>
                                                    </apex:facet>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}%">
                                                        <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Completion_Rate__c}"/>
                                                    </apex:outputText>
                                                </apex:column>

                                            </apex:dataTable>

                                            <div class="bs table-responsive" style="padding-top: 1em; padding-left: 2em; padding-bottom: 1em;">
                                                <table class="bs table table-condensed" style="margin-bottom: 0; width:70%;">
                                                    <tr>
                                                        <td style="border-left: 1px solid #ddd; " class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Historical_Paid_Amount__c.Label}
                                                        </td>
                                                        <td id="{!'PSFHistoricalPaidAmount_'+itm}">
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!PSF_Item_Map[itm].Module.ASI_CRM_Historical_Paid_Amount__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        <td style="border-left: 1px solid #ddd; " class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Application_Payment_Amount__c.Label}
                                                        </td>
                                                        <td style="border-right: 1px solid #ddd; " id="{!'PSFApplicationPaymentAmount_'+itm}">
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!PSF_Item_Map[itm].Module.ASI_CRM_Application_Payment_Amount__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Adjustment__c.Label}
                                                        </td>
                                                        <td>
                                                            <apex:outputText value="{0,number,#,###,##0.00}" styleClass="{!'PSFAdjustment_'+itm}">
                                                                <apex:param value="{!PSF_Item_Map[itm].Module.ASI_CRM_Adjustment__c}"/>
                                                            </apex:outputText>
                                                            %
                                                        </td>
                                                        <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Actual_Payment__c.Label}
                                                        </td>
                                                        <td style=" border-right: 1px solid #ddd; ">
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Actual_Payment__c}"/>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style=" border-left: 1px solid #ddd;  border-bottom: 1px solid #ddd;" class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Overpayment_Reason__c.Label}
                                                        </td>
                                                        <td style=" border-bottom: 1px solid #ddd;">
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_PSF_Overpayment_Reason__c}"/>
                                                        </td>
                                                        <td style=" border-left: 1px solid #ddd; border-bottom: 1px solid #ddd;" class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Other_Comments__c.Label}
                                                        </td>
                                                        <td style=" border-right: 1px solid #ddd; border-bottom: 1px solid #ddd;">
                                                            <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Other_Comments__c}"/>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </apex:outputPanel>
                                    </div>
                                </div>
                            </apex:repeat>
                        </div>


                    </apex:outputPanel>


                </div>

                <!-------------------------------- Display -------------------------------------------------------------->

                <apex:outputPanel rendered="{!DisplayVEC}">

                    <apex:actionFunction name="ChangingVECDate" action="{!GenerateVECVol}" rerender="VECPanel,EditHeavyPaymentDetailPageId" status="ActionStatus">
                        <apex:param name="PARAMID" value=""/>
                    </apex:actionFunction>


                    <div class="row" id="DisplayItemMapDivIdPart">

                        <div class="PanelHeader">Display</div>
                        <div class="PanelBody">
                            <apex:variable var="i" value="{!0}"/>
                            <apex:repeat value="{!DisplayItemMap}" var="itm" id="DisplayItem">
                                <apex:variable var="i" value="{!i+1}"/>
                                <apex:variable var="interimData" value="{!DisplayItemMap[itm]}"/>

                                <div class="panel panel-primary">
                                    <div class="panel-heading">{!$Label.ASI_CRM_CN_Module} {!i}</div>
                                    <div class="panel-body">
                                        <table class="bs table table-condensed module-table" style="margin-bottom: 0; width:80%">
                                            <tr>
                                                <td>{!$Label.ASI_CRM_CN_Start_Date}</td>
                                                <td>
                                                    <apex:outputField value="{!PH.ASI_CRM_CN_PO_Start_Date__c}"/>
                                                </td>
                                                <td>{!$Label.ASI_CRM_CN_End_Date}</td>
                                                <td>
                                                    <apex:outputField value="{!interimData.Module.ASI_CRM_End_Date__c}"/>
                                                </td>
                                                <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_Minimal_Achievement__c.Label}</td>
                                                <td>
                                                    <apex:outputField value="{!interimData.Module.ASI_CRM_CN_Minimal_Achievement__c}"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Methodology__c.Label}</td>
                                                <td>
                                                    <apex:outputField value="{!interimData.Module.ASI_CRM_Methodology__r.Name}" rendered="{!!showCN}"/>
                                                    <apex:outputField value="{!interimData.Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} " rendered="{!showCN}"/>
                                                </td>
                                                <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                                <td>
                                                    <apex:outputField value="{!interimData.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Volume_Base__c}"/>
                                                </td>
                                                <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_CTD_Minimal_Achievement__c.Label}</td>
                                                <td>
                                                    <apex:outputField value="{!interimData.Module.ASI_CRM_CN_CTD_Minimal_Achievement__c}"/>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}</td>
                                                <td colspan="3">
                                                    <apex:outputField value="{!interimData.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Unit__c}"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="1">
                                                    {!$Label.ASI_CRM_CN_Contract_Terms_Ref}
                                                </td>
                                                <td colspan="5">
                                                    <apex:outputText escape="false" value="{!interimData.Module.ASI_CRM_Parent_Module__r.ASI_CRM_Payment_Reference__c}"/>
                                                </td>
                                            </tr>
                                        </table>
                                        <apex:outputPanel id="VECPanel">

                                            <table class="bs table table-condensed" id="VECDataTable">
                                                <thead>
                                                <tr>
                                                    <th>Volume/Value Base</th>
                                                    <th>
                                                        <apex:outputText escape="false" value="Contract Total Amount"/>
                                                    </th>
                                                    <th>
                                                        <apex:outputText escape="false" value="Volume Target"/>
                                                    </th>
                                                    <th>
                                                        <apex:outputText escape="false" value="CTD Actual Vol"/>
                                                    </th>
                                                    <th>
                                                        <apex:outputText escape="false" value="Actual Achievement%"/>
                                                    </th>
                                                    <th>
                                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_CTD_Payable_Amount}"/>
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody>

                                                <apex:repeat value="{!interimData.DetailLineMap}" var="itm" id="VECitem">
                                                    <apex:variable var="line" value="{!interimData.DetailLineMap[itm]}"/>
                                                    <tr>
                                                        <td>
                                                            {!$Label.ASI_CRM_CN_By_Total}
                                                        </td>
                                                        <td>
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!line.ASI_CRM_CN_Contract_BRSF_Line_Item__r.ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        <td>
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!line.ASI_CRM_CN_Contract_BRSF_Line_Item__r.ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        <td>
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!line.ASI_CRM_CTD_Actual_Vol__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        <td>
                                                            <apex:outputText value="{0,number,0.0}%">
                                                                <apex:param value="{!line.ASI_CRM_CN_Completion_Rate__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        <td>
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!line.ASI_CRM_CN_Completion_Rate__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                    </tr>
                                                </apex:repeat>

                                                </tbody>

                                            </table>


                                            <div class="bs table-responsive" style="padding-top: 1em; padding-left: 2em; padding-bottom: 1em;">
                                                <table class="bs table table-condensed" style="margin-bottom: 0; width:60%;">
                                                    <tr>
                                                        <td style="border-left: 1px solid #ddd; " class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Historical_Paid_Amount__c.Label}
                                                        </td>
                                                        <td id="VECHistoricalPaidAmountId">
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!interimData.Module.ASI_CRM_Historical_Paid_Amount__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                        <td style="border-left: 1px solid #ddd; " class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Application_Payment_Amount__c.Label}
                                                        </td>
                                                        <td style="border-right: 1px solid #ddd; " id="VECApplicationPaymentAmountId">
                                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                                <apex:param value="{!interimData.Module.ASI_CRM_Application_Payment_Amount__c}"/>
                                                            </apex:outputText>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel">{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Adjustment__c.Label}</td>
                                                        <td>
                                                            <apex:outputText value="{0,number,#,###,##0.00}" styleClass="VECAdjustmentclass">
                                                                <apex:param value="{!interimData.Module.ASI_CRM_Adjustment__c}"/>
                                                            </apex:outputText>
                                                            %

                                                        </td>
                                                        <td style=" border-left: 1px solid #ddd; " class="MethodologyLabel">{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Actual_Payment__c.Label}</td>
                                                        <td style=" border-right: 1px solid #ddd; " id="VECActualPaymentId">
                                                            <apex:outputText value="{!interimData.Module.ASI_CRM_Actual_Payment__c}"/>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style=" border-left: 1px solid #ddd;  border-bottom: 1px solid #ddd;" class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Overpayment_Reason__c.Label}
                                                        </td>
                                                        <td style=" border-bottom: 1px solid #ddd;">
                                                            <apex:outputField value="{!interimData.Module.ASI_CRM_VEC_Overpayment_Reason__c}"/>
                                                        </td>
                                                        <td style=" border-left: 1px solid #ddd; border-bottom: 1px solid #ddd;" class="MethodologyLabel">
                                                            {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Other_Comments__c.Label}
                                                        </td>
                                                        <td style=" border-right: 1px solid #ddd; border-bottom: 1px solid #ddd;">
                                                            <apex:outputField value="{!interimData.Module.ASI_CRM_Other_Comments__c}"/>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </apex:outputPanel>

                                    </div>
                                </div>
                            </apex:repeat>
                        </div>

                    </div>

                </apex:outputPanel>

                <!-------------------------------- Other Payment Detail -------------------------------------------------------------->

                <div class="row " style="padding-top: 1em;">

                    <div class="PanelHeader">Other Cost</div>

                    <div class="PanelBody">

                        <apex:outputPanel id="OtherPaymentDetailPanel">
                            <table class="bs table table-condensed" style="margin-bottom: 0;" id="OtherPaymentDetailDataTable">
                                <thead>
                                <tr>
                                    <th>{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Expense_Type__c.Label}</th>
                                    <th>{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Contract_Amount__c.Label}</th>
                                    <th>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Historical_Paid_Amount__c.Label}</th>
                                    <th>{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_TH_CRM_Amount__c.Label}</th>
                                    <th>{!$ObjectType.ASI_TH_CRM_PaymentRequestLineItem__c.Fields.ASI_CRM_CN_Comment__c.Label}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <apex:repeat value="{!OtherPaymentLineList}" var="OtherPaymentLine" id="OtherPaymentLineTable">
                                    <tr>

                                        <td>
                                            <apex:outputField value="{!OtherPaymentLine.ASI_CRM_CN_Expense_Type__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                <apex:param value="{!OtherPaymentLine.ASI_CRM_CN_Contract_Cost__r.ASI_CRM_CN_Contract_Amount__c}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                <apex:param value="{!0}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{!OtherPaymentLine.ASI_TH_CRM_Amount__c}" styleClass="ApexInputNumberField"/>
                                        </td>
                                        <td>
                                            <apex:outputText value="{!OtherPaymentLine.ASI_CRM_CN_Comment__c}" styleClass="ApexInputNumberField"/>
                                        </td>
                                    </tr>
                                </apex:repeat>
                                </tbody>

                            </table>
                        </apex:outputPanel>

                    </div>

                </div>


                <!-- Cash -->
                <div class="row  " style="{!IF(cashtype,'padding-top: 1em;','display:none;')}  ">

                    <div class="PanelHeader">{!$Label.ASI_CRM_CN_VF_LABEL_Cash}</div>
                    <div class="PanelBody">

                        <apex:outputPanel id="PayeeCashDetailPanel">
                            <table class="bs table table-condensed" style="margin-bottom: 0;" id="PayeeCashDetailDataTable">
                                <thead>
                                <tr>

                                    <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Cash_Payee_Name_T1__c.Label}</th>
                                    <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Amount__c.Label}</th>
                                    <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Reason__c.Label}</th>
                                    <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Comfirm_Receipt__c.Label}</th>
                                </tr>
                                </thead>
                                <tbody>

                                <apex:repeat value="{!Payee_Item_Map_CASH}" var="itm" id="PayeeCashDetailLineTable">
                                    <tr>
                                        <td>
                                            <apex:outputField value="{!Payee_Item_Map_CASH[itm].ASI_CRM_CN_Cash_Payee_Name_T1__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!Payee_Item_Map_CASH[itm].ASI_CRM_CN_Amount__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!Payee_Item_Map_CASH[itm].ASI_CRM_CN_Reason__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputField value="{!Payee_Item_Map_CASH[itm].ASI_CRM_CN_Comfirm_Receipt__c}"/>
                                        </td>
                                    </tr>
                                </apex:repeat>
                                </tbody>

                            </table>
                        </apex:outputPanel>
                    </div>

                </div>


                <div class="row  " style="{!IF(discounttype,'padding-top: 1em;','display:none;')}  ">
                    <div class="col">
                        <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;">
                            <div class="HeaderCss" style="grid-column-start: 1; grid-column-end: 1;">{!$Label.ASI_CRM_CN_VF_LABEL_Discount}</div>
                            <div style="grid-column-start: 2; grid-column-end: 2;  "></div>
                        </div>
                        <div class="PanelBody">

                            <apex:outputPanel id="PayeeDiscountDetailPanel">
                                <table class="bs table table-condensed" style="margin-bottom: 0;" id="PayeeDiscountDetailDataTable">
                                    <thead>
                                    <tr>

                                        <th>{!$Label.ASI_CRM_CN_VF_LABEL_T2_WS}</th>
                                        <th>{!$Label.ASI_CRM_CN_VF_LABEL_T1_WS}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Discount_Amount__c.Label}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Reason__c.Label}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Instruction_Sent_Time__c.Label}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Comfirm_Receipt__c.Label}</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    <apex:repeat value="{!Payee_Item_Map_DISCOUNT}" var="itm" id="PayeeDiscountDetailLineTable">
                                        <tr>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Payee_T2__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Payee_T1__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Amount__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Reason__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Instruction_Sent_Time__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_DISCOUNT[itm].ASI_CRM_CN_Comfirm_Receipt__c}"/>
                                            </td>

                                        </tr>
                                    </apex:repeat>
                                    </tbody>

                                </table>
                            </apex:outputPanel>
                        </div>
                    </div>
                </div>


                <div class="row  " style="{!IF(discounttype,'padding-top: 1em;','display:none;')}  ">
                    <div class="col">
                        <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;">
                            <div class="HeaderCss" style="grid-column-start: 1; grid-column-end: 1;">{!$Label.ASI_CRM_CN_VF_LABEL_Others}</div>
                            <div style="grid-column-start: 2; grid-column-end: 2;  "></div>
                        </div>
                        <div class="PanelBody">

                            <apex:outputPanel id="PayeeOtherWSDetailPanel">
                                <table class="bs table table-condensed" style="margin-bottom: 0;" id="PayeeOtherWSDetailDataTable">
                                    <thead>
                                    <tr>

                                        <th>{!$Label.ASI_CRM_CN_VF_LABEL_T2_WS}</th>
                                        <th>{!$Label.ASI_CRM_CN_VF_LABEL_T1_WS}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Discount_Amount__c.Label}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Reason__c.Label}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Instruction_Sent_Time__c.Label}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_PH_Payee_Line_Item__c.Fields.ASI_CRM_CN_Comfirm_Receipt__c.Label}</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    <apex:repeat value="{!Payee_Item_Map_CD}" var="itm" id="PayeeOtherWSDetailLineTable">
                                        <tr>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Payee_T2__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Payee_T1__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Amount__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Reason__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Instruction_Sent_Time__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!Payee_Item_Map_CD[itm].ASI_CRM_CN_Comfirm_Receipt__c}"/>
                                            </td>
                                        </tr>
                                    </apex:repeat>
                                    </tbody>

                                </table>
                            </apex:outputPanel>
                        </div>
                    </div>
                </div>


                <apex:actionstatus id="ActionStatus">
                    <apex:facet name="start">
                        <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                                                                             height: 100%; width:100%; opacity:0.65;">
                            <div class="waitingHolder" id="loadtext" style="position: absolute;" align="left" valign="top">
                                &nbsp;&nbsp;&nbsp;
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..."/>
                                <span class="waitingDescription">Please Wait...</span>
                            </div>
                        </div>
                    </apex:facet>
                </apex:actionstatus>


            </div>

        </div>
    </apex:form>

    <apex:relatedList id="Attachments" subject="{!pageid}" list="CombinedAttachments"/>
    <apex:relatedList id="Approval" subject="{!pageid}" list="ProcessSteps"/>

    <apex:relatedList id="ApprovalComment" subject="{!pageid}" list="Payment_Request_Approval_Comments__r"/>
</apex:page>