<!--
 - Created by Jeffrey Cheung on 9/8/2018.
 -->

<apex:page id="ASI_CRM_CN_ViewContractOffPage" standardController="ASI_TH_CRM_Contract__c" extensions="ASI_CRM_CN_ViewContractOffCtrl" action="{!Calculation}" sidebar="false">
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <apex:stylesheet value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.ASI_Library, 'dist/css/bootstrap.min.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery1.10.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_CRM_CN_Jquery, 'jquery-ui1.10.4.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.ASI_Library, 'dist/js/bootstrap.min.js')}" />

    <style type="text/css">
        .AlignRight{
            text-align: right  !important;
            font-weight: bold !important;
        }

        .BSCommandButton{
            color: #333 !important;
            background-color: #fff !important;
            border-color: #ccc !important;
            margin-left: 0.5em !important;
            margin-right: 0.5em !important;
            margin-bottom: 0.5em !important;
            padding: 3px 6px !important;
        }


        .HeaderCss{
            color: #fff;
            border-top-left-radius: 3px;
            border-top-right-radius: 3px;
            background-color: #337ab7;
            border: 1px solid transparent;
            border-color: #337ab7;
            padding: 5px 7.5px;
            text-align: center;
        }

        .module-header-table{
            width: 100%;
        }

        .module-header-table td {
            width: 15%;
            padding: 0.1rem;
            border: 1px solid #ddd;
        }

        .module-header-table tr td:nth-child(odd) {
            text-align: right  !important;
            font-weight: bold !important;
        }

        .table-summary-row{
            font-weight: bold;
            background-color: #e3e3d7;
        }
        .PanelBody{
            padding: 0.3em;
            background-color: #fff;
            border: 1px solid transparent;
            border-color: #337ab7;
            border-bottom-left-radius: 3px;
            border-bottom-right-radius: 3px;
            border-top-right-radius: 3px;
        }

        .PSFAdjLabel{
            font-weight: bold;
            text-align: right;
            padding-top: 0.8em;

        }
        .overPaid {
            color: red !important;
        }

    </style>


    <script type='text/javascript'>
        $(document).ready(function() {
            document.getElementsByClassName("bPageFooter")[0].style="display: none";
        });
        function addLoadEvent(func) {
            var oldonload = window.onload;
            if (typeof window.onload != 'function') {
                window.onload = func;   }
            else {  window.onload = function() {
                if (oldonload) {    oldonload();    }
                func(); }
            }
        }


        function checkPage() {
            if (document.getElementsByName("piSubmit")[0] != null)
                document.getElementsByName("piSubmit")[0].style.display = 'none';
            if (document.getElementsByName("piSubmit")[0] != null)
                document.getElementsByName("piSubmit")[0].style.display = 'none';
            if (document.getElementsByName("piRemove")[0] != null) {
                var orgFunc = document.getElementsByName("piRemove")[0].onclick;
                document.getElementsByName("piRemove")[0].onclick = function(){ recallApprovalRequest(orgFunc);};
            }
            var anchors = document.getElementsByTagName("a");
            var reassignBackToRelatedList = "apex%2FASI_MFM_CN_Approval_Related_List%3Finline%3D1%26id%3D"; // the pattern of URL returning to related list iframe
            for (var i = 0; i < anchors.length; i++) {
                if (anchors[i].href.indexOf(reassignBackToRelatedList) > 0) {
                    anchors[i].href = anchors[i].href.replace(reassignBackToRelatedList,""); // remove the url portion of returning to related list iframe
                }
                if (anchors[i].href.indexOf("salesforce.com") > 0) {
                    anchors[i].setAttribute('target', '_top'); // open the link in parent window when user press any links containing "salesforce.com" in URL
                }
            }


        }

        function recallApprovalRequest(func) {
            var recallApprovalRequestBackToRelatedList = "apex%2FASI_MFM_CN_Approval_Related_List%3Finline%3D1%26id%3D";  // the pattern of URL returning to related list iframe
            var funcStr = func.toString();
            var urlIndexStart = funcStr.indexOf("https");
            var funcStr2 = funcStr.substring(urlIndexStart,funcStr.length);
            var urlIndexEnd = funcStr2.indexOf(",")-1;
            var urlStr = funcStr2.substring(0,urlIndexEnd); // extract the url of cancel button from the original onClick function
            urlStr = urlStr.replace(recallApprovalRequestBackToRelatedList,""); // remove the url portion of returning to related list iframe
            var newWin = window.open(urlStr, "_top");  // open the window "Recall Approval Request" in parent window when the user press the button "Recall Approval Request"
        }

        addLoadEvent(function() {    checkPage();    });

    </script>

    <chatter:feedWithFollowers entityid="{!ASI_TH_CRM_Contract__c.id}" />

    <apex:form >


        <div class="bs">

            <div class="container-fluid" >

                <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto;" >
                    <div style="grid-column-start: 1; grid-column-end: 1;" >
                        <div style="font-weight: bold; font-family: Arial,Helvetica,sans-serif; color: #000; font-size: 1.3em; margin: 0.5em;">
                            {!$ObjectType.ASI_TH_CRM_Contract__c.Label}
                        </div>
                    </div>

                    <div style="grid-column-start: 2; grid-column-end: 2;  margin-top: 0.5em;" >
                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_HK_CRM_VF_COMMON_BTN_Edit}" action="{!GoEditHeaderPage}"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c == 'Draft'}"/>
                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Contract_Shuttle}" onclick="window.open('/apex/ASI_CRM_CN_OffPDFRedirectPage?id={!ASI_TH_CRM_Contract__c.id}&Type=PDF')"
                                            rendered="{!ContractSelected.ASI_CRM_CN_PO_Version__c='0.0' && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive' && !isGroupPo}"/>
                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Modification} (PDF) " onclick="window.open('/apex/ASI_CRM_CN_OffPDFRedirectPage?id={!ASI_TH_CRM_Contract__c.id}&Type=POModificationPDF')"
                                            rendered="{!ContractSelected.ASI_CRM_CN_PO_Version__c != '0.0' && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'  && !isGroupPo}"/>

                        <apex:commandButton styleClass="BSCommandButton"
                                            value="Consolidated Shuttle"
                                            onclick="window.open('/apex/ASI_CRM_CN_OffPDFRedirectPage?id={!ASI_TH_CRM_Contract__c.id}&Type=GroupConsolidateShuttle')"
                                            rendered="{!isGroupPo}"
                                            />
                        <apex:commandButton styleClass="BSCommandButton"
                                            value="{!$Label.ASI_CRM_CN_IOM_Submit_for_Approval}"
                                            action="{!submitForApproval}"
                                            rendered="{!isGroupPo && ContractSelected.ASI_CRM_CN_Status__c == 'Draft'}"
                                            />

                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Modification}" action="{!POModification}"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c == 'Final' && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive' && !isGroupPo && !ContractSelected.ASI_CRM_Auto_PO_Modification__c && !ContractSelected.ASI_CRM_CN_Is_Block__c}"/>
                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Make_Payment}" action="{!GoPayment }"
                                            rendered="{!makePayment && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive' && !isGroupPo && !ContractSelected.ASI_CRM_CN_Is_Block__c}"/>

                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Contract_Preview}" action="{!GoToContractGenerationPage}"
                                            rendered="{! ContractSelected.ASI_CRM_CN_Status__c == 'Draft' && ContractSelected.ASI_CRM_CN_PO_Version__c == '0.0' && ContractSelected.ASI_CRM_CN_Use_PRC_Contract_Template__c && !isGroupPo}"/>

                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Contract_Preview}"
                                            rendered="{! ContractSelected.ASI_CRM_CN_Status__c != 'Draft' && ContractSelected.ASI_CRM_CN_Status__c != 'Archived' && ContractSelected.ASI_CRM_CN_Status__c != 'FY landing Archive' && ContractSelected.ASI_CRM_CN_Status__c != 'Final' && ContractSelected.ASI_CRM_CN_PO_Version__c == '0.0' && ContractSelected.ASI_CRM_CN_Group_Contract__c ==null  && ContractSelected.ASI_CRM_CN_Use_PRC_Contract_Template__c }"
                                            onclick="window.open('/apex/ASI_CRM_CN_OffContractGenerationPage?edit=1&ViewType=Read&id={!ASI_TH_CRM_Contract__c.id}')"/>

                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Restore_Previous_Version}" action="{!restorePO}"
                                            rendered="{!if(showRestorePO,true,false) && LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive'}"/>

                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_VF_BTN_Submit_Approval}" action="{!GoCheckPointPage}"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c == 'Draft' && !isGroupPo}"/>

                        <apex:commandButton styleClass="BSCommandButton"
                                            value="{!$Label.ASI_CRM_CN_CTD_Sales_Report}"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c != 'FY landing Archive' && !isGroupPo}"
                                            onclick="window.open('/apex/ASI_CRM_CN_OffContractVolumeReportPage?id={!ASI_TH_CRM_Contract__c.id}')"/>

                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_View} {!$Label.ASI_CRM_CN_Check_Point}" action="{!ViewCheckPointPage}"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c != 'Draft' &&  LOWER(ASI_TH_CRM_Contract__c.ASI_CRM_CN_Status__c) != 'fy landing archive' && !isGroupPo}"/>


                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Upload_Completion}" action="{!UploadCompletion}"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c == 'Approved' &&  !contractSelected.ASI_CRM_CN_Contract_Upload__c}"/>

                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Uncheck_Contract_Upload}" action="{!UncheckContractUploading}"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c == 'Approved' && contractSelected.ASI_CRM_CN_Contract_Upload__c && inBAPermissionSet}"/>


                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Set_to_Final}" action="{!SetToFinal}"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c == 'Approved' && IsRBAUser}"/>

                        <apex:commandButton styleClass="BSCommandButton" value="{!$Label.ASI_CRM_CN_Contract_Return}" action="{!GoReturn}"
                                            rendered="{!showReturn}"/>

                        <apex:commandButton styleClass="BSCommandButton" value="Set To Draft" action="{!SetToDraft}"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c == 'Approved' && ContractSelected.ASI_CRM_CN_Group_Contract__c !=null && ContractSelected.ASI_CRM_CN_Local_Group_Contract__c  }"/>

                    </div>
                </div>

                <div class="alert alert-danger fade in" style="{!IF(UpsertPermission,'display:none;','')}"  id="SaveFailPart">
                    <strong>Error!!</strong><br/>
                    <apex:outputText escape="false" value="{!Msg}"/>
                </div>

                <!--　Header Information　-->
                <div class="row">
                    <apex:outputPanel rendered="{!!isGroupPo}">
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                {!$Label.ASI_CRM_CN_VF_LABEL_Header_Info}
                            </div>
                            <div class="panel-body" style="padding: 0.5em">

                                <div class="bs table-responsive">
                                    <table class="bs table table-condensed" style="margin-bottom: 0;">
                                        <tr>
                                            <td class="AlignRight" style="width: 20% ">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.Name.Label}"/>
                                            </td>
                                            <td style="width: 25% ">
                                                <apex:outputField value="{!ContractSelected.Name}"/>
                                            </td>
                                            <td class="AlignRight" style="width: 15% ">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_PO_Start_Date__c.Label}"/>
                                            </td>
                                            <td style="width: 40% ">
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_Start_Date__c}"/>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_PO_No__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_No__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_PO_End_Date__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_End_Date__c}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_PO_Version__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_PO_Version__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Group_Contract__c.Label}" rendered="{!!IsDolphinContract}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Group_Contract__c}" rendered="{!!IsDolphinContract}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$Label.ASI_CRM_CN_Outlet_WS}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Outlet_WS__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_PO_Channel__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_PO_Channel__c}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_TH_CRM_Promotion_Type__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_TH_CRM_Promotion_Type__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_PO_Province__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_PO_Province__c}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Source_of_Contract__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Source_of_Contract__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_PO_City__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Outlet_WS__r.ASI_CRM_CN_CCity__c}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Vol_Budget_LE__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Vol_Budget_LE__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Status__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Status__c}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Budget_LE__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Budget_LE__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Contract_Upload__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Contract_Upload__c}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Reason_without_Budget__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Reason_without_Budget__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Use_PRC_Contract_Template__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Use_PRC_Contract_Template__c}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Is_Dolphin__c.Label}" />
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Is_Dolphin__c}" />
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText rendered="{!IsDolphinContract}" value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Activity_Times__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField rendered="{!IsDolphinContract}" value="{!ContractSelected.ASI_CRM_CN_Activity_Times__c}" />
                                            </td>
                                        </tr>
                                        <tr style="{!IF(IsDolphinContract,'','display:none')}">
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Target_Base__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Target_Base__c}" />
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Contract_Classification__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Contract_Classification__c}" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Description__c.Label}"/>

                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_CN_Description__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                            </td>
                                            <td>
                                            </td>
                                        </tr>
                                        <tr style="{!IF(ContractSelected.ASI_CRM_Auto_PO_Modification__c,'','display:none')}">
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Auto_PO_Modification__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_Auto_PO_Modification__c}"/>
                                            </td>
                                            <td class="AlignRight">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Auto_PO_Modification_Time__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputField value="{!ContractSelected.ASI_CRM_Auto_PO_Modification_Time__c}"/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!isGroupPo}">
                        <c:ASI_CRM_CN_OffGroupPOHeaderCmp isEditMode="false" contract="{!ContractSelected}"/>
                    </apex:outputPanel>

                </div>


                <div class="row">
                    <div class="col-md-offset-4">
                        <apex:commandButton styleClass="BSCommandButton"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c == 'Draft'}"
                                            value="{!$Label.ASI_CRM_CN_Edit_Contract_Details}"
                                            action="{!GoEditDetailPage}"   />
                        <apex:commandButton styleClass="BSCommandButton"
                                            rendered="{!ContractSelected.ASI_CRM_CN_Status__c == 'Draft'}"
                                            value="{!$Label.ASI_CRM_CN_Upload_Covered_Outlet}"
                                            action="{!GoUploadPage}"   />
                    </div>
                </div>

                <!-- Volume/Value Target-->
                <apex:variable value="{!0}" var="ContractTotal"/>
                <apex:variable value="{!0}" var="EstTotal"/>

                <div class="row">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            {!$Label.ASI_CRM_CN_Volume_Value_Target}
                        </div>
                        <div class="panel-body" style="padding: 0.5em" >
                            <table class="bs table table-condensed module-header-table">
                                <tr>
                                    <td>
                                        {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_Contract_Volume_Base__c.Label}
                                    </td>
                                    <td>
                                        <apex:outputField value="{!BRSFItemMap.Module.ASI_CRM_CN_Contract_Volume_Base__c}"/>
                                    </td>
                                    <td>
                                        {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_Volume_Value_Base__c.Label}
                                    </td>
                                    <td>
                                        <apex:outputField value="{!BRSFItemMap.Module.ASI_CRM_CN_Volume_Value_Base__c}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_Total_Markup__c.Label}
                                    </td>
                                    <td>
                                        <apex:outputText value="{0, number, 0}%" styleClass="{!IF(BRSFItemMap.Module.ASI_CRM_CN_Total_Markup__c > maxMargin, 'overPaid', '')}">
                                            <apex:param value="{!BRSFItemMap.Module.ASI_CRM_CN_Total_Markup__c}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}
                                    </td>
                                    <td>
                                        {!BRSFItemMap.Module.ASI_CRM_Remark_Display__c}
                                    </td>
                                </tr>
                            </table>



                            <div class="bs table-responsive" >
                                <table class="bs table table-condensed" style="margin-bottom: 0;padding-top: 0.5em;" >
                                    <thead>
                                    <tr>
                                        <th>{!$ObjectType.ASI_MFM_Sub_brand__c.Label}</th>
                                        <th>{!$Label.ASI_CRM_CN_Grade}</th>
                                        <th style="{!IF(isPOModi,'display:none','')}">
                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                        </th>
                                        <th style="{!IF(isPOModi,'display:none','')}">
                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                        </th>
                                        <!-- <th>{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_Contract_Total_QTY_std_Btl__c.Label}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_Est_Total_QTY_std_Btl__c.Label}</th> -->
                                        <th>
                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                        </th>
                                        <th>
                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                        </th>
                                        <th>{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Contract_Purchase_Value__c.Label}</th>
                                        <th>{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Estimate_Purchase_Value__c.Label}</th>
                                        <th style="{!IF(IsDolphinContract,'','display: none;')}">
                                            <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Key_Strategy_Sub_Brand}"/>
                                        </th>
                                    </tr>
                                    </thead>

                                    <apex:variable value="{!0}" var="EstMonthlyQty"/>
                                    <apex:variable value="{!0}" var="ContractMonthlyQty"/>
                                    <apex:variable value="{!0}" var="ContractTotalQty"/>
                                    <apex:variable value="{!0}" var="EstTotalQty"/>

                                    <tbody>

                                    <apex:repeat value="{!BRSFItemMap.DetailLineMap}" var="Line" >
                                        <apex:variable var="EstMonthlyQty" value="{!EstMonthlyQty+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                        <apex:variable var="ContractMonthlyQty" value="{!ContractMonthlyQty+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>
                                        <apex:variable var="ContractTotalQty" value="{!ContractTotalQty+BRSFItemMap.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>
                                        <apex:variable var="EstTotalQty" value="{!EstTotalQty+BRSFItemMap.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>
                                        <apex:variable var="EstTotal" value="{!EstTotal+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                        <apex:variable var="ContractTotal" value="{!ContractTotal+BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>

                                        <tr>
                                            <td>
                                                <apex:outputField value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Sub_Brand__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputLink value="/{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__c}">
                                                    {!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Sub_Brand_Grade__r.ASI_CRM_Chinese_Name__c}
                                                </apex:outputLink>
                                            </td>
                                            <td style="{!IF(isPOModi,'display:none','')}">
                                                <apex:outputField value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>
                                            </td>
                                            <td style="{!IF(isPOModi,'display:none','')}">
                                                <apex:outputField value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/></apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/></apex:outputText>
                                            </td>
                                            <td >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/></apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/></apex:outputText>
                                            </td>
                                            <td style="{!IF(IsDolphinContract,'','display: none;')}">
                                                <apex:outputField value="{!BRSFItemMap.DetailLineMap[Line].ASI_CRM_Key_Sub_brand__c}"/>
                                            </td>
                                        </tr>
                                    </apex:repeat>
                                    </tbody>
                                    <tr class="table-summary-row">
                                        <td>{!$Label.ASI_CRM_CN_TOTMOT_Total_Amount}</td>
                                        <td></td>
                                        <td style="{!IF(isPOModi,'display:none','')}">
                                            <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!ContractMonthlyQty}"/></apex:outputText>
                                        </td>
                                        <td style="{!IF(isPOModi,'display:none','')}">
                                            <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!EstMonthlyQty}"/></apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!ContractTotalQty}"/></apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0}"><apex:param value="{!EstTotalQty}"/></apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractTotal}"/></apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!EstTotal}"/></apex:outputText>
                                        </td>
                                        <td style="{!IF(IsDolphinContract,'','display: none;')}"></td>

                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>


                </div>




                <!-- PSF -->
                <apex:outputPanel rendered="{!!isGroupPo}" layout="block" styleClass="row">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            {!$Label.ASI_CRM_CN_PSF}
                        </div>
                        <div class="panel-body" style="padding: 0.5em" >


                            <apex:outputPanel rendered="{!PSFNoModules}">
                                <div style=" font-weight: bold;">
                                    {!$Label.ASI_CRM_CN_No_Modules_Display}
                                </div>
                            </apex:outputPanel>

                            <apex:variable value="{!0}" var="i"/>
                            <apex:repeat value="{!PSF_Item_Map}"  var="itm" id="PSFitem" >
                                <apex:variable var="i" value="{!i+1}"/>
                                <div style="display: grid; grid-template-columns: 10% 90% ; grid-template-rows: auto; padding-top:0.5em;"   >
                                    <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;"  >{!$Label.ASI_CRM_CN_Module}-{!i}</div>
                                </div>
                                <div class="PanelBody" >
                                    <table class="bs table table-condensed module-header-table">
                                        <tr>
                                            <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Methodology__c.Label}</td>
                                            <td>
                                                <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name}" rendered="{!!showCN}"/>
                                                <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} " rendered="{!showCN}"/>
                                            </td>
                                            <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                            <td>
                                                <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c}"/>
                                            </td>
                                            <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}</td>
                                            <td>{!PSF_Item_Map[itm].Module.ASI_CRM_Remark__c}</td>
                                        </tr>
                                        <tr>
                                            <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}</td>
                                            <td>
                                                <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_Unit__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputText value="{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_Minimal_Achievement__c.Label}" rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Reach X get Y' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others'}"/>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, 0}%" rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Reach X get Y' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others'}">
                                                    <apex:param value="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_Minimal_Achievement__c}"/>
                                                </apex:outputText>
                                            </td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Ladder', '', 'display:none;')}">
                                            <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_Is_Capped__c.Label}</td>
                                            <td>
                                                <apex:outputField value="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_Is_Capped__c}"/>
                                            </td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </table>

                                    <apex:outputPanel rendered="{!PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Tax' || PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Ladder'}">
                                        <table class="module-header-table">
                                            <tr>
                                                <td>{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Contract_Purchase_Value__c.Label}</td>
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!ContractTotal}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td>{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Estimate_Purchase_Value__c.Label}</td>
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!EstTotal}"/>
                                                    </apex:outputText>
                                                </td>
                                            </tr>
                                        </table>
                                    </apex:outputPanel>


                                    <div class="bs table-responsive"  style="padding-top: 0.5em;">
                                        <table class="bs table table-condensed" style="margin-bottom: 0; "  >
                                            <thead>
                                            <tr>
                                                <th  style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  "  >
                                                </th>
                                                <th style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:20%;')}  " >{!$ObjectType.ASI_MFM_Sub_brand__c.Label}</th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}"  >{!$Label.ASI_CRM_CN_Grade}</th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}"  >
                                                    {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                                </th>
                                                <th colspan="2" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Others','','display:none;')}"  >

                                                </th>

                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && (PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && isPOModi || PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand') && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}">

                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && !isPOModi && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}">
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Monthly_QTY_StdBottle}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && (PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && isPOModi || PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand') && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}">
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && !isPOModi && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}">
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Monthly_QTY_StdBottle}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}"  >
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}"  >
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}"  >
                                                    <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Contract_BRSF_Per_Bottle__c.Label}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}">
                                                    <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Est_BRSF_Per_Bottle__c.Label}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Ladder','','display:none;')}"  >
                                                    <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Min_Purchase_Target__c.Label}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Tax','','display:none;')}"  >
                                                    <apex:outputText escape="false" value="{!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Max_Purchase_Target__c.Label}"/>
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Tax)'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Ladder)' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    {!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Contract_Purchase_Value__c.Label}
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Tax)'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Ladder)' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    {!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Estimate_Purchase_Value__c.Label}
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && contains(PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name, 'Rebate%') && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    {!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Rebate_Percent__c.Label}
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Reach X get Y' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    {!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Target__c.Label}
                                                </th>
                                                <th style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Reach X get Y','','display:none')}">
                                                    {!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Rebate__c.Label}
                                                </th>
                                                <th>
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                                </th>
                                                <th>
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <apex:variable value="{!0}" var="PSFEstMonthlyQty"/>
                                            <apex:variable value="{!0}" var="PSFContractMonthlyQty"/>
                                            <apex:variable value="{!0}" var="PSFEstTotalQty"/>
                                            <apex:variable value="{!0}" var="PSFContractTotalQty"/>
                                            <apex:variable value="{!0}" var="PSFEstBRSFPerBottle"/>
                                            <apex:variable value="{!0}" var="PSFContractBRSFPerBottle"/>
                                            <apex:variable value="{!0}" var="PSFEstTotalQTYCR12"/>
                                            <apex:variable value="{!0}" var="PSFContractTotalQTYCR12"/>
                                            <apex:variable value="{!0}" var="PSFEstTotal"/>
                                            <apex:variable value="{!0}" var="PSFContractTotal"/>
                                            <apex:variable value="{!0}" var="TotalContractPurchaseValue"/>
                                            <apex:variable value="{!0}" var="TotalEstimatePurchaseValue"/>

                                            <apex:repeat value="{!PSF_Item_Map[itm].DetailLineMap}"  var="line" id="lineItem" >
                                                <apex:variable var="PSFEstMonthlyQty" value="{!PSFEstMonthlyQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                <apex:variable var="PSFContractMonthlyQty" value="{!PSFContractMonthlyQty+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>

                                                <apex:variable var="PSFContractTotalQty"
                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c!=null}"
                                                               value="{!PSFContractTotalQty+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>
                                                <apex:variable var="PSFEstTotalQty"
                                                               rendered="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c!=null}"
                                                               value="{!PSFEstTotalQty+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>

                                                <apex:variable var="PSFEstTotalQTYCR12" value="{!PSFEstTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>
                                                <apex:variable var="PSFContractTotalQTYCR12" value="{!PSFContractTotalQTYCR12+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>
                                                <apex:variable var="PSFEstTotal" value="{!PSFEstTotal+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                <apex:variable var="PSFContractTotal" value="{!PSFContractTotal+PSF_Item_Map[itm].DetailLineMap[Line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                <apex:variable value="{!TotalContractPurchaseValue+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Purchase_Value__c}" var="TotalContractPurchaseValue"/>
                                                <apex:variable value="{!TotalEstimatePurchaseValue+PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Estimate_Purchase_Value__c}" var="TotalEstimatePurchaseValue"/>

                                                <tr>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Total','','display:none;')}  ">
                                                    </td>

                                                    <td >
                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;width:20%;')}  " >
                                                            <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Sub_Brand__c}"
                                                            />
                                                        </div>
                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Category','','display:none;')}  " >
                                                            <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Product_Category__c}">
                                                                {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}</apex:outputLink>
                                                        </div>
                                                        <div style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','','display:none;')}  " >
                                                            {!$Label.ASI_CRM_CN_By_Total}
                                                        </div>
                                                    </td>

                                                    <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;width:5%;')}  " >
                                                        <apex:outputLink value="/{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Sub_Brand_Grade__c}">
                                                            {!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Line_Name__c}
                                                        </apex:outputLink>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && !isPOModi,'','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Monthly_Qty__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td id="ASI_CRM_Contract_Total_QTY_std_Btl__c" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && (PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && isPOModi || PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand') && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c }"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand'  && !isPOModi,'','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Monthly_Qty__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td id="ASI_CRM_Est_Total_QTY_std_Btl__c" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && (PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && isPOModi || PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand') && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c }"/>
                                                        </apex:outputText>
                                                    </td>

                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}"    >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}" >
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>
                                                        </apex:outputText>
                                                    </td>

                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}" styleClass="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c != null && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c != null && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c > PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c,'overPaid','')}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_BRSF_Per_Bottle__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}" styleClass="{!IF(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c != null && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c != null && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c > PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_Max_Incentive__c,'overPaid','')}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_BRSF_Per_Bottle__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Ladder','','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Min_Purchase_Target__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Tax','','display:none;')}">
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Max_Purchase_Target__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Tax)'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Ladder)' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                        <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Purchase_Value__c}"/>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Tax)'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Ladder)' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                        <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Estimate_Purchase_Value__c}"/>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && contains(PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name, 'Rebate%'),'','display:none')}">
                                                        <apex:outputText value="{0, number, 0.00}%" styleClass="{!IF((PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Rebate_Percent__c != null && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Max_Rebate_Percent__c != null && PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Rebate_Percent__c > PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Max_Rebate_Percent__c) || (IsOverContractGuideline && i != 1),'overPaid','')}">
                                                            <apex:param value="{!BLANKVALUE(PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Rebate_Percent__c,0)}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Reach X get Y','','display:none')}">
                                                        <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Target__c}"/>
                                                    </td>
                                                    <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Reach X get Y','','display:none')}">
                                                        <apex:outputField value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Rebate__c}"/>
                                                    </td>
                                                    <td>
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                    <td>
                                                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                            <apex:param value="{!PSF_Item_Map[itm].DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                        </apex:outputText>
                                                    </td>
                                                </tr>
                                            </apex:repeat>

                                            <tr class="table-summary-row" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Others' || (PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c == 'By Total' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Tax)' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Ladder)'),'display:none;','')}">
                                                <td colspan="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Total','1','2')} ">{!$Label.ASI_CRM_CN_TOTMOT_Total_Amount}
                                                </td>
                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                </td>

                                                <td id="{!'TotalPSFContractQty_'+itm}"
                                                    style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && !isPOModi,'','display:none;')}  ">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                        <apex:param value="{!PSFContractMonthlyQty}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td id="{!'TotalPSFEstimateQty_'+itm}"
                                                    style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && !isPOModi,'','display:none;')}  ">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0}">
                                                        <apex:param value="{!PSFEstMonthlyQty}"/>
                                                    </apex:outputText>
                                                </td>

                                                <td id="{!'PSFContractTotalQTY_'+itm}"
                                                    style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && (PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && isPOModi || PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand'),'','display:none;')}  ">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSFContractTotalQty}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td id="{!'PSFEstTotalQTY_'+itm}" style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && (PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand' && isPOModi || PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand'),'','display:none;')}  ">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSFEstTotalQty}"/>
                                                    </apex:outputText>
                                                </td>

                                                <td id="{!'TotalPSFContractTotalQTYCR12_'+itm}"
                                                    style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSFContractTotalQTYCR12}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td id="{!'TotalPSFEstTotalQTYCR12_'+itm}"
                                                    style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c!='By Sub-Brand','','display:none;')}  ">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSFEstTotalQTYCR12}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                </td>
                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','','display:none;')}  ">
                                                </td>
                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Ladder','','display:none;')}">
                                                </td>
                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_Criteria__c == 'By Tax','','display:none;')}">
                                                </td>
                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Tax)'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Ladder)','','display:none')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!TotalContractPurchaseValue}"/>
                                                    </apex:outputText>

                                                </td>
                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Tax)'  && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name != 'Rebate%(By Ladder)','','display:none')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!TotalEstimatePurchaseValue}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td id="{!'PSFRebatePercent'+itm}" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && contains(PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name, 'Rebate%'),'','display:none;')}">
                                                </td>
                                                <td id="{!'PSFTarget'+itm}" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Reach X get Y','','display:none;')}">
                                                </td>
                                                <td id="{!'PSFRebate'+itm}" style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && PSF_Item_Map[itm].Module.ASI_CRM_Methodology__r.Name == 'Reach X get Y','','display:none;')}">
                                                </td>
                                                <td style=" {!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','')}" id="{!'PSFContractTotalPart'+itm}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSFContractTotal}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td style="{!IF(PSF_Item_Map[itm].Module.ASI_CRM_Volume_Base__c=='By Sub-Brand','padding-right: 2em;','')}" id="{!'PSFEstTotalPart_'+itm}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!PSFEstTotal}"/>
                                                    </apex:outputText>
                                                </td>
                                            </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            </apex:repeat>


                            <div style="{!IF(isPOModi && !PSFNoModules,'','display:none; ')} " >
                                <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto; padding-top:0.5em;"   >
                                    <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;font-weight: bold;" title="Adjustment and Grand Total" >
                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_OFF_PSF_Summary_Label}"/>
                                    </div>
                                    <div style="grid-column-start: 2; grid-column-end: 2;  " ></div>
                                </div>
                                <div class="PanelBody" style="width:70%" >
                                    <div class="bs table-responsive" >
                                        <table class="bs table table-condensed" style="margin-bottom: 0; width:100%" >
                                            <tr>
                                                <td  class="PSFAdjLabel" >
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_V0_PSF_Contract_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em; " >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_V0_PSF_Contract_Total__c}"/></apex:outputText>
                                                </td>
                                                <td  class="PSFAdjLabel" title="V0.0 PSF Est. Total">
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Expected_V0_PSF_Estimated_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em; ">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!ContractSelected.ASI_CRM_Expected_V0_PSF_Estimated_Total__c}"/>
                                                    </apex:outputText>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td></td>
                                                <td style="padding-top: 0.8em; " >
                                                </td>
                                                <td class="PSFAdjLabel" >
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Previous_Version_PSF_Est_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em; ">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_Previous_Version_PSF_Est_Total__c}"/></apex:outputText>
                                                </td>
                                            </tr>


                                            <tr>
                                                <td class="PSFAdjLabel" title="Adjustment" >
                                                </td>
                                                <td style="padding-top: 0.8em; " ></td>
                                                <td class="PSFAdjLabel"  title="Adjustment" >
                                                    <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Adjustment}"/>
                                                </td>
                                                <td style="padding-top: 0.4em; " >
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_PSF_Estimate_Adjustment_Amount__c}"/></apex:outputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td  class="PSFAdjLabel" ></td>
                                                <td style="padding-top: 0.8em; " ></td>
                                                <td  class="PSFAdjLabel" title="Expected PSF Est. Total" >
                                                    <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Expected_PSF_Est_Total__c.Label}"/>
                                                </td>
                                                <td style="padding-top: 0.4em; ">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_CN_Expected_PSF_Est_Total__c}"/></apex:outputText>
                                                </td>
                                            </tr>

                                        </table>


                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>

                </apex:outputPanel>

                <!-- Display -->
                <apex:outputPanel rendered="{!!isGroupPo && !IsDolphinContract}" layout="block" styleClass="row">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            {!$Label.ASI_CRM_CN_Display}
                        </div>
                        <div class="panel-body" style="padding: 0.5em">
                            <apex:outputPanel rendered="{!DisplayNoModules}">
                                <div style=" font-weight: bold;">
                                    {!$Label.ASI_CRM_CN_No_Modules_Display}
                                </div>
                            </apex:outputPanel>

                            <apex:variable value="{!0}" var="i"/>
                            <apex:repeat value="{!DisplayListingItemMap}"  var="itm">
                                <apex:variable var="i" value="{!i+1}"/>
                                <apex:variable var="displayListingItem" value="{!DisplayListingItemMap[itm]}"/>


                                <div style="display: grid; grid-template-columns: 10% 90% ; grid-template-rows: auto; padding-top:0.5em;">
                                    <div class="HeaderCss" style="grid-column-start: 1; grid-column-end: 1;">{!$Label.ASI_CRM_CN_Module}-{!i}</div>
                                </div>
                                <div class="PanelBody">
                                    <table class="bs table table-condensed module-header-table">
                                        <tr>
                                            <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Methodology__c.Label}</td>
                                            <td>
                                                <apex:outputField value="{!displayListingItem.Module.ASI_CRM_Methodology__r.Name}" rendered="{!!showCN}"/>
                                                <apex:outputField value="{!displayListingItem.Module.ASI_CRM_Methodology__r.ASI_CRM_Chinese_Name__c} " rendered="{!showCN}"/>
                                            </td>
                                            <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}</td>
                                            <td>
                                                <apex:outputField value="{!displayListingItem.Module.ASI_CRM_Volume_Base__c}"/>
                                            </td>
                                            <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Remark__c.Label}</td>
                                            <td>{!displayListingItem.Module.ASI_CRM_Remark__c}</td>
                                        </tr>
                                        <tr>
                                            <td>{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Unit__c.Label}</td>
                                            <td>
                                                <apex:outputField value="{!displayListingItem.Module.ASI_CRM_Unit__c}"/>
                                            </td>
                                            <td>
                                                <apex:outputText value="{!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_CN_Minimal_Achievement__c.Label}" rendered="{!displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Reach X get Y' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others'}"/>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, 0}%" rendered="{!displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Reach X get Y' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others'}">
                                                    <apex:param value="{!displayListingItem.Module.ASI_CRM_CN_Minimal_Achievement__c}"/>
                                                </apex:outputText>
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                            </td>
                                        </tr>
                                    </table>


                                    <table class="bs table table-condensed data-table">
                                        <thead>
                                        <tr>
                                            <th style="{!IF(displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                {!$ObjectType.ASI_CRM_Module__c.Fields.ASI_CRM_Volume_Base__c.Label}
                                            </th>
                                            <th style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_StdBottle}"/>
                                            </th>
                                            <th style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_StdBottle}"/>
                                            </th>
                                            <th style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total_QTY_CR12Eqv}"/>
                                            </th>
                                            <th style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total_QTY_CR12Eqv}"/>
                                            </th>
                                            <th style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                {!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Contract_Purchase_Value__c.Label}
                                            </th>
                                            <th style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Value base'  && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                {!$ObjectType.ASI_CRM_CN_Contract_BRSF_Line_Item__c.Fields.ASI_CRM_CN_Estimate_Purchase_Value__c.Label}
                                            </th>
                                            <th>
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Contract_Total}"/>
                                            </th>
                                            <th>
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Estimate_Total}"/>
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        <apex:repeat value="{!displayListingItem.DetailLineMap}" var="line" id="lineItem">


                                            <tr>
                                                <td style="{!IF(displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    {!$Label.ASI_CRM_CN_By_Total}
                                                </td>
                                                <td style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!displayListingItem.DetailLineMap[line].ASI_CRM_Contract_Total_QTY_std_Btl__c}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!displayListingItem.DetailLineMap[line].ASI_CRM_Est_Total_QTY_std_Btl__c}"/>
                                                    </apex:outputText>
                                                </td>

                                                <td style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!displayListingItem.DetailLineMap[line].ASI_CRM_Contract_Total_QTY_CR12_Eqv__c}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Volume base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!displayListingItem.DetailLineMap[line].ASI_CRM_Est_Total_QTY_CR12_Eqv__c}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!displayListingItem.DetailLineMap[line].ASI_CRM_CN_Contract_Purchase_Value__c}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td style="{!IF(displayListingItem.Module.ASI_CRM_CN_KPI_Base__c == 'Value base' && displayListingItem.Module.ASI_CRM_Methodology__r.Name != 'Others','','display:none')}">
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!displayListingItem.DetailLineMap[line].ASI_CRM_CN_Estimate_Purchase_Value__c}"/>
                                                    </apex:outputText>
                                                </td>

                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!displayListingItem.DetailLineMap[line].ASI_CRM_CN_Contract_Total_Dummy__c}"/>
                                                    </apex:outputText>
                                                </td>
                                                <td>
                                                    <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                        <apex:param value="{!displayListingItem.DetailLineMap[line].ASI_CRM_CN_Est_Total_Dummy__c}"/>
                                                    </apex:outputText>

                                                </td>
                                            </tr>
                                        </apex:repeat>


                                        </tbody>

                                    </table>


                                </div>

                            </apex:repeat>
                            <!--Display Summary total-->
                            <div style="{!IF(isPOModi && !DisplayNoModules,'','display:none; ')} " >
                                <div style="display: grid; grid-template-columns: 20% 80% ; grid-template-rows: auto; padding-top:0.5em;"   >
                                    <div class="HeaderCss"  style="grid-column-start: 1; grid-column-end: 1;font-weight: bold;" title="Adjustment and Grand Total" >
                                        <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_OFF_Display_Summary_Label}"/>
                                    </div>
                                </div>
                                <div class="PanelBody" style="width:70%" >
                                    <table class="bs table table-condensed" style="margin-bottom: 0; width:100%" >
                                        <tr>
                                            <td  class="PSFAdjLabel" >
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_V0_Display_Contract_Total__c.Label}"/>
                                            </td>
                                            <td style="padding-top: 0.4em; " >
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_CN_V0_Display_Contract_Total__c}"/></apex:outputText>
                                            </td>
                                            <td  class="PSFAdjLabel" title="V0.0 PSF Est. Total">
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Expected_V0_Display_Est_Total__c.Label}"/>
                                            </td>
                                            <td style="padding-top: 0.4em; ">
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                    <apex:param value="{!ContractSelected.ASI_CRM_CN_Expected_V0_Display_Est_Total__c}"/>
                                                </apex:outputText>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td class="PSFAdjLabel" >
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_Prev_Version_Display_Est_Total__c.Label}"/>
                                            </td>
                                            <td id="DisplayGrandEstimateTotalBeforeAdjustmentId">
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_Prev_Version_Display_Est_Total__c}"/></apex:outputText>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td class="PSFAdjLabel"  title="Adjustment" >
                                                <apex:outputText escape="false" value="{!$Label.ASI_CRM_CN_Adjustment}"/>
                                            </td>
                                            <td id="DisplayAdjustmentAmountId">
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_Display_Estimate_Adjustment_Amt__c}"/></apex:outputText>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td  class="PSFAdjLabel" title="Expected PSF Est. Total" >
                                                <apex:outputText value="{!$ObjectType.ASI_TH_CRM_Contract__c.Fields.ASI_CRM_CN_Expected_Display_Est_Total__c.Label}"/>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractSelected.ASI_CRM_CN_Expected_Display_Est_Total__c}"/></apex:outputText>
                                            </td>
                                        </tr>

                                    </table>



                                </div>
                            </div>

                        </div>
                    </div>

                </apex:outputPanel>

                <!-- Other Cost -->
                <apex:outputPanel rendered="{!!isGroupPo}" layout="block" styleClass="row">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            {!$Label.ASI_CRM_CN_Other_Cost}
                        </div>
                        <div class="panel-body" style="padding: 0.5em" >

                            <div class="bs table-responsive" >
                                <table class="bs table table-condensed" style="margin-bottom: 0;" >
                                    <thead>
                                    <tr>
                                        <th></th>
                                        <th style="{!IF(IsDolphinContract,'','display:none;')}"><apex:outputText value="{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Contract_Amount_Rate__c.Label}" /></th>
                                        <th><apex:outputText value="{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Contract_Amount__c.Label}" /></th>
                                        <th style="{!IF(IsDolphinContract,'','display:none;')}"><apex:outputText value="{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Estimate_Amount_Rate__c.Label}" /></th>
                                        <th><apex:outputText value="{!$ObjectType.ASI_CRM_Contract_Cost__c.Fields.ASI_CRM_CN_Estimate_Amount__c.Label}" /></th>
                                    </tr>
                                    </thead>
                                    <apex:variable value="{!0}" var="ContractAmount"/>
                                    <apex:variable value="{!0}" var="EstimateAmount"/>
                                    <apex:variable value="{!0}" var="ContractAmountRate"/>
                                    <apex:variable value="{!0}" var="EstimateAmountRate"/>
                                    <tbody>
                                    <apex:repeat value="{!LFixCost}" var="FCLine">
                                        <apex:variable var="ContractAmount" value="{!ContractAmount+FCLine.ASI_CRM_CN_Contract_Amount__c}"/>
                                        <apex:variable var="EstimateAmount" value="{!EstimateAmount+FCLine.ASI_CRM_CN_Estimate_Amount__c}"/>
                                        <apex:variable var="ContractAmountRate" value="{!ContractAmountRate+FCLine.ASI_CRM_CN_Contract_Amount_Rate__c}"/>
                                        <apex:variable var="EstimateAmountRate" value="{!EstimateAmountRate+FCLine.ASI_CRM_CN_Estimate_Amount_Rate__c}"/>
                                        <tr>
                                            <td>
                                                <apex:outputField value="{!FCLine.Name}"  rendered="{!!showCN}" />
                                                <apex:outputField value="{!FCLine.ASI_CRM_CN_Chinese_Description__c}"  rendered="{!showCN}" />
                                            </td>
                                            <td style="{!IF(IsDolphinContract,'','display:none;')}">
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}%" styleClass="{!IF(IsOverContractGuideline,'overPaid','')}">
                                                    <apex:param value="{!FCLine.ASI_CRM_CN_Contract_Amount_Rate__c}"/>
                                                </apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                    <apex:param value="{!FCLine.ASI_CRM_CN_Contract_Amount__c}"/>
                                                </apex:outputText>
                                            </td>
                                            <td style="{!IF(IsDolphinContract,'','display:none;')}">
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}%" styleClass="{!IF(IsOverEstGuideline,'overPaid','')}">
                                                    <apex:param value="{!FCLine.ASI_CRM_CN_Estimate_Amount_Rate__c}"/>
                                                </apex:outputText>
                                            </td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                    <apex:param value="{!FCLine.ASI_CRM_CN_Estimate_Amount__c}"/>
                                                </apex:outputText>
                                            </td>
                                        </tr>
                                    </apex:repeat>
                                    </tbody>
                                    <tr class="table-summary-row">
                                        <td>{!$Label.ASI_CRM_CN_TOTMOT_Total_Amount}
                                        </td>
                                        <td style="{!IF(IsDolphinContract,'','display:none;')}">
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}%" styleClass="{!IF(IsOverContractGuideline,'overPaid','')}">
                                                <apex:param value="{!ContractAmountRate}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!ContractAmount}"/></apex:outputText>
                                        </td>
                                        <td style="{!IF(IsDolphinContract,'','display:none;')}">
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}%" styleClass="{!IF(IsOverEstGuideline,'overPaid','')}">
                                                <apex:param value="{!EstimateAmountRate}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!EstimateAmount}"/></apex:outputText>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>


                </apex:outputPanel>


                <!-- Covered outlets -->
                <div class="row" style="{!IF(ShowCoveredOutlet,'','display:none;')}">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            {!$Label.ASI_CRM_CN_Covered_Outlet}
                        </div>
                        <div class="panel-body" style="padding: 0.5em" >
                            <span>{!$Label.ASI_CRM_CN_No_Covered_Outlet}: {!numberOfCoveredOutlets}</span>

                            <table class="bs table table-condensed" style="margin-bottom: 0; " >
                                <thead>
                                <tr>
                                    <th title="Outlet">
                                        {!$Label.ASI_CRM_CN_Outlet}
                                    </th>
                                    <th>{!$ObjectType.ASI_CRM_CN_Covered_Outlet__c .Fields.ASI_CRM_CN_Target_Volume_9L__c.Label}</th>
                                    <th>{!$ObjectType.ASI_CRM_CN_Covered_Outlet__c .Fields.ASI_CRM_CN_Target_Value__c.Label}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <apex:repeat value="{!ContractOutletList}" var="ContractOutletLine" >
                                    <tr>
                                        <td>
                                            <apex:outputField value="{!ContractOutletLine.ASI_CRM_CN_Outlet__r.ASI_CRM_Account__c}"/>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                <apex:param value="{!ContractOutletLine.ASI_CRM_CN_Target_Volume_9L__c}"/></apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                                                <apex:param value="{!ContractOutletLine.ASI_CRM_CN_Target_Value__c}"/></apex:outputText>
                                        </td>
                                    </tr>
                                </apex:repeat>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>


                <div class="row  "  style="{!IF(ShowPaymentList,'','display:none;')}"  >
                    <div class="col">
                        <div class="panel panel-primary">
                            <div class="panel-heading" title="Historical Payment Details" >
                                {!$Label.ASI_CRM_CN_Historical_Payment_Details}
                            </div>
                            <div class="panel-body" style="padding: 0.5em" >
                                <div class="bs table-responsive" style="padding-top: 0.5em;" >
                                    <table class="bs table table-condensed" style="margin-bottom: 0; " >
                                        <thead>
                                        <tr>
                                            <th>{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.Name.Label}</th>
                                            <th>{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_TH_CRM_Status__c.Label}</th>
                                            <th>{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Payment_Raised_Date__c.Label}</th>
                                            <th>{!$ObjectType.ASI_TH_CRM_PaymentRequest__c.Fields.ASI_CRM_CN_Total_Payment__c.Label}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <apex:variable value="{!0}" var="TotalPaymentAmount"/>
                                        <apex:repeat value="{!PaymentRequestList}" var="PaymentRequest" >
                                            <apex:variable var="TotalPaymentAmount" value="{!TotalPaymentAmount+PaymentRequest.ASI_CRM_CN_Total_Payment__c}"/>

                                            <tr>
                                                <td>
                                                    <apex:outputLink value="/{!PaymentRequest.id}">{!PaymentRequest.Name}</apex:outputLink>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!PaymentRequest.ASI_TH_CRM_Status__c}"/>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!PaymentRequest.ASI_CRM_CN_Payment_Raised_Date__c}"/>
                                                </td>

                                                <td>
                                                    <apex:outputField value="{!PaymentRequest.ASI_CRM_CN_Total_Payment__c}"/>

                                                </td>
                                            </tr>
                                        </apex:repeat>
                                        </tbody>

                                        <tr class="table-summary-row">
                                            <td>{!$Label.ASI_CRM_CN_TOTMOT_Total_Amount}
                                            </td>
                                            <td></td>
                                            <td></td>
                                            <td>
                                                <apex:outputText value="{0, number, ###,###,###,###,##0.00}"><apex:param value="{!TotalPaymentAmount}"/></apex:outputText>
                                            </td>
                                        </tr>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>




                <apex:actionstatus id="ActionStatus">
                    <apex:facet name="start">
                        <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                                                                             height: 100%; width:100%; opacity:0.65;">
                            <div class="waitingHolder" id="loadtext" style="position: absolute;" align="left" valign="top">
                                &nbsp;&nbsp;&nbsp;
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                                <span class="waitingDescription">Please Wait...</span>
                            </div>
                        </div>
                    </apex:facet>
                </apex:actionstatus>



            </div>

        </div>




    </apex:form>

    <!-- Child POs -->
    <apex:relatedList subject="{!pageid}" list="Contracts3__r" rendered="{!isGroupPo}"/>

    <apex:relatedList id="Attachments" subject="{!pageid}" list="CombinedAttachments"/>
    <apex:relatedList id="Approval" list="ProcessSteps" subject="{!pageid}" />

    <apex:relatedList id="ApprovalComment" subject="{!pageid}" list="Contract_Approval_Comments__r" />
</apex:page>