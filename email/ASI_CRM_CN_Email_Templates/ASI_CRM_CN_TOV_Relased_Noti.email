<messaging:emailTemplate subject="TOV <{!relatedTo.ASI_CRM_SO_Number__c}> from {!IF(ISNULL(relatedTo.ASI_CRM_SF_SO_Request_Number__c),'Free Goods Request','Sales Order Request')} -<{!IF(ISNULL(relatedTo.ASI_CRM_SF_SO_Request_Number__c),relatedTo.ASI_CRM_Free_Goods_Request__r.Name,relatedTo.ASI_CRM_SF_SO_Request_Number__r.Name)}> / Customer ({!relatedTo.ASI_CRM_Customer_Name__c}) has been {!relatedTo.ASI_CRM_Status__c}" recipientType="User" relatedToType="ASI_CRM_TOV__c"><messaging:htmlEmailBody ><head><style>    @page {    @bottom-left{        content: element(a);    }    @bottom-right {        padding : 10px;        font-size : 3px;        content: counter(pages);    }        size:portrait;        margin-top: 1cm;    }        table tr td{        page-break-inside: avoid;    }    div.totalQTY{        padding-bottom : 20px;        display: block;        position: running(a);    }</style></head>To view the detail, click this link <a href="{!LEFT($Api.Partner_Server_URL_140, FIND(".com/",$Api.Partner_Server_URL_140)+3)}/{!relatedto.id}">{!LEFT($Api.Partner_Server_URL_140, FIND(".com/",$Api.Partner_Server_URL_140)+3)}/{!relatedto.id}</a><br/>To view the PDF version, click this link<a href="{!LEFT($Api.Partner_Server_URL_140, FIND(".com/",$Api.Partner_Server_URL_140)+3)}/apex/ASI_CRM_CN_TOV_PDF?&amp;id={!relatedto.id}">{!LEFT($Api.Partner_Server_URL_140, FIND(".com/",$Api.Partner_Server_URL_140)+3)}/apex/ASI_CRM_CN_TOV_PDF?&amp;id={!relatedto.id}</a><br/><br/><table border="1"><tr><td width="50%">{!IF(ISNULL(relatedTo.ASI_CRM_SF_SO_Request_Number__c),'Free Goods Request Number','Sales Order Request Number')}</td><td width="50%">{!IF(ISNULL(relatedTo.ASI_CRM_SF_SO_Request_Number__c),relatedTo.ASI_CRM_Free_Goods_Request__r.Name,relatedTo.ASI_CRM_SF_SO_Request_Number__r.Name)}</td></tr><tr><td>Customer</td><td>{!relatedTo.ASI_CRM_Customer_Name__c}</td></tr><tr><td>JDE Code</td><td>{!relatedTo.ASI_CRM_Customer_Code__c}</td></tr><tr><td>TOV Number</td><td>{!relatedTo.ASI_CRM_SO_Number__c}</td></tr><tr><td>Invoice Amount</td><td style="text-align: right;"><apex:outputText value="{0, number, ###,###,##0.00}" ><apex:param value="{!ROUND(relatedTo.ASI_CRM_CN_JDE_Total_Amount__c * 1.13, 2)}" /></apex:outputText></td></tr></table></messaging:htmlEmailBody><messaging:attachment renderAs="PDF" filename="{!relatedTo.ASI_CRM_SO_Number__c}" ><c:ASI_CRM_CN_TOV_PDF_Comp headerId="{!relatedTo.id}" /></messaging:attachment></messaging:emailTemplate>