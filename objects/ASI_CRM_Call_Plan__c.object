<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionOverrides>
        <actionName>Accept</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Accept</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Accept</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>CancelEdit</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>CancelEdit</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>CancelEdit</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Clone</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Clone</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Clone</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Delete</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Delete</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Delete</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Edit</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Edit</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Edit</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>List</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>List</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>List</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>New</actionName>
        <content>ASI_CRM_JP_CallPlanRedirectPage</content>
        <skipRecordTypeSelect>false</skipRecordTypeSelect>
        <type>Visualforce</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>New</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>New</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>SaveEdit</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>SaveEdit</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>SaveEdit</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Tab</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Tab</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Tab</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>View</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>View</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>View</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <allowInChatterGroups>false</allowInChatterGroups>
    <compactLayoutAssignment>SYSTEM</compactLayoutAssignment>
    <deploymentStatus>Deployed</deploymentStatus>
    <description>ASI CRM - Call Plan. The following countries are using this object:
-PRJ</description>
    <enableActivities>false</enableActivities>
    <enableBulkApi>true</enableBulkApi>
    <enableFeeds>false</enableFeeds>
    <enableHistory>true</enableHistory>
    <enableLicensing>false</enableLicensing>
    <enableReports>true</enableReports>
    <enableSearch>true</enableSearch>
    <enableSharing>true</enableSharing>
    <enableStreamingApi>true</enableStreamingApi>
    <externalSharingModel>Private</externalSharingModel>
    <fields>
        <fullName>ASI_CRM_Approved__c</fullName>
        <defaultValue>false</defaultValue>
        <externalId>false</externalId>
        <label>Approved</label>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Approver_1__c</fullName>
        <deleteConstraint>SetNull</deleteConstraint>
        <externalId>false</externalId>
        <label>Sys_Approver 1</label>
        <referenceTo>User</referenceTo>
        <relationshipName>Visitation_Plans</relationshipName>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Lookup</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Call_Plan_Period__c</fullName>
        <externalId>false</externalId>
        <formula>TEXT(ASI_CRM_Period_From__c) &amp; &apos; ~ &apos; &amp;  TEXT(ASI_CRM_Period_To__c)</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Call Plan Period</label>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>ASI_CRM_No_of_Achieved__c</fullName>
        <externalId>false</externalId>
        <label>No. of Achieved</label>
        <summaryFilterItems>
            <field>ASI_CRM_Call_Detail__c.ASI_CRM_Status__c</field>
            <operation>equals</operation>
            <value>Achieved</value>
        </summaryFilterItems>
        <summaryForeignKey>ASI_CRM_Call_Detail__c.ASI_CRM_Call_Plan__c</summaryForeignKey>
        <summaryOperation>count</summaryOperation>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Summary</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_No_of_Ad_hoc__c</fullName>
        <externalId>false</externalId>
        <label>No. of Ad-hoc</label>
        <summaryFilterItems>
            <field>ASI_CRM_Call_Detail__c.ASI_CRM_Ad_hoc__c</field>
            <operation>equals</operation>
            <value>True</value>
        </summaryFilterItems>
        <summaryForeignKey>ASI_CRM_Call_Detail__c.ASI_CRM_Call_Plan__c</summaryForeignKey>
        <summaryOperation>count</summaryOperation>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Summary</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_No_of_Cancelled__c</fullName>
        <externalId>false</externalId>
        <label>No. of Cancelled</label>
        <summaryFilterItems>
            <field>ASI_CRM_Call_Detail__c.ASI_CRM_Status__c</field>
            <operation>equals</operation>
            <value>Cancelled</value>
        </summaryFilterItems>
        <summaryForeignKey>ASI_CRM_Call_Detail__c.ASI_CRM_Call_Plan__c</summaryForeignKey>
        <summaryOperation>count</summaryOperation>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Summary</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_No_of_Draft__c</fullName>
        <externalId>false</externalId>
        <label>No. of Draft</label>
        <summaryFilterItems>
            <field>ASI_CRM_Call_Detail__c.ASI_CRM_Status__c</field>
            <operation>equals</operation>
            <value>Draft</value>
        </summaryFilterItems>
        <summaryForeignKey>ASI_CRM_Call_Detail__c.ASI_CRM_Call_Plan__c</summaryForeignKey>
        <summaryOperation>count</summaryOperation>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Summary</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_No_of_Planned__c</fullName>
        <externalId>false</externalId>
        <label>No. of Planned</label>
        <summaryFilterItems>
            <field>ASI_CRM_Call_Detail__c.ASI_CRM_Status__c</field>
            <operation>equals</operation>
            <value>Planned</value>
        </summaryFilterItems>
        <summaryForeignKey>ASI_CRM_Call_Detail__c.ASI_CRM_Call_Plan__c</summaryForeignKey>
        <summaryOperation>count</summaryOperation>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Summary</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_No_of_TnE_Created__c</fullName>
        <externalId>false</externalId>
        <label>No. of TnE Created</label>
        <summaryFilterItems>
            <field>ASI_CRM_Call_Detail__c.ASI_CRM_Status__c</field>
            <operation>equals</operation>
            <value>TnE Created</value>
        </summaryFilterItems>
        <summaryForeignKey>ASI_CRM_Call_Detail__c.ASI_CRM_Call_Plan__c</summaryForeignKey>
        <summaryOperation>count</summaryOperation>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Summary</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Period_From__c</fullName>
        <externalId>false</externalId>
        <label>Period From</label>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Date</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Period_To__c</fullName>
        <externalId>false</externalId>
        <label>Period To</label>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Date</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Sales_Group__c</fullName>
        <externalId>false</externalId>
        <label>Sales Group</label>
        <length>20</length>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>ASI_CRM_Staff_Code__c</fullName>
        <externalId>false</externalId>
        <formula>Owner:User.ASI_TnE_Sub_Ledger__c</formula>
        <label>Staff Code</label>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>ASI_CRM_Sys_Allow_Set_Draft__c</fullName>
        <externalId>false</externalId>
        <formula>IF( CONTAINS($Setup.ASI_JP_Validation_Bypass__c.ASI_JP_Object_API__c, &apos;ASI_CRM_Call_Plan__c&apos;),  $Setup.ASI_JP_Validation_Bypass__c.ASI_JP_Bybass_Validation__c , false)</formula>
        <label>Sys_Allow Set Draft</label>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Sys_Allow_Submit_Approval__c</fullName>
        <defaultValue>false</defaultValue>
        <externalId>false</externalId>
        <label>Sys_Allow Submit Approval</label>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Sys_Fiscal_Year__c</fullName>
        <externalId>false</externalId>
        <formula>IF( MONTH(ASI_CRM_Period_From__c ) &gt;= 7 , &quot;FY&quot; &amp; RIGHT(TEXT(YEAR(ASI_CRM_Period_From__c )), 2) &amp; RIGHT(TEXT(YEAR(ASI_CRM_Period_From__c ) + 1), 2) , &quot;FY&quot; &amp; RIGHT(TEXT(YEAR(ASI_CRM_Period_From__c ) - 1), 2) &amp; RIGHT(TEXT(YEAR(ASI_CRM_Period_From__c )), 2))</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Sys_Fiscal Year</label>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>ASI_CRM_Sys_In_Approval__c</fullName>
        <defaultValue>false</defaultValue>
        <externalId>false</externalId>
        <label>Sys_In Approval</label>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Sys_Is_Real_Time_Print__c</fullName>
        <defaultValue>false</defaultValue>
        <externalId>false</externalId>
        <label>Sys_Is Real Time Print</label>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Sys_Ref_Period_From__c</fullName>
        <externalId>false</externalId>
        <label>Sys_Ref Period From</label>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Date</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Sys_Ref_Period_To__c</fullName>
        <externalId>false</externalId>
        <label>Sys_Ref Period To</label>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Date</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_Sys_Trigger_Time__c</fullName>
        <externalId>false</externalId>
        <formula>NOW() - 0.038</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Sys_Trigger Time</label>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>DateTime</type>
    </fields>
    <fields>
        <fullName>ASI_CRM_TnE_Number__c</fullName>
        <deleteConstraint>SetNull</deleteConstraint>
        <externalId>false</externalId>
        <label>TnE Number</label>
        <lookupFilter>
            <active>true</active>
            <filterItems>
                <field>ASI_TnE_ClaimHeader__c.ASI_TnE_Status__c</field>
                <operation>equals</operation>
                <value>Draft</value>
            </filterItems>
            <isOptional>true</isOptional>
        </lookupFilter>
        <referenceTo>ASI_TnE_ClaimHeader__c</referenceTo>
        <relationshipLabel>Call Plans</relationshipLabel>
        <relationshipName>Visitation_Plans</relationshipName>
        <required>false</required>
        <trackHistory>false</trackHistory>
        <trackTrending>false</trackTrending>
        <type>Lookup</type>
    </fields>
    <label>Call Plan</label>
    <listViews>
        <fullName>ASI_CRM_JP_All_Call_Plans</fullName>
        <columns>NAME</columns>
        <columns>RECORDTYPE</columns>
        <columns>ASI_CRM_Period_From__c</columns>
        <columns>ASI_CRM_Period_To__c</columns>
        <columns>ASI_CRM_Approved__c</columns>
        <columns>ASI_CRM_TnE_Number__c</columns>
        <columns>LAST_UPDATE</columns>
        <filterScope>Everything</filterScope>
        <filters>
            <field>RECORDTYPE</field>
            <operation>equals</operation>
            <value>ASI_CRM_Call_Plan__c.ASI_CRM_JP_Call_Plan,ASI_CRM_Call_Plan__c.ASI_CRM_JP_Call_Plan_Locked</value>
        </filters>
        <label>All JP Call Plans</label>
        <language>en_US</language>
        <sharedTo>
            <group>ASI_CRM_JP_All_Users</group>
        </sharedTo>
    </listViews>
    <listViews>
        <fullName>ASI_CRM_JP_My_Call_Plans</fullName>
        <columns>NAME</columns>
        <columns>RECORDTYPE</columns>
        <columns>ASI_CRM_Period_From__c</columns>
        <columns>ASI_CRM_Period_To__c</columns>
        <columns>ASI_CRM_Approved__c</columns>
        <columns>LAST_UPDATE</columns>
        <filterScope>Mine</filterScope>
        <filters>
            <field>RECORDTYPE</field>
            <operation>equals</operation>
            <value>ASI_CRM_Call_Plan__c.ASI_CRM_JP_Call_Plan,ASI_CRM_Call_Plan__c.ASI_CRM_JP_Call_Plan_Locked</value>
        </filters>
        <label>My JP Call Plans</label>
        <language>en_US</language>
        <sharedTo>
            <group>ASI_CRM_JP_All_Users</group>
        </sharedTo>
    </listViews>
    <nameField>
        <label>Call Plan Name</label>
        <trackHistory>false</trackHistory>
        <type>Text</type>
    </nameField>
    <pluralLabel>Call Plans</pluralLabel>
    <recordTypeTrackHistory>true</recordTypeTrackHistory>
    <recordTypes>
        <fullName>ASI_CRM_JP_Call_Plan</fullName>
        <active>true</active>
        <label>JP Call Plan</label>
    </recordTypes>
    <recordTypes>
        <fullName>ASI_CRM_JP_Call_Plan_Locked</fullName>
        <active>true</active>
        <label>JP Call Plan Locked</label>
    </recordTypes>
    <searchLayouts>
        <customTabListAdditionalFields>ASI_CRM_Period_From__c</customTabListAdditionalFields>
        <customTabListAdditionalFields>ASI_CRM_Period_To__c</customTabListAdditionalFields>
        <customTabListAdditionalFields>ASI_CRM_Staff_Code__c</customTabListAdditionalFields>
        <customTabListAdditionalFields>ASI_CRM_Sales_Group__c</customTabListAdditionalFields>
        <customTabListAdditionalFields>ASI_CRM_Approved__c</customTabListAdditionalFields>
        <lookupDialogsAdditionalFields>ASI_CRM_Period_From__c</lookupDialogsAdditionalFields>
        <lookupDialogsAdditionalFields>ASI_CRM_Period_To__c</lookupDialogsAdditionalFields>
        <lookupDialogsAdditionalFields>ASI_CRM_Staff_Code__c</lookupDialogsAdditionalFields>
        <lookupDialogsAdditionalFields>ASI_CRM_Sales_Group__c</lookupDialogsAdditionalFields>
        <lookupDialogsAdditionalFields>ASI_CRM_Approved__c</lookupDialogsAdditionalFields>
        <lookupDialogsAdditionalFields>OWNER.ALIAS</lookupDialogsAdditionalFields>
        <searchFilterFields>NAME</searchFilterFields>
        <searchFilterFields>ASI_CRM_Period_From__c</searchFilterFields>
        <searchFilterFields>ASI_CRM_Period_To__c</searchFilterFields>
        <searchFilterFields>ASI_CRM_Staff_Code__c</searchFilterFields>
        <searchFilterFields>ASI_CRM_Sales_Group__c</searchFilterFields>
        <searchFilterFields>ASI_CRM_Approved__c</searchFilterFields>
        <searchFilterFields>OWNER.ALIAS</searchFilterFields>
        <searchResultsAdditionalFields>ASI_CRM_Period_From__c</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>ASI_CRM_Period_To__c</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>ASI_CRM_Staff_Code__c</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>ASI_CRM_Sales_Group__c</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>ASI_CRM_Approved__c</searchResultsAdditionalFields>
        <searchResultsAdditionalFields>OWNER.ALIAS</searchResultsAdditionalFields>
    </searchLayouts>
    <sharingModel>Private</sharingModel>
    <validationRules>
        <fullName>ASI_CRM_JP_Period_Date_Validation</fullName>
        <active>true</active>
        <description>Check if Period To is greater than Period From</description>
        <errorConditionFormula>(ASI_CRM_Period_From__c &gt; ASI_CRM_Period_To__c) &amp;&amp; (CONTAINS( RecordType.DeveloperName, &quot;ASI_CRM_JP&quot;))</errorConditionFormula>
        <errorDisplayField>ASI_CRM_Period_From__c</errorDisplayField>
        <errorMessage>&quot;Period From&quot; must not be greater than &quot;Period To&quot;</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>ASI_CRM_JP_Period_From_DateTooLarge</fullName>
        <active>true</active>
        <errorConditionFormula>RecordType.DeveloperName=&apos;ASI_CRM_JP_Call_Plan&apos; &amp;&amp; ASI_CRM_Sys_Ref_Period_From__c &lt; ASI_CRM_Period_From__c &amp;&amp;  ISCHANGED(ASI_CRM_Period_From__c)</errorConditionFormula>
        <errorDisplayField>ASI_CRM_Period_From__c</errorDisplayField>
        <errorMessage>You cannot change Period From to this date. There is Call(s) in this Plan with date earlier than this date.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>ASI_CRM_JP_Period_To_DateTooEarly</fullName>
        <active>true</active>
        <errorConditionFormula>RecordType.DeveloperName=&apos;ASI_CRM_JP_Call_Plan&apos; &amp;&amp;  ASI_CRM_Sys_Ref_Period_To__c &gt; ASI_CRM_Period_To__c &amp;&amp; ISCHANGED(ASI_CRM_Period_To__c)</errorConditionFormula>
        <errorDisplayField>ASI_CRM_Period_To__c</errorDisplayField>
        <errorMessage>You cannot change Period To to this date. There is Call(s) in this Plan with date later than this date.</errorMessage>
    </validationRules>
    <visibility>Public</visibility>
    <webLinks>
        <fullName>ASI_CRM_JP_Call_Planned</fullName>
        <availability>online</availability>
        <displayType>button</displayType>
        <linkType>javascript</linkType>
        <masterLabel>Call Planned</masterLabel>
        <openType>onClickJavaScript</openType>
        <protected>false</protected>
        <url>{!requireScript(&quot;/soap/ajax/30.0/connection.js&quot;)} 
sforce.connection.sessionId = &quot;{!$Api.Session_ID}&quot;; 

var currentHeader = sforce.connection.query(&quot;Select Id,ASI_CRM_Sys_In_Approval__c from ASI_CRM_Call_Plan__c where Id = &apos;{!ASI_CRM_Call_Plan__c.Id}&apos;&quot;); 

var currentHeaderDetails = sforce.connection.query(&quot;Select Id, ASI_CRM_Status__c, ASI_CRM_Planned_Amount__c from ASI_CRM_Call_Detail__c where ASI_CRM_Call_Plan__c = &apos;{!ASI_CRM_Call_Plan__c.Id}&apos; &quot;); 

var limitDetail = sforce.connection.query(&quot;Select ASI_CRM_Threshold__c From ASI_CRM_Route_Type__c Where ASI_CRM_Module__c = &apos;Call Plan&apos;&quot;);

var limit = Math.round(limitDetail.getArray(&quot;records&quot;)[0].ASI_CRM_Threshold__c);

var Header = currentHeader.getArray(&quot;records&quot;); 
var detailRecords = currentHeaderDetails.getArray(&quot;records&quot;); 
var exceedMax = false; 
var noItem = true;
var toConfirm = false;

if ({!ASI_CRM_Call_Plan__c.ASI_CRM_Sys_In_Approval__c} == false){
for (var i = 0; i &lt; detailRecords.length; i++) 
{ 
    if (detailRecords[i].ASI_CRM_Planned_Amount__c &gt; limit &amp;&amp; {!ASI_CRM_Call_Plan__c.ASI_CRM_Approved__c} == false) { 
        exceedMax = true; 
    } 
    noItem = false; 
} 


if (noItem == true) { 
    alert(&quot;{!$Label.ASI_CRM_JP_EmptyPlanDetailWarning}&quot;);
    }else if (exceedMax == true) { 
    alert(&quot;{!$Label.ASI_CRM_JP_PlanDetailNeedApprovalWarning} &quot;+limit); 
    }else{
    toConfirm = true;
}

if(toConfirm){
    window.open(&quot;apex/ASI_CRM_JP_ConfirmPlanPage?id={!ASI_CRM_Call_Plan__c.Id}&quot;,&quot;_self&quot;);
}
}</url>
    </webLinks>
    <webLinks>
        <fullName>ASI_CRM_JP_Create_TnE</fullName>
        <availability>online</availability>
        <displayType>button</displayType>
        <height>600</height>
        <linkType>page</linkType>
        <masterLabel>Create TnE</masterLabel>
        <openType>noSidebar</openType>
        <page>ASI_CRM_JP_CallPlanCreateTnE_Page</page>
        <protected>false</protected>
    </webLinks>
    <webLinks>
        <fullName>ASI_CRM_JP_PDF</fullName>
        <availability>online</availability>
        <displayType>button</displayType>
        <hasMenubar>false</hasMenubar>
        <hasScrollbars>true</hasScrollbars>
        <hasToolbar>false</hasToolbar>
        <height>600</height>
        <isResizable>true</isResizable>
        <linkType>page</linkType>
        <masterLabel>PDF</masterLabel>
        <openType>newWindow</openType>
        <page>ASI_CRM_JP_CallPlanPDFPage</page>
        <position>none</position>
        <protected>false</protected>
        <showsLocation>false</showsLocation>
        <showsStatus>false</showsStatus>
    </webLinks>
    <webLinks>
        <fullName>ASI_CRM_JP_Print_Payment</fullName>
        <availability>online</availability>
        <displayType>button</displayType>
        <hasMenubar>false</hasMenubar>
        <hasScrollbars>true</hasScrollbars>
        <hasToolbar>false</hasToolbar>
        <height>600</height>
        <isResizable>true</isResizable>
        <linkType>page</linkType>
        <masterLabel>Print Payment</masterLabel>
        <openType>newWindow</openType>
        <page>ASI_CRM_JP_PrintPaymentPage</page>
        <position>none</position>
        <protected>false</protected>
        <showsLocation>false</showsLocation>
        <showsStatus>false</showsStatus>
    </webLinks>
    <webLinks>
        <fullName>ASI_CRM_JP_Set_Status_Draft</fullName>
        <availability>online</availability>
        <displayType>button</displayType>
        <linkType>javascript</linkType>
        <masterLabel>Set Status Draft</masterLabel>
        <openType>onClickJavaScript</openType>
        <protected>false</protected>
        <url>//alert({!ASI_CRM_Call_Plan__c.ASI_CRM_Sys_Allow_Set_Draft__c});
if({!ASI_CRM_Call_Plan__c.ASI_CRM_Sys_Allow_Set_Draft__c} == true){
window.open(&quot;apex/ASI_CRM_JP_SetCallPlanDraftPage?id={!ASI_CRM_Call_Plan__c.Id}&quot;,&quot;_self&quot;);
}else{
alert(&apos;{!$Label.ASI_CRM_JP_SetStatusDraftWarning}&apos;); 
}</url>
    </webLinks>
    <webLinks>
        <fullName>ASI_CRM_JP_Submit_For_Plan_Approval</fullName>
        <availability>online</availability>
        <displayType>button</displayType>
        <linkType>javascript</linkType>
        <masterLabel>Submit for Approval</masterLabel>
        <openType>onClickJavaScript</openType>
        <protected>false</protected>
        <url>{!requireScript(&quot;/soap/ajax/30.0/connection.js&quot;)} 
sforce.connection.sessionId = &quot;{!$Api.Session_ID}&quot;; 

var currentHeader = sforce.connection.query(&quot;Select Id from ASI_CRM_Call_Plan__c where Id = &apos;{!ASI_CRM_Call_Plan__c.Id}&apos;&quot;); 

var currentHeaderDetails = sforce.connection.query(&quot;Select Id, ASI_CRM_Status__c, ASI_CRM_Planned_Amount__c from ASI_CRM_Call_Detail__c where ASI_CRM_Status__c = &apos;Draft&apos; And ASI_CRM_Call_Plan__c = &apos;{!ASI_CRM_Call_Plan__c.Id}&apos; &quot;);  

var ownerId = &apos;{!ASI_CRM_Call_Plan__c.OwnerId}&apos;;
var createdById = &apos;{!ASI_CRM_Call_Plan__c.CreatedById}&apos;;
var currentUserId = &apos;{!$User.Id}&apos;;
var isCorrectUser = true;
if(currentUserId != ownerId &amp;&amp; currentUserId != createdById){
isCorrectUser = false;
}

var records = currentHeader.getArray(&quot;records&quot;); 
var detailRecords = currentHeaderDetails.getArray(&quot;records&quot;); 
var exceedMax = false;
var noItem = true;
var confirmRst = false;
var forceApproval = false;

var limitDetail = sforce.connection.query(&quot;Select ASI_CRM_Threshold__c From ASI_CRM_Route_Type__c Where ASI_CRM_Module__c = &apos;Call Plan&apos;&quot;);

var limit = Math.round(limitDetail.getArray(&quot;records&quot;)[0].ASI_CRM_Threshold__c);

for (var i = 0; i &lt; detailRecords.length; i++) { 
    if (detailRecords[i].ASI_CRM_Planned_Amount__c &gt; limit) { 
        exceedMax = true; 
    } 
    noItem = false;
} 


if (isCorrectUser == false){
    alert(&quot;{!$Label.ASI_CRM_JP_NotCorrectUser}&quot;);
}else if(noItem == true) { 
    alert(&quot;{!$Label.ASI_CRM_JP_EmptyPlanDetailWarning}&quot;); 
}else if (exceedMax == false) {
    confirmRst  = confirm(&quot;{!$Label.ASI_CRM_JP_PlanDetailNoNeedApprovalWarning} &quot;+limit);
    if(confirmRst == true){forceApproval = true;}
    else{;} 
}

if((forceApproval || exceedMax) &amp;&amp; isCorrectUser){
var rec = new sforce.SObject(&apos;ASI_CRM_Call_Plan__c&apos;); 
rec.Id = &quot;{!ASI_CRM_Call_Plan__c.Id}&quot;; 
rec.ASI_CRM_Sys_Allow_Submit_Approval__c = true; 
result = sforce.connection.update([rec]); 
window.open(&quot;/apex/ASI_SubmitApprovalPage?id={!ASI_CRM_Call_Plan__c.Id}&quot;,&quot;_self&quot;);  
}</url>
    </webLinks>
</CustomObject>
